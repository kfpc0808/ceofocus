<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê³ ê° ê´€ë¦¬ - Executive Consulting Solution</title>
  
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <!-- CryptoJS for ì•”í˜¸í™” -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
  <!-- Daum Postcode API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  
  <!-- SheetJS for Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <!-- Kakao Maps API -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=1ada66397913195f6a7512567faa5fac&libraries=services"></script>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      min-height: 100vh;
      padding: 1rem;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .header h1 {
      color: #fff;
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
      justify-content: center;
    }
    
    .btn {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      text-decoration: none;
      white-space: nowrap;
    }
    
    .btn-back {
      background: rgba(255,255,255,0.15);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .btn-back:hover {
      background: rgba(255,255,255,0.25);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
      color: #fff;
      box-shadow: 0 4px 12px rgba(255,136,2,0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255,136,2,0.4);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.9);
      color: #0c2c54;
    }
    
    .btn-secondary:hover {
      background: #fff;
    }
    
    .btn-map {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: #fff;
    }
    
    .btn-map:hover {
      transform: translateY(-2px);
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      color: #fff;
    }
    
    .stat-card h3 {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 0.5rem;
    }
    
    .stat-card .number {
      font-size: 2rem;
      font-weight: 700;
    }
    
    .controls {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .controls-top {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1;
      min-width: 250px;
      position: relative;
    }
    
    .search-box input {
      width: 100%;
      padding: 0.8rem 1rem 0.8rem 2.5rem;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 0.95rem;
    }
    
    .search-box input::placeholder {
      color: rgba(255,255,255,0.6);
    }
    
    .search-icon {
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
    }
    
    .controls-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .btn-google-drive {
      background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
      color: #fff;
      box-shadow: 0 4px 12px rgba(66,133,244,0.3);
    }
    
    .btn-google-drive:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(66,133,244,0.4);
    }
    
    .btn-delete-selected {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
      display: none;
    }
    
    .btn-delete-selected.show {
      display: inline-flex;
    }
    
    .btn-send-selected {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      display: none;
    }
    
    .btn-send-selected.show {
      display: inline-flex;
    }
    
    .table-container {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      overflow-x: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1500px;
    }
    
    thead {
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      color: #fff;
    }
    
    th {
      padding: 0.8rem 0.5rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.85rem;
      white-space: nowrap;
    }
    
    th:first-child {
      width: 40px;
      text-align: center;
    }
    
    th:nth-child(2) {
      width: 50px;
      text-align: center;
    }
    
    td {
      padding: 0.5rem;
      border-bottom: 1px solid #e2e8f0;
      color: #334155;
      font-size: 0.85rem;
      vertical-align: middle;
    }
    
    tbody tr:hover {
      background: #f8fafc;
    }
    
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .action-btns {
      display: flex;
      gap: 0.25rem;
      flex-wrap: nowrap;
    }
    
    .btn-icon {
      padding: 0.35rem 0.5rem;
      border: 1px solid;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.7rem;
      font-weight: 600;
      background: #fff;
      white-space: nowrap;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 45px;
    }
    
    .btn-icon:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .btn-view { 
      color: #3b82f6; 
      border-color: #3b82f6;
    }
    .btn-view:hover {
      background: #eff6ff;
    }
    
    .btn-edit { 
      color: #10b981; 
      border-color: #10b981;
    }
    .btn-edit:hover {
      background: #f0fdf4;
    }
    
    .btn-delete { 
      color: #ef4444; 
      border-color: #ef4444;
    }
    .btn-delete:hover {
      background: #fef2f2;
    }
    
    .btn-ceo { 
      color: #FF8802; 
      border-color: #FF8802;
    }
    .btn-ceo:hover {
      background: #fff7ed;
    }
    
    .btn-fm { 
      color: #8b5cf6; 
      border-color: #8b5cf6;
    }
    .btn-fm:hover {
      background: #faf5ff;
    }
    
    .btn-call { 
      color: #06b6d4; 
      border-color: #06b6d4;
      padding: 0.3rem 0.4rem;
      min-width: 35px;
    }
    .btn-call:hover {
      background: #ecfeff;
    }
    
    .btn-send {
      color: #10b981;
      border-color: #10b981;
      padding: 0.3rem 0.5rem;
      min-width: 45px;
    }
    .btn-send:hover {
      background: #f0fdf4;
    }
    
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      padding: 2rem;
      overflow-y: auto;
    }
    
    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: #fff;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      color: #fff;
      border-radius: 16px 16px 0 0;
    }
    
    .modal-header h2 {
      font-size: 1.3rem;
    }
    
    .close-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: 0.2s;
    }
    
    .close-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.2rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #334155;
      font-size: 0.9rem;
    }
    
    .required::after {
      content: ' *';
      color: #ef4444;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: 0.2s;
    }
    
    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #94a3b8;
      font-size: 0.85rem;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #FF8802;
      box-shadow: 0 0 0 3px rgba(255,136,2,0.1);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .phone-inputs {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    
    .phone-prefix {
      padding: 0.7rem 1rem;
      background: #f1f5f9;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-weight: 600;
      color: #475569;
    }
    
    .phone-inputs input {
      flex: 1;
      text-align: center;
    }
    
    .address-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .address-group input {
      flex: 1;
    }
    
    .btn-address {
      padding: 0.7rem 1.2rem;
      background: #475569;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .btn-address:hover {
      background: #334155;
    }
    
    .calendar-type {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    
    .calendar-type label {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-weight: normal;
      cursor: pointer;
    }
    
    .anniversary-input {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .anniversary-input input[type="text"] {
      flex: 1;
    }
    
    .anniversary-input input[type="date"] {
      flex: 2;
    }
    
    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid #e2e8f0;
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }
    
    .btn-cancel {
      background: #e2e8f0;
      color: #475569;
    }
    
    .btn-cancel:hover {
      background: #cbd5e1;
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #64748b;
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    .loading {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading.hide { display: none; }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      color: #fff;
      margin-top: 1rem;
      font-size: 1rem;
    }
    
    .spreadsheet-container {
      overflow-x: auto;
      margin: 1rem 0;
    }
    
    .spreadsheet {
      border-collapse: collapse;
      width: 100%;
      min-width: 1200px;
    }
    
    .spreadsheet th,
    .spreadsheet td {
      border: 1px solid #cbd5e1;
      padding: 0.5rem;
    }
    
    .spreadsheet th {
      background: #f1f5f9;
      font-weight: 600;
      color: #475569;
      position: sticky;
      top: 0;
      font-size: 0.85rem;
    }
    
    .spreadsheet input,
    .spreadsheet select {
      width: 100%;
      border: none;
      padding: 0.3rem;
      background: transparent;
    }
    
    .spreadsheet input::placeholder {
      color: #94a3b8;
      font-size: 0.8rem;
    }
    
    .spreadsheet input:focus,
    .spreadsheet select:focus {
      outline: 2px solid #FF8802;
      background: #fff;
    }

    .map-modal-content {
      max-width: 90%;
      max-height: 90vh;
    }

    #clientMap {
      width: 100%;
      height: 70vh;
      border-radius: 8px;
    }
    
    #mapInfo {
      margin-top: 1rem;
      padding: 0.8rem;
      background: #f1f5f9;
      border-radius: 8px;
      color: #334155;
      font-size: 0.9rem;
    }
    
    
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }
      
      .header {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }
      
      .header h1 {
        justify-content: center;
        font-size: 1.5rem;
      }
      
      .btn-back {
        position: static !important;
        width: 100%;
      }
      
      .stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }
      
      .stat-card {
        padding: 1rem;
      }
      
      .stat-card h3 {
        font-size: 0.8rem;
      }
      
      .stat-card .number {
        font-size: 1.5rem;
      }
      
      /* âœ… ëª¨ë°”ì¼ ì§€ë„ - ê±°ì˜ ì „ì²´ í™”ë©´ìœ¼ë¡œ! */
      .map-modal-content {
        max-width: 100% !important;
        max-height: 100vh !important;
        margin: 0 !important;
        border-radius: 0 !important;
      }
      
      .map-modal-content .modal-body {
        padding: 0.3rem !important;
      }
      
      .map-modal-content .modal-header {
        padding: 0.8rem 1rem !important;
      }
      
      .map-modal-content .modal-header h2 {
        font-size: 1.1rem !important;
      }
      
      #clientMap {
        height: calc(100vh - 150px) !important;
        min-height: 500px !important;
        border-radius: 0 !important;
      }
      
      #mapInfo {
        padding: 0.4rem !important;
        font-size: 0.7rem !important;
        margin-top: 0.3rem !important;
      }
      
      .controls {
        padding: 1rem;
      }
      
      .controls-top {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .search-box {
        min-width: 100%;
      }
      
      .controls-buttons {
        flex-wrap: wrap;
        gap: 0.4rem;
      }
      
      .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
        gap: 0.2rem;
      }
      
      .table-container {
        font-size: 0.85rem;
      }
      
      .modal-content {
        max-width: 95%;
        margin: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div class="loading-text">êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ê²° ì¤‘...</div>
  </div>

  <!-- ëª¨ë°”ì¼ ë””ë²„ê·¸ ë¡œê·¸ (ì§€ë„ ë¬¸ì œ í•´ê²°ìš©) -->
  <div id="mobileDebug" style="display:none; position:fixed; bottom:0; left:0; right:0; background:rgba(0,0,0,0.9); color:#0f0; padding:10px; max-height:200px; overflow-y:auto; z-index:99999; font-size:11px; font-family:monospace;">
    <button onclick="document.getElementById('mobileDebug').style.display='none'" style="position:absolute; top:5px; right:5px; background:#f00; color:#fff; border:none; padding:5px 10px; cursor:pointer;">ë‹«ê¸°</button>
    <div id="debugLog"></div>
  </div>

  <div class="container">
    <div class="header">
      <a href="index.html" class="btn btn-back" style="position: absolute; left: 1.5rem;">â† ëŒì•„ê°€ê¸°</a>
      <h1>ğŸ¢ ê³ ê° ê´€ë¦¬</h1>
    </div>

    <div class="stats">
      <div class="stat-card">
        <h3>ì´ ê³ ê°</h3>
        <div class="number" id="totalClients">0</div>
      </div>
      <div class="stat-card" onclick="filterBySangryeong('next')" style="cursor: pointer;">
        <h3>ìµì›” ìƒë ¹ì¼</h3>
        <div class="number" id="nextMonthSangryeong">0</div>
      </div>
      <div class="stat-card" onclick="filterBySangryeong('afternext')" style="cursor: pointer;">
        <h3>ìµìµì›” ìƒë ¹ì¼</h3>
        <div class="number" id="afterNextMonthSangryeong">0</div>
      </div>
      <div class="stat-card">
        <h3>ìƒì¼ ì˜ˆì •</h3>
        <div class="number" id="upcomingBirthdays">0</div>
      </div>
      <div class="stat-card">
        <h3>ê¸°ë…ì¼ ì˜ˆì •</h3>
        <div class="number" id="upcomingAnniversaries">0</div>
      </div>
    </div>

    <div class="controls">
      <div class="controls-top">
        <div class="search-box">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="searchInput" placeholder="ì´ë¦„, íšŒì‚¬ëª…, ì—°ë½ì²˜ë¡œ ê²€ìƒ‰...">
        </div>
      </div>
      <div class="controls-buttons">
        <button class="btn btn-google-drive" onclick="handleGoogleDriveConnect()">ğŸ”— êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ë™</button>
        <button class="btn btn-primary" onclick="openAddModal()">â• ê³ ê° ì¶”ê°€</button>
        <button class="btn btn-secondary" onclick="openBulkUploadModal()">ğŸ“¥ ë‹¨ì²´ ë“±ë¡</button>
        <button class="btn btn-secondary" onclick="exportToExcel()">ğŸ“¤ ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-map" onclick="openMapModal()">ğŸ—ºï¸ ì§€ë„ì—ì„œ ë³´ê¸°</button>
        <button class="btn btn-delete-selected" id="deleteSelectedBtn" onclick="deleteSelected()">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
        <button class="btn btn-send-selected" id="sendSelectedBtn" onclick="sendToSelected()">ğŸ“§ ì„ íƒ ë°œì†¡</button>
      </div>
    </div>

    <div class="table-container">
      <table id="clientsTable">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)"></th>
            <th>No</th>
            <th>ê³ ê°ëª…</th>
            <th>ì§í•¨</th>
            <th>í˜¸ì¹­</th>
            <th>ì—°ë½ì²˜</th>
            <th>íšŒì‚¬ëª…</th>
            <th>ì§ì—…</th>
            <th>ì£¼ì†Œ</th>
            <th>ìœ„ë„</th>
            <th>ê²½ë„</th>
            <th>ì¢Œí‘œ</th>
            <th>ì‹¤ì œìƒì¼</th>
            <th>ìƒë ¹ì¼</th>
            <th>ë“±ë¡ì¼</th>
            <th style="min-width: 280px;">í”„ë¡œê·¸ë¨</th>
            <th>ë°œì†¡</th>
          </tr>
        </thead>
        <tbody id="clientsTableBody">
          <tr>
            <td colspan="17" class="empty-state">
              <div class="empty-state-icon">ğŸ“‹</div>
              <div>ë“±ë¡ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.<br/>ê³ ê°ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ê³ ê° ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal" id="clientModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">â• ê³ ê° ì¶”ê°€</h2>
        <button class="close-btn" onclick="closeModal('clientModal')">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="clientForm">
          <div class="form-group">
            <label class="required">ê³ ê°ëª…</label>
            <input type="text" id="clientName" required placeholder="í™ê¸¸ë™">
          </div>
          
          <div class="form-group">
            <label>ì§í•¨</label>
            <input type="text" id="clientTitle" placeholder="ê³¼ì¥, íŒ€ì¥, ëŒ€í‘œì´ì‚¬ ë“±">
          </div>
          
          <div class="form-group">
            <label>í˜¸ì¹­</label>
            <input type="text" id="clientHonorific" value="ë‹˜" placeholder="ë‹˜">
          </div>
          
          <div class="form-group">
            <label class="required">ì—°ë½ì²˜</label>
            <div class="phone-inputs">
              <span class="phone-prefix">010</span>
              <span>-</span>
              <input type="text" id="phone1" maxlength="4" required placeholder="1234" inputmode="numeric">
              <span>-</span>
              <input type="text" id="phone2" maxlength="4" required placeholder="5678" inputmode="numeric">
            </div>
          </div>
          
          <div class="form-group">
            <label class="required">ì£¼ì†Œ</label>
            <div class="address-group">
              <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸ (ì§ì ‘ì…ë ¥ ë˜ëŠ” ê²€ìƒ‰)" autocomplete="off">
              <button type="button" class="btn btn-secondary" onclick="searchAddress()" style="flex-shrink: 0;">ğŸ” ì£¼ì†Œ ê²€ìƒ‰</button>
            </div>
            <input type="text" id="address" placeholder="ê¸°ë³¸ì£¼ì†Œ (ì˜ˆ: ì„œìš¸ ì†¡íŒŒêµ¬ ìœ„ë¡€ì„œë¡œ 252)" required style="margin-bottom:0.5rem;" autocomplete="off">
            <input type="text" id="detailAddress" placeholder="ìƒì„¸ì£¼ì†Œ (ì˜ˆ: 101ë™ 1001í˜¸, ê±´ë¬¼ëª… ë“±)" required autocomplete="off">
            <div style="margin-top:0.5rem; padding:0.5rem; background:#f0f9ff; border:1px solid #bae6fd; border-radius:6px; font-size:0.85rem;">
              <div style="color:#0369a1; font-weight:600; margin-bottom:0.3rem;">ğŸ“ ì¢Œí‘œ (ìë™ ë³€í™˜)</div>
              <div id="coordinatesDisplay" style="color:#0c4a6e;">ì£¼ì†Œ ì…ë ¥ í›„ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>
          </div>
          
          <div class="form-group">
            <label>íšŒì‚¬ëª…</label>
            <input type="text" id="company" placeholder="(ì£¼)ABC">
          </div>
          
          <div class="form-group">
            <label>ì§ì—…</label>
            <input type="text" id="job" placeholder="ëŒ€í‘œì´ì‚¬">
          </div>
          
          <div class="form-group">
            <label>ìƒë…„ì›”ì¼</label>
            <input type="date" id="birthDate" onchange="updateSangryeongDisplay()">
            <div id="sangryeongDisplay" style="margin-top: 0.5rem; padding: 0.5rem; background: #FFF9E6; border-radius: 4px; color: #FF8802; font-weight: 600; display: none;">
              ğŸ“… ìƒë ¹ì¼: <span id="sangryeongValue"></span>
            </div>
          </div>
          
          <div class="form-group">
            <label>ì‹¤ì œìƒì¼</label>
            <input type="date" id="birthday">
            <div class="calendar-type">
              <label>
                <input type="radio" name="birthdayType" value="solar" checked> â˜€ï¸ ì–‘ë ¥
              </label>
              <label>
                <input type="radio" name="birthdayType" value="lunar"> ğŸŒ™ ìŒë ¥
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label>ê¸°ë…ì¼</label>
            <div class="anniversary-input">
              <input type="text" id="anniversaryName" placeholder="í•­ëª©ëª… (ì˜ˆ: ê²°í˜¼ê¸°ë…ì¼)">
              <input type="date" id="anniversary">
            </div>
          </div>
          
          <div class="form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" id="email" placeholder="example@email.com">
          </div>
          
          <div class="form-group">
            <label>ë©”ëª¨</label>
            <textarea id="memo" placeholder="ë©”ëª¨ ì‚¬í•­"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-cancel" onclick="closeModal('clientModal')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveClient()">ğŸ’¾ ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ë‹¨ì²´ ë“±ë¡ ëª¨ë‹¬ -->
  <div class="modal" id="bulkUploadModal">
    <div class="modal-content" style="max-width: 95%; max-height: 95vh;">
      <div class="modal-header">
        <h2>ğŸ“¥ ë‹¨ì²´ ê³ ê° ë“±ë¡</h2>
        <button class="close-btn" onclick="closeModal('bulkUploadModal')">Ã—</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom: 1rem;">
          <label class="btn btn-secondary" style="cursor: pointer;">
            ğŸ“‚ ì—‘ì…€ íŒŒì¼ ì„ íƒ
            <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" style="display:none;" onchange="handleFileUpload(event)">
          </label>
          <span style="margin: 0 1rem; color: #64748b;">ë˜ëŠ”</span>
          <button class="btn btn-secondary" onclick="initSpreadsheet()">ğŸ“‹ ì§ì ‘ ì…ë ¥</button>
        </div>
        
        <div id="spreadsheetContainer" style="display:none;">
          <div class="spreadsheet-container">
            <table class="spreadsheet" id="spreadsheet">
              <thead>
                <tr>
                  <th>ê³ ê°ëª…*</th>
                  <th>ì§í•¨</th>
                  <th>í˜¸ì¹­</th>
                  <th>ì—°ë½ì²˜*</th>
                  <th>ì£¼ì†Œ*</th>
                  <th>ìƒì„¸ì£¼ì†Œ*</th>
                  <th>íšŒì‚¬ëª…</th>
                  <th>ì§ì—…</th>
                  <th>ìƒë…„ì›”ì¼</th>
                  <th>ìƒë ¹ì¼</th>
                  <th>ì‹¤ì œìƒì¼</th>
                  <th>ì–‘/ìŒë ¥</th>
                  <th>ê¸°ë…ì¼ëª…</th>
                  <th>ê¸°ë…ì¼</th>
                  <th>ì´ë©”ì¼</th>
                  <th>ë©”ëª¨</th>
                </tr>
              </thead>
              <tbody id="spreadsheetBody">
              </tbody>
            </table>
          </div>
          <div style="margin-top: 1rem;">
            <button class="btn btn-secondary" onclick="addSpreadsheetRow()">â• í–‰ ì¶”ê°€</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-cancel" onclick="closeModal('bulkUploadModal')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveBulkClients()">ğŸ’¾ ì¼ê´„ ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
  <div class="modal" id="viewModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ‘¤ ê³ ê° ìƒì„¸ì •ë³´</h2>
        <button class="close-btn" onclick="closeModal('viewModal')">Ã—</button>
      </div>
      <div class="modal-body" id="viewModalBody">
      </div>
      <div class="modal-footer">
        <button class="btn btn-cancel" onclick="closeModal('viewModal')">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ì§€ë„ ëª¨ë‹¬ -->
  <div class="modal" id="mapModal">
    <div class="modal-content map-modal-content">
      <div class="modal-header">
        <h2>ğŸ—ºï¸ ê³ ê° ì§€ë„</h2>
        <button class="close-btn" onclick="closeModal('mapModal')">Ã—</button>
      </div>
      <div class="modal-body" style="padding: 0.5rem;">
        <div id="clientMap"></div>
        <div id="mapInfo">
          <strong>ğŸ“ ë§ˆì»¤ ì •ë³´:</strong>
          <span id="markerCount">ë¡œë”© ì¤‘...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ì£¼ì†Œ ê²€ìƒ‰ ë ˆì´ì–´ -->

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDbufefZCVqCY8QQppcdQFoqVFpMriv1m0",
      authDomain: "kfpc-company-support-project.firebaseapp.com",
      projectId: "kfpc-company-support-project"
    };
    
    let auth = null;
    
    // Firebase ì´ˆê¸°í™” (ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œì»¬ ëª¨ë“œë¡œ ì „í™˜)
    try {
      if (typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');
      } else {
        console.warn('âš ï¸ Firebase SDKë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ ëª¨ë“œë¡œ ì‘ë™í•©ë‹ˆë‹¤.');
      }
    } catch (error) {
      console.warn('âš ï¸ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error.message);
      console.log('ğŸ’¾ ë¡œì»¬ ì €ì¥ì†Œ ëª¨ë“œë¡œ ì‘ë™í•©ë‹ˆë‹¤.');
    }
    
    const CLIENT_ID = '288996084140-0eo93heqd66hqhg0fh1rbum6scnt3757.apps.googleusercontent.com';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const ENCRYPTION_KEY = 'KFPC-CEO-FOCUS-MASTER-KEY-2025';
    
    let clients = [];
    let currentEditId = null;
    let currentUser = null;
    let tokenClient;
    let accessToken = null;
    let gisInited = false;
    
    // âœ… ëª¨ë°”ì¼ ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
    function mobileLog(message) {
      const debugDiv = document.getElementById('mobileDebug');
      const logDiv = document.getElementById('debugLog');
      if (debugDiv && logDiv) {
        debugDiv.style.display = 'block';
        const time = new Date().toLocaleTimeString();
        logDiv.innerHTML += `<div>[${time}] ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
      console.log(message); // ì½˜ì†”ì—ë„ ì¶œë ¥
    }
    
    // âœ… ë””ë²„ê·¸ ë¡œê·¸ ì´ˆê¸°í™”
    function clearMobileLog() {
      const logDiv = document.getElementById('debugLog');
      if (logDiv) logDiv.innerHTML = '';
    }
    
    
    
    function encryptData(data) {
      const jsonString = JSON.stringify(data);
      const encrypted = CryptoJS.AES.encrypt(jsonString, ENCRYPTION_KEY);
      return encrypted.toString();
    }
    
    function decryptData(encryptedData) {
      try {
        const decrypted = CryptoJS.AES.decrypt(encryptedData, ENCRYPTION_KEY);
        const jsonString = decrypted.toString(CryptoJS.enc.Utf8);
        return JSON.parse(jsonString);
      } catch (error) {
        console.error('ë³µí˜¸í™” ì˜¤ë¥˜:', error);
        return [];
      }
    }
    
    function saveLoginState() {
      if (accessToken) {
        localStorage.setItem('googleAccessToken', accessToken);
        localStorage.setItem('tokenExpiry', Date.now() + 3600000);
      }
    }
    
    function restoreLoginState() {
      const token = localStorage.getItem('googleAccessToken');
      const expiry = localStorage.getItem('tokenExpiry');
      
      if (token && expiry && Date.now() < parseInt(expiry)) {
        accessToken = token;
        return true;
      }
      
      localStorage.removeItem('googleAccessToken');
      localStorage.removeItem('tokenExpiry');
      return false;
    }
    
    function gisLoaded() {
      console.log('âœ… Google Identity Services ë¡œë“œ');
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '',
      });
      gisInited = true;
      console.log('âœ… Google OAuth ì¤€ë¹„ ì™„ë£Œ');
    }
    
    function initGoogleAPI() {
      let attempts = 0;
      const maxAttempts = 50;
      
      const checkGIS = setInterval(() => {
        attempts++;
        if (typeof google !== 'undefined' && google.accounts) {
          clearInterval(checkGIS);
          gisLoaded();
        } else if (attempts >= maxAttempts) {
          clearInterval(checkGIS);
          console.warn('âš ï¸ Google API ë¡œë“œ ì§€ì—°');
        }
      }, 100);
    }
    
    async function init() {
      document.getElementById('loading').classList.remove('hide');
      document.getElementById('loading').querySelector('.loading-text').textContent = 'ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...';
      
      currentUser = { uid: 'user-' + Date.now() };
      initGoogleAPI();
      
      if (restoreLoginState()) {
        console.log('âœ… ë¡œê·¸ì¸ ìƒíƒœ ë³µì› ì¤‘...');
        document.getElementById('loading').querySelector('.loading-text').textContent = 'ë°ì´í„° ë¡œë“œ ì¤‘...';
        loadClients().then(() => {
          updateStats();
          document.getElementById('loading').classList.add('hide');
          console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        }).catch(err => {
          console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', err);
          document.getElementById('loading').classList.add('hide');
        });
      } else {
        document.getElementById('loading').classList.add('hide');
      }
    }
    


    function handleGoogleDriveConnect() {
      if (!gisInited) {
        alert('Google APIê°€ ì•„ì§ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      showGoogleDriveInfo();
      
      setTimeout(() => {
        console.log('ğŸ” Google ë¡œê·¸ì¸ ì‹œì‘...');
        
        tokenClient.callback = async (resp) => {
          if (resp.error !== undefined) {
            console.error('âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜:', resp);
            alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + resp.error);
            document.getElementById('loading').classList.add('hide');
            return;
          }
          
          accessToken = resp.access_token;
          saveLoginState();
          console.log('âœ… Google ë¡œê·¸ì¸ ì„±ê³µ!');
          
          await loadClients();
          updateStats();
          document.getElementById('loading').classList.add('hide');
          alert('êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ë™ ì™„ë£Œ! âœ…');
        };
        
        if (accessToken === null) {
          tokenClient.requestAccessToken({prompt: 'consent'});
        } else {
          tokenClient.requestAccessToken({prompt: ''});
        }
      }, 2000);
    }
    
    async function findFile(fileName) {
      if (!accessToken) return null;
      
      try {
        const response = await fetch(
          `https://www.googleapis.com/drive/v3/files?q=name='${fileName}' and trashed=false&fields=files(id,name)`,
          {
            headers: {
              'Authorization': `Bearer ${accessToken}`
            }
          }
        );
        
        const data = await response.json();
        
        if (data.files && data.files.length > 0) {
          console.log('âœ… íŒŒì¼ ë°œê²¬:', data.files[0].id);
          return data.files[0];
        }
        
        console.log('â„¹ï¸ íŒŒì¼ ì—†ìŒ');
        return null;
      } catch (error) {
        console.error('âŒ íŒŒì¼ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        return null;
      }
    }
    
    async function downloadFile(fileId) {
      try {
        const response = await fetch(
          `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
          {
            headers: {
              'Authorization': `Bearer ${accessToken}`
            }
          }
        );
        
        return await response.text();
      } catch (error) {
        console.error('âŒ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
        return null;
      }
    }
    
    async function uploadFile(fileName, content) {
      try {
        const metadata = {
          name: fileName,
          mimeType: 'application/octet-stream'
        };
        
        const form = new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
        form.append('file', new Blob([content], { type: 'application/octet-stream' }));
        
        const response = await fetch(
          'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
          {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${accessToken}`
            },
            body: form
          }
        );
        
        return await response.json();
      } catch (error) {
        console.error('âŒ íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        return null;
      }
    }
    
    async function updateFile(fileId, content) {
      try {
        const response = await fetch(
          `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=media`,
          {
            method: 'PATCH',
            headers: {
              'Authorization': `Bearer ${accessToken}`,
              'Content-Type': 'application/octet-stream'
            },
            body: content
          }
        );
        
        return await response.json();
      } catch (error) {
        console.error('âŒ íŒŒì¼ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        return null;
      }
    }
    
    async function loadFromDrive() {
      try {
        const file = await findFile('ê³ ê°ëª©ë¡.fmd');
        
        if (file) {
          const encryptedData = await downloadFile(file.id);
          if (encryptedData) {
            return decryptData(encryptedData);
          }
        }
        
        return [];
      } catch (error) {
        console.error('ë“œë¼ì´ë¸Œ ë¡œë“œ ì˜¤ë¥˜:', error);
        return [];
      }
    }
    
    async function saveToDrive() {
      try {
        const encrypted = encryptData(clients);
        const file = await findFile('ê³ ê°ëª©ë¡.fmd');
        
        if (file) {
          await updateFile(file.id, encrypted);
        } else {
          await uploadFile('ê³ ê°ëª©ë¡.fmd', encrypted);
        }
        
        return true;
      } catch (error) {
        console.error('ë“œë¼ì´ë¸Œ ì €ì¥ ì˜¤ë¥˜:', error);
        return false;
      }
    }
    
    async function loadClients() {
      clients = await loadFromDrive();
      renderTable();
    }
    
    async function saveClients() {
      const success = await saveToDrive();
      if (success) {
        renderTable();
        updateStats();
      } else {
        alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }
    
    function formatPhone(phone) {
      const cleaned = phone.replace(/\D/g, '');
      if (cleaned.length === 11) {
        return cleaned.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
      } else if (cleaned.length === 10) {
        return cleaned.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
      }
      return phone;
    }
    
    function getFullName(client) {
      let fullName = client.name;
      if (client.title) {
        fullName += ' ' + client.title;
      }
      if (client.honorific) {
        fullName += client.honorific;
      }
      return fullName;
    }
    
    function renderTable() {
      const tbody = document.getElementById('clientsTableBody');
      
      if (clients.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="17" class="empty-state">
              <div class="empty-state-icon">ğŸ“‹</div>
              <div>ë“±ë¡ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.<br/>ê³ ê°ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = clients.map((client, index) => `
        <tr>
          <td style="text-align: center;">
            <input type="checkbox" class="client-checkbox" value="${index}" onchange="updateSelectedButtons()">
          </td>
          <td style="text-align: center;"><strong>${index + 1}</strong></td>
          <td><strong>${client.name}</strong></td>
          <td>${client.title || '-'}</td>
          <td>${client.honorific || '-'}</td>
          <td style="white-space: nowrap;">
            ${formatPhone(client.phone)}
            <a href="tel:${client.phone}" class="btn-icon btn-call" title="ì „í™”ê±¸ê¸°">ğŸ“</a>
          </td>
          <td>${client.company || '-'}</td>
          <td>${client.job || '-'}</td>
          <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${client.address}">${client.address}</td>
          <td style="font-size: 0.75rem; color: #059669;" title="ìœ„ë„">${client.latitude ? client.latitude.toFixed(6) : '-'}</td>
          <td style="font-size: 0.75rem; color: #059669;" title="ê²½ë„">${client.longitude ? client.longitude.toFixed(6) : '-'}</td>
          <td style="text-align: center;">${client.latitude && client.longitude ? 'âœ…' : 'âŒ'}</td>
          <td>${client.birthday ? new Date(client.birthday).toLocaleDateString('ko-KR', {month: 'numeric', day: 'numeric'}) : '-'}</td>
          <td style="text-align: center; color: #FF8802; font-weight: 600;">${client.sangryeong || '-'}</td>
          <td>${new Date(client.createdAt).toLocaleDateString('ko-KR', {month: 'numeric', day: 'numeric'})}</td>
          <td>
            <div class="action-btns">
              <button class="btn-icon btn-ceo" onclick="openCEOFocus(${index})" title="CEO Focus">CEO</button>
              <button class="btn-icon btn-fm" onclick="openFM(${index})" title="FM">FM</button>
              <button class="btn-icon btn-view" onclick="viewClient(${index})" title="ìƒì„¸ë³´ê¸°">ë³´ê¸°</button>
              <button class="btn-icon btn-edit" onclick="editClient(${index})" title="ìˆ˜ì •">ìˆ˜ì •</button>
              <button class="btn-icon btn-delete" onclick="deleteClient(${index})" title="ì‚­ì œ">ì‚­ì œ</button>
            </div>
          </td>
          <td style="text-align: center;">
            <button class="btn-icon btn-send" onclick="sendToClient(${index})" title="ë°œì†¡">ë°œì†¡</button>
          </td>
        </tr>
      `).join('');
      
      document.getElementById('selectAll').checked = false;
      updateSelectedButtons();
    }
    
    function updateStats() {
      document.getElementById('totalClients').textContent = clients.length;
      
      const now = new Date();
      const currentMonth = now.getMonth() + 1; // 1-12
      const nextMonth = currentMonth === 12 ? 1 : currentMonth + 1;
      const afterNextMonth = nextMonth === 12 ? 1 : nextMonth + 1;
      
      // ìµì›” ìƒë ¹ì¼ ì¸ì›
      const nextMonthSangryeong = clients.filter(c => {
        if (!c.sangryeong) return false;
        const sangMonth = getSangryeongMonth(c.sangryeong);
        return sangMonth === nextMonth;
      }).length;
      
      // ìµìµì›” ìƒë ¹ì¼ ì¸ì›
      const afterNextMonthSangryeong = clients.filter(c => {
        if (!c.sangryeong) return false;
        const sangMonth = getSangryeongMonth(c.sangryeong);
        return sangMonth === afterNextMonth;
      }).length;
      
      document.getElementById('nextMonthSangryeong').textContent = nextMonthSangryeong;
      document.getElementById('afterNextMonthSangryeong').textContent = afterNextMonthSangryeong;
      
      const today = new Date();
      const in30Days = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
      
      const upcomingBirthdays = clients.filter(c => {
        if (!c.birthday) return false;
        const birthday = new Date(c.birthday);
        const thisYearBirthday = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
        return thisYearBirthday >= today && thisYearBirthday <= in30Days;
      }).length;
      
      const upcomingAnniversaries = clients.filter(c => {
        if (!c.anniversary) return false;
        const anniversary = new Date(c.anniversary);
        const thisYearAnniversary = new Date(today.getFullYear(), anniversary.getMonth(), anniversary.getDate());
        return thisYearAnniversary >= today && thisYearAnniversary <= in30Days;
      }).length;
      
      document.getElementById('upcomingBirthdays').textContent = upcomingBirthdays;
      document.getElementById('upcomingAnniversaries').textContent = upcomingAnniversaries;
    }
    
    function filterBySangryeong(type) {
      const now = new Date();
      const currentMonth = now.getMonth() + 1;
      const nextMonth = currentMonth === 12 ? 1 : currentMonth + 1;
      const afterNextMonth = nextMonth === 12 ? 1 : nextMonth + 1;
      
      const targetMonth = type === 'next' ? nextMonth : afterNextMonth;
      const tbody = document.getElementById('clientsTableBody');
      
      const filtered = clients.filter(c => {
        if (!c.sangryeong) return false;
        const sangMonth = getSangryeongMonth(c.sangryeong);
        return sangMonth === targetMonth;
      });
      
      if (filtered.length === 0) {
        alert(`${type === 'next' ? 'ìµì›”' : 'ìµìµì›”'} ìƒë ¹ì¼ ëŒ€ìƒìê°€ ì—†ìŠµë‹ˆë‹¤.`);
        return;
      }
      
      // í•„í„°ë§ëœ ê²°ê³¼ë§Œ í‘œì‹œ
      tbody.innerHTML = filtered.map((client) => {
        const index = clients.indexOf(client);
        return `
        <tr style="background-color: #FFF9E6;">
          <td style="text-align: center;">
            <input type="checkbox" class="client-checkbox" value="${index}" onchange="updateSelectedButtons()">
          </td>
          <td style="text-align: center;"><strong>${index + 1}</strong></td>
          <td><strong>${client.name}</strong></td>
          <td>${client.title || '-'}</td>
          <td>${client.honorific || '-'}</td>
          <td style="white-space: nowrap;">
            ${formatPhone(client.phone)}
            <a href="tel:${client.phone}" class="btn-icon btn-call" title="ì „í™”ê±¸ê¸°">ğŸ“</a>
          </td>
          <td>${client.company || '-'}</td>
          <td>${client.job || '-'}</td>
          <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${client.address}">${client.address}</td>
          <td style="font-size: 0.75rem; color: #059669;">${client.latitude ? client.latitude.toFixed(6) : '-'}</td>
          <td style="font-size: 0.75rem; color: #059669;">${client.longitude ? client.longitude.toFixed(6) : '-'}</td>
          <td style="text-align: center;">${client.latitude && client.longitude ? 'âœ…' : 'âŒ'}</td>
          <td>${client.birthday ? new Date(client.birthday).toLocaleDateString('ko-KR', {month: 'numeric', day: 'numeric'}) : '-'}</td>
          <td style="text-align: center; color: #FF8802; font-weight: 600; background-color: #FFE5CC;">${client.sangryeong || '-'}</td>
          <td>${new Date(client.createdAt).toLocaleDateString('ko-KR', {month: 'numeric', day: 'numeric'})}</td>
          <td>
            <div class="action-btns">
              <button class="btn-icon btn-ceo" onclick="openCEOFocus(${index})" title="CEO Focus">CEO</button>
              <button class="btn-icon btn-fm" onclick="openFM(${index})" title="FM">FM</button>
              <button class="btn-icon btn-view" onclick="viewClient(${index})" title="ìƒì„¸ë³´ê¸°">ë³´ê¸°</button>
              <button class="btn-icon btn-edit" onclick="editClient(${index})" title="ìˆ˜ì •">ìˆ˜ì •</button>
              <button class="btn-icon btn-delete" onclick="deleteClient(${index})" title="ì‚­ì œ">ì‚­ì œ</button>
            </div>
          </td>
          <td style="text-align: center;">
            <button class="btn-icon btn-send" onclick="sendToClient(${index})" title="ë°œì†¡">ë°œì†¡</button>
          </td>
        </tr>
        `;
      }).join('');
      
      // í•„í„° í•´ì œ ë²„íŠ¼ ì¶”ê°€
      const resetBtn = document.createElement('div');
      resetBtn.style.cssText = 'padding: 1rem; background: #FFF3CD; text-align: center; margin-bottom: 1rem; border-radius: 8px;';
      resetBtn.innerHTML = `
        <strong>ğŸ” ${type === 'next' ? 'ìµì›”' : 'ìµìµì›”'} ìƒë ¹ì¼ ëŒ€ìƒì: ${filtered.length}ëª…</strong>
        <button onclick="renderTable()" style="margin-left: 1rem; padding: 0.5rem 1rem; background: #0c2c54; color: white; border: none; border-radius: 4px; cursor: pointer;">ì „ì²´ ë³´ê¸°</button>
      `;
      tbody.parentElement.parentElement.insertBefore(resetBtn, tbody.parentElement);
      
      updateSelectedButtons();
    }
    
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('show');
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
      if (modalId === 'clientModal') {
        document.getElementById('clientForm').reset();
        document.getElementById('clientHonorific').value = 'ë‹˜';
        currentEditId = null;
      }
    }
    
    // ì£¼ì†Œ ê²€ìƒ‰ ê¸°ëŠ¥
    function searchAddress() {
      new daum.Postcode({
        oncomplete: async function(data) {
          // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ ì…ë ¥
          document.getElementById('postcode').value = data.zonecode;
          
          // ë„ë¡œëª… ì£¼ì†Œ ë˜ëŠ” ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒ
          let addr = '';
          if (data.userSelectedType === 'R') {
            addr = data.roadAddress;
          } else {
            addr = data.jibunAddress;
          }
          
          document.getElementById('address').value = addr;
          
          // ìë™ìœ¼ë¡œ ì¢Œí‘œ ë³€í™˜ ì‹œì‘
          const coordsDisplay = document.getElementById('coordinatesDisplay');
          coordsDisplay.textContent = 'ì¢Œí‘œ ë³€í™˜ ì¤‘...';
          coordsDisplay.style.color = '#f59e0b';
          
          const coords = await getCoordinates(addr);
          
          if (coords.latitude && coords.longitude) {
            coordsDisplay.innerHTML = `<strong>ìœ„ë„:</strong> ${coords.latitude.toFixed(6)} | <strong>ê²½ë„:</strong> ${coords.longitude.toFixed(6)} âœ…`;
            coordsDisplay.style.color = '#059669';
          } else {
            coordsDisplay.textContent = 'âš ï¸ ì¢Œí‘œ ë³€í™˜ ì‹¤íŒ¨ - ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”';
            coordsDisplay.style.color = '#dc2626';
          }
          
          // ìƒì„¸ì£¼ì†Œ ì…ë ¥ë€ì— í¬ì»¤ìŠ¤
          document.getElementById('detailAddress').focus();
        }
      }).open();
    }
    
    function openAddModal() {
      currentEditId = null;
      document.getElementById('modalTitle').textContent = 'â• ê³ ê° ì¶”ê°€';
      document.getElementById('clientForm').reset();
      document.getElementById('clientHonorific').value = 'ë‹˜';
      openModal('clientModal');
    }
    
    // Google Geocoding APIë¥¼ ì‚¬ìš©í•œ ì¢Œí‘œ ë³€í™˜ í•¨ìˆ˜
    async function getCoordinates(address) {
      if (!address || address.trim() === '') {
        console.warn('âš ï¸ ì£¼ì†Œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
        return { latitude: null, longitude: null };
      }
      
      const cleanAddress = address.trim();
      console.log('ğŸ—ºï¸ Kakao Local APIë¡œ ì¢Œí‘œ ë³€í™˜ ì‹œë„:', cleanAddress);
      
      // âœ… Kakao Local API ì‚¬ìš© (ë¬´ë£Œ)
      if (typeof kakao === 'undefined' || !kakao.maps || !kakao.maps.services) {
        console.error('âŒ Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        mobileLog('âŒ ì¢Œí‘œë³€í™˜ ì‹¤íŒ¨: Kakao API ë¯¸ë¡œë“œ');
        return { latitude: null, longitude: null };
      }
      
      return new Promise((resolve) => {
        const geocoder = new kakao.maps.services.Geocoder();
        
        geocoder.addressSearch(cleanAddress, function(result, status) {
          if (status === kakao.maps.services.Status.OK) {
            const lat = parseFloat(result[0].y);
            const lng = parseFloat(result[0].x);
            
            console.log('âœ… ì¢Œí‘œ ë³€í™˜ ì„±ê³µ:', lat, lng);
            console.log('ğŸ“ ìƒì„¸ ì£¼ì†Œ:', result[0].address_name);
            mobileLog(`âœ… ì¢Œí‘œë³€í™˜ ì„±ê³µ: ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
            
            resolve({ 
              latitude: lat, 
              longitude: lng,
              formattedAddress: result[0].address_name
            });
          } else {
            console.warn('âŒ ì¢Œí‘œ ë³€í™˜ ì‹¤íŒ¨ - Status:', status, 'ì£¼ì†Œ:', cleanAddress);
            mobileLog(`âŒ ì¢Œí‘œë³€í™˜ ì‹¤íŒ¨: ${cleanAddress}`);
            resolve({ latitude: null, longitude: null });
          }
        });
      });
    }
    
    function calculateSangryeong(birthDate) {
      if (!birthDate) return '';
      
      // YYYY-MM-DD í˜•ì‹ì—ì„œ ì›”-ì¼ ì¶”ì¶œ
      const parts = birthDate.split('-');
      if (parts.length !== 3) return '';
      
      let month = parseInt(parts[1]);
      let day = parseInt(parts[2]);
      
      // 6ê°œì›” ì „ìœ¼ë¡œ ê³„ì‚°
      month -= 6;
      if (month <= 0) {
        month += 12;
      }
      
      // MM-DD í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
      return `${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    }
    
    function getSangryeongMonth(sangryeong) {
      if (!sangryeong) return null;
      const parts = sangryeong.split('-');
      return parts.length === 2 ? parseInt(parts[0]) : null;
    }
    
    function updateSangryeongDisplay() {
      const birthDate = document.getElementById('birthDate').value;
      const display = document.getElementById('sangryeongDisplay');
      const valueSpan = document.getElementById('sangryeongValue');
      
      if (birthDate) {
        const sangryeong = calculateSangryeong(birthDate);
        if (sangryeong) {
          valueSpan.textContent = sangryeong;
          display.style.display = 'block';
        } else {
          display.style.display = 'none';
        }
      } else {
        display.style.display = 'none';
      }
    }
    


    async function saveClient() {
      const name = document.getElementById('clientName').value.trim();
      const title = document.getElementById('clientTitle').value.trim();
      const honorific = document.getElementById('clientHonorific').value.trim();
      const phone1 = document.getElementById('phone1').value.trim();
      const phone2 = document.getElementById('phone2').value.trim();
      const postcode = document.getElementById('postcode').value.trim();
      const address = document.getElementById('address').value.trim();
      const detailAddress = document.getElementById('detailAddress').value.trim();
      
      if (!name || !phone1 || !phone2 || !address || !detailAddress) {
        alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const phone = `010${phone1}${phone2}`;
      const fullAddress = `${address} ${detailAddress}`;
      const birthdayType = document.querySelector('input[name="birthdayType"]:checked').value;
      
      const loading = document.getElementById('loading');
      loading.classList.remove('hide');
      loading.querySelector('.loading-text').textContent = 'ì €ì¥ ì¤€ë¹„ ì¤‘...';
      
      console.log('\n=== ê³ ê° ì €ì¥: ' + name + ' ===');
      console.log('ê¸°ë³¸ì£¼ì†Œ:', address);
      console.log('ìƒì„¸ì£¼ì†Œ:', detailAddress);
      console.log('ì „ì²´ì£¼ì†Œ:', fullAddress);
      
      let coordinates = { latitude: null, longitude: null };
      
      // Google Geocoding APIë¡œ ì¢Œí‘œ ë³€í™˜
      loading.querySelector('.loading-text').textContent = 'ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜ ì¤‘...';
      coordinates = await getCoordinates(address);
      
      if (coordinates.latitude && coordinates.longitude) {
        console.log('âœ… ì¢Œí‘œ ë³€í™˜ ì„±ê³µ:', coordinates.latitude, coordinates.longitude);
      } else {
        console.warn('âš ï¸ ì¢Œí‘œ ë³€í™˜ ì‹¤íŒ¨ - ì¢Œí‘œ ì—†ì´ ì €ì¥ë©ë‹ˆë‹¤.');
        const continueAnyway = confirm(
          `âš ï¸ ì¢Œí‘œ ë³€í™˜ ì‹¤íŒ¨\n\nì£¼ì†Œ: ${address}\n\n` +
          `ì¢Œí‘œ ì—†ì´ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë‚˜ì¤‘ì— ìˆ˜ì •í•˜ì—¬ ì¢Œí‘œ ì¶”ê°€ ê°€ëŠ¥)`
        );
        
        if (!continueAnyway) {
          loading.classList.add('hide');
          return;
        }
      }
      
      
      const birthDate = document.getElementById('birthDate').value;
      const sangryeong = calculateSangryeong(birthDate);
      
      const client = {
        name,
        title,
        honorific,
        phone,
        address: fullAddress,
        postcode,
        latitude: coordinates.latitude,
        longitude: coordinates.longitude,
        company: document.getElementById('company').value.trim(),
        job: document.getElementById('job').value.trim(),
        birthDate: birthDate,
        birthday: document.getElementById('birthday').value,
        birthdayType,
        sangryeong: sangryeong,
        anniversaryName: document.getElementById('anniversaryName').value.trim(),
        anniversary: document.getElementById('anniversary').value,
        email: document.getElementById('email').value.trim(),
        memo: document.getElementById('memo').value.trim(),
        createdAt: currentEditId !== null ? clients[currentEditId].createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      if (currentEditId !== null) {
        clients[currentEditId] = client;
      } else {
        clients.push(client);
      }
      
      loading.querySelector('.loading-text').textContent = 'êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì €ì¥ ì¤‘...';
      await saveClients();
      loading.classList.add('hide');
      closeModal('clientModal');
      
      if (coordinates.latitude && coordinates.longitude) {
        alert('âœ… ì €ì¥ ì™„ë£Œ!\n\nì¢Œí‘œê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        alert('âœ… ì €ì¥ ì™„ë£Œ!\n\nâš ï¸ ì¢Œí‘œëŠ” "ë¯¸ë“±ë¡" ìƒíƒœì…ë‹ˆë‹¤.\nìˆ˜ì • ë²„íŠ¼ìœ¼ë¡œ ë‹¤ì‹œ ì €ì¥í•˜ë©´ ì¢Œí‘œ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
      }
    }
    
    function editClient(index) {
      currentEditId = index;
      const client = clients[index];
      
      document.getElementById('modalTitle').textContent = 'âœï¸ ê³ ê° ìˆ˜ì •';
      document.getElementById('clientName').value = client.name;
      document.getElementById('clientTitle').value = client.title || '';
      document.getElementById('clientHonorific').value = client.honorific || 'ë‹˜';
      
      const cleaned = client.phone.replace(/\D/g, '');
      if (cleaned.length === 11) {
        document.getElementById('phone1').value = cleaned.substr(3, 4);
        document.getElementById('phone2').value = cleaned.substr(7, 4);
      }
      
      document.getElementById('postcode').value = client.postcode || '';
      const addressParts = client.address.split(' ');
      const detailAddr = addressParts.pop();
      document.getElementById('address').value = addressParts.join(' ');
      document.getElementById('detailAddress').value = detailAddr;
      
      document.getElementById('company').value = client.company || '';
      document.getElementById('job').value = client.job || '';
      document.getElementById('birthDate').value = client.birthDate || '';
      document.getElementById('birthday').value = client.birthday || '';
      
      // ìƒë ¹ì¼ í‘œì‹œ
      updateSangryeongDisplay();
      
      const birthdayTypeRadio = document.querySelector(`input[name="birthdayType"][value="${client.birthdayType || 'solar'}"]`);
      if (birthdayTypeRadio) birthdayTypeRadio.checked = true;
      
      document.getElementById('anniversaryName').value = client.anniversaryName || '';
      document.getElementById('anniversary').value = client.anniversary || '';
      document.getElementById('email').value = client.email || '';
      document.getElementById('memo').value = client.memo || '';
      
      openModal('clientModal');
    }
    
    async function deleteClient(index) {
      if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        clients.splice(index, 1);
        await saveClients();
        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    function toggleSelectAll(checkbox) {
      const checkboxes = document.querySelectorAll('.client-checkbox');
      checkboxes.forEach(cb => {
        cb.checked = checkbox.checked;
      });
      updateSelectedButtons();
    }
    
    function updateSelectedButtons() {
      const checkboxes = document.querySelectorAll('.client-checkbox:checked');
      const deleteBtn = document.getElementById('deleteSelectedBtn');
      const sendBtn = document.getElementById('sendSelectedBtn');
      
      if (checkboxes.length > 0) {
        deleteBtn.classList.add('show');
        sendBtn.classList.add('show');
      } else {
        deleteBtn.classList.remove('show');
        sendBtn.classList.remove('show');
      }
    }
    
    async function deleteSelected() {
      const checkboxes = document.querySelectorAll('.client-checkbox:checked');
      const count = checkboxes.length;
      
      if (count === 0) {
        alert('ì‚­ì œí•  ê³ ê°ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!confirm(`ì„ íƒí•œ ${count}ëª…ì˜ ê³ ê° ë°ì´í„°ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      const indicesToDelete = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
      
      indicesToDelete.forEach(index => {
        clients.splice(index, 1);
      });
      
      await saveClients();
      alert(`${count}ëª…ì˜ ê³ ê°ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
    
    function sendToClient(index) {
      const client = clients[index];
      const fullName = getFullName(client);
      alert(`${fullName}ê»˜ ë©”ì‹œì§€ ë°œì†¡ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.\n\nì—°ë½ì²˜: ${formatPhone(client.phone)}\nì´ë©”ì¼: ${client.email || 'ì—†ìŒ'}`);
    }
    
    function sendToSelected() {
      const checkboxes = document.querySelectorAll('.client-checkbox:checked');
      const count = checkboxes.length;
      
      if (count === 0) {
        alert('ë°œì†¡í•  ê³ ê°ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const selectedClients = Array.from(checkboxes).map(cb => {
        const index = parseInt(cb.value);
        return clients[index];
      });
      
      const names = selectedClients.map(c => getFullName(c)).join(', ');
      alert(`${count}ëª…ì˜ ê³ ê°ì—ê²Œ ì¼ê´„ ë°œì†¡ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.\n\nì„ íƒëœ ê³ ê°: ${names}`);
    }
    
    function showGoogleDriveInfo() {
      const message = `ğŸ”— êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ë™ ì•ˆë‚´\n\nì•ˆë…•í•˜ì„¸ìš”! ê³ ê° ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê¸° ìœ„í•´\nêµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nğŸ“‹ ì—°ë™ ë°©ë²•:\n1. í˜ì´ì§€ë¥¼ ì²˜ìŒ ë°©ë¬¸í•˜ì‹œë©´ Google ë¡œê·¸ì¸ íŒì—…ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.\n2. "ì´ ì•±ì´ Google Driveì— ì ‘ê·¼í•˜ë„ë¡ í—ˆìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"\n   ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.\n3. [í—ˆìš©] ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.\n\nâœ… ì—°ë™ í›„:\nâ€¢ ëª¨ë“  ê³ ê° ë°ì´í„°ê°€ ê·€í•˜ì˜ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.\nâ€¢ "ê³ ê°ëª©ë¡.fmd" íŒŒì¼ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.\nâ€¢ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ê°™ì€ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nğŸ”’ ë³´ì•ˆ:\nâ€¢ AES-256 ì•”í˜¸í™”ë¡œ ë°ì´í„° ë³´í˜¸\nâ€¢ ê·€í•˜ì˜ ë“œë¼ì´ë¸Œì—ë§Œ ì €ì¥ë¨\n\nê°ì‚¬í•©ë‹ˆë‹¤! ğŸ˜Š`;
      
      alert(message);
    }
    
    function viewClient(index) {
      const client = clients[index];
      const body = document.getElementById('viewModalBody');
      
      body.innerHTML = `
        <div style="padding: 1rem 0;">
          <div style="margin-bottom: 1.5rem;">
            <h3 style="color: #0c2c54; margin-bottom: 0.5rem;">ê¸°ë³¸ ì •ë³´</h3>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
              <p style="margin: 0.5rem 0;"><strong>ê³ ê°ëª…:</strong> ${getFullName(client)}</p>
              <p style="margin: 0.5rem 0;"><strong>ì—°ë½ì²˜:</strong> ${formatPhone(client.phone)} <a href="tel:${client.phone}" style="color: #06b6d4;">ğŸ“ ì „í™”ê±¸ê¸°</a></p>
              <p style="margin: 0.5rem 0;"><strong>ì£¼ì†Œ:</strong> ${client.address}</p>
              ${client.latitude && client.longitude ? `<p style="margin: 0.5rem 0;"><strong>ì¢Œí‘œ:</strong> ${client.latitude.toFixed(6)}, ${client.longitude.toFixed(6)}</p>` : ''}
              ${client.company ? `<p style="margin: 0.5rem 0;"><strong>íšŒì‚¬ëª…:</strong> ${client.company}</p>` : ''}
              ${client.job ? `<p style="margin: 0.5rem 0;"><strong>ì§ì—…:</strong> ${client.job}</p>` : ''}
            </div>
          </div>
          
          ${client.birthDate || client.birthday || client.anniversary ? `
          <div style="margin-bottom: 1.5rem;">
            <h3 style="color: #0c2c54; margin-bottom: 0.5rem;">ê¸°ë…ì¼ ì •ë³´</h3>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
              ${client.birthDate ? `<p style="margin: 0.5rem 0;"><strong>ìƒë…„ì›”ì¼:</strong> ${client.birthDate}</p>` : ''}
              ${client.birthday ? `<p style="margin: 0.5rem 0;"><strong>ì‹¤ì œìƒì¼:</strong> ${new Date(client.birthday).toLocaleDateString()} (${client.birthdayType === 'lunar' ? 'ğŸŒ™ ìŒë ¥' : 'â˜€ï¸ ì–‘ë ¥'})</p>` : ''}
              ${client.anniversary ? `<p style="margin: 0.5rem 0;"><strong>${client.anniversaryName || 'ê¸°ë…ì¼'}:</strong> ${new Date(client.anniversary).toLocaleDateString()}</p>` : ''}
            </div>
          </div>
          ` : ''}
          
          ${client.email || client.memo ? `
          <div>
            <h3 style="color: #0c2c54; margin-bottom: 0.5rem;">ê¸°íƒ€ ì •ë³´</h3>
            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
              ${client.email ? `<p style="margin: 0.5rem 0;"><strong>ì´ë©”ì¼:</strong> ${client.email}</p>` : ''}
              ${client.memo ? `<p style="margin: 0.5rem 0;"><strong>ë©”ëª¨:</strong> ${client.memo}</p>` : ''}
            </div>
          </div>
          ` : ''}
        </div>
      `;
      
      openModal('viewModal');
    }
    
    function openCEOFocus(index) {
      const client = clients[index];
      const clientData = encryptData(client);
      const encoded = encodeURIComponent(clientData);
      window.open(`ceoFocus.html?client=${encoded}`, '_blank');
    }
    
    function openFM(index) {
      const client = clients[index];
      const clientData = encryptData(client);
      const encoded = encodeURIComponent(clientData);
      window.open(`financialMaster.html?client=${encoded}`, '_blank');
    }
    
    // ê°„ë‹¨í•œ ì§€ë„ ë³´ê¸° - Kakao Maps ì‚¬ìš©
    async function openMapModal() {
      clearMobileLog(); // ë¡œê·¸ ì´ˆê¸°í™”
      mobileLog('ğŸ—ºï¸ ì§€ë„ ì—´ê¸° ì‹œì‘...');
      
      if (clients.length === 0) {
        alert('ì§€ë„ì— í‘œì‹œí•  ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ì¢Œí‘œê°€ ìˆëŠ” ê³ ê° í•„í„°ë§
      const clientsWithCoords = clients.filter(c => c.latitude && c.longitude);
      mobileLog(`ğŸ“Š ì „ì²´ ê³ ê°: ${clients.length}ëª…, ì¢Œí‘œ ìˆìŒ: ${clientsWithCoords.length}ëª…`);
      
      if (clientsWithCoords.length === 0) {
        alert('âš ï¸ ì¢Œí‘œê°€ ë“±ë¡ëœ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.\n\nì¢Œí‘œëŠ” ê³ ê° ì •ë³´ë¥¼ ê°œë³„ ìˆ˜ì •í•  ë•Œ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.\n\nğŸ’¡ ê³ ê° ìˆ˜ì • â†’ ì£¼ì†Œ ì…ë ¥ í›„ ì €ì¥');
        return;
      }
      
      // âœ… Kakao Maps API ë¡œë”© í™•ì¸ ë° ëŒ€ê¸°
      mobileLog('ğŸ” Kakao Maps SDK ë¡œë”© í™•ì¸ ì¤‘...');
      
      // SDKê°€ ë¡œë“œë  ë•Œê¹Œì§€ ìµœëŒ€ 5ì´ˆ ëŒ€ê¸°
      let attempts = 0;
      const maxAttempts = 50;
      
      while (attempts < maxAttempts) {
        if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.Map) {
          mobileLog(`âœ… Kakao Maps SDK ë¡œë“œ ì™„ë£Œ! (${attempts * 100}ms)`);
          break;
        }
        await new Promise(resolve => setTimeout(resolve, 100));
        attempts++;
        if (attempts % 10 === 0) {
          mobileLog(`â³ SDK ë¡œë”© ëŒ€ê¸° ì¤‘... (${attempts * 100}ms)`);
        }
      }
      
      if (typeof kakao === 'undefined' || !kakao.maps || !kakao.maps.Map) {
        mobileLog('âŒ Kakao Maps SDK ë¡œë”© ì‹¤íŒ¨!');
        alert('âš ï¸ Kakao Maps API ë¡œë”© ì‹¤íŒ¨\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\n\nì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ëª¨ë‹¬ ì—´ê¸°
      mobileLog('ğŸ“± ëª¨ë‹¬ ì°½ ì—´ê¸°...');
      openModal('mapModal');
      
      // âœ… ëª¨ë°”ì¼ ì§€ì›: ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ì´ ì™„ë£Œëœ í›„ ì§€ë„ ìƒì„± (300ms ëŒ€ê¸°)
      setTimeout(() => {
        try {
          mobileLog('ğŸ—ºï¸ ì§€ë„ ìƒì„± ì‹œì‘...');
          
          // ì§€ë„ ì»¨í…Œì´ë„ˆ
          const mapDiv = document.getElementById('clientMap');
          if (!mapDiv) {
            mobileLog('âŒ clientMap ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            alert('ì§€ë„ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          mobileLog('âœ… ì§€ë„ ì»¨í…Œì´ë„ˆ í™•ì¸ ì™„ë£Œ');
          mobileLog(`ğŸ“ ì²« ê³ ê° ì¢Œí‘œ: ${clientsWithCoords[0].latitude}, ${clientsWithCoords[0].longitude}`);
          
          // ì²« ë²ˆì§¸ ê³ ê° ìœ„ì¹˜ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ
          const center = new kakao.maps.LatLng(clientsWithCoords[0].latitude, clientsWithCoords[0].longitude);
          
          mobileLog('ğŸ—ºï¸ ì¹´ì¹´ì˜¤ ì§€ë„ ê°ì²´ ìƒì„± ì¤‘...');
          
          // Kakao ì§€ë„ ìƒì„±
          const map = new kakao.maps.Map(mapDiv, {
            center: center,
            level: 6
          });
          
          mobileLog('âœ… ì¹´ì¹´ì˜¤ ì§€ë„ ê°ì²´ ìƒì„± ì™„ë£Œ!');
          
          // âœ… ëª¨ë°”ì¼ ì§€ì›: ì§€ë„ í¬ê¸° ì¬ê³„ì‚° (í•„ìˆ˜!)
          setTimeout(() => {
            mobileLog('ğŸ”„ ì§€ë„ í¬ê¸° ì¬ê³„ì‚° ì¤‘...');
            map.relayout();
            mobileLog('âœ… ì§€ë„ í¬ê¸° ì¬ê³„ì‚° ì™„ë£Œ!');
          }, 100);
        
        // ì§€ë„ íƒ€ì… ì»¨íŠ¸ë¡¤ ì¶”ê°€
        const mapTypeControl = new kakao.maps.MapTypeControl();
        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
        
        // ì¤Œ ì»¨íŠ¸ë¡¤ ì¶”ê°€
        const zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
        
        // ëª¨ë“  ê³ ê°ì˜ ë§ˆì»¤ì™€ ì •ë³´ì°½ ìƒì„±
        const bounds = new kakao.maps.LatLngBounds();
        const infoWindows = []; // ì—´ë¦° ì •ë³´ì°½ ê´€ë¦¬
        
        clientsWithCoords.forEach((client, index) => {
          const position = new kakao.maps.LatLng(client.latitude, client.longitude);
          
          // ë§ˆì»¤ ìƒì„±
          const marker = new kakao.maps.Marker({
            position: position,
            map: map
          });
          
          // ë§ˆì»¤ ìœ„ì— ê³ ê° ì´ë¦„ ë¼ë²¨ í‘œì‹œ (í´ë¦­ ê°€ëŠ¥)
          const labelContent = `
            <div onclick="openClientInfo_${index}()" style="cursor: pointer; position: relative; bottom: 45px; background: #FF6B00; color: white; padding: 6px 12px; border-radius: 6px; font-weight: 700; font-size: 13px; white-space: nowrap; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 2px solid white;">
              ${client.name}
              <div style="position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 6px solid #FF6B00;"></div>
            </div>
          `;
          
          const customOverlay = new kakao.maps.CustomOverlay({
            position: position,
            content: labelContent,
            yAnchor: 1
          });
          
          customOverlay.setMap(map);
          
          // ì •ë³´ì°½ ë‚´ìš© (ë‹«ê¸° ë²„íŠ¼ í¬í•¨)
          const infoContent = `
            <div style="position: relative; padding: 14px; min-width: 240px; max-width: 320px; font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
              <button onclick="closeAllInfoWindows()" style="position: absolute; top: 8px; right: 8px; background: none; border: none; font-size: 20px; cursor: pointer; color: #94a3b8; padding: 4px 8px; line-height: 1;">Ã—</button>
              <h3 style="margin: 0 0 8px 0; color: #FF6B00; font-size: 16px; font-weight: 700; padding-right: 24px;">
                ${client.name}${client.honorific || ''}
              </h3>
              ${client.title ? `<p style="margin: 3px 0; color: #64748b; font-size: 12px; font-weight: 500;">${client.title}</p>` : ''}
              ${client.company ? `<p style="margin: 3px 0; color: #64748b; font-size: 12px;">${client.company}</p>` : ''}
              <hr style="margin: 8px 0; border: none; border-top: 1px solid #e2e8f0;">
              <div style="margin: 6px 0; font-size: 13px; display: flex; align-items: center; gap: 6px;">
                <strong>ğŸ“</strong> 
                <span style="color: #0c2c54; font-weight: 600;">
                  ${formatPhone(client.phone)}
                </span>
                <a href="tel:${client.phone}" 
                   style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; text-decoration: none; font-size: 11px; display: inline-flex; align-items: center; gap: 3px;">
                  ğŸ“
                </a>
              </div>
              <p style="margin: 6px 0; font-size: 12px; color: #475569; line-height: 1.4;">
                <strong>ğŸ“</strong> ${client.address}
              </p>
              ${client.birthDate ? `<p style="margin: 4px 0; font-size: 11px; color: #64748b;">
                ğŸ‚ ${new Date(client.birthDate).toLocaleDateString()}
              </p>` : ''}
              ${client.sangryeong ? `<p style="margin: 4px 0; font-size: 11px; color: #64748b;">
                ğŸ ìƒë ¹ì¼: ${client.sangryeong}
              </p>` : ''}
              <div style="margin-top: 10px; display: flex; gap: 6px;">
                <a href="https://map.kakao.com/link/to/${encodeURIComponent(client.name)},${client.latitude},${client.longitude}" 
                   target="_blank"
                   style="padding: 8px 14px; background: #FEE500; color: #3C1E1E; text-decoration: none; border-radius: 5px; font-size: 12px; font-weight: 600; display: inline-block; flex: 1; text-align: center;">
                  ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ
                </a>
                <a href="https://www.google.com/maps/dir/?api=1&destination=${client.latitude},${client.longitude}" 
                   target="_blank"
                   style="padding: 8px 14px; background: #4285F4; color: white; text-decoration: none; border-radius: 5px; font-size: 12px; font-weight: 600; display: inline-block; flex: 1; text-align: center;">
                  ğŸ—ºï¸ êµ¬ê¸€ë§µ
                </a>
              </div>
            </div>
          `;
          
          // ì •ë³´ì°½ ìƒì„±
          const infoWindow = new kakao.maps.InfoWindow({
            content: infoContent
          });
          
          infoWindows.push(infoWindow);
          
          // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
          kakao.maps.event.addListener(marker, 'click', function() {
            // ëª¨ë“  ì •ë³´ì°½ ë‹«ê¸°
            infoWindows.forEach(iw => iw.close());
            // í˜„ì¬ ì •ë³´ì°½ ì—´ê¸°
            infoWindow.open(map, marker);
          });
          
          // ë¼ë²¨ í´ë¦­ ì‹œ ì •ë³´ì°½ ì—´ê¸° (ì „ì—­ í•¨ìˆ˜)
          window[`openClientInfo_${index}`] = function() {
            // ëª¨ë“  ì •ë³´ì°½ ë‹«ê¸°
            infoWindows.forEach(iw => iw.close());
            // í˜„ì¬ ì •ë³´ì°½ ì—´ê¸°
            infoWindow.open(map, marker);
          };
          
          // ì§€ë„ ë²”ìœ„ í™•ì¥
          bounds.extend(position);
        });
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ì •ë³´ì°½ ë‹«ê¸° (ì •ë³´ì°½ ë‚´ë¶€ ë²„íŠ¼ì—ì„œ í˜¸ì¶œ)
        window.closeAllInfoWindows = function() {
          infoWindows.forEach(iw => iw.close());
        };
        
        // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì§€ë„ ë²”ìœ„ ì¡°ì •
        if (clientsWithCoords.length > 1) {
          map.setBounds(bounds);
        }
        
        // ë§ˆì»¤ ê°œìˆ˜ í‘œì‹œ
        const markerCount = document.getElementById('markerCount');
        if (markerCount) {
          markerCount.innerHTML = `ì´ <strong style="color: #FF6B00;">${clientsWithCoords.length}ëª…</strong>ì˜ ê³ ê° ìœ„ì¹˜ | ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤`;
        }
        
        mobileLog(`âœ…âœ…âœ… ì§€ë„ í‘œì‹œ ì™„ë£Œ! ì´ ${clientsWithCoords.length}ëª… ë§ˆì»¤ í‘œì‹œ`);
        mobileLog('ğŸ’¡ ì´ì œ ì§€ë„ë¥¼ í™•ì¸í•˜ì„¸ìš”!');
        
      } catch (error) {
        mobileLog('âŒ ì§€ë„ ìƒì„± ì˜¤ë¥˜ ë°œìƒ!');
        mobileLog(`ì˜¤ë¥˜ ë‚´ìš©: ${error.message}`);
        mobileLog(`kakao ê°ì²´: ${typeof kakao !== 'undefined' ? 'ìˆìŒ' : 'ì—†ìŒ'}`);
        
        console.error('âŒ ì§€ë„ ìƒì„± ì˜¤ë¥˜:', error);
        console.error('ì˜¤ë¥˜ ìƒì„¸:', error.message);
        console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
        closeModal('mapModal');
        
        let errorMessage = 'âš ï¸ ì§€ë„ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n';
        errorMessage += 'ì˜¤ë¥˜: ' + error.message + '\n\n';
        errorMessage += 'í™”ë©´ í•˜ë‹¨ì˜ ë””ë²„ê·¸ ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
        
        alert(errorMessage);
      }
      }, 300); // âœ… ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ ëŒ€ê¸° ì‹œê°„
    }
    
    function exportToExcel() {
      if (clients.length === 0) {
        alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const data = clients.map(c => {
        const addressParts = c.address.split(' ');
        let baseAddress = '';
        let detailAddress = '';
        
        if (addressParts.length > 4) {
          detailAddress = addressParts.pop();
          baseAddress = addressParts.join(' ');
        } else {
          baseAddress = c.address;
        }
        
        return {
          'ê³ ê°ëª…': c.name,
          'ì§í•¨': c.title || '',
          'í˜¸ì¹­': c.honorific || '',
          'ì—°ë½ì²˜': formatPhone(c.phone),
          'ì£¼ì†Œ': baseAddress,
          'ìƒì„¸ì£¼ì†Œ': detailAddress,
          'ìœ„ë„': c.latitude || '',
          'ê²½ë„': c.longitude || '',
          'íšŒì‚¬ëª…': c.company || '',
          'ì§ì—…': c.job || '',
          'ìƒë…„ì›”ì¼': c.birthDate || '',
          'ì‹¤ì œìƒì¼': c.birthday ? new Date(c.birthday).toLocaleDateString() : '',
          'ì–‘/ìŒë ¥': c.birthdayType === 'lunar' ? 'ìŒë ¥' : 'ì–‘ë ¥',
          'ê¸°ë…ì¼ëª…': c.anniversaryName || '',
          'ê¸°ë…ì¼': c.anniversary ? new Date(c.anniversary).toLocaleDateString() : '',
          'ì´ë©”ì¼': c.email || '',
          'ë©”ëª¨': c.memo || ''
        };
      });
      
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'ê³ ê°ëª©ë¡');
      XLSX.writeFile(wb, `ê³ ê°ëª©ë¡_${new Date().toISOString().split('T')[0]}.xlsx`);
    }
    
    function openBulkUploadModal() {
      document.getElementById('spreadsheetContainer').style.display = 'none';
      openModal('bulkUploadModal');
    }
    
    function initSpreadsheet() {
      const container = document.getElementById('spreadsheetContainer');
      container.style.display = 'block';
      
      const tbody = document.getElementById('spreadsheetBody');
      tbody.innerHTML = '';
      
      for (let i = 0; i < 10; i++) {
        addSpreadsheetRow();
      }
    }
    
    function addSpreadsheetRow() {
      const tbody = document.getElementById('spreadsheetBody');
      const row = tbody.insertRow();
      
      const cells = [
        'text', 'text', 'text', 'text', 'text', 'text', 'text', 'text',
        'date', 'text', 'date', 'select', 'text', 'date', 'email', 'text'
      ];
      
      const placeholders = [
        'í™ê¸¸ë™',
        'ê³¼ì¥/íŒ€ì¥/ëŒ€í‘œ ë“±',
        'ë‹˜',
        '01012345678',
        'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
        'ì•„íŒŒíŠ¸ 101ë™ 1001í˜¸',
        '(ì£¼)ABC',
        'ëŒ€í‘œì´ì‚¬',
        '',
        '',
        '',
        '',
        'ê²°í˜¼ê¸°ë…ì¼',
        '',
        'example@email.com',
        'íŠ¹ì´ì‚¬í•­ ë©”ëª¨'
      ];
      
      cells.forEach((type, i) => {
        const cell = row.insertCell();
        if (type === 'select') {
          cell.innerHTML = '<select><option value="solar">ì–‘ë ¥</option><option value="lunar">ìŒë ¥</option></select>';
        } else if (i === 2) {
          cell.innerHTML = '<input type="text" value="ë‹˜" placeholder="ë‹˜">';
        } else if (i === 3) {
          cell.innerHTML = `<input type="text" placeholder="${placeholders[i]}" inputmode="numeric">`;
        } else if (i === 9) {
          // ìƒë ¹ì¼ - ì½ê¸° ì „ìš©
          cell.innerHTML = `<input type="text" readonly style="background: #f1f5f9; color: #64748b;" placeholder="ìë™ê³„ì‚°">`;
        } else {
          cell.innerHTML = `<input type="${type}" placeholder="${placeholders[i] || ''}">`;
        }
      });
    }
    
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(sheet);
        
        initSpreadsheet();
        const tbody = document.getElementById('spreadsheetBody');
        tbody.innerHTML = '';
        
        jsonData.forEach(row => {
          const tr = tbody.insertRow();
          
          let baseAddress = row['ì£¼ì†Œ'] || '';
          let detailAddress = row['ìƒì„¸ì£¼ì†Œ'] || '';
          
          if (!detailAddress && baseAddress) {
            const addressParts = baseAddress.split(' ');
            if (addressParts.length > 4) {
              detailAddress = addressParts.pop();
              baseAddress = addressParts.join(' ');
            }
          }
          
          const birthDate = row['ìƒë…„ì›”ì¼'] || '';
          const sangryeong = birthDate ? calculateSangryeong(birthDate) : '';
          
          const values = [
            row['ê³ ê°ëª…'] || '',
            row['ì§í•¨'] || '',
            row['í˜¸ì¹­'] || 'ë‹˜',
            row['ì—°ë½ì²˜'] || '',
            baseAddress,
            detailAddress,
            row['íšŒì‚¬ëª…'] || '',
            row['ì§ì—…'] || '',
            birthDate,
            sangryeong,
            row['ìƒì¼'] || row['ì‹¤ì œìƒì¼'] || '',
            row['ì–‘/ìŒë ¥'] || 'solar',
            row['ê¸°ë…ì¼ëª…'] || '',
            row['ê¸°ë…ì¼'] || '',
            row['ì´ë©”ì¼'] || '',
            row['ë©”ëª¨'] || ''
          ];
          
          values.forEach((value, i) => {
            const td = tr.insertCell();
            if (i === 11) {
              td.innerHTML = `<select><option value="solar" ${value === 'ì–‘ë ¥' || value === 'solar' ? 'selected' : ''}>ì–‘ë ¥</option><option value="lunar" ${value === 'ìŒë ¥' || value === 'lunar' ? 'selected' : ''}>ìŒë ¥</option></select>`;
            } else if (i === 8 || i === 10 || i === 13) {
              td.innerHTML = `<input type="date" value="${value}">`;
            } else if (i === 9) {
              // ìƒë ¹ì¼ - ì½ê¸° ì „ìš©
              td.innerHTML = `<input type="text" value="${value}" readonly style="background: #f1f5f9; color: #64748b;">`;
            } else if (i === 14) {
              td.innerHTML = `<input type="email" value="${value}">`;
            } else if (i === 3) {
              td.innerHTML = `<input type="text" value="${value}" placeholder="'-' ë¹¼ê³  ìˆ«ìë§Œ ì…ë ¥" inputmode="numeric">`;
            } else {
              td.innerHTML = `<input type="text" value="${value}" ${i === 4 ? 'placeholder="ë„ë¡œëª…ì£¼ì†Œ"' : i === 5 ? 'placeholder="ë™/í˜¸ìˆ˜ ë“±"' : ''}>`;
            }
          });
        });
        
        alert(`${jsonData.length}í–‰ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.\n\nì£¼ì†Œì™€ ìƒì„¸ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¦¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.`);
      };
      reader.readAsArrayBuffer(file);
    }
    
    async function saveBulkClients() {
      const tbody = document.getElementById('spreadsheetBody');
      const rows = tbody.querySelectorAll('tr');
      let added = 0;
      let failed = [];
      let skipped = 0;
      let noCoordinates = 0;
      
      const loading = document.getElementById('loading');
      loading.classList.remove('hide');
      loading.querySelector('.loading-text').textContent = 'ì €ì¥ ì¤€ë¹„ ì¤‘...';
      
      for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const inputs = row.querySelectorAll('input, select');
        const name = inputs[0].value.trim();
        const title = inputs[1].value.trim();
        const honorific = inputs[2].value.trim();
        const phone = inputs[3].value.trim().replace(/\D/g, '');
        let address = inputs[4].value.trim();
        let detailAddress = inputs[5].value.trim();
        
        if (!name && !phone && !address) {
          skipped++;
          continue;
        }
        
        if (name && phone && address && detailAddress) {
          const fullAddress = `${address} ${detailAddress}`;
          
          // ë‹¨ì²´ì…ë ¥ì€ ì¢Œí‘œ ì—†ì´ ë¹ ë¥´ê²Œ ì €ì¥ (ë‚˜ì¤‘ì— ê°œë³„ ìˆ˜ì • ì‹œ ì¢Œí‘œ ì¶”ê°€ ê°€ëŠ¥)
          loading.querySelector('.loading-text').textContent = `${added + 1}ë²ˆì§¸ "${name}" ì €ì¥ ì¤‘...`;
          
          const birthDate = inputs[8].value.trim();
          const sangryeong = calculateSangryeong(birthDate);
          
          clients.push({
            name,
            title,
            honorific,
            phone,
            address: fullAddress,
            postcode: '',
            latitude: null,
            longitude: null,
            company: inputs[6].value.trim(),
            job: inputs[7].value.trim(),
            birthDate: birthDate,
            birthday: inputs[10].value.trim(),
            birthdayType: inputs[11].value,
            sangryeong: sangryeong,
            anniversaryName: inputs[12].value.trim(),
            anniversary: inputs[13].value.trim(),
            email: inputs[14].value.trim(),
            memo: inputs[15].value.trim(),
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          });
          added++;
          noCoordinates++;
        } else if (name || phone || address) {
          failed.push({
            row: i + 1,
            name: name || '(ì´ë¦„ì—†ìŒ)',
            address: address || '(ì£¼ì†Œì—†ìŒ)',
            reason: 'í•„ìˆ˜ í•­ëª© ëˆ„ë½'
          });
        }
      }
      
      if (added > 0) {
        loading.querySelector('.loading-text').textContent = 'êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì €ì¥ ì¤‘...';
        await saveClients();
        loading.classList.add('hide');
        closeModal('bulkUploadModal');
        
        let message = `âœ… ${added}ëª…ì˜ ê³ ê°ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`;
        
        if (skipped > 0) {
          message += `\n\në¹ˆ í–‰ ${skipped}ê°œ ê±´ë„ˆëœ€`;
        }
        
        if (noCoordinates > 0) {
          message += `\n\nğŸ“ ì¢Œí‘œ ë¯¸ë“±ë¡: ${noCoordinates}ëª…`;
          message += `\n(ê°œë³„ ìˆ˜ì •ìœ¼ë¡œ ì¢Œí‘œ ì¶”ê°€ ê°€ëŠ¥)`;
        }
        
        if (failed.some(f => f.reason)) {
          const reasonFailed = failed.filter(f => f.reason);
          message += `\n\nâŒ ì €ì¥ ì‹¤íŒ¨: ${reasonFailed.length}ê±´\n`;
          reasonFailed.slice(0, 3).forEach(f => {
            message += `\n${f.row}í–‰: ${f.name} - ${f.reason}`;
          });
        }
        
        message += `\n\nğŸ’¡ ë¹ ë¥¸ ì €ì¥ì„ ìœ„í•´ ì¢Œí‘œëŠ” ë‚˜ì¤‘ì— ê°œë³„ ìˆ˜ì • ì‹œ ìë™ ì¶”ê°€ë©ë‹ˆë‹¤.`;
        
        alert(message);
      } else {
        loading.classList.add('hide');
        alert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n\ní•„ìˆ˜ í•­ëª©:\n- ê³ ê°ëª…\n- ì—°ë½ì²˜\n- ì£¼ì†Œ\n- ìƒì„¸ì£¼ì†Œ');
      }
    }
    
    document.getElementById('searchInput').addEventListener('input', function(e) {
      const query = e.target.value.toLowerCase();
      const rows = document.querySelectorAll('#clientsTableBody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(query) ? '' : 'none';
      });
    });
    
    document.getElementById('phone1').addEventListener('input', function(e) {
      this.value = this.value.replace(/\D/g, '');
    });
    
    document.getElementById('phone2').addEventListener('input', function(e) {
      this.value = this.value.replace(/\D/g, '');
    });
    
    document.addEventListener('DOMContentLoaded', function() {
      document.addEventListener('paste', function(e) {
        const activeElement = document.activeElement;
        if (activeElement && activeElement.closest('.spreadsheet')) {
          e.preventDefault();
          
          const clipboardData = e.clipboardData.getData('text');
          const rows = clipboardData.split('\n').map(row => row.split('\t'));
          
          let currentCell = activeElement.closest('td');
          if (!currentCell) return;
          
          const table = currentCell.closest('tbody');
          let rowIndex = currentCell.parentElement.rowIndex - 1;
          let cellIndex = currentCell.cellIndex;
          
          rows.forEach((rowData, i) => {
            let row = table.rows[rowIndex + i];
            if (!row) {
              addSpreadsheetRow();
              row = table.rows[rowIndex + i];
            }
            
            rowData.forEach((cellData, j) => {
              const cell = row.cells[cellIndex + j];
              if (cell) {
                const input = cell.querySelector('input, select');
                if (input) {
                  input.value = cellData.trim();
                }
              }
            });
          });
        }
      });
    });
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
    window.addEventListener('load', function() {
      document.getElementById('searchInput').addEventListener('input', function(e) {
        const query = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#clientsTableBody tr');
        
        rows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(query) ? '' : 'none';
        });
      });
      
      document.getElementById('phone1').addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '');
      });
      
      document.getElementById('phone2').addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '');
      });
    });
    document.getElementById('address').addEventListener('blur', async function() {
      const address = this.value.trim();
      const coordsDisplay = document.getElementById('coordinatesDisplay');
      
      if (!address) {
        coordsDisplay.textContent = 'ì£¼ì†Œ ì…ë ¥ í›„ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤';
        coordsDisplay.style.color = '#0c4a6e';
        return;
      }
      
      coordsDisplay.textContent = 'ì¢Œí‘œ ë³€í™˜ ì¤‘...';
      coordsDisplay.style.color = '#f59e0b';
      
      const coords = await getCoordinates(address);
      
      if (coords.latitude && coords.longitude) {
        coordsDisplay.innerHTML = `<strong>ìœ„ë„:</strong> ${coords.latitude.toFixed(6)} | <strong>ê²½ë„:</strong> ${coords.longitude.toFixed(6)} âœ…`;
        coordsDisplay.style.color = '#059669';
      } else {
        coordsDisplay.textContent = 'âš ï¸ ì¢Œí‘œ ë³€í™˜ ì‹¤íŒ¨ - ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”';
        coordsDisplay.style.color = '#dc2626';
      }
    });
    
    // ë‹¨ì²´ì…ë ¥ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ ìƒë…„ì›”ì¼ ì…ë ¥ ì‹œ ìƒë ¹ì¼ ìë™ ê³„ì‚°
    document.addEventListener('input', function(e) {
      if (e.target && e.target.type === 'date' && e.target.closest('.spreadsheet')) {
        const cell = e.target.closest('td');
        if (!cell) return;
        
        const row = cell.parentElement;
        const cells = row.querySelectorAll('td');
        const cellIndex = Array.from(cells).indexOf(cell);
        
        // ìƒë…„ì›”ì¼ ì»¬ëŸ¼(8ë²ˆì§¸)ì¸ ê²½ìš°
        if (cellIndex === 8) {
          const birthDate = e.target.value;
          if (birthDate) {
            const sangryeong = calculateSangryeong(birthDate);
            const sangryeongCell = cells[9]; // ìƒë ¹ì¼ì€ 9ë²ˆì§¸
            if (sangryeongCell) {
              const input = sangryeongCell.querySelector('input');
              if (input) {
                input.value = sangryeong;
              }
            }
          }
        }
      }
    });
    
  </script>
</body>
</html>