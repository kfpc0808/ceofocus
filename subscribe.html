<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”” ì•Œë¦¼ êµ¬ë… - KFPC</title>
    
    <!-- Google OAuth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: clamp(25px, 5vw, 40px);
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .icon {
            font-size: clamp(48px, 12vw, 64px);
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: clamp(22px, 5vw, 28px);
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: clamp(13px, 3vw, 14px);
            line-height: 1.5;
        }
        
        .benefits {
            text-align: left;
            margin: 25px 0;
            padding: clamp(15px, 3vw, 20px);
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .benefit-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: clamp(13px, 3vw, 14px);
        }
        
        .benefit-item:last-child {
            margin-bottom: 0;
        }
        
        .benefit-icon {
            font-size: clamp(20px, 4vw, 24px);
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .consultant-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: clamp(15px, 3vw, 20px);
            border-radius: 10px;
            margin-bottom: 25px;
            border: 2px solid #1976d2;
        }
        
        .consultant-name {
            font-size: clamp(18px, 4vw, 20px);
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 5px;
        }
        
        .consultant-title {
            color: #666;
            font-size: clamp(12px, 3vw, 14px);
        }
        
        .subscribe-btn {
            width: 100%;
            padding: clamp(15px, 3vw, 18px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: clamp(16px, 3.5vw, 18px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        
        .subscribe-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .subscribe-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .subscribe-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: clamp(13px, 3vw, 14px);
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-message.show {
            display: block;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        
        .privacy-notice {
            margin-top: 20px;
            font-size: clamp(11px, 2.5vw, 12px);
            color: #999;
            line-height: 1.6;
        }
        
        .footer {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: clamp(10px, 2.5vw, 12px);
            color: #999;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: clamp(12px, 3vw, 13px);
            color: #856404;
            text-align: left;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon">ğŸ””</div>
        <h1>ì•Œë¦¼ë°›ê¸°</h1>
        <p class="subtitle"><span id="displayCustomerName"></span>ë‹˜ê»˜ ê°€ì¥ ê·€í•˜ê³  ê°€ì¹˜ìˆëŠ” ì •ë³´ë¥¼ ì „í•´ë“œë¦½ë‹ˆë‹¤.</p>
        
        <!-- ë‹´ë‹¹ ì»¨ì„¤í„´íŠ¸ ì •ë³´ -->
        <div class="consultant-info" id="consultantInfo">
            <div class="consultant-signature" id="consultantSignature" style="font-size: clamp(14px, 3vw, 16px); color: #1976d2; line-height: 1.6;">
                <span id="companyName"></span> <span id="consultantName"></span> <span id="consultantTitle"></span> ë“œë¦¼
            </div>
        </div>
        
        <!-- êµ¬ë… ë²„íŠ¼ -->
        <button class="subscribe-btn" id="subscribeBtn" onclick="subscribePush()">
            ë°›ê¸°
        </button>
        
        <!-- ìƒíƒœ ë©”ì‹œì§€ -->
        <div class="status-message" id="statusMessage"></div>
        
        <!-- ê°œì¸ì •ë³´ ì•ˆë‚´ -->
        <div class="privacy-notice">
            *ì•Œë¦¼ì„ í—ˆìš©í•˜ì‹œë©´ ì •ë³´ë¥¼ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìœ¼ë©°, ì–¸ì œë“ ì§€ í•´ì œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
        
        <div class="footer">
            Â© 2025 KFPC. All rights reserved.
        </div>
    </div>

    <script>
        // ================================================================
        // ì „ì—­ ë³€ìˆ˜
        // ================================================================
        
        let gapiLoaded = false;
        let gisLoaded = false;
        let tokenClient;
        let accessToken = null;
        
        // Google Drive API ì„¤ì •
        const CLIENT_ID = '288996084140-0eo93heqd66hqhg0fh1rbum6scnt3757.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyBl4elHOfZ97gcK5vBQol9f0PUYxaK80Qk';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDbufefZCVqCY8QQppcdQFoqVFpMriv1m0",
            authDomain: "kfpc-company-support-project.firebaseapp.com",
            databaseURL: "https://kfpc-company-support-project-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kfpc-company-support-project",
            storageBucket: "kfpc-company-support-project.firebasestorage.app",
            messagingSenderId: "1012609333373",
            appId: "1:1012609333373:web:ffba9039a7f9568356d914",
            measurementId: "G-Y757PLYBEE"
        };
        
        // Firebase ì´ˆê¸°í™”
        let firebaseAuth = null;
        let currentUser = null;
        try {
            if (typeof firebase !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                firebaseAuth = firebase.auth();
            }
        } catch (error) {
            console.warn('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        }
        
        // Drive í´ë” ë° íŒŒì¼ ì„¤ì •
        const FOLDER_NAME = 'KFPC_PushSystem';
        const SUBSCRIBERS_FILE = 'subscribers.json';
        
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const consultantId = urlParams.get('c') || urlParams.get('consultant') || 'default';
        const customerId = urlParams.get('id') || urlParams.get('customer') || null;
        const customerName = decodeURIComponent(urlParams.get('name') || 'ê³ ê°');
        const consultantName = decodeURIComponent(urlParams.get('c') || 'ë‹´ë‹¹ì');
        const consultantTitle = decodeURIComponent(urlParams.get('title') || 'ì¬ë¬´ ì»¨ì„¤í„´íŠ¸');
        const companyName = decodeURIComponent(urlParams.get('company') || 'KFPC');
        
        // í™”ë©´ì— ì •ë³´ í‘œì‹œ
        document.getElementById('displayCustomerName').textContent = customerName;
        document.getElementById('companyName').textContent = companyName;
        document.getElementById('consultantName').textContent = consultantName;
        document.getElementById('consultantTitle').textContent = consultantTitle;
        
        // ================================================================
        // Google API ì´ˆê¸°í™”
        // ================================================================
        
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }
        
        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: [DISCOVERY_DOC],
                });
                gapiLoaded = true;
                console.log('âœ… GAPI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ GAPI ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        }
        
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '',
            });
            gisLoaded = true;
            console.log('âœ… GIS ì´ˆê¸°í™” ì™„ë£Œ');
        }
        
        // ================================================================
        // Firebase ë¡œê·¸ì¸ ì²´í¬
        // ================================================================
        
        async function checkFirebaseLogin() {
            if (!firebaseAuth) return;
            
            return new Promise((resolve) => {
                firebaseAuth.onAuthStateChanged(async (user) => {
                    if (user) {
                        currentUser = user;
                        console.log('âœ… Firebase ë¡œê·¸ì¸ ì™„ë£Œ:', user.email);
                        resolve(true);
                    } else {
                        console.log('â„¹ï¸ Firebase ë¡œê·¸ì¸ í•„ìš”');
                        
                        try {
                            const provider = new firebase.auth.GoogleAuthProvider();
                            await firebaseAuth.signInWithPopup(provider);
                            console.log('âœ… Firebase ìë™ ë¡œê·¸ì¸ ì™„ë£Œ');
                            resolve(true);
                        } catch (error) {
                            console.warn('Firebase ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                            resolve(false);
                        }
                    }
                });
            });
        }
        
        // ================================================================
        // Google Drive ì—°ë™ í•¨ìˆ˜
        // ================================================================
        
        async function getAccessToken() {
            return new Promise((resolve, reject) => {
                try {
                    tokenClient.callback = async (response) => {
                        if (response.error !== undefined) {
                            reject(response);
                        }
                        accessToken = response.access_token;
                        resolve(accessToken);
                    };
                    
                    if (accessToken === null) {
                        tokenClient.requestAccessToken({prompt: 'consent'});
                    } else {
                        tokenClient.requestAccessToken({prompt: ''});
                    }
                } catch (error) {
                    reject(error);
                }
            });
        }
        
        async function findFolder(folderName) {
            try {
                const response = await gapi.client.drive.files.list({
                    q: `name='${folderName}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });
                
                return response.result.files.length > 0 ? response.result.files[0].id : null;
            } catch (error) {
                console.error('í´ë” ì°¾ê¸° ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        async function createFolder(folderName) {
            try {
                const response = await gapi.client.drive.files.create({
                    resource: {
                        name: folderName,
                        mimeType: 'application/vnd.google-apps.folder'
                    },
                    fields: 'id'
                });
                
                return response.result.id;
            } catch (error) {
                console.error('í´ë” ìƒì„± ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        async function findFileInFolder(fileName, folderId) {
            try {
                const response = await gapi.client.drive.files.list({
                    q: `name='${fileName}' and '${folderId}' in parents and trashed=false`,
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });
                
                return response.result.files.length > 0 ? response.result.files[0] : null;
            } catch (error) {
                console.error('íŒŒì¼ ì°¾ê¸° ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        async function loadSubscribers(fileId) {
            try {
                const response = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media'
                });
                
                return JSON.parse(response.body);
            } catch (error) {
                console.error('êµ¬ë…ì ë¡œë“œ ì˜¤ë¥˜:', error);
                return [];
            }
        }
        
        async function saveSubscribers(subscribers, folderId, fileId = null) {
            const boundary = '-------314159265358979323846';
            const delimiter = "\r\n--" + boundary + "\r\n";
            const close_delim = "\r\n--" + boundary + "--";
            
            const metadata = {
                name: SUBSCRIBERS_FILE,
                mimeType: 'application/json',
                parents: [folderId]
            };
            
            const multipartRequestBody =
                delimiter +
                'Content-Type: application/json; charset=UTF-8\r\n\r\n' +
                JSON.stringify(metadata) +
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                JSON.stringify(subscribers, null, 2) +
                close_delim;
            
            try {
                const response = await gapi.client.request({
                    path: fileId ? `/upload/drive/v3/files/${fileId}` : '/upload/drive/v3/files',
                    method: fileId ? 'PATCH' : 'POST',
                    params: {
                        uploadType: 'multipart'
                    },
                    headers: {
                        'Content-Type': 'multipart/related; boundary="' + boundary + '"'
                    },
                    body: multipartRequestBody
                });
                
                return response.result.id;
            } catch (error) {
                console.error('êµ¬ë…ì ì €ì¥ ì˜¤ë¥˜:', error);
                throw error;
            }
        }
        
        // ================================================================
        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        // ================================================================
        
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.innerHTML = message;
            statusEl.className = `status-message show ${type}`;
            
            // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€ (ì—ëŸ¬ ì œì™¸)
            if (type !== 'error') {
                setTimeout(() => {
                    statusEl.classList.remove('show');
                }, 5000);
            }
        }
        
        // ================================================================
        // í‘¸ì‹œ êµ¬ë… ë©”ì¸ í•¨ìˆ˜
        // ================================================================
        
        window.subscribePush = async function() {
            const btn = document.getElementById('subscribeBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner"></span>ì²˜ë¦¬ ì¤‘...';
            
            try {
                // 1. ë¸Œë¼ìš°ì € ì§€ì› í™•ì¸
                if (!('Notification' in window)) {
                    throw new Error('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                
                // 2. ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
                showStatus('ğŸ“± ì•Œë¦¼ ê¶Œí•œì„ ìš”ì²­í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                const permission = await Notification.requestPermission();
                
                if (permission !== 'granted') {
                    throw new Error('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }
                
                // 3. Google Drive ì¸ì¦
                showStatus('ğŸ” Google ê³„ì • ì—°ê²° ì¤‘...', 'info');
                if (!gapiLoaded || !gisLoaded) {
                    throw new Error('Google APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
                
                await getAccessToken();
                
                // Firebase ë¡œê·¸ì¸ ì²´í¬
                await checkFirebaseLogin();
                
                // 4. êµ¬ë… ì •ë³´ ì €ì¥
                showStatus('ğŸ’¾ êµ¬ë… ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                await saveSubscription();
                
                // 5. ì™„ë£Œ
                showStatus('âœ… ì•Œë¦¼ êµ¬ë…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!<br>ì´ì œ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'success');
                btn.innerHTML = 'âœ… êµ¬ë… ì™„ë£Œ';
                btn.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
                
                // í…ŒìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
                setTimeout(() => {
                    new Notification('ğŸ‰ êµ¬ë… ì™„ë£Œ!', {
                        body: `${consultantName}ë‹˜ì˜ ì•Œë¦¼ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                        icon: 'ğŸ””',
                        badge: 'ğŸ””'
                    });
                }, 1000);
                
                // 5ì´ˆ í›„ ì°½ ë‹«ê¸° ë˜ëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸
                setTimeout(() => {
                    showStatus('âœ… êµ¬ë…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì°½ì„ ë‹«ìœ¼ì…”ë„ ë©ë‹ˆë‹¤.', 'success');
                }, 3000);
                
            } catch (error) {
                console.error('êµ¬ë… ì˜¤ë¥˜:', error);
                let errorMessage = 'âŒ ' + error.message;
                
                if (error.message.includes('ê¶Œí•œ')) {
                    errorMessage += '<br><br>ğŸ’¡ <strong>í•´ê²° ë°©ë²•:</strong><br>1. ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ ì™¼ìª½ ìë¬¼ì‡  ì•„ì´ì½˜ í´ë¦­<br>2. ì•Œë¦¼ ê¶Œí•œì„ "í—ˆìš©"ìœ¼ë¡œ ë³€ê²½<br>3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„';
                }
                
                showStatus(errorMessage, 'error');
                btn.disabled = false;
                btn.innerHTML = 'ğŸ”” ì•Œë¦¼ ë°›ê¸°';
            }
        };
        
        // ================================================================
        // êµ¬ë… ì •ë³´ ì €ì¥
        // ================================================================
        
        async function saveSubscription() {
            try {
                // í´ë” í™•ì¸ ë˜ëŠ” ìƒì„±
                let folderId = await findFolder(FOLDER_NAME);
                if (!folderId) {
                    folderId = await createFolder(FOLDER_NAME);
                }
                
                if (!folderId) {
                    throw new Error('Drive í´ë”ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ê¸°ì¡´ êµ¬ë…ì íŒŒì¼ í™•ì¸
                const file = await findFileInFolder(SUBSCRIBERS_FILE, folderId);
                let subscribers = [];
                
                if (file) {
                    subscribers = await loadSubscribers(file.id);
                }
                
                // ìƒˆ êµ¬ë…ì ì •ë³´ ìƒì„±
                const newSubscriber = {
                    id: Date.now(),
                    consultantId: consultantId,
                    customerId: customerId,
                    customerName: customerName,
                    consultantName: consultantName,
                    subscribedAt: new Date().toISOString(),
                    permission: 'granted',
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    notificationToken: 'browser-notification-' + Date.now(), // ê°„ë‹¨í•œ í† í°
                    status: 'active'
                };
                
                // ê¸°ì¡´ êµ¬ë…ì í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
                const existingIndex = subscribers.findIndex(s => 
                    s.customerId === customerId && s.consultantId === consultantId
                );
                
                if (existingIndex >= 0) {
                    // ê¸°ì¡´ êµ¬ë…ì ì—…ë°ì´íŠ¸
                    subscribers[existingIndex] = {
                        ...subscribers[existingIndex],
                        ...newSubscriber,
                        updatedAt: new Date().toISOString()
                    };
                    console.log('âœ… ê¸°ì¡´ êµ¬ë… ì •ë³´ ì—…ë°ì´íŠ¸');
                } else {
                    // ìƒˆ êµ¬ë…ì ì¶”ê°€
                    subscribers.push(newSubscriber);
                    console.log('âœ… ìƒˆ êµ¬ë…ì ì¶”ê°€');
                }
                
                // Driveì— ì €ì¥
                await saveSubscribers(subscribers, folderId, file ? file.id : null);
                
                // localStorageì—ë„ ë°±ì—… ì €ì¥
                localStorage.setItem('kfpc_subscriber_info', JSON.stringify(newSubscriber));
                
                console.log('âœ… êµ¬ë… ì •ë³´ ì €ì¥ ì™„ë£Œ:', newSubscriber);
                
            } catch (error) {
                console.error('êµ¬ë… ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
                throw new Error('êµ¬ë… ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ================================================================
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í™•ì¸
        // ================================================================
        
        window.addEventListener('load', async () => {
            // ì´ë¯¸ êµ¬ë…ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            if ('Notification' in window && Notification.permission === 'granted') {
                const savedInfo = localStorage.getItem('kfpc_subscriber_info');
                if (savedInfo) {
                    showStatus('âœ… ì´ë¯¸ ì•Œë¦¼ì„ êµ¬ë…í•˜ê³  ê³„ì‹­ë‹ˆë‹¤.', 'info');
                    document.getElementById('subscribeBtn').innerHTML = 'âœ… êµ¬ë… ì¤‘';
                    document.getElementById('subscribeBtn').style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
                }
            }
            
            // URL íŒŒë¼ë¯¸í„° ë¡œê·¸ (ë””ë²„ê¹…ìš©)
            console.log('ğŸ“Š êµ¬ë… í˜ì´ì§€ ì •ë³´:', {
                consultantId,
                customerId,
                customerName,
                consultantName,
                consultantTitle
            });
        });
        
        // GAPI ë° GIS ë¡œë“œ
        window.gapiLoaded = gapiLoaded;
        window.gisLoaded = gisLoaded;
    </script>
    
    <!-- Google API ë¡œë“œ -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
