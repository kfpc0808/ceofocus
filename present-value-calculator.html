<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>현재가치·연금 현재가치 계산기 (KFPC)</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body{
            font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI','Roboto',sans-serif;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh; padding:15px; line-height:1.4;
        }
        .container{
            max-width:1400px; margin:0 auto; background:#fff; border-radius:15px;
            box-shadow:0 20px 60px rgba(0,0,0,.3); overflow:hidden;
        }

        /* ===== Header with KFPC logo ===== */
        .header{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:#fff; padding:16px 24px;
            display:flex; align-items:center; justify-content:space-between; gap:16px;
        }
        .brand{
            display:flex; align-items:center; gap:10px; user-select:none; cursor:pointer;
        }
        .brand .logo{
            font-weight:900; letter-spacing:.5px; font-size:22px;
            background:linear-gradient(135deg,#ffffff 0%, #e6eaff 40%, #ffe7ae 100%);
            -webkit-background-clip:text; background-clip:text; color:transparent;
            text-shadow:0 2px 10px rgba(0,0,0,.15);
        }
        .brand .divider{
            width:1px; height:22px; background:rgba(255,255,255,.35);
        }
        .headings{
            flex:1; text-align:center;
        }
        .headings h1{ font-size:1.8em; margin-bottom:4px; }
        .headings p{ font-size:.95em; opacity:.9; }

        .usage-guide{ background:#f8f9fa; padding:15px 30px; border-bottom:2px solid #667eea; }
        .usage-guide h2{ color:#667eea; margin-bottom:10px; font-size:1.2em; }
        .usage-guide ul{ list-style-position:inside; margin-left:15px; }
        .usage-guide li{ margin:5px 0; color:#333; font-size:.85em; }
        .usage-guide strong{ color:#667eea; }

        .main-content{ display:flex; gap:20px; padding:20px; }
        .calculator-side{ flex:1; }

        .tabs{ display:flex; gap:8px; margin-bottom:15px; }
        .tab-button{
            flex:1; padding:10px 15px; border:none; background:#e9ecef; color:#495057;
            font-size:.95em; font-weight:600; cursor:pointer; border-radius:8px; transition:.3s;
        }
        .tab-button.active{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:#fff; transform:translateY(-2px); box-shadow:0 5px 15px rgba(102,126,234,.4);
        }
        .tab-content{ display:none; }
        .tab-content.active{ display:block; }

        .input-group{ margin-bottom:15px; }
        .input-group label{ display:block; margin-bottom:5px; color:#495057; font-weight:700; font-size:.9em; }
        .input-wrapper{ position:relative; display:flex; align-items:center; }
        .input-wrapper input{
            flex:1; padding:10px; border:2px solid #e9ecef; border-radius:8px; font-size:1em; transition:.3s;
        }
        .input-wrapper input:focus{ outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.1); }
        .input-prefix,.input-suffix{ position:absolute; color:#6c757d; font-weight:700; font-size:.95em; }
        .input-prefix{ left:12px; } .input-suffix{ right:12px; }
        .input-wrapper input.with-prefix{ padding-left:35px; }
        .input-wrapper input.with-suffix{ padding-right:45px; }
        .input-hint{ display:block; margin-top:3px; font-size:.75em; color:#6c757d; font-style:italic; }

        .quick-buttons{ display:flex; gap:5px; flex-wrap:wrap; margin-top:5px; }
        .quick-button{
            padding:5px 10px; border:1px solid #667eea; background:#fff; color:#667eea;
            border-radius:15px; cursor:pointer; font-size:.8em; transition:.2s;
        }
        .quick-button:hover{ background:#667eea; color:#fff; }

        .radio-group{ display:flex; gap:15px; margin-top:8px; }
        .radio-option{ display:flex; align-items:center; gap:6px; cursor:pointer; font-size:.9em; }
        .radio-option input[type="radio"]{ width:18px; height:18px; cursor:pointer; }

        .calculate-button{
            width:100%; padding:12px;
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff;
            border:none; border-radius:8px; font-size:1.1em; font-weight:700; cursor:pointer; transition:.3s; margin-top:15px;
        }
        .calculate-button:hover{ transform:translateY(-2px); box-shadow:0 10px 25px rgba(102,126,234,.4); }

        .result-side{
            flex:1; background:#f8f9fa; padding:20px; border-radius:12px; max-height:none; overflow-y:visible;
        }
        .result-title{
            font-size:1.2em; color:#495057; margin-bottom:12px; padding-bottom:10px; border-bottom:2px solid #667eea;
        }
        .result-box{ background:#fff; padding:15px; border-radius:8px; margin-bottom:12px; box-shadow:0 2px 10px rgba(0,0,0,.05); }
        .result-item{ display:flex; justify-content:space-between; margin:8px 0; font-size:.95em; }
        .result-label{ color:#6c757d; font-weight:600; }
        .result-value{ color:#667eea; font-weight:900; font-size:1.1em; }

        .result-table{ width:100%; border-collapse:collapse; margin-top:12px; font-size:.8em; display:table; max-height:none; }
        .result-table thead{ display:table-header-group; }
        .result-table tbody{ display:table-row-group; max-height:none; }
        .result-table tbody tr{ display:table-row; }
        .result-table th{
            background:#667eea; color:#fff; padding:8px 4px; text-align:center; font-weight:800; font-size:.9em;
        }
        .result-table td{ padding:6px 4px; text-align:center; border-bottom:1px solid #e9ecef; font-size:.85em; }
        .result-table tr:hover{ background:#f8f9fa; }

        .chart-wrap{
            background:#fff; margin-top:12px; border-radius:8px; padding:12px;
            box-shadow:0 2px 10px rgba(0,0,0,.05);
        }
        .chart-title{ font-size:.9em; font-weight:800; color:#495057; margin-bottom:8px; }

        .result-explanation{
            background:#fff3cd; padding:12px; border-radius:8px; margin-top:12px; border-left:3px solid #667eea; box-shadow:0 2px 8px rgba(0,0,0,.1);
        }
        .result-explanation h4{ color:#667eea; font-size:.9em; margin-bottom:8px; display:flex; align-items:center; gap:6px; }
        .result-explanation p{ font-size:.75em; color:#6c757d; line-height:1.5; margin-bottom:6px; }
        .result-explanation ul{ font-size:.75em; color:#6c757d; margin-left:15px; line-height:1.5; }
        .result-explanation li{ margin-bottom:4px; }
        .result-explanation strong{ color:#495057; font-weight:700; }
        .highlight-box{ background:#fff; padding:8px; border-radius:6px; margin-top:6px; font-size:.75em; color:#495057; }

        .error-message{ background:#f8d7da; color:#721c24; padding:10px; border-radius:8px; margin-top:12px; display:none; font-size:.85em; }

        @media (max-width:768px){
            body{ padding:10px; }
            .headings h1{ font-size:1.5em; }
            .headings p{ font-size:.85em; }
            .usage-guide{ padding:12px 20px; }
            .usage-guide h2{ font-size:1em; }
            .usage-guide li{ font-size:.8em; }
            .main-content{ flex-direction:column; padding:15px; }
            .tabs{ flex-direction:column; }
            .result-side{ max-height:none; padding:15px; }
            .result-table{ font-size:.75em; }
            .result-table th, .result-table td{ padding:6px 2px; }
            .result-explanation{ padding:10px; }
            .result-explanation h4{ font-size:.85em; }
            .result-explanation p, .result-explanation ul, .highlight-box{ font-size:.7em; }
        }

        .hidden{ display:none; }

        /* ===== Welcome Modal ===== */
        .modal-overlay{
            position:fixed; inset:0; background:rgba(0,0,0,.7);
            display:flex; justify-content:center; align-items:center; z-index:9999; padding:20px;
        }
        .modal-content{
            background:#fff; border-radius:15px; max-width:550px; width:100%; max-height:85vh; overflow-y:auto;
            box-shadow:0 20px 60px rgba(0,0,0,.5); animation:modalSlideIn .4s ease-out;
        }
        @keyframes modalSlideIn{ from{opacity:0; transform:translateY(-50px) scale(.9);} to{opacity:1; transform:translateY(0) scale(1);} }
        @keyframes fadeOut{ from{opacity:1;} to{opacity:0;} }
        .modal-header{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; padding:20px; border-radius:15px 15px 0 0; text-align:center; }
        .modal-header h2{ font-size:1.5em; margin-bottom:8px; }
        .modal-header .emoji{ font-size:2.5em; margin-bottom:8px; display:block; }
        .modal-header p{ font-size:.9em; }
        .modal-body{ padding:20px; }
        .modal-section{ margin-bottom:15px; }
        .modal-section h3{ color:#667eea; font-size:1.1em; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
        .modal-section p{ color:#495057; line-height:1.6; margin-bottom:8px; font-size:.85em; }
        .modal-section ul{ list-style:none; padding-left:0; }
        .modal-section li{ color:#495057; padding:6px 0 6px 25px; position:relative; line-height:1.5; font-size:.85em; }
        .modal-section li:before{ content:"✓"; position:absolute; left:0; color:#667eea; font-weight:bold; font-size:1.1em; }
        .example-box{ background:#f8f9fa; padding:10px; border-radius:8px; border-left:3px solid #667eea; margin-top:8px; }
        .example-box strong{ color:#667eea; font-size:.85em; }
        .example-box p{ font-size:.8em; margin-bottom:5px; }
        .modal-button{ width:100%; padding:14px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none; border-radius:8px; font-size:1.1em; font-weight:700; cursor:pointer; transition:.3s; margin-top:8px; }
        .modal-button:hover{ transform:translateY(-2px); box-shadow:0 10px 25px rgba(102,126,234,.4); }

        /* ===== Footer ===== */
        .footer{
            text-align:center; color:#6c757d; font-size:.85em; padding:16px; border-top:1px solid #e9ecef; background:#fff;
        }
    </style>
</head>
<body>
    <!-- 초기 팝업 모달 -->
    <div class="modal-overlay" id="welcomeModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="emoji">💰</span>
                <h2>현재가치 계산기 사용 가이드</h2>
                <p>쉽고 빠르게 미래의 돈 가치를 계산하세요!</p>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3>🎯 현재가치란?</h3>
                    <p>미래에 받을 돈이 지금은 얼마의 값어치인지 나타내는 수치입니다.</p>
                </div>
                <div class="modal-section">
                    <h3>📊 두 가지 계산</h3>
                    <ul>
                        <li><strong>고정 기간:</strong> 미래 일시금의 현재가치</li>
                        <li><strong>고정 지불금:</strong> 연금처럼 정기 지급의 현재가치</li>
                    </ul>
                </div>
                <div class="modal-section">
                    <h3>💡 활용 예시</h3>
                    <div class="example-box"><strong>은퇴 자금:</strong><p>“10년 후 1,000만원이 필요하면 지금 얼마?”</p></div>
                    <div class="example-box"><strong>연금 평가:</strong><p>“매년 100만원×10년의 현재가치는?”</p></div>
                </div>
                <div class="modal-section">
                    <h3>⚙️ 사용법</h3>
                    <ul>
                        <li>계산 방법 <strong>탭 선택</strong></li>
                        <li>각 항목에 <strong>숫자 입력</strong>(, 자동)</li>
                        <li><strong>계산하기</strong> 클릭 → 오른쪽에 결과</li>
                    </ul>
                </div>
                <button class="modal-button" onclick="closeWelcomeModal()">확인하고 계산기 사용하기 →</button>
            </div>
        </div>
    </div>

    <div class="container" id="top">
        <!-- Header with KFPC text logo -->
        <div class="header">
            <div class="brand" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="KFPC 홈으로">
                <span class="logo">KFPC</span>
                <span class="divider"></span>
            </div>
            <div class="headings">
                <h1>💰 현재가치·연금 현재가치 계산기</h1>
                <p>미래의 돈이 지금 얼마인지, 한눈에 계산하세요</p>
            </div>
            <div style="width:64px;"></div>
        </div>

        <div class="usage-guide">
            <h2>📘 사용 가이드</h2>
            <ul>
                <li><strong>고정 기간:</strong> 미래 일시금의 현재가치 (예: 10년 후 1,000만원 = 지금 얼마?)</li>
                <li><strong>고정 지불금:</strong> 정기 지급의 현재가치 (예: 매년 30만원×10년 = 현재 얼마?)</li>
                <li><strong>이자율:</strong> 연간 수익률/할인율 (6 → 6%)</li>
                <li><strong>자동 포맷:</strong> 숫자 입력 시 천단위 콤마 자동</li>
            </ul>
        </div>

        <div class="main-content">
            <div class="calculator-side">
                <div class="tabs">
                    <button class="tab-button active" onclick="switchTab(0)">고정 기간</button>
                    <button class="tab-button" onclick="switchTab(1)">고정 지불금</button>
                </div>

                <!-- 탭 1: 고정 기간 -->
                <div class="tab-content active" id="tab1">
                    <div class="input-group">
                        <label>미래 금액</label>
                        <div class="input-wrapper">
                            <span class="input-prefix">₩</span>
                            <input type="text" id="future_value" class="with-prefix" value="10,000,000" oninput="formatNumber(this)">
                        </div>
                        <span class="input-hint">미래에 받을 금액을 입력하세요</span>
                    </div>

                    <div class="input-group">
                        <label>기간(년)</label>
                        <div class="input-wrapper">
                            <input type="text" id="number_periods" value="10" oninput="formatNumber(this)">
                        </div>
                        <span class="input-hint">몇 년 뒤인지 입력하세요</span>
                        <div class="quick-buttons">
                            <button class="quick-button" onclick="setQuickValue('number_periods','5')">5년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods','10')">10년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods','15')">15년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods','20')">20년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods','30')">30년</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>이자율(%)</label>
                        <div class="input-wrapper">
                            <input type="text" id="interest_rate" class="with-suffix" value="6" oninput="formatNumber(this)">
                            <span class="input-suffix">%</span>
                        </div>
                        <span class="input-hint">연 수익률 또는 할인율 (예: 6)</span>
                        <div class="quick-buttons">
                            <button class="quick-button" onclick="setQuickValue('interest_rate','2.5')">2.5%</button>
                            <button class="quick-button" onclick="setQuickValue('interest_rate','3')">3%</button>
                            <button class="quick-button" onclick="setQuickValue('interest_rate','4')">4%</button>
                            <button class="quick-button" onclick="setQuickValue('interest_rate','6')">6%</button>
                        </div>
                    </div>

                    <button class="calculate-button" onclick="calculate1()">계산하기</button>
                </div>

                <!-- 탭 2: 고정 지불금 -->
                <div class="tab-content" id="tab2">
                    <div class="input-group">
                        <label>정기 입금액(매년)</label>
                        <div class="input-wrapper">
                            <span class="input-prefix">₩</span>
                            <input type="text" id="periodic_deposit" class="with-prefix" value="300,000" oninput="formatNumber(this)">
                        </div>
                        <span class="input-hint">매년 넣을 금액</span>
                    </div>

                    <div class="input-group">
                        <label>기간(년)</label>
                        <div class="input-wrapper">
                            <input type="text" id="number_periods_2" value="10" oninput="formatNumber(this)">
                        </div>
                        <span class="input-hint">총 몇 년 입금하는지</span>
                        <div class="quick-buttons">
                            <button class="quick-button" onclick="setQuickValue('number_periods_2','5')">5년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods_2','10')">10년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods_2','15')">15년</button>
                            <button class="quick-button" onclick="setQuickValue('number_periods_2','20')">20년</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>이자율(%)</label>
                        <div class="input-wrapper">
                            <input type="text" id="interest_rate_2" class="with-suffix" value="6" oninput="formatNumber(this)">
                            <span class="input-suffix">%</span>
                        </div>
                        <span class="input-hint">연 수익률</span>
                        <div class="quick-buttons">
                            <button class="quick-button" onclick="setQuickValue('interest_rate_2','2.5')">2.5%</button>
                            <button class="quick-button" onclick="setQuickValue('interest_rate_2','3')">3%</button>
                            <button class="quick-button" onclick="setQuickValue('interest_rate_2','4')">4%</button>
                            <button class="quick-button" onclick="setQuickValue('interest_rate_2','6')">6%</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>입금 시점</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="pmt" value="beginning" checked>
                                <span>기간 시작에 입금</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="pmt" value="end">
                                <span>기간 끝에 입금</span>
                            </label>
                        </div>
                        <span class="input-hint">시작에 넣으면 이자가 더 붙습니다</span>
                    </div>

                    <button class="calculate-button" onclick="calculate2()">계산하기</button>
                </div>

                <div class="error-message" id="error-box"></div>
            </div>

            <div class="result-side">
                <h2 class="result-title">📊 계산 결과</h2>

                <!-- 탭 1 결과 -->
                <div id="result1" class="hidden">
                    <div class="result-box">
                        <div class="result-item">
                            <span class="result-label">현재가치</span>
                            <span class="result-value" id="pv_result1">₩0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">총 이자</span>
                            <span class="result-value" id="interest_result1">₩0</span>
                        </div>
                    </div>

                    <div class="result-explanation">
                        <h4>📖 쉽게 이해하기</h4>
                        <p><strong>현재가치</strong>는 “지금 얼마를 갖고 있으면 목표 금액이 되는가”입니다.</p>
                        <p><strong>총 이자</strong>는 현재가치와 미래 금액의 차이입니다.</p>
                        <div class="highlight-box">💡 대학등록금·주택자금 같은 장기 목표 계산에 유용합니다.</div>
                    </div>
                </div>

                <!-- 탭 2 결과 -->
                <div id="result2" class="hidden">
                    <div class="result-box">
                        <div class="result-item">
                            <span class="result-label">현재가치</span>
                            <span class="result-value" id="pv_result2">₩0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">미래가치</span>
                            <span class="result-value" id="fv_result2">₩0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">총 이자</span>
                            <span class="result-value" id="interest_result2">₩0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">총 원금</span>
                            <span class="result-value" id="principal_result2">₩0</span>
                        </div>
                    </div>

                    <table class="result-table" id="result-table">
                        <thead>
                            <tr>
                                <th>년도</th>
                                <th>시작 잔액</th>
                                <th>이자</th>
                                <th>원금</th>
                                <th>증가분(Δ)</th>
                                <th>종료 잔액</th>
                            </tr>
                        </thead>
                        <tbody id="table-body"></tbody>
                    </table>

                    <div class="chart-wrap">
                        <div class="chart-title">연도별 종료 잔액 추이 (선형 그래프)</div>
                        <canvas id="resultChart" width="800" height="280" aria-label="연도별 종료 잔액 그래프"></canvas>
                    </div>

                    <div class="result-explanation">
                        <h4>📖 쉽게 이해하기</h4>
                        <p><strong>현재가치</strong>: 연금처럼 받을 돈의 “지금 값어치”.</p>
                        <p><strong>미래가치</strong>: 모든 입금에 복리가 붙어 최종적으로 모이는 금액.</p>
                        <p><strong>증가분(Δ)</strong>: 해당 연도에 늘어난 금액(이자+원금).</p>
                        <div class="highlight-box"><strong>표 해석:</strong> 시작잔액 → 이자 → 원금 → 종료잔액(누적)</div>
                        <div class="highlight-box" style="margin-top:6px;">💡 입금을 “기간 시작”으로 선택하면 이자가 더 붙어 유리합니다.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Copyright © 2025 KFPC Co., Ltd. All Rights Reserved.
        </div>
    </div>

    <script>
        // 탭 전환
        function switchTab(index){
            const tabs=document.querySelectorAll('.tab-button');
            const contents=document.querySelectorAll('.tab-content');
            tabs.forEach((tab,i)=>{
                if(i===index){ tab.classList.add('active'); contents[i].classList.add('active'); }
                else{ tab.classList.remove('active'); contents[i].classList.remove('active'); }
            });
            document.getElementById('result1').classList.add('hidden');
            document.getElementById('result2').classList.add('hidden');
            document.getElementById('error-box').style.display='none';
        }

        // 숫자 포맷팅
        function formatNumber(input){
            let value=input.value.replace(/,/g,'');
            if(value==='') return;
            const parts=value.split('.');
            parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,',');
            input.value=parts.join('.');
        }

        // 빠른 값
        function setQuickValue(id,value){
            const input=document.getElementById(id);
            input.value=value; formatNumber(input);
        }

        // 파싱/표시 유틸
        function parseNumber(value){ return parseFloat(value.replace(/,/g,''))||0; }
        function formatCurrency(number){ return '₩'+Math.round(number).toLocaleString('ko-KR'); }

        // 오류 표시
        function showError(message){
            const box=document.getElementById('error-box');
            box.textContent=message; box.style.display='block';
        }

        // ===== 탭1 계산: 고정 기간 =====
        function calculate1(){
            try{
                const fv=parseNumber(document.getElementById('future_value').value);
                const n =parseNumber(document.getElementById('number_periods').value);
                const r =parseNumber(document.getElementById('interest_rate').value)/100;

                if(fv<=0 || n<=0 || r<0){ showError('모든 값은 0보다 커야 합니다.'); return; }

                const pv=fv/Math.pow(1+r,n);
                const totalInterest=fv-pv;

                document.getElementById('pv_result1').textContent=formatCurrency(pv);
                document.getElementById('interest_result1').textContent=formatCurrency(totalInterest);

                document.getElementById('result1').classList.remove('hidden');
                document.getElementById('result2').classList.add('hidden');
                document.getElementById('error-box').style.display='none';
            }catch(e){ showError('계산 중 오류가 발생했습니다.'); }
        }

        // ===== 간단 선형 차트 그리기(외부 라이브러리 없이) =====
        function drawLineChart(canvasId, labels, data){
            const canvas=document.getElementById(canvasId);
            if(!canvas) return;
            const ctx=canvas.getContext('2d');

            // clear
            ctx.clearRect(0,0,canvas.width,canvas.height);

            // padding
            const pad={top:20,right:20,bottom:35,left:50};
            const W=canvas.width, H=canvas.height;
            const chartW=W-pad.left-pad.right, chartH=H-pad.top-pad.bottom;

            // scales
            const minY=0;
            const maxY=Math.max(...data)*1.1 || 1;
            const stepX=chartW/(labels.length-1 || 1);

            // axes
            ctx.strokeStyle="#d0d7e2";
            ctx.lineWidth=1;
            ctx.beginPath();
            ctx.moveTo(pad.left, pad.top);
            ctx.lineTo(pad.left, H-pad.bottom);
            ctx.lineTo(W-pad.right, H-pad.bottom);
            ctx.stroke();

            // y grid & labels (5 lines)
            ctx.fillStyle="#546174";
            ctx.font="12px system-ui";
            ctx.textAlign="right"; ctx.textBaseline="middle";
            for(let i=0;i<=5;i++){
                const yVal=minY+(maxY-minY)*i/5;
                const y=H-pad.bottom - (yVal-minY)/(maxY-minY)*chartH;
                ctx.strokeStyle="#eef2f7";
                ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(W-pad.right, y); ctx.stroke();
                ctx.fillText('₩'+Math.round(yVal).toLocaleString('ko-KR'), pad.left-8, y);
            }

            // x labels
            ctx.textAlign="center"; ctx.textBaseline="top"; ctx.fillStyle="#546174";
            labels.forEach((lb,idx)=>{
                const x=pad.left+idx*stepX;
                ctx.fillText(lb, x, H-pad.bottom+8);
            });

            // line path
            ctx.strokeStyle="#667eea";
            ctx.lineWidth=2;
            ctx.beginPath();
            data.forEach((val,idx)=>{
                const x=pad.left+idx*stepX;
                const y=H-pad.bottom - (val-minY)/(maxY-minY)*chartH;
                if(idx===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            });
            ctx.stroke();

            // points
            ctx.fillStyle="#764ba2";
            data.forEach((val,idx)=>{
                const x=pad.left+idx*stepX;
                const y=H-pad.bottom - (val-minY)/(maxY-minY)*chartH;
                ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
            });
        }

        // ===== 탭2 계산: 고정 지불금 =====
        function calculate2(){
            try{
                const pmt=parseNumber(document.getElementById('periodic_deposit').value);
                const n  =parseNumber(document.getElementById('number_periods_2').value);
                const r  =parseNumber(document.getElementById('interest_rate_2').value)/100;
                const pmtType=document.querySelector('input[name="pmt"]:checked').value;

                if(pmt<=0 || n<=0 || r<0){ showError('모든 값은 0보다 커야 합니다.'); return; }

                // 현재가치
                let pv=pmt*((1-Math.pow(1+r,-n))/r);
                if(pmtType==='beginning') pv=pv*(1+r);

                // 표/미래가치
                const tableBody=document.getElementById('table-body');
                tableBody.innerHTML='';
                let balance=0;
                const labels=[], seriesEnd=[], seriesDelta=[];
                for(let i=1;i<=n;i++){
                    const startBalance=balance;
                    let interest, endBalance;

                    if(pmtType==='beginning'){
                        balance+=pmt;
                        interest=balance*r;
                        balance+=interest;
                        endBalance=balance;
                    }else{
                        interest=balance*r;
                        balance+=interest+pmt;
                        endBalance=balance;
                    }

                    const delta=endBalance-startBalance; // 증가분(이자+원금)
                    const row = `
                        <tr>
                            <td>${i}</td>
                            <td>${formatCurrency(startBalance)}</td>
                            <td>${formatCurrency(interest)}</td>
                            <td>${formatCurrency(pmt)}</td>
                            <td>${formatCurrency(delta)}</td>
                            <td>${formatCurrency(endBalance)}</td>
                        </tr>`;
                    tableBody.insertAdjacentHTML('beforeend', row);

                    labels.push(String(i));
                    seriesEnd.push(Math.round(endBalance));
                    seriesDelta.push(Math.round(delta));
                }

                const fv=balance;
                const totalPrincipal=pmt*n;
                const totalInterest=fv-totalPrincipal;

                document.getElementById('pv_result2').textContent=formatCurrency(pv);
                document.getElementById('fv_result2').textContent=formatCurrency(fv);
                document.getElementById('interest_result2').textContent=formatCurrency(totalInterest);
                document.getElementById('principal_result2').textContent=formatCurrency(totalPrincipal);

                document.getElementById('result2').classList.remove('hidden');
                document.getElementById('result1').classList.add('hidden');
                document.getElementById('error-box').style.display='none';

                // 그래프 그리기: 종료 잔액 선형
                drawLineChart('resultChart', labels, seriesEnd);
            }catch(error){
                showError('계산 중 오류가 발생했습니다.');
            }
        }

        // 팝업 닫기
        function closeWelcomeModal(){
            const modal=document.getElementById('welcomeModal');
            modal.style.animation='fadeOut .3s ease-out';
            setTimeout(()=>{ modal.style.display='none'; },300);
        }

        // 초기 포맷팅
        window.onload=function(){
            formatNumber(document.getElementById('future_value'));
            formatNumber(document.getElementById('periodic_deposit'));
            document.getElementById('welcomeModal').style.display='flex';
        };
    </script>
</body>
</html>