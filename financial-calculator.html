<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>재무계산기 - 원화 버전</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #f3f4f6;
            color: #1f2937;
            line-height: 1.6;
            padding: 20px 20px 30px 20px;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .header-logo {
            font-size: 32px;
            font-weight: 900;
            font-family: 'Arial Black', 'Arial', sans-serif;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #DAA520 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.4));
            flex-shrink: 0;
            position: relative;
            padding: 12px 20px;
            border-radius: 8px;
            background-image: 
                linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #DAA520 100%),
                linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.15) 100%);
            background-clip: text, border-box;
            -webkit-background-clip: text, border-box;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .header-logo::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(184, 134, 11, 0.1) 100%);
            transform: translate(-50%, -50%) rotate(45deg);
            border-radius: 8px;
            z-index: -1;
        }

        .header-content {
            flex: 1;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            margin: 0;
        }

        .footer {
            background: #1f2937;
            color: #9ca3af;
            text-align: center;
            padding: 25px 20px;
            font-size: 13px;
            max-width: 1200px;
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .footer-copyright {
            color: #d1d5db;
            margin: 0;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .input-section, .result-section {
            padding: 20px;
        }

        .input-section {
            background: #f9fafb;
            border-radius: 8px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #374151;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 25px;
            position: relative;
            overflow: visible;
        }

        .btn-toggle {
            position: relative;
            padding: 14px 12px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 600;
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            z-index: 1;
        }

        .btn-toggle:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            z-index: 100;
        }

        .btn-toggle.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            z-index: 10;
        }

        .btn-toggle.active:hover {
            z-index: 100;
        }

        .btn-main-text {
            font-size: 14px;
            font-weight: 700;
            color: inherit;
        }

        .btn-sub-text {
            font-size: 11px;
            opacity: 0.8;
            color: inherit;
        }

        .btn-toggle.active .btn-sub-text {
            opacity: 0.95;
        }

        .info-icon {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 18px;
            height: 18px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            cursor: help;
            z-index: 50;
            transition: all 0.2s;
        }

        .btn-toggle.active .info-icon {
            background: white;
            color: #667eea;
            z-index: 50;
        }

        .info-icon:hover {
            transform: scale(1.15);
            z-index: 100;
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 10px;
            padding: 12px 16px;
            background: #111827;
            color: white;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.5;
            white-space: normal;
            width: 280px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 2000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            pointer-events: none;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 7px solid transparent;
            border-top-color: #111827;
            z-index: 2001;
        }

        .btn-toggle:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .tooltip-title {
            font-weight: 700;
            color: #93c5fd;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
            overflow: visible;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 14px;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper input, .input-wrapper select {
            width: 100%;
            padding: 12px 50px 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-wrapper select {
            padding-right: 35px;
            cursor: pointer;
        }

        .input-wrapper input:focus, .input-wrapper select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-wrapper input:disabled {
            background: #f3f4f6;
            color: #9ca3af;
        }

        .input-suffix {
            position: absolute;
            right: 15px;
            color: #6b7280;
            font-size: 14px;
        }

        .help-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
            line-height: 1.4;
        }

        .auto-calc {
            background: #eff6ff;
            padding: 10px;
            border-radius: 6px;
            margin-top: 5px;
            font-size: 12px;
            color: #1e40af;
            font-weight: 600;
        }

        .options {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #e5e7eb;
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .result-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #d1fae5;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #065f46;
        }

        .result-value {
            font-size: 24px;
            font-weight: 700;
            color: #047857;
        }

        .result-explanation {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.6;
        }

        .chart-container {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }

        .chart-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            text-align: center;
        }

        canvas {
            width: 100% !important;
            height: auto !important;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #667eea;
        }

        .modal-body {
            line-height: 1.8;
            color: #374151;
        }

        .modal-body h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .modal-body ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .modal-body li {
            margin-bottom: 8px;
        }

        .modal-footer {
            margin-top: 25px;
            text-align: center;
        }

        .modal-btn {
            padding: 12px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .error-message {
            background: #fee2e2;
            border: 2px solid #fca5a5;
            color: #991b1b;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .button-group {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px 20px;
                gap: 15px;
            }

            .header-logo {
                width: 45px;
                height: 45px;
            }

            .header h1 {
                font-size: 20px;
                margin-bottom: 3px;
            }

            .header p {
                font-size: 12px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .button-group {
                gap: 8px;
            }
            
            .btn-toggle {
                padding: 10px 8px;
                font-size: 11px;
            }
            
            .modal-content {
                margin: 5% auto;
                padding: 20px;
            }

            .tooltip {
                width: 240px;
                font-size: 11px;
                padding: 10px 12px;
            }

            .footer {
                font-size: 11px;
                padding: 20px 15px;
            }
        }

        .two-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 480px) {
            .two-inputs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 사용 설명 모달 -->
    <div id="instructionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">📊 재무계산기 사용 가이드</div>
            <div class="modal-body">
                <p><strong>재무계산기에 오신 것을 환영합니다!</strong></p>
                <p>복잡한 금융 계산을 쉽게! 저축과 투자 계획을 세워보세요.</p>
                
                <h3>🎯 무엇을 계산할 수 있나요?</h3>
                <ul>
                    <li><strong>미래가치</strong>: "지금 1천만원을 10년간 투자하면 얼마가 될까?"</li>
                    <li><strong>정기납입액</strong>: "5년 후 3천만원 모으려면 매월 얼마씩 저축해야 할까?"</li>
                    <li><strong>필요수익률</strong>: "목표 달성하려면 몇 %의 수익률이 필요할까?"</li>
                    <li><strong>투자기간</strong>: "매월 10만원씩 저축하면 목표까지 몇 년 걸릴까?"</li>
                    <li><strong>현재가치</strong>: "미래 목표를 위해 지금 얼마를 투자해야 할까?"</li>
                </ul>

                <h3>📝 사용 방법 (3단계)</h3>
                <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <p><strong>1단계:</strong> 알고 싶은 것을 선택하세요 (각 버튼의 ⓘ를 참고)</p>
                    <p><strong>2단계:</strong> 간단한 정보를 입력하세요 (투자 기간, 금액 등)</p>
                    <p><strong>3단계:</strong> 계산하기 버튼을 누르면 결과와 그래프가 나옵니다!</p>
                </div>

                <h3>💡 핵심 팁</h3>
                <p style="background: #fef3c7; padding: 12px; border-radius: 6px; margin-top: 10px;">
                    <strong>간단한 입력:</strong><br>
                    • 모든 금액은 <strong>양수로 입력</strong>하세요<br>
                    • 투자/저축하는 돈은 자동으로 처리됩니다<br>
                    • 예: 매월 10만원 저축 → 그냥 <strong>100,000</strong> 입력
                </p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeModal()">시작하기</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <!-- KFPC 텍스트 로고 -->
            <div class="header-logo">KFPC</div>
            
            <div class="header-content">
                <h1>💰 재무계산기</h1>
                <p>간단하고 쉬운 저축 & 투자 계산</p>
            </div>
        </div>

        <div class="main-content">
            <!-- 입력 섹션 -->
            <div class="input-section">
                <h2 class="section-title">📥 입력 항목</h2>
                
                <div class="input-group">
                    <label>무엇을 알고 싶으신가요?</label>
                    <div class="button-group">
                        <button class="btn-toggle active" data-find="fv">
                            <span class="info-icon">i</span>
                            <span class="btn-main-text">미래가치</span>
                            <span class="btn-sub-text">Future Value</span>
                            <div class="tooltip">
                                <div class="tooltip-title">미래가치 (Future Value)</div>
                                현재의 투자금과 정기적인 저축으로 미래에 얼마나 모을 수 있는지 계산합니다. 복리 효과를 포함한 최종 금액을 확인할 수 있습니다.
                            </div>
                        </button>
                        <button class="btn-toggle" data-find="pmt">
                            <span class="info-icon">i</span>
                            <span class="btn-main-text">정기납입액</span>
                            <span class="btn-sub-text">Payment</span>
                            <div class="tooltip">
                                <div class="tooltip-title">정기납입액 (Payment)</div>
                                목표 금액을 달성하기 위해 매월(또는 매번) 얼마씩 저축해야 하는지 계산합니다. 정기적인 저축 계획을 세울 때 유용합니다.
                            </div>
                        </button>
                        <button class="btn-toggle" data-find="iy">
                            <span class="info-icon">i</span>
                            <span class="btn-main-text">필요수익률</span>
                            <span class="btn-sub-text">Required Rate</span>
                            <div class="tooltip">
                                <div class="tooltip-title">필요수익률 (Required Rate)</div>
                                목표 금액을 달성하기 위해 필요한 연간 수익률을 계산합니다. 어떤 투자 상품을 선택해야 할지 판단하는 기준이 됩니다.
                            </div>
                        </button>
                        <button class="btn-toggle" data-find="n">
                            <span class="info-icon">i</span>
                            <span class="btn-main-text">투자기간</span>
                            <span class="btn-sub-text">Period</span>
                            <div class="tooltip">
                                <div class="tooltip-title">투자기간 (Investment Period)</div>
                                목표 금액을 모으는 데 필요한 시간(년)을 계산합니다. 언제까지 저축하면 목표에 도달할 수 있는지 알 수 있습니다.
                            </div>
                        </button>
                        <button class="btn-toggle" data-find="pv">
                            <span class="info-icon">i</span>
                            <span class="btn-main-text">현재가치</span>
                            <span class="btn-sub-text">Present Value</span>
                            <div class="tooltip">
                                <div class="tooltip-title">현재가치 (Present Value)</div>
                                미래의 목표 금액을 달성하기 위해 지금 당장 투자해야 하는 초기 금액을 계산합니다. 목돈 투자 계획 수립에 활용됩니다.
                            </div>
                        </button>
                    </div>
                    <div class="help-text">
                        💡 각 버튼의 ⓘ 아이콘에 마우스를 올려 상세 설명을 확인하세요<br>
                        ✨ 모든 금액은 양수로 입력하시면 됩니다
                    </div>
                </div>

                <div class="input-group" id="group-period">
                    <label>투자/저축 기간 <span style="color: #ef4444;">*</span></label>
                    <div class="two-inputs">
                        <div class="input-wrapper">
                            <input type="text" id="input-years" value="10" placeholder="예: 10">
                            <span class="input-suffix">년</span>
                        </div>
                        <div class="input-wrapper">
                            <select id="input-frequency">
                                <option value="1">매년</option>
                                <option value="2">6개월마다</option>
                                <option value="4">3개월마다</option>
                                <option value="12" selected>매월</option>
                            </select>
                        </div>
                    </div>
                    <div class="auto-calc" id="auto-n">
                        ✓ 자동 계산: 10년 × 매월 = 총 120회
                    </div>
                    <div class="help-text">
                        📅 <strong>기간 설정 예시:</strong><br>
                        • 10년 + 매월 = 10년간 매달 저축 (총 120회)<br>
                        • 5년 + 매년 = 5년간 1년에 1번 저축 (총 5회)<br>
                        • 3년 + 3개월마다 = 3년간 분기별 저축 (총 12회)
                    </div>
                </div>

                <div class="input-group" id="group-iy">
                    <label>연 이자율 (수익률) <span style="color: #ef4444;">*</span></label>
                    <div class="input-wrapper">
                        <input type="text" id="input-iy" value="5" placeholder="예: 5">
                        <span class="input-suffix">%</span>
                    </div>
                    <div class="help-text">
                        📈 예금 3%, 적금 4%, 주식 투자 7~10% 정도가 일반적입니다
                    </div>
                </div>

                <div class="input-group" id="group-pv">
                    <label>초기 투자금액 (목돈)</label>
                    <div class="input-wrapper">
                        <input type="text" id="input-pv" value="10,000,000" placeholder="예: 10,000,000">
                        <span class="input-suffix">원</span>
                    </div>
                    <div class="help-text">
                        💵 처음 한번에 투자하는 금액 (없으면 0 입력)
                    </div>
                </div>

                <div class="input-group" id="group-pmt">
                    <label>정기 저축금액</label>
                    <div class="input-wrapper">
                        <input type="text" id="input-pmt" value="100,000" placeholder="예: 100,000">
                        <span class="input-suffix">원</span>
                    </div>
                    <div class="help-text">
                        💳 매월(또는 매번) 꾸준히 저축하는 금액 (없으면 0 입력)
                    </div>
                </div>

                <div class="input-group" id="group-fv" style="display:none;">
                    <label>목표 금액 (미래가치) <span style="color: #ef4444;">*</span></label>
                    <div class="input-wrapper">
                        <input type="text" id="input-fv" value="30,000,000" placeholder="예: 30,000,000" disabled>
                        <span class="input-suffix">원</span>
                    </div>
                    <div class="help-text">
                        🎯 달성하고 싶은 목표 금액
                    </div>
                </div>

                <div class="options">
                    <div class="option-title">⚙️ 추가 옵션</div>
                    
                    <div class="input-group">
                        <label>저축 시점 선택</label>
                        <div class="button-group" style="grid-template-columns: 1fr 1fr;">
                            <button class="btn-toggle active" data-payment="end">기간 말</button>
                            <button class="btn-toggle" data-payment="beginning">기간 시작</button>
                        </div>
                        <div class="help-text">
                            📆 월말 저축: "기간 말" / 월초 저축: "기간 시작" (대부분의 경우 기간 말 선택)
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculate()">🧮 계산하기</button>
            </div>

            <!-- 결과 섹션 -->
            <div class="result-section">
                <h2 class="section-title">📊 계산 결과</h2>
                <div id="resultArea">
                    <div style="text-align: center; padding: 30px 20px; color: #6b7280; background: #f9fafb; border-radius: 8px; border: 2px dashed #e5e7eb;">
                        <p style="font-size: 48px; margin-bottom: 15px;">📋</p>
                        <p style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 10px;">
                            <strong style="color: #667eea;">미래가치</strong>를 계산합니다
                        </p>
                        <p style="font-size: 13px; line-height: 1.6; margin-top: 10px; color: #6b7280;">
                            지금 투자한 돈과 꾸준한 저축으로<br>미래에 얼마를 모을 수 있는지 알려드립니다
                        </p>
                        <p style="font-size: 14px; line-height: 1.6; margin-top: 15px;">
                            값을 입력하고<br>
                            '계산하기' 버튼을 눌러주세요
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p class="footer-copyright">Copyright © 2025 KFPC Co., Ltd. All Rights Reserved.</p>
    </div>

    <script>
        let currentFind = 'fv';
        let currentPayment = 'end';

        window.onload = function() {
            document.getElementById('instructionModal').style.display = 'block';
            updateAutoCalc();
            // 초기 상태 설정 (미래가치 모드)
            document.getElementById('group-fv').style.display = 'none';
        };

        function closeModal() {
            document.getElementById('instructionModal').style.display = 'none';
        }

        function formatNumber(num) {
            if (!num && num !== 0) return '';
            const number = parseInt(num.toString().replace(/,/g, ''));
            if (isNaN(number)) return '';
            return number.toLocaleString('ko-KR');
        }

        function parseNumber(str) {
            if (!str) return 0;
            return parseInt(str.toString().replace(/,/g, '')) || 0;
        }

        function updateAutoCalc() {
            const years = parseFloat(document.getElementById('input-years').value) || 0;
            const frequency = parseInt(document.getElementById('input-frequency').value) || 1;
            const total = years * frequency;
            
            const freqText = {
                '1': '매년 1회',
                '2': '6개월마다 (연 2회)',
                '4': '3개월마다 (연 4회)',
                '12': '매월 (연 12회)'
            };
            
            const freqLabel = {
                '1': '매년',
                '2': '6개월마다',
                '4': '3개월마다',
                '12': '매월'
            };
            
            if (years === 1) {
                document.getElementById('auto-n').textContent = 
                    `✓ 자동 계산: 1년 동안 ${freqLabel[frequency]} 저축 = 총 ${total}회`;
            } else {
                document.getElementById('auto-n').textContent = 
                    `✓ 자동 계산: ${years}년 × ${freqLabel[frequency]} = 총 ${total}회 저축`;
            }
        }

        document.getElementById('input-years').addEventListener('input', updateAutoCalc);
        document.getElementById('input-frequency').addEventListener('change', updateAutoCalc);

        document.querySelectorAll('input[type="text"]').forEach(input => {
            if (input.id !== 'input-iy' && input.id !== 'input-years') {
                input.addEventListener('input', function(e) {
                    // 숫자만 추출 (마이너스 제거)
                    const value = e.target.value.replace(/[^0-9]/g, '');
                    
                    if (value) {
                        e.target.value = formatNumber(value);
                    } else {
                        e.target.value = '';
                    }
                });
            }
        });

        const modeDescriptions = {
            'fv': {
                title: '미래가치',
                desc: '지금 투자한 돈과 꾸준한 저축으로<br>미래에 얼마를 모을 수 있는지 알려드립니다',
                required: ['period', 'iy', 'pv_or_pmt']
            },
            'pmt': {
                title: '정기납입액',
                desc: '목표 금액을 달성하기 위해<br>매번 얼마씩 저축해야 하는지 알려드립니다',
                required: ['period', 'iy', 'fv']
            },
            'iy': {
                title: '필요수익률',
                desc: '목표를 달성하기 위해<br>어느 정도의 수익률이 필요한지 알려드립니다',
                required: ['period', 'pv_or_pmt', 'fv']
            },
            'n': {
                title: '투자기간',
                desc: '목표 금액을 모으는데<br>얼마나 시간이 걸리는지 알려드립니다',
                required: ['iy', 'pv_or_pmt', 'fv']
            },
            'pv': {
                title: '현재가치',
                desc: '미래 목표를 달성하기 위해<br>지금 얼마를 투자해야 하는지 알려드립니다',
                required: ['period', 'iy', 'fv']
            }
        };

        document.querySelectorAll('[data-find]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-find]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFind = this.dataset.find;
                
                // 모든 입력 필드 활성화 및 표시
                document.querySelectorAll('.input-group').forEach(g => {
                    if (g.id && g.id.startsWith('group-')) {
                        const input = g.querySelector('input, select');
                        if (input) input.disabled = false;
                    }
                });
                
                // 선택된 항목에 따라 필드 처리
                if (currentFind === 'fv') {
                    // 미래가치 모드: FV는 결과값이므로 비활성화
                    document.getElementById('group-fv').style.display = 'none';
                    document.getElementById('group-pv').style.display = 'block';
                    document.getElementById('group-pmt').style.display = 'block';
                } else if (currentFind === 'pmt') {
                    // 정기납입액 모드: PMT는 결과값, FV 필요
                    document.getElementById('input-pmt').disabled = true;
                    document.getElementById('group-fv').style.display = 'block';
                    document.getElementById('input-fv').disabled = false;
                } else if (currentFind === 'iy') {
                    // 필요수익률 모드: IY는 결과값, FV 필요
                    document.getElementById('input-iy').disabled = true;
                    document.getElementById('group-fv').style.display = 'block';
                    document.getElementById('input-fv').disabled = false;
                } else if (currentFind === 'n') {
                    // 투자기간 모드: 기간은 결과값, FV 필요
                    document.getElementById('input-years').disabled = true;
                    document.getElementById('input-frequency').disabled = true;
                    document.getElementById('group-fv').style.display = 'block';
                    document.getElementById('input-fv').disabled = false;
                } else if (currentFind === 'pv') {
                    // 현재가치 모드: PV는 결과값, FV 필요
                    document.getElementById('input-pv').disabled = true;
                    document.getElementById('group-fv').style.display = 'block';
                    document.getElementById('input-fv').disabled = false;
                }
                
                // 안내 메시지 업데이트
                const mode = modeDescriptions[currentFind];
                document.getElementById('resultArea').innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: #6b7280; background: #f9fafb; border-radius: 8px; border: 2px dashed #e5e7eb;">
                        <p style="font-size: 48px; margin-bottom: 15px;">📋</p>
                        <p style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 10px;">
                            <strong style="color: #667eea;">${mode.title}</strong>를 계산합니다
                        </p>
                        <p style="font-size: 13px; line-height: 1.6; margin-top: 10px; color: #6b7280;">
                            ${mode.desc}
                        </p>
                        <p style="font-size: 14px; line-height: 1.6; margin-top: 15px;">
                            값을 입력하고<br>
                            '계산하기' 버튼을 눌러주세요
                        </p>
                    </div>
                `;
            });
        });

        document.querySelectorAll('[data-payment]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-payment]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentPayment = this.dataset.payment;
            });
        });

        function calculate() {
            try {
                const years = parseFloat(document.getElementById('input-years').value) || 0;
                const frequency = parseInt(document.getElementById('input-frequency').value) || 1;
                const n = years * frequency;
                const iy = parseFloat(document.getElementById('input-iy').value) || 0;
                
                // 사용자 입력값을 양수로 받아서 내부적으로 음수로 처리
                let pv = parseNumber(document.getElementById('input-pv').value);
                let pmt = parseNumber(document.getElementById('input-pmt').value);
                const fv = parseNumber(document.getElementById('input-fv').value);
                
                // 입력값 검증
                if (currentFind !== 'n' && years <= 0) {
                    showError('투자 기간을 입력해주세요! (예: 10년)');
                    return;
                }
                if (currentFind !== 'iy' && iy === 0) {
                    showError('연 이자율을 입력해주세요! (예: 예금 3%, 투자 5~7%)');
                    return;
                }
                
                // 각 모드별 필수 입력 체크
                if (currentFind === 'fv' && pv === 0 && pmt === 0) {
                    showError('초기 투자금 또는 정기 저축금액 중 하나는 반드시 입력해야 합니다!');
                    return;
                }
                if (currentFind === 'pmt' && fv === 0) {
                    showError('목표 금액을 입력해주세요!');
                    return;
                }
                if (currentFind === 'iy' && fv === 0) {
                    showError('목표 금액을 입력해주세요!');
                    return;
                }
                if (currentFind === 'n' && fv === 0) {
                    showError('목표 금액을 입력해주세요!');
                    return;
                }
                if (currentFind === 'pv' && fv === 0) {
                    showError('목표 금액을 입력해주세요!');
                    return;
                }
                
                // PV와 PMT는 지출이므로 음수로 변환 (사용자가 음수로 입력했어도 절댓값 후 음수 적용)
                if (currentFind !== 'pv') {
                    pv = -Math.abs(pv);
                }
                if (currentFind !== 'pmt') {
                    pmt = -Math.abs(pmt);
                }

                const r = (iy / 100) / frequency;
                const paymentType = currentPayment === 'beginning' ? 1 : 0;
                let result;

                switch(currentFind) {
                    case 'fv':
                        result = calculateFV(r, n, pmt, pv, paymentType);
                        displayResult(result, n, iy, pv, pmt, years, frequency);
                        break;
                    case 'pv':
                        result = calculatePV(r, n, pmt, fv, paymentType);
                        displayPVResult(result, fv, pmt, n, iy, years, frequency);
                        break;
                    case 'pmt':
                        result = calculatePMT(r, n, pv, fv, paymentType);
                        displayPMTResult(result, pv, fv, n, iy, years, frequency);
                        break;
                    case 'iy':
                        result = calculateRate(n, pmt, pv, fv, paymentType) * 100 * frequency;
                        displayIYResult(result, pv, pmt, fv, years, frequency);
                        break;
                    case 'n':
                        result = calculateNPER(r, pmt, pv, fv, paymentType);
                        displayNResult(result, pv, pmt, fv, iy, frequency);
                        break;
                }

            } catch (error) {
                showError('계산 중 오류가 발생했습니다. 입력값을 확인해주세요.');
                console.error(error);
            }
        }

        function calculateFV(rate, nper, pmt, pv, type) {
            if (rate === 0) {
                return -(pv + pmt * nper);
            }
            const pvFactor = Math.pow(1 + rate, nper);
            const pmtFactor = (1 + rate * type) * ((pvFactor - 1) / rate);
            return -(pv * pvFactor + pmt * pmtFactor);
        }

        function calculatePV(rate, nper, pmt, fv, type) {
            if (rate === 0) {
                return -(fv + pmt * nper);
            }
            const pvFactor = Math.pow(1 + rate, nper);
            const pmtFactor = (1 + rate * type) * ((pvFactor - 1) / rate);
            return -(fv + pmt * pmtFactor) / pvFactor;
        }

        function calculatePMT(rate, nper, pv, fv, type) {
            if (rate === 0) {
                return -(pv + fv) / nper;
            }
            const pvFactor = Math.pow(1 + rate, nper);
            return -(rate * (fv + pv * pvFactor)) / ((1 + rate * type) * (pvFactor - 1));
        }

        function calculateRate(nper, pmt, pv, fv, type) {
            let rate = 0.1;
            for (let i = 0; i < 100; i++) {
                const f = calculateFV(rate, nper, pmt, pv, type) - fv;
                const df = (calculateFV(rate + 0.0000001, nper, pmt, pv, type) - fv - f) / 0.0000001;
                const newRate = rate - f / df;
                if (Math.abs(newRate - rate) < 0.0000001) return newRate;
                rate = newRate;
            }
            return rate;
        }

        function calculateNPER(rate, pmt, pv, fv, type) {
            if (rate === 0) {
                return -(pv + fv) / pmt;
            }
            const num = Math.log((pmt * (1 + rate * type) - fv * rate) / (pmt * (1 + rate * type) + pv * rate));
            return num / Math.log(1 + rate);
        }

        function displayResult(fv, n, iy, pv, pmt, years, frequency) {
            const totalPayment = Math.abs(pmt * n);
            const totalInterest = Math.abs(fv) - Math.abs(pv) - totalPayment;
            
            let description = '';
            if (pv !== 0 && pmt !== 0) {
                description = `처음 <strong>${formatNumber(Math.abs(pv))}원</strong>을 투자하고,<br>
                매번 <strong>${formatNumber(Math.abs(pmt))}원</strong>씩 ${years}년간 저축하면`;
            } else if (pv !== 0) {
                description = `<strong>${formatNumber(Math.abs(pv))}원</strong>을 ${years}년간 투자하면`;
            } else {
                description = `매번 <strong>${formatNumber(Math.abs(pmt))}원</strong>씩 ${years}년간 저축하면`;
            }
            
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">💰 미래에 모이는 돈</span>
                        <span class="result-value">₩${formatNumber(Math.abs(Math.round(fv)))}</span>
                    </div>
                </div>
                
                <div class="result-explanation">
                    <strong style="font-size: 16px;">📊 계산 결과</strong><br><br>
                    ${description}<br>
                    연 ${iy}% 수익률로 <strong style="color: #047857; font-size: 18px;">₩${formatNumber(Math.abs(Math.round(fv)))}원</strong>이 됩니다!<br><br>
                    
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <strong>💵 돈의 흐름:</strong><br>
                        • 내가 투자한 돈: ${formatNumber(Math.abs(pv))}원<br>
                        • 저축한 돈: ${formatNumber(totalPayment)}원<br>
                        • 이자로 번 돈: <strong style="color: #059669;">${formatNumber(Math.round(totalInterest))}원</strong><br>
                        • 최종 금액: <strong style="color: #047857;">${formatNumber(Math.abs(Math.round(fv)))}원</strong>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">📈 돈이 불어나는 과정</div>
                    <canvas id="resultChart" width="400" height="250"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fbbf24;"></div>
                            <span>내 투자금</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #a78bfa;"></div>
                            <span>저축 이액</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #34d399;"></div>
                            <span>이자 수익</span>
                        </div>
                    </div>
                </div>
            `;
            
            drawFVChart(Math.abs(pv), totalPayment, totalInterest, years, n, pv, pmt, iy / 100, frequency);
        }

        function displayPMTResult(pmt, pv, fv, n, iy, years, frequency) {
            const freqText = {1: '매년', 2: '6개월마다', 4: '3개월마다', 12: '매월'};
            
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">💳 매번 저축할 금액</span>
                        <span class="result-value">₩${formatNumber(Math.abs(Math.round(pmt)))}</span>
                    </div>
                </div>
                
                <div class="result-explanation">
                    <strong style="font-size: 16px;">📊 계산 결과</strong><br><br>
                    ${pv !== 0 ? `처음 ${formatNumber(Math.abs(pv))}원으로 시작해서, ` : ''}
                    <strong style="color: #047857; font-size: 18px;">₩${formatNumber(Math.abs(Math.round(pmt)))}원</strong>씩 ${freqText[frequency]} 저축하면<br>
                    ${years}년 후 <strong>${formatNumber(Math.abs(fv))}원</strong>을 모을 수 있습니다!<br><br>
                    
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <strong>💵 저축 계획:</strong><br>
                        ${pv !== 0 ? `• 처음 투자: ${formatNumber(Math.abs(pv))}원<br>` : ''}
                        • ${freqText[frequency]} 저축: ${formatNumber(Math.abs(Math.round(pmt)))}원<br>
                        • 저축 기간: ${years}년 (${n}회)<br>
                        • 총 저축액: ${formatNumber(Math.round(Math.abs(pmt * n)))}원<br>
                        • 목표 달성: <strong style="color: #047857;">${formatNumber(Math.abs(fv))}원</strong>
                    </div>
                </div>
            `;
        }

        function displayPVResult(pv, fv, pmt, n, iy, years, frequency) {
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">💵 지금 필요한 금액</span>
                        <span class="result-value">₩${formatNumber(Math.abs(Math.round(pv)))}</span>
                    </div>
                </div>
                
                <div class="result-explanation">
                    <strong style="font-size: 16px;">📊 계산 결과</strong><br><br>
                    ${years}년 후 <strong>${formatNumber(Math.abs(fv))}원</strong>을 만들려면,<br>
                    지금 <strong style="color: #047857; font-size: 18px;">₩${formatNumber(Math.abs(Math.round(pv)))}원</strong>을 투자해야 합니다!<br><br>
                    
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <strong>💡 투자 정보:</strong><br>
                        • 필요한 초기 투자금: ${formatNumber(Math.abs(Math.round(pv)))}원<br>
                        ${pmt !== 0 ? `• 추가 저축: ${formatNumber(Math.abs(pmt))}원/회<br>` : ''}
                        • 투자 기간: ${years}년<br>
                        • 예상 수익률: ${iy}%<br>
                        • 목표 금액: <strong style="color: #047857;">${formatNumber(Math.abs(fv))}원</strong>
                    </div>
                </div>
            `;
        }

        function displayIYResult(iy, pv, pmt, fv, years, frequency) {
            let risk = '';
            if (iy < 5) risk = '예금/적금 수준의 안전한 투자';
            else if (iy < 10) risk = '채권이나 배당주 같은 중간 위험 투자';
            else risk = '주식이나 펀드 같은 적극적 투자';
            
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">📈 필요한 수익률</span>
                        <span class="result-value">${iy.toFixed(2)}%</span>
                    </div>
                </div>
                
                <div class="result-explanation">
                    <strong style="font-size: 16px;">📊 계산 결과</strong><br><br>
                    ${pv !== 0 ? `${formatNumber(Math.abs(pv))}원을 투자하고, ` : ''}
                    ${pmt !== 0 ? `매번 ${formatNumber(Math.abs(pmt))}원씩 저축해서 ` : ''}
                    ${years}년 후 ${formatNumber(Math.abs(fv))}원을 만들려면<br>
                    연 <strong style="color: #047857; font-size: 18px;">${iy.toFixed(2)}%</strong>의 수익률이 필요합니다!<br><br>
                    
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <strong>💡 투자 가이드:</strong><br>
                        • 필요 수익률: ${iy.toFixed(2)}%<br>
                        • 적합한 투자: ${risk}<br>
                        • 투자 기간: ${years}년
                    </div>
                </div>
            `;
        }

        function displayNResult(n, pv, pmt, fv, iy, frequency) {
            const years = (n / frequency).toFixed(1);
            const months = Math.round(n / frequency * 12);
            
            const resultArea = document.getElementById('resultArea');
            resultArea.innerHTML = `
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">⏰ 필요한 기간</span>
                        <span class="result-value">${years}년</span>
                    </div>
                </div>
                
                <div class="result-explanation">
                    <strong style="font-size: 16px;">📊 계산 결과</strong><br><br>
                    ${pv !== 0 ? `${formatNumber(Math.abs(pv))}원으로 시작해서, ` : ''}
                    ${pmt !== 0 ? `매번 ${formatNumber(Math.abs(pmt))}원씩 저축하면 ` : ''}
                    연 ${iy}% 수익률로<br>
                    <strong style="color: #047857; font-size: 18px;">${years}년</strong> (약 ${months}개월) 후에 ${formatNumber(Math.abs(fv))}원을 모을 수 있습니다!<br><br>
                    
                    <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <strong>⏱️ 시간 정보:</strong><br>
                        • 소요 기간: ${years}년 (${months}개월)<br>
                        • 총 저축 횟수: ${Math.round(n)}회<br>
                        • 목표 금액: ${formatNumber(Math.abs(fv))}원
                    </div>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('resultArea').innerHTML = `
                <div class="error-message">
                    ⚠️ ${message}
                </div>
            `;
        }

        function drawFVChart(initialPV, totalPMT, totalInterest, years, n, pv, pmt, annualRate, frequency) {
            const canvas = document.getElementById('resultChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const points = 5;
            const data = [];
            const rate = annualRate / frequency;
            
            for (let i = 0; i <= points; i++) {
                const period = Math.floor((n * i) / points);
                let cumPV = pv * Math.pow(1 + rate, period);
                let cumPMT = pmt * ((Math.pow(1 + rate, period) - 1) / rate);
                let fv = -(cumPV + cumPMT);
                
                data.push({
                    period: period,
                    pv: Math.abs(pv),
                    pmt: Math.abs(pmt * period),
                    interest: fv - Math.abs(pv) - Math.abs(pmt * period),
                    total: fv
                });
            }
            
            const maxValue = Math.max(...data.map(d => d.total));
            const padding = 40;
            const barWidth = (width - padding * 2) / points - 10;
            
            data.forEach((d, i) => {
                const x = padding + i * ((width - padding * 2) / points);
                const scale = (height - padding * 2) / maxValue;
                
                const pvHeight = d.pv * scale;
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x, height - padding - pvHeight, barWidth, pvHeight);
                
                const pmtHeight = d.pmt * scale;
                ctx.fillStyle = '#a78bfa';
                ctx.fillRect(x, height - padding - pvHeight - pmtHeight, barWidth, pmtHeight);
                
                const interestHeight = d.interest * scale;
                ctx.fillStyle = '#34d399';
                ctx.fillRect(x, height - padding - pvHeight - pmtHeight - interestHeight, barWidth, interestHeight);
                
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                const yearLabel = (d.period / frequency).toFixed(0);
                ctx.fillText(yearLabel + '년', x + barWidth / 2, height - padding + 20);
            });
        }
    </script>
</body>
</html>