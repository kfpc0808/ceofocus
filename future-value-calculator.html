<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>KFPC ë¯¸ë˜ê°€ì¹˜ ê³„ì‚°ê¸°</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Malgun Gothic',sans-serif; background:#f9fafb; line-height:1.6; color:#1f2937; }
    .container { max-width:1280px; margin:0 auto; padding:20px; }
    .top-header { display:flex; align-items:center; gap:20px; margin-bottom:12px; padding:10px 0; }
    .top-header { position: relative; }
    .close-btn { position: absolute; top: 10px; right: 0; width: 40px; height: 40px; background: rgba(79, 70, 229, 0.1); border: 2px solid rgba(79, 70, 229, 0.3); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #4f46e5; transition: all 0.3s; z-index: 100; }
    .close-btn:hover { background: rgba(79, 70, 229, 0.2); transform: rotate(90deg); border-color: #4f46e5; }
    .close-btn:active { transform: rotate(90deg) scale(0.95); }
    .logo-kfpc { font-size:32px; font-weight:900; letter-spacing:3px; background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; text-shadow:0 2px 10px rgba(79,70,229,.3); }
    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:9999; padding:20px; }
    .modal-content { background:#fff; border-radius:16px; max-width:600px; width:100%; max-height:90vh; overflow-y:auto; box-shadow:0 20px 25px -5px rgba(0,0,0,.1); }
    .modal-header { background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); color:#fff; padding:24px; border-radius:16px 16px 0 0; }
    .modal-header h2 { font-size:22px; font-weight:bold; margin-bottom:8px; }
    .modal-body { padding:24px; }
    .info-box { padding:16px; border-radius:8px; margin-bottom:16px; border-left:4px solid; }
    .info-box.blue { background:#eff6ff; border-color:#3b82f6; }
    .info-box.yellow { background:#fef3c7; border-color:#f59e0b; }
    .info-box.green { background:#d1fae5; border-color:#10b981; }
    .btn-primary{ width:100%; padding:16px; background:linear-gradient(135deg,#4f46e5 0%,#7c3aed 100%); color:#fff; border:none; border-radius:12px; font-size:16px; font-weight:bold; cursor:pointer; transition:.2s; }
    .btn-primary:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(79,70,229,.3); }
    .card{ background:#fff; border-radius:12px; padding:16px 24px; box-shadow:0 1px 3px rgba(0,0,0,.1); margin-bottom:20px; }
    .card-header{ display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .icon-box{ width:48px; height:48px; background:#e0e7ff; border-radius:10px; display:flex; align-items:center; justify-content:center; }
    .form-group{ margin-bottom:20px; }
    .form-label{ display:block; font-weight:600; margin-bottom:8px; color:#374151; font-size:14px; }
    .input-wrapper{ position:relative; }
    .form-input{ width:100%; padding:12px; border:1px solid #d1d5db; border-radius:8px; font-size:16px; transition:.2s; }
    .form-input:focus{ outline:none; border-color:#4f46e5; box-shadow:0 0 0 3px rgba(79,70,229,.1); }
    .input-prefix,.input-suffix{ position:absolute; top:50%; transform:translateY(-50%); color:#6b7280; font-size:14px; }
    .input-prefix{ left:12px; } .input-suffix{ right:12px; }
    .has-prefix{ padding-left:32px; } .has-suffix{ padding-right:60px; }
    .form-hint{ margin-top:6px; font-size:12px; color:#6b7280; line-height:1.5; }
    .button-group{ display:flex; align-items:center; gap:8px; margin-top:8px; }
    .btn-toggle{ padding:6px 12px; border:none; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer; background:#e5e7eb; color:#4b5563; transition:.2s; }
    .btn-toggle.active{ background:#4f46e5; color:#fff; }
    .btn-calculate{ width:100%; padding:14px; background:#f59e0b; color:#fff; border:none; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; margin-top:24px; transition:.2s; }
    .btn-calculate:hover{ background:#d97706; transform:translateY(-2px); box-shadow:0 6px 15px rgba(245,158,11,.3); }
    .result-card{ background:#fff; border-radius:12px; padding:24px; box-shadow:0 1px 3px rgba(0,0,0,.1); }
    .result-header{ background:#312e81; color:#fff; padding:16px; border-radius:8px; margin-bottom:16px; }
    .result-row{ display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #e5e7eb; }
    .result-row:last-child{ border-bottom:none; }
    .result-explain{ background:#f3f4f6; padding:12px; border-radius:8px; margin-top:12px; font-size:13px; color:#4b5563; line-height:1.6; }
    .chart-section{ display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-top:24px; padding-top:24px; border-top:1px solid #e5e7eb; text-align:center; }
    .chart-color{ width:16px; height:16px; border-radius:4px; margin:0 auto 8px; }
    .chart-color.purple{ background:#8b5cf6; } .chart-color.blue{ background:#60a5fa; } .chart-color.yellow{ background:#fbbf24; }
    .chart-container{ margin-top:24px; padding:20px; background:#fff; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,.1); }
    .schedule-toggle{ width:100%; padding:16px; background:none; border:none; cursor:pointer; display:flex; justify-content:space-between; align-items:center; transition:.2s; }
    .schedule-table{ width:100%; margin-top:16px; border-collapse:collapse; font-size:14px; }
    .schedule-table thead{ background:#312e81; color:#fff; }
    .schedule-table th,.schedule-table td{ padding:12px; text-align:left; border-bottom:1px solid #e5e7eb; }
    .hidden{ display:none; }
    .footer{ text-align:center; padding:30px 20px; color:#6b7280; font-size:13px; border-top:1px solid #e5e7eb; margin-top:40px; }
    @media (max-width:768px){
      .container{ padding:12px; } .top-header{ padding:8px 0; margin-bottom:10px; }
      .card{ padding:12px 16px; } .card-header{ gap:10px; margin-bottom:10px; }
      .modal-header h2{ font-size:18px; } .chart-section{ grid-template-columns:1fr; }
      .logo-kfpc{ font-size:26px; letter-spacing:2px; }
      .card-header h1{ font-size:18px !important; } .card-header p{ font-size:12px !important; }
      .schedule-table{ font-size:12px; } .schedule-table th,.schedule-table td{ padding:8px 6px; }
    }
    @media (min-width:1024px){ .main-grid{ display:grid; grid-template-columns:1fr 2fr; gap:24px; } }
  </style>
</head>
<body>
  <!-- ì›°ì»´ ëª¨ë‹¬ -->
  <div id="welcomeModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ‰ KFPC ë¯¸ë˜ê°€ì¹˜ ê³„ì‚°ê¸°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
        <p>ë‹¹ì‹ ì˜ íˆ¬ì ë¯¸ë˜ë¥¼ ë¯¸ë¦¬ í™•ì¸í•´ë³´ì„¸ìš”</p>
      </div>
      <div class="modal-body">
        <div class="info-box blue">
          <h3 style="font-weight:bold; margin-bottom:8px;">ğŸ’° ì´ ê³„ì‚°ê¸°ë¡œ ë¬´ì—‡ì„ í•  ìˆ˜ ìˆë‚˜ìš”?</h3>
          <p style="font-size:14px;">ì§€ê¸ˆ íˆ¬ìí•œ ëˆì´ ë¯¸ë˜ì— ì–¼ë§ˆê°€ ë ì§€ ì •í™•í•˜ê²Œ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³µë¦¬ì˜ í˜ì„ ì§ì ‘ í™•ì¸í•˜ì„¸ìš”!</p>
        </div>
        <div class="info-box yellow">
          <h3 style="font-weight:bold; margin-bottom:12px;">ğŸ“‹ ì‚¬ìš© ë°©ë²•</h3>
          <p style="font-size:14px;">
            <strong>1ë‹¨ê³„:</strong> ì²˜ìŒ íˆ¬ìí•  ê¸ˆì•¡ ì…ë ¥<br>
            <strong>2ë‹¨ê³„:</strong> ì˜ˆìƒ ìˆ˜ìµë¥  ì…ë ¥ (ì€í–‰ ì´ììœ¨, ì£¼ì‹ ìˆ˜ìµë¥  ë“±)<br>
            <strong>3ë‹¨ê³„:</strong> íˆ¬ì ê¸°ê°„ ì…ë ¥ (ëª‡ ë…„ ë™ì•ˆ íˆ¬ìí• ì§€)<br>
            <strong>4ë‹¨ê³„:</strong> ë§¤ë…„ ì¶”ê°€í•  ê¸ˆì•¡ ì…ë ¥ (ì„ íƒì‚¬í•­)<br>
            <strong>5ë‹¨ê³„:</strong> ê³„ì‚°í•˜ê¸° ë²„íŠ¼ í´ë¦­!
          </p>
        </div>
        <div class="info-box green">
          <h3 style="font-weight:bold; margin-bottom:8px;">ğŸ“Š ê²°ê³¼ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ƒ</h3>
          <p style="font-size:14px;">â€¢ ìµœì¢… ê¸ˆì•¡ (íˆ¬ì í›„ ë°›ì„ ì´ ê¸ˆì•¡)<br>â€¢ ì—°ë„ë³„ ìì‚° ì¦ê°€ ê·¸ë˜í”„<br>â€¢ ë§¤ë…„ ì”ì•¡ ìƒì„¸ í‘œ</p>
        </div>
        <button class="btn-primary" onclick="closeModal()">í™•ì¸, ê³„ì‚°ê¸° ì‚¬ìš©í•˜ê¸° â†’</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="top-header"><div class="logo-kfpc">KFPC</div><div class="close-btn" onclick="closeAndGoHome()" title="ë‹«ê¸°">âœ•</div></div>

    <div class="card">
      <div class="card-header">
        <div class="icon-box">
          <svg width="24" height="24" fill="none" stroke="#4f46e5" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
          </svg>
        </div>
        <div>
          <h1 style="font-size:20px; font-weight:bold; margin-bottom:2px;">ë¯¸ë˜ ê°€ì¹˜ ê³„ì‚°ê¸°</h1>
          <p style="font-size:13px; color:#6b7280;">íˆ¬ìì˜ ë¯¸ë˜ ê°€ì¹˜ë¥¼ ì •í™•í•˜ê²Œ ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </div>
      </div>
    </div>

    <div class="main-grid">
      <!-- ì…ë ¥ -->
      <div>
        <div class="card">
          <div class="form-group">
            <label class="form-label">ì²˜ìŒ íˆ¬ìí•  ê¸ˆì•¡</label>
            <div class="input-wrapper">
              <span class="input-prefix">â‚©</span>
              <input type="text" id="presentValue" class="form-input has-prefix" value="10,000,000">
            </div>
            <p class="form-hint">ğŸ’° ì§€ê¸ˆ ê°€ì§€ê³  ìˆëŠ” ëˆ ë˜ëŠ” ì²˜ìŒì— ë„£ì„ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”</p>
          </div>

          <div class="form-group">
            <label class="form-label">ì˜ˆìƒ ìˆ˜ìµë¥  (ì—°ê°„)</label>
            <div class="input-wrapper">
              <input type="text" id="interestRate" class="form-input has-suffix" value="6">
              <span class="input-suffix">%</span>
            </div>
            <p class="form-hint">ğŸ“ˆ 1ë…„ì— ëª‡ %ì˜ ìˆ˜ìµì„ ê¸°ëŒ€í•˜ë‚˜ìš”?</p>
          </div>

          <div class="form-group">
            <label class="form-label">íˆ¬ì ê¸°ê°„</label>
            <input type="text" id="periods" class="form-input" value="20">
            <p class="form-hint">â° ëª‡ ë…„ ë™ì•ˆ íˆ¬ìí•  ê±´ê°€ìš”? (ìˆ«ìë§Œ ì…ë ¥)</p>
          </div>

          <div class="form-group">
            <label class="form-label">ë§¤ë…„ ì¶”ê°€í•  ê¸ˆì•¡ (ì„ íƒì‚¬í•­)</label>
            <div class="input-wrapper">
              <input type="text" id="periodicDeposit" class="form-input has-suffix" value="200,000">
              <span class="input-suffix">/ ë…„</span>
            </div>
            <div class="button-group">
              <span style="font-size:12px; color:#6b7280;">ì¶”ê°€ ì‹œê¸°:</span>
              <button class="btn-toggle active" id="btnBeginning" onclick="setTiming('beginning')">ë§¤ë…„ ì´ˆ</button>
              <button class="btn-toggle" id="btnEnd" onclick="setTiming('end')">ë§¤ë…„ ë§</button>
            </div>
            <p class="form-hint">ğŸ’¸ ë§¤ë…„ ì¶”ê°€ë¡œ ì €ì¶•í•  ê¸ˆì•¡ (ì•ˆ í•˜ë©´ 0)</p>
          </div>

          <button class="btn-calculate" onclick="calculate()">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
        </div>
      </div>

      <!-- ê²°ê³¼ -->
      <div>
        <div id="resultArea" class="result-card" style="text-align:center; padding:48px 24px;">
          <svg width="64" height="64" fill="none" stroke="#d1d5db" viewBox="0 0 24 24" style="margin:0 auto 16px;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
          </svg>
          <p style="color:#6b7280;">ì™¼ìª½ì— ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ <br><strong>ê³„ì‚°í•˜ê¸°</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
        </div>
      </div>
    </div>

    <div class="footer">Copyright Â© 2025 KFPC Co., Ltd. All Rights Reserved.</div>
  </div>

  <script>
    let timing = 'beginning';
    let chartInstance = null;

    function closeModal(){ document.getElementById('welcomeModal').style.display='none'; }

    // ë‹«ê¸° ë²„íŠ¼ - indexë¡œ ì´ë™
    function closeAndGoHome() {
      window.location.href = 'index.html';
    }

    function formatNumber(v){ if(!v) return ''; const n=v.toString().replace(/[^\d]/g,''); return n.replace(/\B(?=(\d{3})+(?!\d))/g,','); }
    function parseNum(v){ if(!v) return 0; return parseFloat(v.toString().replace(/,/g,''))||0; }
    function formatCurrency(n){ return 'â‚©'+Math.round(n).toLocaleString('ko-KR'); }

    function setTiming(t){
      timing=t;
      document.getElementById('btnBeginning').className = t==='beginning'?'btn-toggle active':'btn-toggle';
      document.getElementById('btnEnd').className       = t==='end'?'btn-toggle active':'btn-toggle';
    }

    document.getElementById('presentValue').addEventListener('input', e=> e.target.value = formatNumber(e.target.value));
    document.getElementById('periodicDeposit').addEventListener('input', e=> e.target.value = formatNumber(e.target.value));

    /* Chart.js ë¡œë”© ë³´ì¥ */
    function ensureChartJs(cb){
      if(typeof Chart!=='undefined'){ cb(); return; }
      const s=document.createElement('script');
      s.src='https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js';
      s.onload=cb;
      s.onerror=()=>{
        const s2=document.createElement('script');
        s2.src='https://unpkg.com/chart.js@4.4.6/dist/chart.umd.js';
        s2.onload=cb;
        s2.onerror=()=>{ console.error('Chart.js ë¡œë”© ì‹¤íŒ¨'); alert('âŒ ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨'); };
        document.head.appendChild(s2);
      };
      document.head.appendChild(s);
    }

    function calculate(){
      const pv = parseNum(document.getElementById('presentValue').value);
      const rate = parseFloat(document.getElementById('interestRate').value)/100 || 0;
      const n = parseInt(document.getElementById('periods').value) || 0;
      const pmt = parseNum(document.getElementById('periodicDeposit').value);

      if(n<=0){ alert('íˆ¬ì ê¸°ê°„ì„ 1ë…„ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

      const fvLump = pv * Math.pow(1+rate, n);
      let fvAnn = 0;
      if(pmt!==0 && rate!==0){
        fvAnn = pmt * ((Math.pow(1+rate,n)-1)/rate);
        if(timing==='beginning') fvAnn *= (1+rate);
      }else if(pmt!==0){ fvAnn = pmt * n; }

      const totalFV = fvLump + fvAnn;
      const totalDep = pmt * n;
      const totalInt = totalFV - pv - totalDep;

      const p1 = ((pv/totalFV)*100).toFixed(1);
      const p2 = ((totalDep/totalFV)*100).toFixed(1);
      const p3 = ((totalInt/totalFV)*100).toFixed(1);

      const schedule=[];
      for(let i=1;i<=n;i++){
        let beginBalance, interest, endBalance;
        if(i===1){
          if(timing==='beginning'){ beginBalance=pv+pmt; interest=beginBalance*rate; endBalance=beginBalance+interest; }
          else { beginBalance=pv; interest=beginBalance*rate; endBalance=beginBalance+interest+pmt; }
        }else{
          const prevEnd=schedule[i-2].endBalance;
          if(timing==='beginning'){ beginBalance=prevEnd+pmt; interest=beginBalance*rate; endBalance=beginBalance+interest; }
          else { beginBalance=prevEnd; interest=beginBalance*rate; endBalance=beginBalance+interest+pmt; }
        }
        schedule.push({ period:i, beginBalance, deposit:pmt, interest, endBalance });
      }

      let html = '<div class="result-header"><h3 style="font-size:20px;">ğŸ’° ê³„ì‚° ê²°ê³¼</h3></div>';
      html += `<div class="result-row"><span>ìµœì¢… ê¸ˆì•¡ (ë¯¸ë˜ ê°€ì¹˜):</span><span style="font-weight:bold; font-size:20px; color:#4f46e5;">${formatCurrency(totalFV)}</span></div>`;
      html += `<div class="result-row"><span>ì²˜ìŒ íˆ¬ì ê¸ˆì•¡:</span><span>${formatCurrency(pv)}</span></div>`;
      html += `<div class="result-row"><span>íˆ¬ì ê¸°ê°„:</span><span>${n}ë…„</span></div>`;
      html += `<div class="result-row"><span>ì—° ìˆ˜ìµë¥ :</span><span>${(rate*100).toFixed(2)}%</span></div>`;
      html += `<div class="result-row"><span>ì¶”ê°€ ì €ì¶• ì´ì•¡:</span><span style="color:#3b82f6;">${formatCurrency(totalDep)}</span></div>`;
      html += `<div class="result-row"><span>ì´ ì´ì ìˆ˜ìµ:</span><span style="color:#10b981; font-weight:600;">${formatCurrency(totalInt)}</span></div>`;
      html += '<div class="result-explain"><strong>ğŸ“Š ê²°ê³¼ ì„¤ëª…:</strong><br>';
      html += `${n}ë…„ ë™ì•ˆ ì—° ${(rate*100).toFixed(1)}%ì˜ ìˆ˜ìµë¥ ë¡œ íˆ¬ìí•˜ë©´, ì²˜ìŒ íˆ¬ìê¸ˆ ${formatCurrency(pv)}ì´(ê°€) <strong>${formatCurrency(totalFV)}</strong>ìœ¼ë¡œ ì¦ê°€í•©ë‹ˆë‹¤. `;
      if(pmt>0){ html += `ë§¤ë…„ ${formatCurrency(pmt)}ì”© ì¶”ê°€ë¡œ ì €ì¶•í•˜ë©´ ì´ ${formatCurrency(totalDep)}ì„(ë¥¼) ë” ë„£ê²Œ ë˜ë©°, `; }
      html += `ë³µë¦¬ íš¨ê³¼ë¡œ <strong style="color:#10b981;">${formatCurrency(totalInt)}</strong>ì˜ ì´ì ìˆ˜ìµì´ ë°œìƒí•©ë‹ˆë‹¤.</div>`;
      html += '<div class="chart-section">';
      html += `<div><div class="chart-color purple"></div><p style="font-size:12px; color:#6b7280;">ì‹œì‘ ê¸ˆì•¡</p><p style="font-weight:600;">${p1}%</p></div>`;
      html += `<div><div class="chart-color blue"></div><p style="font-size:12px; color:#6b7280;">ì¶”ê°€ ì €ì¶•</p><p style="font-weight:600;">${p2}%</p></div>`;
      html += `<div><div class="chart-color yellow"></div><p style="font-size:12px; color:#6b7280;">ì´ì ìˆ˜ìµ</p><p style="font-weight:600;">${p3}%</p></div>`;
      html += '</div>';

      const area = document.getElementById('resultArea');
      area.innerHTML = html;
      area.style.textAlign='left'; area.style.padding='24px';

      ensureChartJs(()=>{ drawChart(schedule); addScheduleTable(schedule); });
    }

    function drawChart(schedule){
      // ê³ ì • í¬ê¸° ì„¤ì • (ë°˜ì‘í˜• ë¦¬ì‚¬ì´ì¦ˆ OFF)
      const CHART_MAX_WIDTH = 900;   // í•„ìš”ì‹œ ì¡°ì ˆ
      const CHART_HEIGHT    = 260;

      if(chartInstance){ try{ chartInstance.destroy(); }catch(e){} chartInstance=null; }
      const existing=document.querySelector('.chart-container'); if(existing) existing.remove();

      const container=document.getElementById('resultArea');

      const chartDiv=document.createElement('div');
      chartDiv.className='chart-container';
      chartDiv.style.maxWidth = CHART_MAX_WIDTH + 'px';
      chartDiv.style.margin   = '24px auto 0';

      const title=document.createElement('h3');
      title.style.marginBottom='16px'; title.style.fontSize='18px';
      title.innerHTML='ğŸ“ˆ ì—°ë„ë³„ ìì‚° ì¦ê°€ ê·¸ë˜í”„';
      chartDiv.appendChild(title);

      const canvas=document.createElement('canvas');
      canvas.id='growthChart';
      const parentW = container.clientWidth || 800;
      const width   = Math.min(parentW, CHART_MAX_WIDTH);
      canvas.style.display='block';
      canvas.style.width  = width + 'px';
      canvas.style.height = CHART_HEIGHT + 'px';
      canvas.width  = width;          // ë Œë” í•´ìƒë„
      canvas.height = CHART_HEIGHT;   // ë Œë” í•´ìƒë„
      chartDiv.appendChild(canvas);

      container.appendChild(chartDiv);

      const labels   = schedule.map(s=>`${s.period}ë…„ì°¨`);
      const balances = schedule.map(s=>s.endBalance);
      const interests= schedule.map(s=>s.interest);

      const ctx=canvas.getContext('2d');
      chartInstance = new Chart(ctx,{
        type:'line',
        data:{
          labels,
          datasets:[
            { label:'ì´ ìì‚°', data:balances, borderColor:'#4f46e5', backgroundColor:'rgba(79,70,229,.1)', borderWidth:3, fill:true, tension:.4, pointRadius:2, pointHoverRadius:4 },
            { label:'ì—°ê°„ ì´ì', data:interests, borderColor:'#10b981', backgroundColor:'rgba(16,185,129,.1)', borderWidth:2, fill:false, tension:.4, pointRadius:2, pointHoverRadius:4 }
          ]
        },
        options:{
          responsive:false,             // âœ… ë¬´í•œ ë¦¬ì‚¬ì´ì¦ˆ ì°¨ë‹¨
          maintainAspectRatio:false,
          plugins:{
            legend:{ display:true, position:'top', labels:{ font:{ size:13, weight:'bold' }, padding:12 } },
            tooltip:{ callbacks:{ label:(ctx)=>`${ctx.dataset.label}: ${formatCurrency(ctx.parsed.y)}` } }
          },
          scales:{
            x:{ ticks:{ maxTicksLimit:10 } },
            y:{ beginAtZero:true, ticks:{ callback:(v)=> v>=1_000_000 ? 'â‚©'+(v/1_000_000).toFixed(1)+'M' : 'â‚©'+Math.round(v).toLocaleString() } }
          }
        }
      });
      // ì¶”ê°€ resize í˜¸ì¶œ ì—†ìŒ (ë£¨í”„ ë°©ì§€)
    }

    function addScheduleTable(schedule){
      const container=document.getElementById('resultArea');
      let html = '<div style="margin-top:24px; background:#fff; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,.1);">';
      html += '<button class="schedule-toggle" onclick="toggleSchedule()">';
      html += '<div><span style="font-size:18px; font-weight:600;">ğŸ“‹ ì—°ë„ë³„ ìƒì„¸ ë‚´ì—­</span>';
      html += '<p style="font-size:12px; color:#6b7280; margin-top:4px;">ë§¤ë…„ ìì‚°ì´ ì–´ë–»ê²Œ ì¦ê°€í•˜ëŠ”ì§€ ìì„¸íˆ í™•ì¸í•˜ì„¸ìš”</p></div>';
      html += '<svg id="scheduleIcon" width="20" height="20" fill="none" stroke="#4f46e5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>';
      html += '</button>';
      html += '<div id="scheduleTable" class="hidden" style="overflow-x:auto;">';
      html += '<table class="schedule-table"><thead><tr>';
      html += '<th style="text-align:center;">ì—°ì°¨</th><th>ê¸°ê°„ ì‹œì‘ ê¸ˆì•¡</th><th>ì¶”ê°€ ì €ì¶•</th><th>ë°œìƒ ì´ì</th><th>ê¸°ê°„ ë§ ê¸ˆì•¡</th>';
      html += '</tr></thead><tbody>';
      for(const r of schedule){
        html += '<tr>';
        html += `<td style="text-align:center; font-weight:600;">${r.period}ë…„</td>`;
        html += `<td>${formatCurrency(r.beginBalance)}</td>`;
        html += `<td style="color:#3b82f6;">${formatCurrency(r.deposit)}</td>`;
        html += `<td style="color:#10b981; font-weight:600;">${formatCurrency(r.interest)}</td>`;
        html += `<td style="font-weight:700; color:#4f46e5;">${formatCurrency(r.endBalance)}</td>`;
        html += '</tr>';
      }
      html += '</tbody></table></div></div>';
      container.insertAdjacentHTML('beforeend', html);
    }

    function toggleSchedule(){
      const table=document.getElementById('scheduleTable');
      const icon=document.getElementById('scheduleIcon');
      if(table.classList.contains('hidden')){ table.classList.remove('hidden'); icon.style.transform='rotate(180deg)'; }
      else { table.classList.add('hidden'); icon.style.transform='rotate(0deg)'; }
    }
  </script>

  <!-- Chart.jsëŠ” ensureChartJsë¡œ ë™ì  ë¡œë”©ë©ë‹ˆë‹¤ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" defer onload=""></script>
</body>
</html>