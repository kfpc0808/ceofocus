<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FM - Financial Master</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        :root {
            --primary: #0066FF;
            --secondary: #2a5a8a;
            --accent: #00C9A7;
            --danger: #FF4757;
            --warning: #FFA502;
            --success: #26DE81;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --border: #e1e8ed;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .progress-bar-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s ease;
        }

        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .save-status.show { opacity: 1; }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            z-index: 100;
        }
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .toolbar {
            background: white;
            padding: 1rem;
            margin: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            position: relative;
            z-index: 500;
        }
        .toolbar-left {
            font-weight: 500;
            font-size: 1.1rem;
            position: relative;
            z-index: 501;
        }
        .toolbar-right {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            position: relative;
            z-index: 501;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            z-index: 502;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,102,255,0.3); }
        .btn.success { background: var(--success); }
        .btn.warning { background: var(--warning); }
        .btn.danger { background: var(--danger); }
        .btn.secondary { background: var(--secondary); }
        .btn.info { background: #17a2b8; }

.main-grid {
    display: grid;
    grid-template-columns: 50% 50%;  /* ë˜ëŠ” 1fr 1fr */
    gap: 1rem;  /* gapì„ ì¤„ì„ */
    /* ... */
}

        .input-section {
            overflow: hidden;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }
        .card h2 {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card h3 {
            font-size: 1.1rem;
            color: var(--secondary);
            margin: 1.5rem 0 1rem 0;
            padding-left: 0.75rem;
            border-left: 4px solid var(--accent);
        }

        .input-group {
            margin-bottom: 1rem;
        }
        .input-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-size: 0.95rem;
        }
        .input-field {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 0;
        }
        
        .input-field input,
        .input-field select {
            flex: 1;
            min-width: 0;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        input[type="month"],
        input[type="tel"],
        select {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
            font-family: inherit;
            height: 50px;
            line-height: 1.5;
            width: 100%;
        }

        textarea {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
            font-family: inherit;
            width: 100%;
            min-height: 80px;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .input-field input[type="number"],
        .input-field input[inputmode="numeric"] {
            text-align: right;
        }
        
        .input-field span {
            color: var(--text-light);
            font-weight: 500;
            white-space: nowrap;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .dynamic-container {
            border: 2px dashed var(--border);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            background: #fafbfc;
            position: relative;
        }
        
        .btn-remove {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-add {
            width: 100%;
            margin-top: 0.5rem;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,255,0.3);
        }

        .retirement-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }
        
        .result-box h4 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 1rem;
            gap: 0.5rem;
            overflow-x: auto;
        }
        
        .step {
            flex: 1;
            min-width: 100px;
            text-align: center;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .step.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .step:hover { 
            transform: translateY(-2px); 
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background: var(--border);
            margin-bottom: 0.5rem;
        }
        
        .step.active .step-number {
            background: white;
            color: var(--primary);
        }

        .profile-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
        }

        .info-box {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .info-box.primary { border-left: 4px solid var(--primary); }
        .info-box.accent { border-left: 4px solid var(--accent); }
        .info-box.success { border-left: 4px solid var(--success); }
        .info-box.warning { border-left: 4px solid var(--warning); }

        .question-box {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 2px solid var(--border);
        }

        .question-box h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .radio-group label {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .radio-group label:hover {
            border-color: var(--primary);
            background: #f8f9ff;
        }

        .radio-group input[type="radio"] {
            width: auto;
            height: auto;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        footer {
            background: var(--text);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            .two-col {
                grid-template-columns: 1fr;
            }
            .retirement-layout {
                grid-template-columns: 1fr !important;
            }
            .summary-grid {
                grid-template-columns: 1fr 1fr !important;
            }
            .toolbar {
                padding: 0.75rem;
                gap: 0.5rem;
            }
            
            .toolbar-right {
                flex-wrap: nowrap;
                overflow-x: auto;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* Firefox */
                padding-bottom: 0.5rem;
            }
            
            .toolbar-right::-webkit-scrollbar {
                display: none; /* Chrome, Safari */
            }
            
            .toolbar-right .btn {
                flex-shrink: 0;
                white-space: nowrap;
                font-size: 0.85rem;
                padding: 0.5rem 0.9rem;
            }
        }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ëª¨ë°”ì¼ ê²½ê³  ì˜¤ë²„ë ˆì´ -->
    <div id="mobileWarning" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 3rem 2rem; border-radius: 20px; text-align: center; max-width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <div style="font-size: 4rem; margin-bottom: 1.5rem;">ğŸ’»</div>
            <h2 style="font-size: 1.5rem; color: #2c3e50; margin-bottom: 1rem; font-weight: 700;">PC ë° íƒœë¸”ë¦¿ ê¶Œì¥</h2>
            <p style="color: #7f8c8d; font-size: 1rem; line-height: 1.6; margin-bottom: 1.5rem;">
                ë” ë‚˜ì€ ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´<br>
                PC/íƒœë¸”ë¦¿ì—ì„œ ì´ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
            </p>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; font-size: 0.9rem; color: #666; margin-bottom: 1.5rem;">
                <strong>ê¶Œì¥ í™˜ê²½:</strong><br>
                PC, ë…¸íŠ¸ë¶, íƒœë¸”ë¦¿ (768px ì´ìƒ)
            </div>
            <button onclick="closeMobileWarning()" style="background: linear-gradient(135deg, #0066FF, #2a5a8a); color: white; border: none; padding: 1rem 2rem; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; box-shadow: 0 4px 12px rgba(0,102,255,0.3);">
                ë‘˜ëŸ¬ë³´ê¸°
            </button>
        </div>
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="save-status" id="saveStatus">
        <i class="fas fa-check-circle"></i> ì €ì¥ë¨
    </div>

    <header>
        <h1><i class="fas fa-chart-line"></i> FM - Financial Master</h1>
        <p>í”„ë¦¬ë¯¸ì—„ ì¬ë¬´ì»¨ì„¤íŒ… í”Œë«í¼</p>
    </header>

    <div class="toolbar">
        <div class="toolbar-left">
            <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                <strong id="customerName">ê³ ê°ëª…</strong>
                
                <a id="phoneCallLink" href="tel:" style="
                    display: none;
                    align-items: center;
                    gap: 0.4rem;
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: white;
                    padding: 0.35rem 0.75rem;
                    border-radius: 16px;
                    text-decoration: none;
                    font-weight: 600;
                    font-size: 0.8rem;
                    box-shadow: 0 2px 6px rgba(16, 185, 129, 0.25);
                    transition: all 0.2s;
                    white-space: nowrap;
                " onmouseover="this.style.transform='scale(1.05)'" 
                   onmouseout="this.style.transform='scale(1)'">
                    <i class="fas fa-phone-alt"></i>
                    <span id="displayPhone"></span>
                </a>
            </div>
        </div>
        <div class="toolbar-right">
            <button class="btn success" id="saveBtn"><i class="fas fa-save"></i> ì €ì¥</button>
            <button class="btn warning" id="loadBtn"><i class="fas fa-upload"></i> ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn info" id="refreshBtn"><i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨</button>
            <button class="btn secondary" id="mainBtn"><i class="fas fa-home"></i> ë©”ì¸</button>
            <button class="btn danger" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="step-indicator">
        <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div>ê³ ê°ì •ë³´</div>
        </div>
        <div class="step" data-step="2">
            <div class="step-number">2</div>
            <div>ì¬ë¬´í˜„í™©</div>
        </div>
        <div class="step" data-step="3">
            <div class="step-number">3</div>
            <div>ë³´í—˜ì§„ë‹¨</div>
        </div>
        <div class="step" data-step="4">
            <div class="step-number">4</div>
            <div>ì€í‡´ì¤€ë¹„</div>
        </div>
        <div class="step" data-step="5">
            <div class="step-number">5</div>
            <div>ëª©ì ìê¸ˆ</div>
        </div>
        <div class="step" data-step="6">
            <div class="step-number">6</div>
            <div>íˆ¬ìì„±í–¥</div>
        </div>
        <div class="step" data-step="7">
            <div class="step-number">7</div>
            <div>ìƒì†ì¦ì—¬</div>
        </div>
        <div class="step" data-step="8">
            <div class="step-number">8</div>
            <div>ì´í‰</div>
        </div>
    </div>

    <div class="main-grid">
        <div class="input-section">
            <!-- Step 1: ê³ ê° ê¸°ë³¸ì •ë³´ -->
            <div class="card" id="step1">
                <h2><i class="fas fa-user"></i> Step 1. ê³ ê° ê¸°ë³¸ì •ë³´</h2>
                
                <div class="input-group">
                    <label><i class="fas fa-calendar"></i> ê³ ê°ë¯¸íŒ…ì¼ì</label>
                    <input type="date" id="meetingDate">
                </div>

                <h3>ê¸°ë³¸ í”„ë¡œí•„</h3>
                <div class="two-col">
                    <div class="input-group">
                        <label>ì´ë¦„ *</label>
                        <input type="text" id="name" placeholder="í™ê¸¸ë™">
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-phone"></i> ì—°ë½ì²˜ *</label>
                        <div style="display: flex; gap: 0.3rem; align-items: center;">
                            <input type="text" value="010" readonly style="width: 60px; text-align: center; background: #f0f0f0; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; height: 50px;">
                            <span style="font-weight: bold; color: #999;">-</span>
                            <input type="tel" id="phone1" maxlength="4" placeholder="1234" style="flex: 1; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; text-align: center; height: 50px;">
                            <span style="font-weight: bold; color: #999;">-</span>
                            <input type="tel" id="phone2" maxlength="4" placeholder="5678" style="flex: 1; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; text-align: center; height: 50px;">
                        </div>
                    </div>
                </div>

                <div class="two-col">
                    <div class="input-group">
                        <label>ì„±ë³„ *</label>
                        <select id="gender">
                            <option value="">ì„ íƒ</option>
                            <option value="ë‚¨">ë‚¨</option>
                            <option value="ì—¬">ì—¬</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>ìƒë…„ì›”ì¼ *</label>
                        <input type="date" id="birthDate">
                        <span id="ageDisplay" style="font-size: 0.9rem; color: #666; margin-top: 0.3rem; display: block;"></span>
                    </div>
                </div>

                <div class="two-col">
                    <div class="input-group">
                        <label>ì›” ì†Œë“</label>
                        <div class="input-field">
                            <input type="text" id="income" inputmode="numeric"
       oninput="formatInputNumber(this); updateStep1Analysis();">
                            <span>ì›</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>íšŒì‚¬ëª…</label>
                        <input type="text" id="companyName" placeholder="íšŒì‚¬ëª… ì…ë ¥">
                    </div>
                </div>

                <div class="input-group">
                    <label>ì§ì—… *</label>
                    <select id="occupation">
                        <option value="">ì„ íƒ</option>
                        <option value="ì§ì¥ì¸(ëŒ€ê¸°ì—…)">ì§ì¥ì¸(ëŒ€ê¸°ì—…)</option>
                        <option value="ì§ì¥ì¸(ì¤‘ì†Œê¸°ì—…)">ì§ì¥ì¸(ì¤‘ì†Œê¸°ì—…)</option>
                        <option value="ê³µë¬´ì›">ê³µë¬´ì›</option>
                        <option value="ìì˜ì—…">ìì˜ì—…</option>
                        <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                        <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
                    </select>
                    <input type="text" id="customOccupation" placeholder="ì§ì—…ì„ ì…ë ¥í•˜ì„¸ìš”" style="display: none; margin-top: 0.5rem;">
                </div>

                <div class="input-group">
                    <label>ì£¼ì†Œ</label>
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <select id="addressType" style="width: auto;">
                            <option value="">ì„ íƒ</option>
                            <option value="íšŒì‚¬">íšŒì‚¬</option>
                            <option value="ì§‘">ì§‘</option>
                        </select>
                    </div>
                    <input type="text" id="address" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥">
                </div>

                <h3>ê°€êµ¬ êµ¬ì¡°</h3>
                <div class="two-col">
                    <div class="input-group">
                        <label>í˜¼ì¸ ì—¬ë¶€</label>
                        <select id="maritalStatus">
                            <option value="ë¯¸í˜¼">ë¯¸í˜¼</option>
                            <option value="ê¸°í˜¼">ê¸°í˜¼</option>
                            <option value="ì´í˜¼">ì´í˜¼</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>ìë…€ ìˆ˜</label>
                        <select id="childrenCount">
                            <option value="0">ì—†ìŒ</option>
                            <option value="1">1ëª…</option>
                            <option value="2">2ëª…</option>
                            <option value="3">3ëª…</option>
                            <option value="4">4ëª…</option>
                            <option value="5">5ëª…</option>
                        </select>
                    </div>
                </div>

                <div id="spouseSection" style="display: none;">
                    <h3>ë°°ìš°ì ì •ë³´</h3>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ì„±ë³„</label>
                            <input type="text" id="spouseGender" readonly style="background: #f5f5f5;">
                        </div>
                        <div class="input-group">
                            <label>ìƒë…„ì›”ì¼</label>
                            <input type="date" id="spouseBirthDate">
                            <span id="spouseAgeDisplay" style="font-size: 0.9rem; color: #666; margin-top: 0.3rem; display: block;"></span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>ì§ì—…</label>
                        <select id="spouseOccupation">
                            <option value="">ì„ íƒ</option>
                            <option value="ì§ì¥ì¸(ëŒ€ê¸°ì—…)">ì§ì¥ì¸(ëŒ€ê¸°ì—…)</option>
                            <option value="ì§ì¥ì¸(ì¤‘ì†Œê¸°ì—…)">ì§ì¥ì¸(ì¤‘ì†Œê¸°ì—…)</option>
                            <option value="ê³µë¬´ì›">ê³µë¬´ì›</option>
                            <option value="ìì˜ì—…">ìì˜ì—…</option>
                            <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                            <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
                        </select>
                        <input type="text" id="spouseCustomOccupation" placeholder="ì§ì—…ì„ ì…ë ¥í•˜ì„¸ìš”" style="display: none; margin-top: 0.5rem;">
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ì›” ì†Œë“</label>
                            <div class="input-field">
                                <input type="text" id="spouseIncome" inputmode="numeric"
       oninput="formatInputNumber(this);">
                                <span>ì›</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>íšŒì‚¬ëª…</label>
                            <input type="text" id="spouseCompanyName" placeholder="íšŒì‚¬ëª… ì…ë ¥">
                        </div>
                    </div>
                </div>

                <h3>ì¶”ê°€ ì •ë³´</h3>
                <div class="input-group">
                    <label>í–¥í›„ ì£¼ìš” ì¬ë¬´ê³„íš</label>
                    <textarea id="futurePlan" placeholder="ì£¼ìš” ì¬ë¬´ê³„íšì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="input-group">
                    <label>ì£¼ìš” ê´€ì‹¬ì‚¬</label>
                    <textarea id="mainInterest" placeholder="ì£¼ìš” ê´€ì‹¬ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
            </div>

            <!-- Step 2: ì¬ë¬´í˜„í™© -->
            <div class="card" id="step2" style="display:none;">
                <h2><i class="fas fa-wallet"></i> Step 2. ì¬ë¬´í˜„í™© ì§„ë‹¨</h2>
                
                <h3>ğŸ  ë¶€ë™ì‚° ìì‚°</h3>
                <div id="realEstateContainer"></div>
                <button class="btn-add" id="addRealEstate"><i class="fas fa-plus"></i> ë¶€ë™ì‚° ì¶”ê°€</button>

                <h3>ğŸ’° ê¸ˆìœµ ìì‚°</h3>
                <div id="financialAssetsContainer"></div>
                <button class="btn-add" id="addFinancialAsset"><i class="fas fa-plus"></i> ê¸ˆìœµìì‚° ì¶”ê°€</button>

                <h3>ğŸ’³ ë¶€ì±„</h3>
                <div id="debtContainer"></div>
                <button class="btn-add" id="addDebt"><i class="fas fa-plus"></i> ëŒ€ì¶œ ì¶”ê°€</button>

                <h3>ğŸ’µ ì›” ìˆ˜ì…</h3>
                <div id="monthlyIncomeContainer"></div>
                <button class="btn-add" id="addMonthlyIncome"><i class="fas fa-plus"></i> ìˆ˜ì… ì¶”ê°€</button>

                <h3>ğŸ’¸ ì›” ì§€ì¶œ</h3>
                <div id="monthlyExpenseContainer"></div>
                <button class="btn-add" id="addMonthlyExpense"><i class="fas fa-plus"></i> ì§€ì¶œ ì¶”ê°€</button>

                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-top: 2rem;">
                    <h3 style="color: white; border: none;">ğŸ“Š ì¬ë¬´í˜„í™© ìš”ì•½</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">ì´ ìì‚°</div>
                            <div class="summary-value" id="totalAssets">0ì›</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ì´ ë¶€ì±„</div>
                            <div class="summary-value" id="totalDebt">0ì›</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ìˆœìì‚°</div>
                            <div class="summary-value" id="netAssets">0ì›</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ì›” ì‰ì—¬ê¸ˆ</div>
                            <div class="summary-value" id="monthlySurplus">0ì›</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Step 3: ë³´í—˜ì§„ë‹¨ -->
            <div class="card" id="step3" style="display:none;">
                <h2><i class="fas fa-shield-alt"></i> Step 3. ë³´í—˜ ì§„ë‹¨</h2>
                
                <h3>ë³´ì¥ì„± ë³´í—˜</h3>
                <div id="insuranceContainer"></div>
                <button class="btn-add" id="addInsurance"><i class="fas fa-plus"></i> ë³´í—˜ ì¶”ê°€</button>

                <h3>ì—°ê¸ˆ ë³´í—˜</h3>
                <div id="pensionContainer"></div>
                <button class="btn-add" id="addPension"><i class="fas fa-plus"></i> ì—°ê¸ˆ ì¶”ê°€</button>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ“Š ë³´í—˜ë£Œ ìš”ì•½</h3>
                    <div class="two-col">
                        <div class="info-box primary">
                            <div style="color: var(--text-light); font-size: 0.9rem;">ë³´ì¥ì„± ë³´í—˜ë£Œ</div>
                            <div style="font-size: 1.3rem; font-weight: 600;" id="totalInsurancePremium">0ì›</div>
                        </div>
                        <div class="info-box accent">
                            <div style="color: var(--text-light); font-size: 0.9rem;">ì—°ê¸ˆ ë³´í—˜ë£Œ</div>
                            <div style="font-size: 1.3rem; font-weight: 600;" id="totalPensionPremium">0ì›</div>
                        </div>
                        <div class="info-box success">
                            <div style="color: var(--text-light); font-size: 0.9rem;">ì—°ê¸ˆ ì˜ˆìƒ í™˜ê¸‰ì•¡</div>
                            <div style="font-size: 1.3rem; font-weight: 600;" id="totalPensionReturn">0ì›</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: ì€í‡´ì¤€ë¹„ ë¶„ì„ -->
            <div class="card" id="step4" style="display:none;">
                <h2><i class="fas fa-umbrella-beach"></i> Step 4. ì€í‡´ ì¤€ë¹„ ë¶„ì„</h2>
                
                <div class="retirement-layout">
                    <!-- ì™¼ìª½: ì…ë ¥ ì˜ì—­ -->
                    <div>
                        <div class="card">
                            <h3>ê¸°ë³¸ ì •ë³´</h3>
                            <div class="two-col">
                                <div class="input-group">
                                    <label>í¬ë§ ì€í‡´ ì—°ë ¹</label>
                                    <input type="number" id="retirementAge" placeholder="65" min="50" max="80">
                                </div>
                                <div class="input-group">
                                    <label>ì˜ˆìƒ ìˆ˜ëª…</label>
                                    <input type="number" id="lifeExpectancy" placeholder="90" min="70" max="120">
                                </div>
                            </div>
                            <div class="input-group">
                                <label>ì€í‡´ í›„ í¬ë§ ì›” ìƒí™œë¹„ (í˜„ì¬ê°€ì¹˜)</label>
                                <div class="input-field">
                                    <input type="text" id="retirementMonthlyExpense" inputmode="numeric" placeholder="5,000,000">
                                    <span>ì›</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>ë¬¼ê°€ìƒìŠ¹ë¥  (%)</label>
                                <input type="number" id="inflationRate" value="3.1" step="0.1" min="0" max="10">
                            </div>
                        </div>

                        <div class="card">
                            <h3>êµ­ë¯¼ì—°ê¸ˆ</h3>
                            <div class="input-group">
                                <label>ë³¸ì¸ ì˜ˆìƒ ì›” ìˆ˜ë ¹ì•¡</label>
                                <div class="input-field">
                                    <input type="text" id="nationalPension" inputmode="numeric" placeholder="1,500,000">
                                    <span>ì›</span>
                                </div>
                            </div>
                            <div class="input-group" id="spouseNationalPensionGroup" style="display: none;">
                                <label>ë°°ìš°ì ì˜ˆìƒ ì›” ìˆ˜ë ¹ì•¡</label>
                                <div class="input-field">
                                    <input type="text" id="spouseNationalPension" inputmode="numeric" placeholder="800,000">
                                    <span>ì›</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥¸ìª½: ì„ íƒëœ ìì‚° ìƒì„¸ -->
                    <div>
                        <div class="card" style="background: #f8f9fa; border: 2px solid #e9ecef;">
                            <h3 style="color: var(--primary);">ğŸ“‹ ì€í‡´ìì‚° ìƒì„¸ë‚´ì—­(ìƒë…„ì›”ì¼ ì…ë ¥í•„ìˆ˜)</h3>
                            <div id="retirementAssetsDetailPanel">
                                <p style="color: #999; text-align: center; padding: 2rem;">
                                    Step 2ì—ì„œ ìì‚°ì„ ì…ë ¥í•˜ê³ <br>
                                    ê° í•­ëª©ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ë©´<br>
                                    ì€í‡´ì‹œì ì˜ ì˜ˆìƒ ê°€ì¹˜ê°€ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.(ê³ ê°ì •ë³´ì—ì„œ 'ìƒë…„ì›”ì¼' ì…ë ¥ í•„ìˆ˜)
                                </p>
                            </div>
                        </div>

                        <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; margin-top: 1.5rem;">
                            <h3 style="color: white; border: none;">ğŸ’° ì´ ì€í‡´ìì‚°</h3>
                            <div style="font-size: 2rem; font-weight: 700; text-align: center; margin: 1rem 0;">
                                <span id="totalRetirementAssetsFuture">0ì›</span>
                            </div>
                            <div style="font-size: 0.9rem; opacity: 0.9; text-align: center;">
                                ì€í‡´ì‹œì  ì˜ˆìƒê°€ì¹˜ (ë¬¼ê°€ìƒìŠ¹ë¥  ë°˜ì˜)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë¶„ì„ ê²°ê³¼ -->
                <div class="card" style="margin-top: 2rem;">
                    <h3>ğŸ“Š ì€í‡´ ì¤€ë¹„ ë¶„ì„ ê²°ê³¼</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">ì€í‡´ í›„ ê¸°ê°„</div>
                            <div class="summary-value" id="retirementYears">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ì´ í•„ìš”ê¸ˆì•¡</div>
                            <div class="summary-value" id="totalRetirementNeeds">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">í˜„ì¬ ì¤€ë¹„ì•¡</div>
                            <div class="summary-value" id="currentRetirementFunds">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ë¶€ì¡±/ì´ˆê³¼ì•¡</div>
                            <div class="summary-value" id="retirementGap">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ì¤€ë¹„ë„ ì ìˆ˜</div>
                            <div class="summary-value" id="retirementScore" style="font-size: 2rem; color: var(--accent);">-</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem;" id="retirementChartContainer"></div>

                    <div class="info-box primary" style="margin-top: 1.5rem;">
                        <h4 style="color: var(--primary);">ğŸ’¡ ë¶„ì„ ë° ì œì–¸</h4>
                        <div id="retirementAdvice">ì€í‡´ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>

            <!-- Step 5: ëª©ì ìê¸ˆ -->
            <div class="card" id="step5" style="display:none;">
                <h2><i class="fas fa-bullseye"></i> Step 5. ëª©ì ìê¸ˆ</h2>
                
                <div id="goalContainer"></div>
                <button class="btn-add" id="addGoal"><i class="fas fa-plus"></i> ëª©í‘œ ì¶”ê°€</button>
            </div>

            <!-- Step 6: íˆ¬ìì„±í–¥ -->
            <div class="card" id="step6" style="display:none;">
                <h2><i class="fas fa-chart-bar"></i> Step 6. íˆ¬ìì„±í–¥ ë¶„ì„</h2>
                
                <div id="investmentQuestionsContainer"></div>
            </div>

<!-- Step 7: ìƒì†ì¦ì—¬ (êµ­ì„¸ì²­ í”Œë¡œìš° ì™„ë²½ ë°˜ì˜) -->
<div class="card" id="step7" style="display:none;">
    <h2><i class="fas fa-gift"></i> Step 7. ìƒì†Â·ì¦ì—¬ì„¸ ì ˆì„¸ ì „ëµ</h2>
    
    <div class="retirement-layout">
        <!-- ì¢Œì¸¡: ì…ë ¥ íŒ¨ë„ -->
        <div>
            <div class="card" style="background: #f8f9fa;">
                <h3>ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
                
                <div class="input-group">
                    <label>ë¶„ì„ ìœ í˜•</label>
                    <div class="radio-group" style="flex-direction: row; gap: 1rem;">
                        <label style="flex: 1;">
                            <input type="radio" name="taxType" value="gift" checked onchange="toggleTaxType()">
                            <span>ì¦ì—¬</span>
                        </label>
                        <label style="flex: 1;">
                            <input type="radio" name="taxType" value="inheritance" onchange="toggleTaxType()">
                            <span>ìƒì†</span>
                        </label>
                    </div>
                </div>

                <div class="input-group">
                    <label id="donorLabel">ì¦ì—¬ì</label>
                    <input type="text" id="donor" placeholder="ì˜ˆ: í™ê¸¸ë™ (ë¶€)">
                </div>

                <div class="input-group">
                    <label id="recipientLabel">ìˆ˜ì¦ì</label>
                    <input type="text" id="recipient" placeholder="ì˜ˆ: í™ì•„ë“¤ (ìë…€)">
                </div>

                <div class="input-group">
                    <label>ê´€ê³„</label>
                    <select id="taxRelation">
                        <option value="ìë…€">ì§ê³„ë¹„ì† (ìë…€)</option>
                        <option value="ë°°ìš°ì">ë°°ìš°ì</option>
                        <option value="ì†ìë…€">ì§ê³„ë¹„ì† (ì†ìë…€)</option>
                        <option value="ë¶€ëª¨">ì§ê³„ì¡´ì† (ë¶€ëª¨)</option>
                        <option value="í˜•ì œìë§¤">í˜•ì œìë§¤</option>
                        <option value="ê¸°íƒ€ì¹œì¡±">ê¸°íƒ€ ì¹œì¡±</option>
                        <option value="ë¹„ì¹œì¡±">ì¹œì¡± ì•„ë‹˜</option>
                    </select>
                </div>
            </div>

            <!-- 1. ì¬ì‚°ê°€ì•¡ -->
            <div class="card" style="background: #f8f9fa;">
                <h3>ğŸ’° 1. ì¦ì—¬/ìƒì† ì¬ì‚°ê°€ì•¡</h3>
                
                <div class="input-group">
                    <label>ë¶€ë™ì‚° ê°€ì•¡</label>
                    <div class="input-field">
                        <input type="text" id="propertyValue" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>ê¸ˆìœµìì‚° (í˜„ê¸ˆ/ì˜ˆê¸ˆ/ì£¼ì‹ ë“±)</label>
                    <div class="input-field">
                        <input type="text" id="financialValue" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>ê¸°íƒ€ ì¬ì‚°</label>
                    <div class="input-field">
                        <input type="text" id="otherValue" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>

                <div class="info-box primary">
                    <div style="color: var(--text-light); font-size: 0.9rem;">â‘  ì´ ì¬ì‚°ê°€ì•¡</div>
                    <div style="font-size: 1.5rem; font-weight: 700;" id="totalPropertyValue">0ì›</div>
                </div>
            </div>

            <!-- 2. ë¹„ê³¼ì„¸ ë° ì±„ë¬´ -->
            <div class="card" style="background: #f8f9fa;">
                <h3>ğŸ“ 2. ë¹„ê³¼ì„¸ ë° ì±„ë¬´</h3>
                
                <div class="input-group">
                    <label>ë¹„ê³¼ì„¸ ì¬ì‚° (ê³µìµë²•ì¸ ì¶œì—°, ë¬¸í™”ì¬ ë“±)</label>
                    <div class="input-field">
                        <input type="text" id="taxExempt" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>ì±„ë¬´ (ë‹´ë³´ì±„ë¬´, ì„ëŒ€ë³´ì¦ê¸ˆ ë“±)</label>
                    <div class="input-field">
                        <input type="text" id="debtAmount" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>

                <div class="input-group" id="funeralExpenseGroup" style="display: none;">
                    <label>ì¥ë¡€ë¹„ìš© (ìµœëŒ€ 1ì²œë§Œì› ë˜ëŠ” 500ë§Œì›)</label>
                    <div class="input-field">
                        <input type="text" id="funeralExpense" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>
            </div>

            <!-- 3. ì‚¬ì „ì¦ì—¬ì¬ì‚° -->
            <div class="card" style="background: #f8f9fa;">
                <h3>ğŸ“… 3. ê¸°ì¡´ ì¦ì—¬ ì´ë ¥</h3>
                
                <div class="input-group">
                    <label>ìµœê·¼ 10ë…„ ì´ë‚´ ì¦ì—¬ë°›ì€ ê¸ˆì•¡</label>
                    <div class="input-field">
                        <input type="text" id="previousGiftAmount" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                        <span>ì›</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>ì¦ì—¬ ì—°ë„</label>
                    <input type="number" id="previousGiftYear" placeholder="ì˜ˆ: 2020" min="2000" max="2025">
                </div>

                <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.5rem;">
                    * ì§ê³„ì¡´ì†ìœ¼ë¡œë¶€í„°ì˜ ì¦ì—¬ëŠ” 10ë…„, ê¸°íƒ€ëŠ” 5ë…„ ì´ë‚´ í•©ì‚°
                </small>
            </div>

            <!-- 4. ìˆ˜ì¦ì/ìƒì†ì¸ ì •ë³´ -->
            <div class="card" style="background: #f8f9fa;">
                <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ 4. ìˆ˜ì¦ì/ìƒì†ì¸ ì •ë³´</h3>
                
                <div class="input-group">
                    <label>ìˆ˜ì¦ì/ìƒì†ì¸ ë‚˜ì´</label>
                    <input type="number" id="recipientAge" placeholder="ì˜ˆ: 30" min="0" max="120" onchange="calculateTaxTotal()">
                    <small style="color: #666; font-size: 0.85rem; margin-top: 0.3rem; display: block;">
                        * ë¯¸ì„±ë…„ì(ë§Œ 19ì„¸ ë¯¸ë§Œ)ëŠ” ê³µì œì•¡ì´ ë‹¤ë¦…ë‹ˆë‹¤
                    </small>
                </div>

                <div id="inheritanceOnlyFields" style="display: none;">
                    <div class="input-group">
                        <label>ìƒì†ì¸ ìˆ˜ (ìë…€)</label>
                        <input type="number" id="heirCount" placeholder="ì˜ˆ: 2" min="1" max="10" value="1" onchange="calculateTaxTotal()">
                    </div>

                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="hasDisability" onchange="calculateTaxTotal()" style="width: auto; height: auto;">
                            <span>ì¥ì• ì¸ ì—¬ë¶€</span>
                        </label>
                    </div>

                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="isElderly" onchange="calculateTaxTotal()" style="width: auto; height: auto;">
                            <span>ì—°ë¡œì (65ì„¸ ì´ìƒ)</span>
                        </label>
                    </div>

                    <div class="input-group">
                        <label>ë°°ìš°ì ì‹¤ì œ ìƒì†ë¶„ (ë°°ìš°ìê³µì œ ê³„ì‚°ìš©)</label>
                        <div class="input-field">
                            <input type="text" id="spouseInheritance" inputmode="numeric" oninput="formatInputNumber(this); calculateTaxTotal();" placeholder="0">
                            <span>ì›</span>
                        </div>
                        <small style="color: #666; font-size: 0.85rem; margin-top: 0.3rem; display: block;">
                            * ë°°ìš°ìê³µì œ: ìµœì†Œ 5ì–µ ~ ìµœëŒ€ 30ì–µ (ì‹¤ì œ ìƒì†ë¶„ì˜ 30% + 5ì–µ)
                        </small>
                    </div>
                </div>
            </div>

            <button class="btn" style="width: 100%; padding: 1rem; font-size: 1.1rem; margin-top: 1rem;" onclick="calculateDetailedTax()">
                <i class="fas fa-calculator"></i> ìƒì„¸ ì„¸ì•¡ ê³„ì‚°í•˜ê¸°
            </button>
        </div>

        <!-- ìš°ì¸¡: ê²°ê³¼ íŒ¨ë„ -->
        <div>
            <div class="card" id="taxResultPanel" style="display: none;">
                <h3 style="color: var(--primary);">ğŸ“Š ì„¸ì•¡ ê³„ì‚° ê²°ê³¼</h3>
                
                <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid var(--primary);">
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘  ì´ ì¬ì‚°ê°€ì•¡</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result1TotalProperty">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘¡ - ë¹„ê³¼ì„¸/ì±„ë¬´</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result2Exempt">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘¢ + ì‚¬ì „ì¦ì—¬ì¬ì‚°</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result3PreviousGift">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 2px solid #3b82f6;">
                        <span style="font-weight: 700; font-size: 1.05rem; color: var(--primary);">â‘£ = ê³¼ì„¸ê°€ì•¡</span>
                        <span style="font-weight: 700; font-size: 1.2rem; color: var(--primary);" id="result4TaxableAmount">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘¤ - ê³µì œì•¡</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result5Deduction">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 2px solid #3b82f6;">
                        <span style="font-weight: 700; font-size: 1.05rem; color: var(--primary);">â‘¥ = ê³¼ì„¸í‘œì¤€</span>
                        <span style="font-weight: 700; font-size: 1.2rem; color: var(--primary);" id="result6TaxBase">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘¦ Ã— ì„¸ìœ¨ - ëˆ„ì§„ê³µì œ</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result7TaxRate">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘§ + ì„¸ëŒ€ìƒëµ í• ì¦</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result8Surcharge">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                        <span style="color: #64748b; font-size: 0.95rem;">â‘¨ - ì„¸ì•¡ê³µì œ (10%)</span>
                        <span style="font-weight: 700; font-size: 1.05rem;" id="result9Credit">-</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 1rem 0; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); margin: 1rem -1.5rem -1.5rem -1.5rem; padding: 1rem 1.5rem; border-radius: 0 0 12px 12px;">
                        <span style="font-weight: 700; font-size: 1.2rem; color: #dc2626;">â‘© ìµœì¢… ë‚©ë¶€ì„¸ì•¡</span>
                        <span style="font-weight: 700; font-size: 1.5rem; color: #dc2626;" id="result10FinalTax">-</span>
                    </div>
                </div>

                <div id="deductionDetail" style="background: #fffbeb; padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 1.5rem; display: none;">
                    <h4 style="color: #92400e; margin-bottom: 0.75rem; font-size: 0.95rem;">ğŸ“‹ ê³µì œ ìƒì„¸ë‚´ì—­</h4>
                    <div id="deductionDetailContent" style="line-height: 1.8; color: #78350f; font-size: 0.85rem;"></div>
                </div>

                <div id="scenarioComparison" style="display: none; margin-top: 1.5rem;">
                    <h3>ğŸ“ˆ ì‹œë‚˜ë¦¬ì˜¤ë³„ ë¹„êµ</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                        <div style="background: white; border: 2px solid #e2e8f0; border-radius: 10px; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 0.5rem;">ì‹œë‚˜ë¦¬ì˜¤ 1</div>
                            <div style="font-weight: 600; font-size: 0.95rem; color: #64748b; margin-bottom: 0.75rem;">ì§ì ‘ ì¦ì—¬</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #1e293b; margin-bottom: 0.5rem;" id="scenario1Amount">-</div>
                            <div style="display: inline-block; padding: 0.25rem 0.75rem; background: #dbeafe; color: #1e40af; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">í˜„ì¬ ë°©ì‹</div>
                        </div>
                        
                        <div style="background: white; border: 2px solid #e2e8f0; border-radius: 10px; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 0.5rem;">ì‹œë‚˜ë¦¬ì˜¤ 2</div>
                            <div style="font-weight: 600; font-size: 0.95rem; color: #64748b; margin-bottom: 0.75rem;">ë°°ìš°ì ê²½ìœ </div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #10b981; margin-bottom: 0.5rem;" id="scenario2Amount">-</div>
                            <div style="display: inline-block; padding: 0.25rem 0.75rem; background: #dbeafe; color: #1e40af; border-radius: 20px; font-size: 0.8rem; font-weight: 600;" id="scenario2Savings">-</div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #10b981; border-radius: 10px; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 0.85rem; color: #166534; margin-bottom: 0.5rem;">ì‹œë‚˜ë¦¬ì˜¤ 3</div>
                            <div style="font-weight: 600; font-size: 0.95rem; color: #166534; margin-bottom: 0.75rem;">10ë…„ ë¶„í• </div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #10b981; margin-bottom: 0.5rem;" id="scenario3Amount">-</div>
                            <div style="display: inline-block; padding: 0.25rem 0.75rem; background: #dcfce7; color: #166534; border-radius: 20px; font-size: 0.8rem; font-weight: 600;" id="scenario3Savings">âœ¨ ìµœëŒ€ ì ˆì„¸</div>
                        </div>
                    </div>
                </div>

                <div class="info-box primary" style="margin-top: 1.5rem;" id="taxStrategyAdvice">
                    <h4 style="color: var(--primary); margin-bottom: 0.75rem;">ğŸ’¡ ì¶”ì²œ ì ˆì„¸ ì „ëµ</h4>
                    <div id="taxStrategyContent">ê³„ì‚° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
                </div>

                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #f59e0b; margin-top: 1.5rem; display: none;" id="optimalPlan">
                    <h4 style="color: #92400e; margin-bottom: 1rem;">âš¡ ìµœì  ì‹¤í–‰ ë°©ì•ˆ</h4>
                    <div id="optimalPlanContent"></div>
                </div>
            </div>

            <div class="card" style="background: #fffbeb; border: 2px solid #fbbf24;">
                <h4 style="color: #92400e; margin-bottom: 1rem;">ğŸ’¡ ì°¸ê³ ì‚¬í•­</h4>
                <div style="line-height: 1.8; color: #78350f; font-size: 0.9rem;">
                    <strong>ì¦ì—¬ì¬ì‚°ê³µì œ (10ë…„ í•©ì‚°)</strong><br>
                    â€¢ ë°°ìš°ì: 6ì–µì›<br>
                    â€¢ ì§ê³„ë¹„ì† (ì„±ë…„): 5ì²œë§Œì›<br>
                    â€¢ ì§ê³„ë¹„ì† (ë¯¸ì„±ë…„): 2ì²œë§Œì›<br>
                    â€¢ ì§ê³„ì¡´ì†: 5ì²œë§Œì›<br>
                    â€¢ ê¸°íƒ€ì¹œì¡±: 1ì²œë§Œì›<br><br>
                    
                    <strong>ì„¸ìœ¨ (ëˆ„ì§„ì„¸ìœ¨)</strong><br>
                    â€¢ 1ì–µ ì´í•˜: 10%<br>
                    â€¢ 5ì–µ ì´í•˜: 20% (ëˆ„ì§„ê³µì œ 1ì²œë§Œì›)<br>
                    â€¢ 10ì–µ ì´í•˜: 30% (ëˆ„ì§„ê³µì œ 6ì²œë§Œì›)<br>
                    â€¢ 30ì–µ ì´í•˜: 40% (ëˆ„ì§„ê³µì œ 1.6ì–µì›)<br>
                    â€¢ 30ì–µ ì´ˆê³¼: 50% (ëˆ„ì§„ê³µì œ 4.6ì–µì›)<br><br>
                    
                    <strong>âš ï¸ ì£¼ì˜</strong><br>
                    ìœ„ ì„¸ì•¡ì€ ê°œëµì ì¸ ì¶”ì •ì¹˜ì´ë©°, ì‹¤ì œ ì„¸ì•¡ì€ ë‹¤ì–‘í•œ ìš”ì¸ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                    ì •í™•í•œ ì„¸ë¬´ ê³„íšì€ ë°˜ë“œì‹œ ì„¸ë¬´ì‚¬ì™€ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ìœ„ í˜¸í™˜ì„± -->
    <div style="display: none;">
        <input type="text" id="inheritanceAmount" value="0">
        <select id="inheritanceRelation"><option value="ìë…€">ìë…€</option></select>
        <textarea id="inheritanceRecipients"></textarea>
        <input type="text" id="giftAmount" value="0">
        <select id="giftRelation"><option value="ìë…€">ìë…€</option></select>
        <textarea id="giftPurpose"></textarea>
    </div>
</div>

            <!-- Step 8: ì´í‰ -->
            <div class="card" id="step8" style="display:none;">
                <h2><i class="fas fa-file-alt"></i> Step 8. ì¢…í•© ë¶„ì„ ë° ì´í‰</h2>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 1.5rem; text-align: center;">
                    <h3 style="color: white; border: none; padding: 0; margin-bottom: 1rem;">ğŸ¯ ê³ ê°ì •ë³´ ê¸°ë°˜ ì¬ë¬´ì†”ë£¨ì…˜</h3>
                    <p style="opacity: 0.9; margin-bottom: 1.5rem;">ëª¨ë“  ì…ë ¥ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§ì¶¤í˜• ì¬ë¬´ ì†”ë£¨ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤</p>
                    <button class="btn" id="generateAISolution" style="background: white; color: var(--primary); font-weight: 600; padding: 1rem 2rem;">
                        <i class="fas fa-magic"></i> ê³ ê°ì •ë³´ Summary ìƒì„±
                    </button>
                </div>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 1.5rem; text-align: center;">
                    <h3 style="color: white; border: none; padding: 0; margin-bottom: 1rem;">ğŸ“„ ì „ë¬¸ PDF ë³´ê³ ì„œ</h3>
                    <p style="opacity: 0.9; margin-bottom: 1.5rem;">ëª¨ë“  ì…ë ¥ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì „ë¬¸ì ì¸ ì¬ë¬´ë¶„ì„ ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
                    <button class="btn" id="generatePDFReport" style="background: white; color: #667eea; font-weight: 600; padding: 1rem 2rem;">
                        <i class="fas fa-file-pdf"></i> PDF ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>

                <div id="aiSolutionResult" style="display: none;">
                    <div class="info-box primary">
                        <h4 style="color: var(--primary); margin-bottom: 1rem;">ğŸ’¡ ê³ ê°ì •ë³´ Summary</h4>
                        <div id="aiSolutionText" style="line-height: 1.8; white-space: pre-wrap;"></div>
                    </div>
                </div>

                <h3>ìˆ˜ë™ ì´í‰ ì…ë ¥</h3>
                <div class="input-group">
                    <label>ì¢…í•© ë¶„ì„ ë° ì œì•ˆ</label>
                    <textarea id="finalSummary" rows="10" placeholder="ì¢…í•©ì ì¸ ì¬ë¬´ ë¶„ì„ ë° ì œì•ˆì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
            </div>
        </div>
        <!-- ë¶„ì„ ì„¹ì…˜ (ìš°ì¸¡ íŒ¨ë„) -->
        <div class="analysis-section">
            <div class="card" id="analysis1">
                <h2><i class="fas fa-user-check"></i> ê³ ê° í”„ë¡œí•„ ìš”ì•½</h2>
                
                <div class="profile-summary">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‘¤</div>
                    <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;" id="summaryName">ê³ ê°ëª…</div>
                    <div style="font-size: 1.1rem; opacity: 0.9;" id="summaryAge">ë§Œ -ì„¸</div>
                </div>

                <div class="info-box warning" id="summaryMeetingBox" style="display: none;">
                    <div style="color: var(--text-light); font-size: 0.9rem;">ë¯¸íŒ…ì¼ì</div>
                    <div style="font-size: 1.1rem; font-weight: 600;" id="summaryMeeting">-</div>
                </div>

                <div class="info-box primary">
                    <div style="color: var(--text-light); font-size: 0.9rem;">ê°€êµ¬í˜•íƒœ</div>
                    <div style="font-size: 1.1rem; font-weight: 600;" id="summaryFamily">-</div>
                </div>
                <div class="info-box accent">
                    <div style="color: var(--text-light); font-size: 0.9rem;">ì§ì—…</div>
                    <div style="font-size: 1.1rem; font-weight: 600;" id="summaryJob">-</div>
                </div>
                <div class="info-box success">
                    <div style="color: var(--text-light); font-size: 0.9rem;">ì›” ì†Œë“</div>
                    <div style="font-size: 1.1rem; font-weight: 600;" id="summaryIncome">-</div>
                </div>
            </div>

            <div class="card" id="analysis2" style="display:none;">
                <h2><i class="fas fa-chart-pie"></i> ì¬ë¬´í˜„í™© ë¶„ì„</h2>
                
                <div class="result-grid">
                    <div class="result-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <h4>ì´ ìì‚°</h4>
                        <div class="result-value">0ì›</div>
                    </div>
                    <div class="result-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h4>ì´ ë¶€ì±„</h4>
                        <div class="result-value">0ì›</div>
                    </div>
                    <div class="result-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <h4>ìˆœìì‚°</h4>
                        <div class="result-value">0ì›</div>
                    </div>
                    <div class="result-box" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <h4>ì›” ì‰ì—¬ê¸ˆ</h4>
                        <div class="result-value">0ì›</div>
                    </div>
                </div>

                <div id="financialChartContainer"></div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ’¡ ì¬ë¬´ ê±´ì „ì„± í‰ê°€</h3>
                    <p style="line-height: 1.8; color: var(--text);" id="financialAdvice">
                        ì¬ë¬´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div class="card" id="analysis3" style="display:none;">
                <h2><i class="fas fa-shield-alt"></i> ë³´í—˜ ì§„ë‹¨ ê²°ê³¼</h2>
                
                <div class="result-grid">
                    <div class="result-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <h4>ê°€ì… ë³´í—˜ ìˆ˜</h4>
                        <div class="result-value" id="insuranceCount">0ê°œ</div>
                    </div>
                    <div class="result-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h4>ì›” ë³´í—˜ë£Œ</h4>
                        <div class="result-value" id="totalPremium">0ì›</div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ›¡ï¸ ë³´ì¥ ë¶„ì„</h3>
                    <p style="line-height: 1.8; color: var(--text);" id="insuranceAdvice">
                        ë³´í—˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div class="card" id="analysis4" style="display:none;">
                <h2><i class="fas fa-umbrella-beach"></i> ì€í‡´ ì¤€ë¹„ ë¶„ì„</h2>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">ì€í‡´ í›„ í•„ìš” ê¸°ê°„</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">ì´ í•„ìš” ìê¸ˆ</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">í˜„ì¬ ì¤€ë¹„ì•¡</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">ë¶€ì¡±ì•¡</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">-</div>
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ–ï¸ ì€í‡´ ì¤€ë¹„ ì ìˆ˜</h3>
                    <div style="font-size: 3rem; font-weight: 700; text-align: center; color: var(--primary); margin: 1rem 0;">-</div>
                    <p style="line-height: 1.8; color: var(--text); text-align: center;">
                        ì€í‡´ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div class="card" id="analysis5" style="display:none;">
                <h2><i class="fas fa-bullseye"></i> ëª©ì ìê¸ˆ ë‹¬ì„± ê³„íš</h2>
                
                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">ì´ ëª©í‘œ ê¸ˆì•¡</div>
                            <div style="font-size: 1.5rem; font-weight: 700;" id="totalGoalAmount">0ì›</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">í˜„ì¬ ì¤€ë¹„ì•¡</div>
                            <div style="font-size: 1.5rem; font-weight: 700;" id="totalGoalCurrent">0ì›</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">í•„ìš” ì¶”ê°€ì•¡</div>
                            <div style="font-size: 1.5rem; font-weight: 700;" id="totalGoalGap">0ì›</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">ë‹¬ì„±ë¥ </div>
                            <div style="font-size: 1.5rem; font-weight: 700;" id="goalAchievementRate">0%</div>
                        </div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ¯ ëª©í‘œ ë‹¬ì„± ì „ëµ</h3>
                    <p style="line-height: 1.8; color: var(--text);" id="goalAdvice">
                        ëª©ì ìê¸ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div class="card" id="analysis6" style="display:none;">
                <h2><i class="fas fa-chart-bar"></i> íˆ¬ìì„±í–¥ ê²°ê³¼</h2>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“Š</div>
                    <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;" id="investmentType">-</div>
                    <div style="font-size: 1.2rem; opacity: 0.9;" id="investmentScore">ì´ì : 0ì </div>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ“ˆ íˆ¬ì ì„±í–¥ ë¶„ì„</h3>
                    <p style="line-height: 1.8; color: var(--text);" id="investmentAdvice">
                        íˆ¬ìì„±í–¥ ì§ˆë¬¸ì— ë‹µë³€í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div class="card" id="analysis7" style="display:none;">
                <h2><i class="fas fa-gift"></i> ìƒì†Â·ì¦ì—¬ ë¶„ì„</h2>
                
                <div class="result-grid">
                    <div class="result-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <h4>ì˜ˆìƒ ìƒì†ì•¡</h4>
                        <div class="result-value" id="totalInheritance">0ì›</div>
                    </div>
                    <div class="result-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <h4>ì¦ì—¬ ì˜ˆì •ì•¡</h4>
                        <div class="result-value" id="totalGift">0ì›</div>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ’ ìƒì†Â·ì¦ì—¬ ì „ëµ</h3>
                    <p style="line-height: 1.8; color: var(--text);" id="inheritanceAdvice">
                        ìƒì†Â·ì¦ì—¬ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <div class="card" id="analysis8" style="display:none;">
                <h2><i class="fas fa-clipboard-check"></i> ì¢…í•© ë¶„ì„ ê²°ê³¼</h2>
                
                <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">âœ…</div>
                    <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">ì¢…í•© ì¬ë¬´ ê±´ê°•ë„</div>
                    <div style="font-size: 3rem; font-weight: 700;" id="overallScore">-</div>
                </div>

                <div id="comprehensiveAnalysis" style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ“‹ ì¢…í•© í‰ê°€</h3>
                    <p style="line-height: 1.8; color: var(--text);">
                        ëª¨ë“  ë‹¨ê³„ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ì¢…í•©ì ì¸ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        Copyright Â© 2025 (ì£¼)í•œêµ­FPì„¼í„°. All Rights Reserved.
    </footer>

    <script>
        // ëª¨ë°”ì¼ ê²½ê³  ë‹«ê¸°
        function closeMobileWarning() {
            document.getElementById('mobileWarning').style.display = 'none';
            document.body.style.overflow = 'auto';
            sessionStorage.setItem('mobileWarningClosed', 'true');
        }

        let currentStep = 1;
        let realEstateCount = 0;
        let financialAssetCount = 0;
        let debtCount = 0;
        let monthlyIncomeCount = 0;
        let monthlyExpenseCount = 0;
        let insuranceCount = 0;
        let pensionCount = 0;
        let goalCount = 0;

        const incomeCategories = ['ê¸‰ì—¬', 'ì‚¬ì—…ì†Œë“', 'ì„ëŒ€ì†Œë“', 'ì´ìì†Œë“', 'ë°°ë‹¹ì†Œë“', 'ì—°ê¸ˆì†Œë“', 'ê¸°íƒ€', 'ì§ì ‘ì…ë ¥'];
        const expenseCategories = ['ì‹ë¹„', 'ì£¼ê±°ë¹„', 'êµí†µë¹„', 'í†µì‹ ë¹„', 'ì˜ë£Œë¹„', 'êµìœ¡ë¹„', 'ë¬¸í™”ìƒí™œë¹„', 'ë³´í—˜ë£Œ', 'ì €ì¶•', 'ê¸°íƒ€', 'ì§ì ‘ì…ë ¥'];
        const insuranceTypes = ['ìƒëª…ë³´í—˜', 'ì†í•´ë³´í—˜', 'ì¢…ì‹ ë³´í—˜', 'ì‹¤ì†ë³´í—˜', 'ìë™ì°¨ë³´í—˜', 'ì§ˆë³‘ë³´í—˜', 'ì•”ë³´í—˜', 'ì§ì ‘ì…ë ¥'];
        
        const investmentQuestions = [
            {
                q: "íˆ¬ì ê²½í—˜ì´ ì–¼ë§ˆë‚˜ ë˜ì…¨ë‚˜ìš”?",
                options: [
                    { text: "íˆ¬ì ê²½í—˜ì´ ì „í˜€ ì—†ìŒ", score: 1 },
                    { text: "1ë…„ ë¯¸ë§Œ", score: 2 },
                    { text: "1-3ë…„", score: 3 },
                    { text: "3-5ë…„", score: 4 },
                    { text: "5ë…„ ì´ìƒ", score: 5 }
                ]
            },
            {
                q: "íˆ¬ì ëª©ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    { text: "ì›ê¸ˆ ë³´ì¡´", score: 1 },
                    { text: "ì•ˆì •ì ì¸ ìˆ˜ìµ", score: 2 },
                    { text: "ì ì ˆí•œ ìˆ˜ìµê³¼ ì•ˆì •ì„±", score: 3 },
                    { text: "ë†’ì€ ìˆ˜ìµ ì¶”êµ¬", score: 4 },
                    { text: "ìµœê³  ìˆ˜ìµ ì¶”êµ¬ (ê³ ìœ„í—˜ ê°ìˆ˜)", score: 5 }
                ]
            },
            {
                q: "íˆ¬ì ìê¸ˆì˜ ì‚¬ìš© ê³„íšì€?",
                options: [
                    { text: "1ë…„ ì´ë‚´ ì‚¬ìš© ì˜ˆì •", score: 1 },
                    { text: "1-3ë…„ ë‚´ ì‚¬ìš© ì˜ˆì •", score: 2 },
                    { text: "3-5ë…„ ë‚´ ì‚¬ìš© ì˜ˆì •", score: 3 },
                    { text: "5-10ë…„ ë‚´ ì‚¬ìš© ì˜ˆì •", score: 4 },
                    { text: "10ë…„ ì´ìƒ ì¥ê¸° íˆ¬ì", score: 5 }
                ]
            },
            {
                q: "í˜„ì¬ ì¬ë¬´ ìƒí™©ì€?",
                options: [
                    { text: "ìˆ˜ì…ì´ ë¶ˆì•ˆì •í•˜ê³  ë¶€ì±„ê°€ ë§ìŒ", score: 1 },
                    { text: "ìˆ˜ì…ì€ ìˆìœ¼ë‚˜ ì €ì¶• ì—¬ë ¥ ì—†ìŒ", score: 2 },
                    { text: "ì•ˆì •ì  ìˆ˜ì…ê³¼ ì ì ˆí•œ ì €ì¶•", score: 3 },
                    { text: "ì•ˆì •ì  ìˆ˜ì…ê³¼ ì¶©ë¶„í•œ ì €ì¶•", score: 4 },
                    { text: "ë§¤ìš° ì•ˆì •ì ì´ë©° íˆ¬ì ì—¬ë ¥ ì¶©ë¶„", score: 5 }
                ]
            },
            {
                q: "íˆ¬ìê¸ˆì´ 20% ì†ì‹¤ì´ ë°œìƒí•œë‹¤ë©´?",
                options: [
                    { text: "ê²¬ë”œ ìˆ˜ ì—†ì–´ ì¦‰ì‹œ ë§¤ë„", score: 1 },
                    { text: "ë§¤ìš° ë¶ˆì•ˆí•˜ì§€ë§Œ ë³´ìœ ", score: 2 },
                    { text: "ë¶ˆì•ˆí•˜ì§€ë§Œ ê¸°ë‹¤ë¦¼", score: 3 },
                    { text: "ì¶”ê°€ ë§¤ìˆ˜ ê³ ë ¤", score: 4 },
                    { text: "ê¸°íšŒë¡œ ìƒê°í•˜ê³  ì ê·¹ ë§¤ìˆ˜", score: 5 }
                ]
            },
            {
                q: "ì„ í˜¸í•˜ëŠ” íˆ¬ì ìƒí’ˆì€?",
                options: [
                    { text: "ì˜ˆê¸ˆ/ì ê¸ˆ", score: 1 },
                    { text: "ì±„ê¶Œ/ì±„ê¶Œí˜• í€ë“œ", score: 2 },
                    { text: "í˜¼í•©í˜• í€ë“œ", score: 3 },
                    { text: "ì£¼ì‹í˜• í€ë“œ", score: 4 },
                    { text: "ê°œë³„ ì£¼ì‹/íŒŒìƒìƒí’ˆ", score: 5 }
                ]
            },
            {
                q: "ì—°ê°„ ê¸°ëŒ€ ìˆ˜ìµë¥ ì€?",
                options: [
                    { text: "ì›ê¸ˆ ë³´ì¡´ (0-2%)", score: 1 },
                    { text: "ì˜ˆê¸ˆ ìˆ˜ì¤€ (2-4%)", score: 2 },
                    { text: "ì ì • ìˆ˜ìµ (4-8%)", score: 3 },
                    { text: "ë†’ì€ ìˆ˜ìµ (8-15%)", score: 4 },
                    { text: "ë§¤ìš° ë†’ì€ ìˆ˜ìµ (15% ì´ìƒ)", score: 5 }
                ]
            },
            {
                q: "ê¸ˆìœµ ì§€ì‹ ìˆ˜ì¤€ì€?",
                options: [
                    { text: "ê¸°ë³¸ ì˜ˆê¸ˆ ì •ë„ë§Œ ì´í•´", score: 1 },
                    { text: "í€ë“œ ì •ë„ ì´í•´", score: 2 },
                    { text: "ì£¼ì‹ íˆ¬ì ê°€ëŠ¥", score: 3 },
                    { text: "ë‹¤ì–‘í•œ ìƒí’ˆ ì´í•´", score: 4 },
                    { text: "ì „ë¬¸ê°€ ìˆ˜ì¤€", score: 5 }
                ]
            },
            {
                q: "íˆ¬ì ê²°ì • ì‹œ ì¤‘ìš”í•œ ìš”ì†ŒëŠ”?",
                options: [
                    { text: "ì›ê¸ˆ ë³´ì¥", score: 1 },
                    { text: "ì•ˆì •ì„±", score: 2 },
                    { text: "ì•ˆì •ì„±ê³¼ ìˆ˜ìµì˜ ê· í˜•", score: 3 },
                    { text: "ìˆ˜ìµì„±", score: 4 },
                    { text: "ìµœëŒ€ ìˆ˜ìµ", score: 5 }
                ]
            },
            {
                q: "í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„± ì‹œ ì£¼ì‹ ë¹„ì¤‘ì€?",
                options: [
                    { text: "0% (ì£¼ì‹ íˆ¬ì ì•ˆí•¨)", score: 1 },
                    { text: "0-20%", score: 2 },
                    { text: "20-50%", score: 3 },
                    { text: "50-80%", score: 4 },
                    { text: "80-100%", score: 5 }
                ]
            }
        ];

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.round(num || 0));
        }

        function unformat(str) {
            return parseInt((str || '').toString().replace(/,/g, '') || '0');
        }

        function calculateAge(birthDate) {
            if (!birthDate) return 0;
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const m = today.getMonth() - birth.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) age--;
            return age;
        }

        function switchStep(step) {
            for (let i = 1; i <= 8; i++) {
                const stepEl = document.getElementById(`step${i}`);
                const analysisEl = document.getElementById(`analysis${i}`);
                if (stepEl) stepEl.style.display = 'none';
                if (analysisEl) analysisEl.style.display = 'none';
                const stepIndicator = document.querySelector(`[data-step="${i}"]`);
                if (stepIndicator) stepIndicator.classList.remove('active');
            }
            
            const targetStep = document.getElementById(`step${step}`);
            const targetAnalysis = document.getElementById(`analysis${step}`);
            if (targetStep) targetStep.style.display = 'block';
            if (targetAnalysis) targetAnalysis.style.display = 'block';
            
            const targetIndicator = document.querySelector(`[data-step="${step}"]`);
            if (targetIndicator) targetIndicator.classList.add('active');
            
            currentStep = step;
            
            const progress = (step / 8) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            updateAnalysis();
        }

        function updateAnalysis() {
            if (currentStep === 1) {
                updateStep1Analysis();
            } else if (currentStep === 2) {
                calculateFinancialAnalysis();
            } else if (currentStep === 3) {
                calculateInsuranceAnalysis();
            } else if (currentStep === 4) {
                calculateRetirementAnalysis();
            } else if (currentStep === 5) {
                calculateGoalAnalysis();
            } else if (currentStep === 6) {
                calculateInvestmentAnalysis();
            } else if (currentStep === 7) {
                calculateInheritanceAnalysis();
            } else if (currentStep === 8) {
                calculateOverallAnalysis();
            }
        }

        function updateStep1Analysis() {
            const name = document.getElementById('name').value || 'ê³ ê°ëª…';
            const birthDate = document.getElementById('birthDate').value;
            const age = calculateAge(birthDate);
            const marital = document.getElementById('maritalStatus').value;
            const children = document.getElementById('childrenCount').value;
            const occupation = document.getElementById('occupation').value;
            const customOccupation = document.getElementById('customOccupation').value;
            const income = document.getElementById('income').value;
            const meetingDate = document.getElementById('meetingDate').value;

            document.getElementById('customerName').textContent = name;
            document.getElementById('summaryName').textContent = name;
            document.getElementById('summaryAge').textContent = age > 0 ? `ë§Œ ${age}ì„¸` : 'ë§Œ -ì„¸';
            document.getElementById('summaryFamily').textContent = `${marital} / ìë…€ ${children}ëª…`;
            document.getElementById('summaryJob').textContent = occupation === 'ì§ì ‘ì…ë ¥' ? customOccupation : (occupation || '-');
            document.getElementById('summaryIncome').textContent = income ? formatNumber(unformat(income)) + 'ì›' : '-';
            
            if (meetingDate) {
                document.getElementById('summaryMeetingBox').style.display = 'block';
                document.getElementById('summaryMeeting').textContent = meetingDate;
            }
        }

        function calculateFinancialAnalysis() {
            let totalRealEstate = 0;
            let totalFinancial = 0;
            let totalDebt = 0;
            let totalIncome = 0;
            let totalExpense = 0;

            for (let i = 0; i < realEstateCount; i++) {
                const val = document.getElementById(`realEstateValue_${i}`);
                if (val && val.value) totalRealEstate += unformat(val.value);
            }

            for (let i = 0; i < financialAssetCount; i++) {
                const val = document.getElementById(`assetBalance_${i}`);
                if (val && val.value) totalFinancial += unformat(val.value);
            }

            for (let i = 0; i < debtCount; i++) {
                const val = document.getElementById(`debtBalance_${i}`);
                if (val && val.value) totalDebt += unformat(val.value);
            }

            for (let i = 0; i < monthlyIncomeCount; i++) {
                const val = document.getElementById(`incomeAmount_${i}`);
                if (val && val.value) totalIncome += unformat(val.value);
            }

            for (let i = 0; i < monthlyExpenseCount; i++) {
                const val = document.getElementById(`expenseAmount_${i}`);
                if (val && val.value) totalExpense += unformat(val.value);
            }

            const totalAssets = totalRealEstate + totalFinancial;
            const netAssets = totalAssets - totalDebt;
            const monthlySurplus = totalIncome - totalExpense;

            document.getElementById('totalAssets').textContent = formatNumber(totalAssets) + 'ì›';
            document.getElementById('totalDebt').textContent = formatNumber(totalDebt) + 'ì›';
            document.getElementById('netAssets').textContent = formatNumber(netAssets) + 'ì›';
            document.getElementById('monthlySurplus').textContent = formatNumber(monthlySurplus) + 'ì›';

            const analysis2ResultBoxes = document.querySelectorAll('#analysis2 .result-value');
            if (analysis2ResultBoxes.length >= 4) {
                analysis2ResultBoxes[0].textContent = formatNumber(totalAssets) + 'ì›';
                analysis2ResultBoxes[1].textContent = formatNumber(totalDebt) + 'ì›';
                analysis2ResultBoxes[2].textContent = formatNumber(netAssets) + 'ì›';
                analysis2ResultBoxes[3].textContent = formatNumber(monthlySurplus) + 'ì›';
            }

            createFinancialCharts(totalRealEstate, totalFinancial, totalDebt, totalIncome, totalExpense);

            let advice = '';
            const debtRatio = totalAssets > 0 ? (totalDebt / totalAssets * 100) : 0;
            
            if (totalAssets === 0 && totalDebt === 0) {
                advice = 'ğŸ“ ì¬ë¬´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
            } else if (netAssets > 0 && monthlySurplus > 0) {
                if (debtRatio < 30) {
                    advice = `âœ… ì¬ë¬´ ìƒíƒœê°€ ë§¤ìš° ì–‘í˜¸í•©ë‹ˆë‹¤. ìˆœìì‚°ì´ í”ŒëŸ¬ìŠ¤ì´ë©° ì›” ì‰ì—¬ê¸ˆë„ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¶€ì±„ë¹„ìœ¨ ${debtRatio.toFixed(1)}%ë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤.`;
                } else if (debtRatio < 50) {
                    advice = `âœ… ì¬ë¬´ ìƒíƒœê°€ ì–‘í˜¸í•©ë‹ˆë‹¤. ìˆœìì‚°ê³¼ ì›” ì‰ì—¬ê¸ˆì´ ìˆìœ¼ë‚˜, ë¶€ì±„ë¹„ìœ¨ ${debtRatio.toFixed(1)}%ë¡œ ë‹¤ì†Œ ë†’ì€ í¸ì…ë‹ˆë‹¤. ë¶€ì±„ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.`;
                } else {
                    advice = `âš ï¸ ìˆœìì‚°ì€ ì–‘í˜¸í•˜ë‚˜ ë¶€ì±„ë¹„ìœ¨ì´ ${debtRatio.toFixed(1)}%ë¡œ ë†’ìŠµë‹ˆë‹¤. ë¶€ì±„ ìƒí™˜ ê³„íšì´ í•„ìš”í•©ë‹ˆë‹¤.`;
                }
            } else if (netAssets > 0 && monthlySurplus <= 0) {
                advice = `âš ï¸ ìˆœìì‚°ì€ ì–‘í˜¸í•˜ë‚˜ ì›” ì‰ì—¬ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì§€ì¶œ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬ ì›” ${formatNumber(Math.abs(monthlySurplus))}ì› ë¶€ì¡± ìƒíƒœì…ë‹ˆë‹¤.`;
            } else if (netAssets <= 0) {
                advice = `ğŸš¨ ë¶€ì±„ê°€ ìì‚°ë³´ë‹¤ ë§ìŠµë‹ˆë‹¤ (ìˆœìì‚°: ${formatNumber(netAssets)}ì›). ë¶€ì±„ ìƒí™˜ ê³„íšì´ ì‹œê¸‰í•©ë‹ˆë‹¤.`;
            }
            
            document.getElementById('financialAdvice').textContent = advice;
        }

        function createFinancialCharts(realEstate, financial, debt, income, expense) {
            const chartContainer = document.getElementById('financialChartContainer');
            if (!chartContainer) return;
            
            const totalAssets = realEstate + financial;
            
            let chartsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
                    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                        <h4 style="text-align: center; margin-bottom: 1rem; color: var(--secondary);">ìì‚° êµ¬ì„±</h4>
                        <div style="position: relative; height: 200px;">
            `;
            
            if (totalAssets > 0) {
                const realEstatePercent = (realEstate / totalAssets * 100);
                const financialPercent = (financial / totalAssets * 100);
                
                chartsHTML += `
                    <div style="display: flex; flex-direction: column; height: 100%; justify-content: center; gap: 1rem;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>ğŸ  ë¶€ë™ì‚°</span>
                                <span><strong>${realEstatePercent.toFixed(1)}%</strong></span>
                            </div>
                            <div style="background: #e0e0e0; height: 30px; border-radius: 15px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #667eea, #764ba2); width: ${realEstatePercent}%; height: 100%; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; color: white; font-size: 0.85rem; font-weight: 600;">
                                    ${formatNumber(realEstate)}ì›
                                </div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>ğŸ’° ê¸ˆìœµìì‚°</span>
                                <span><strong>${financialPercent.toFixed(1)}%</strong></span>
                            </div>
                            <div style="background: #e0e0e0; height: 30px; border-radius: 15px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #f093fb, #f5576c); width: ${financialPercent}%; height: 100%; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; color: white; font-size: 0.85rem; font-weight: 600;">
                                    ${formatNumber(financial)}ì›
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                chartsHTML += `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #999;">ë°ì´í„° ì—†ìŒ</div>`;
            }
            
            chartsHTML += `
                        </div>
                    </div>
                    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                        <h4 style="text-align: center; margin-bottom: 1rem; color: var(--secondary);">ì›” ìˆ˜ì§€ í˜„í™©</h4>
                        <div style="position: relative; height: 200px;">
            `;
            
            if (income > 0 || expense > 0) {
                const maxValue = Math.max(income, expense);
                const incomeHeight = maxValue > 0 ? (income / maxValue * 100) : 0;
                const expenseHeight = maxValue > 0 ? (expense / maxValue * 100) : 0;
                
                chartsHTML += `
                    <div style="display: flex; height: 100%; align-items: flex-end; justify-content: space-around; gap: 2rem;">
                        <div style="flex: 1; text-align: center;">
                            <div style="background: linear-gradient(180deg, #43e97b, #38f9d7); height: ${incomeHeight}%; min-height: 40px; border-radius: 8px 8px 0 0; display: flex; flex-direction: column; justify-content: flex-start; padding-top: 10px; color: white; font-weight: 600;">
                                ${formatNumber(income)}ì›
                            </div>
                            <div style="margin-top: 0.5rem; font-weight: 600;">ğŸ’µ ìˆ˜ì…</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="background: linear-gradient(180deg, #fa709a, #fee140); height: ${expenseHeight}%; min-height: 40px; border-radius: 8px 8px 0 0; display: flex; flex-direction: column; justify-content: flex-start; padding-top: 10px; color: white; font-weight: 600;">
                                ${formatNumber(expense)}ì›
                            </div>
                            <div style="margin-top: 0.5rem; font-weight: 600;">ğŸ’¸ ì§€ì¶œ</div>
                        </div>
                    </div>
                `;
            } else {
                chartsHTML += `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #999;">ë°ì´í„° ì—†ìŒ</div>`;
            }
            
            chartsHTML += `
                        </div>
                    </div>
                </div>
            `;
            
            chartContainer.innerHTML = chartsHTML;
        }

        function calculateInsuranceAnalysis() {
            let insurancePremium = 0;
            let pensionPremium = 0;
            let pensionReturn = 0;
            let insuranceCountValue = 0;

            for (let i = 0; i < insuranceCount; i++) {
                const premium = document.getElementById(`insurancePremium_${i}`);
                if (premium && premium.value) {
                    insurancePremium += unformat(premium.value);
                    insuranceCountValue++;
                }
            }

            for (let i = 0; i < pensionCount; i++) {
                const premium = document.getElementById(`pensionPremium_${i}`);
                const returnVal = document.getElementById(`pensionReturn_${i}`);
                if (premium && premium.value) pensionPremium += unformat(premium.value);
                if (returnVal && returnVal.value) pensionReturn += unformat(returnVal.value);
            }

            document.getElementById('totalInsurancePremium').textContent = formatNumber(insurancePremium) + 'ì›';
            document.getElementById('totalPensionPremium').textContent = formatNumber(pensionPremium) + 'ì›';
            document.getElementById('totalPensionReturn').textContent = formatNumber(pensionReturn) + 'ì›';

            document.getElementById('insuranceCount').textContent = insuranceCountValue + 'ê°œ';
            document.getElementById('totalPremium').textContent = formatNumber(insurancePremium + pensionPremium) + 'ì›';

            let advice = '';
            const totalPremium = insurancePremium + pensionPremium;
            
            if (totalPremium === 0) {
                advice = 'ğŸ“‹ ë³´í—˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
            } else {
                const income = unformat(document.getElementById('income').value || '0');
                const premiumRatio = income > 0 ? (totalPremium / income * 100) : 0;
                
                if (premiumRatio < 10) {
                    advice = `âœ… ì›” ë³´í—˜ë£Œê°€ ì†Œë“ì˜ ${premiumRatio.toFixed(1)}%ë¡œ ì ì • ìˆ˜ì¤€ì…ë‹ˆë‹¤. ë³´ì¥ì„± ${formatNumber(insurancePremium)}ì›, ì—°ê¸ˆ ${formatNumber(pensionPremium)}ì›ìœ¼ë¡œ ê· í˜•ì¡í˜€ ìˆìŠµë‹ˆë‹¤.`;
                } else if (premiumRatio < 15) {
                    advice = `âš ï¸ ì›” ë³´í—˜ë£Œê°€ ì†Œë“ì˜ ${premiumRatio.toFixed(1)}%ë¡œ ë‹¤ì†Œ ë†’ì€ í¸ì…ë‹ˆë‹¤. ë³´ì¥ ë‚´ì—­ì„ ê²€í† í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¤‘ë³µ ê°€ì…ì´ ìˆëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
                } else {
                    advice = `ğŸš¨ ì›” ë³´í—˜ë£Œê°€ ì†Œë“ì˜ ${premiumRatio.toFixed(1)}%ë¡œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. ë³´í—˜ë£Œ ë¶€ë‹´ì´ ê³¼ë„í•˜ì—¬ ì¬ë¬´ ê³„íšì— ì•…ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´í—˜ êµ¬ì¡°ì¡°ì •ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.`;
                }
            }
            
            document.getElementById('insuranceAdvice').textContent = advice;
        }

        function calculateRetirementAnalysis() {
            const retirementAge = parseInt(document.getElementById('retirementAge').value || '65');
            const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value || '90');
            const monthlyExpense = unformat(document.getElementById('retirementMonthlyExpense').value || '0');
            const inflationRate = parseFloat(document.getElementById('inflationRate').value || '3.1') / 100;
            const nationalPension = unformat(document.getElementById('nationalPension').value || '0');
            const spouseNationalPension = unformat(document.getElementById('spouseNationalPension').value || '0');
            
            const birthDate = document.getElementById('birthDate').value;
            const currentAge = calculateAge(birthDate);
            
            if (currentAge === 0 || retirementAge === 0 || lifeExpectancy === 0) {
                document.getElementById('retirementAdvice').textContent = 'ì€í‡´ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
                return;
            }
            
            const yearsToRetirement = retirementAge - currentAge;
            const retirementYears = lifeExpectancy - retirementAge;
            
            // ë¬¼ê°€ìƒìŠ¹ë¥  ë°˜ì˜í•œ ë¯¸ë˜ ìƒí™œë¹„
            const futureMonthlyExpense = monthlyExpense * Math.pow(1 + inflationRate, yearsToRetirement);
            
            // ì´ í•„ìš” ê¸ˆì•¡ (ì—°ê¸ˆ ì œì™¸)
            const monthlyPension = nationalPension + spouseNationalPension;
            const monthlyGap = Math.max(0, futureMonthlyExpense - monthlyPension);
            const totalNeeds = monthlyGap * 12 * retirementYears;
            
            // í˜„ì¬ ì¤€ë¹„ì•¡ (ì€í‡´ìì‚°ìœ¼ë¡œ ì„ íƒëœ í•­ëª©ë“¤)
            let currentFunds = 0;
            const detailPanel = document.getElementById('retirementAssetsDetailPanel');
            let detailHTML = '';
            
            // ê¸ˆìœµìì‚°
            for (let i = 0; i < financialAssetCount; i++) {
                const checkbox = document.getElementById(`retirementAsset_${i}`);
                if (checkbox && checkbox.checked) {
                    const balance = unformat(document.getElementById(`assetBalance_${i}`).value || '0');
                    const rate = parseFloat(document.getElementById(`assetRate_${i}`).value || '0') / 100;
                    const futureValue = balance * Math.pow(1 + rate, yearsToRetirement);
                    currentFunds += futureValue;
                    
                    const assetType = document.getElementById(`assetType_${i}`).value;
                    detailHTML += `
                        <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem; border-left: 4px solid var(--accent);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>${assetType}</strong>
                                <span style="color: var(--primary);">ì—° ${rate * 100}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #666;">
                                <span>í˜„ì¬: ${formatNumber(balance)}ì›</span>
                                <span>â†’</span>
                                <span style="font-weight: 600; color: var(--success);">${retirementAge}ì„¸: ${formatNumber(futureValue)}ì›</span>
                            </div>
                        </div>
                    `;
                }
            }
            
            // ì—°ê¸ˆë³´í—˜
            for (let i = 0; i < pensionCount; i++) {
                const checkbox = document.getElementById(`retirementPension_${i}`);
                if (checkbox && checkbox.checked) {
                    const returnVal = unformat(document.getElementById(`pensionReturn_${i}`).value || '0');
                    currentFunds += returnVal;
                    
                    const pensionName = document.getElementById(`pensionName_${i}`).value;
                    detailHTML += `
                        <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem; border-left: 4px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>${pensionName}</strong>
                                <span style="color: var(--primary);">ì—°ê¸ˆë³´í—˜</span>
                            </div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <span style="font-weight: 600; color: var(--success);">ì˜ˆìƒ ìˆ˜ë ¹ì•¡: ${formatNumber(returnVal)}ì›</span>
                            </div>
                        </div>
                    `;
                }
            }
            
            if (detailHTML === '') {
                detailHTML = `
                    <p style="color: #999; text-align: center; padding: 2rem;">
                        Step 2ì—ì„œ ìì‚°ì„ ì…ë ¥í•˜ê³ <br>
                        ê° í•­ëª©ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ë©´<br>
                        ì€í‡´ì‹œì ì˜ ì˜ˆìƒ ê°€ì¹˜ê°€ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
                    </p>
                `;
            }
            
            detailPanel.innerHTML = detailHTML;
            document.getElementById('totalRetirementAssetsFuture').textContent = formatNumber(currentFunds) + 'ì›';
            
            const gap = totalNeeds - currentFunds;
            const preparationRate = totalNeeds > 0 ? (currentFunds / totalNeeds * 100) : 0;
const score = Math.min(100, Math.round(preparationRate));
            
            document.getElementById('retirementYears').textContent = retirementYears + 'ë…„';
            document.getElementById('totalRetirementNeeds').textContent = formatNumber(totalNeeds) + 'ì›';
            document.getElementById('currentRetirementFunds').textContent = formatNumber(currentFunds) + 'ì›';
            document.getElementById('retirementGap').textContent = (gap >= 0 ? '-' : '+') + formatNumber(Math.abs(gap)) + 'ì›';
            document.getElementById('retirementScore').textContent = score + 'ì ';
            
            // ì›í˜• ì§„í–‰ë¥  ì°¨íŠ¸ ìƒì„±
            createRetirementCircleChart(preparationRate, score, totalNeeds, currentFunds, gap);
            
            let advice = '';
            if (score >= 80) {
                advice = `âœ… í›Œë¥­í•©ë‹ˆë‹¤! ì€í‡´ ì¤€ë¹„ê°€ ${preparationRate.toFixed(1)}%ë¡œ ë§¤ìš° ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ì¬ ê³„íšëŒ€ë¡œ ì§„í–‰í•˜ì‹œë©´ ì•ˆì •ì ì¸ ì€í‡´ ìƒí™œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
            } else if (score >= 50) {
                advice = `âš ï¸ ì€í‡´ ì¤€ë¹„ê°€ ${preparationRate.toFixed(1)}%ì…ë‹ˆë‹¤. ì¶”ê°€ë¡œ ${formatNumber(Math.abs(gap))}ì›ì´ ë” í•„ìš”í•©ë‹ˆë‹¤. ì›” ì €ì¶•ì„ ëŠ˜ë¦¬ê±°ë‚˜ íˆ¬ì ìˆ˜ìµë¥ ì„ ë†’ì´ëŠ” ë°©ì•ˆì„ ê²€í† í•´ë³´ì„¸ìš”.`;
            } else {
                advice = `ğŸš¨ ì€í‡´ ì¤€ë¹„ê°€ ${preparationRate.toFixed(1)}%ë¡œ ë¶€ì¡±í•©ë‹ˆë‹¤. ${formatNumber(Math.abs(gap))}ì›ì´ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤. ì§€ê¸ˆë¶€í„° ì ê·¹ì ì¸ ì¬ë¬´ ê³„íšì´ í•„ìš”í•©ë‹ˆë‹¤.`;
            }
            
            document.getElementById('retirementAdvice').textContent = advice;
        }

        function createRetirementCircleChart(rate, score, totalNeeds, currentFunds, gap) {
            const container = document.getElementById('retirementChartContainer');
            if (!container) return;
            
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (rate / 100) * circumference;
            
            let color = '#ef4444';
            if (rate >= 80) color = '#10b981';
            else if (rate >= 50) color = '#f59e0b';
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1.2fr; gap: 2rem; align-items: center;">
                    <div style="position: relative; width: 200px; height: 200px; margin: 0 auto;">
                        <svg width="200" height="200" style="transform: rotate(-90deg);">
                            <circle cx="100" cy="100" r="90" fill="none" stroke="#e5e7eb" stroke-width="16"/>
                            <circle cx="100" cy="100" r="90" fill="none" stroke="${color}" stroke-width="16"
                                stroke-dasharray="${circumference}" stroke-dashoffset="${offset}"
                                stroke-linecap="round" style="transition: stroke-dashoffset 1s ease;"/>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 700; color: ${color};">${rate.toFixed(1)}%</div>
                            <div style="font-size: 0.9rem; color: #666; margin-top: 0.25rem;">ì¤€ë¹„ìœ¨</div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 1rem; border-radius: 10px; margin-bottom: 0.75rem;">
                            <div style="color: #64748b; font-size: 0.85rem; margin-bottom: 0.25rem;">ğŸ’° ì´ í•„ìš”ìê¸ˆ</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #1e293b;">${formatNumber(totalNeeds)}ì›</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 1rem; border-radius: 10px; margin-bottom: 0.75rem;">
                            <div style="color: #166534; font-size: 0.85rem; margin-bottom: 0.25rem;">âœ… í˜„ì¬ ì¤€ë¹„ì•¡</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #10b981;">${formatNumber(currentFunds)}ì›</div>
                        </div>
                        <div style="background: linear-gradient(135deg, ${gap >= 0 ? '#fee2e2' : '#f0fdf4'} 0%, ${gap >= 0 ? '#fecaca' : '#dcfce7'} 100%); padding: 1rem; border-radius: 10px; margin-bottom: 0.75rem;">
                            <div style="color: ${gap >= 0 ? '#991b1b' : '#166534'}; font-size: 0.85rem; margin-bottom: 0.25rem;">${gap >= 0 ? 'âš ï¸ ì¶”ê°€ í•„ìš”ê¸ˆì•¡' : 'ğŸ‰ ì´ˆê³¼ ì¤€ë¹„ì•¡'}</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: ${gap >= 0 ? '#dc2626' : '#10b981'};">${formatNumber(Math.abs(gap))}ì›</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 1.25rem; border-radius: 10px; text-align: center;">
                            <div style="color: #1e40af; font-size: 0.9rem; margin-bottom: 0.5rem;">ì€í‡´ ì¤€ë¹„ ì ìˆ˜</div>
                            <div style="font-size: 2.5rem; font-weight: 700; color: #1e40af;">${score}ì </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function calculateGoalAnalysis() {
            let totalGoal = 0;
            let totalCurrent = 0;
            
            for (let i = 0; i < goalCount; i++) {
                const goalAmount = document.getElementById(`goalAmount_${i}`);
                const currentSavings = document.getElementById(`currentSavings_${i}`);
                if (goalAmount && goalAmount.value) totalGoal += unformat(goalAmount.value);
                if (currentSavings && currentSavings.value) totalCurrent += unformat(currentSavings.value);
            }
            
            const gap = totalGoal - totalCurrent;
            const achievementRate = totalGoal > 0 ? (totalCurrent / totalGoal * 100) : 0;
            
            document.getElementById('totalGoalAmount').textContent = formatNumber(totalGoal) + 'ì›';
            document.getElementById('totalGoalCurrent').textContent = formatNumber(totalCurrent) + 'ì›';
            document.getElementById('totalGoalGap').textContent = formatNumber(gap) + 'ì›';
            document.getElementById('goalAchievementRate').textContent = achievementRate.toFixed(1) + '%';
            
            let advice = '';
            if (totalGoal === 0) {
                advice = 'ğŸ“‹ ëª©ì ìê¸ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
            } else if (achievementRate >= 80) {
                advice = `âœ… ëª©í‘œ ë‹¬ì„±ë¥  ${achievementRate.toFixed(1)}%ë¡œ ë§¤ìš° ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ì¬ ê³„íšëŒ€ë¡œ ì§„í–‰í•˜ì‹œë©´ ëª©í‘œë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            } else if (achievementRate >= 50) {
                advice = `âš ï¸ ëª©í‘œ ë‹¬ì„±ë¥  ${achievementRate.toFixed(1)}%ì…ë‹ˆë‹¤. ì¶”ê°€ë¡œ ${formatNumber(gap)}ì›ì´ í•„ìš”í•©ë‹ˆë‹¤. ì €ì¶•ì„ ëŠ˜ë¦¬ê±°ë‚˜ íˆ¬ì ì „ëµì„ ì¬ê²€í† í•´ë³´ì„¸ìš”.`;
            } else {
                advice = `ğŸš¨ ëª©í‘œ ë‹¬ì„±ë¥  ${achievementRate.toFixed(1)}%ë¡œ ë¶€ì¡±í•©ë‹ˆë‹¤. ${formatNumber(gap)}ì›ì´ ì¶”ê°€ë¡œ í•„ìš”í•©ë‹ˆë‹¤. ëª©í‘œ ê¸°ê°„ ì—°ì¥ ë˜ëŠ” ì €ì¶•ì•¡ ì¦ì•¡ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.`;
            }
            
            document.getElementById('goalAdvice').textContent = advice;
        }

        function calculateInvestmentAnalysis() {
            let totalScore = 0;
            let answeredQuestions = 0;
            
            investmentQuestions.forEach((q, qIndex) => {
                const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                if (selected) {
                    totalScore += parseInt(selected.value);
                    answeredQuestions++;
                }
            });
            
            if (answeredQuestions === 0) {
                document.getElementById('investmentAdvice').textContent = 'íˆ¬ìì„±í–¥ ì§ˆë¬¸ì— ë‹µë³€í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
                return;
            }
            
            let type = '';
            let typeEmoji = '';
            let advice = '';
            
            if (totalScore <= 15) {
                type = 'ì•ˆì •í˜•';
                typeEmoji = 'ğŸ›¡ï¸';
                advice = 'ì›ê¸ˆ ë³´ì¡´ì„ ìµœìš°ì„ ìœ¼ë¡œ í•˜ëŠ” íˆ¬ììì…ë‹ˆë‹¤. ì˜ˆê¸ˆ, ì ê¸ˆ, êµ­ì±„ ë“± ì•ˆì „ìì‚° ìœ„ì£¼ì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.';
            } else if (totalScore <= 25) {
                type = 'ì•ˆì •ì¶”êµ¬í˜•';
                typeEmoji = 'ğŸ“Š';
                advice = 'ì•ˆì •ì„±ì„ ì¤‘ì‹œí•˜ë˜ ì ì • ìˆ˜ìµë„ ì¶”êµ¬í•˜ëŠ” íˆ¬ììì…ë‹ˆë‹¤. ì±„ê¶Œí˜• í€ë“œì™€ ì•ˆì •í˜• í˜¼í•© í€ë“œê°€ ì í•©í•©ë‹ˆë‹¤.';
            } else if (totalScore <= 35) {
                type = 'ìœ„í—˜ì¤‘ë¦½í˜•';
                typeEmoji = 'âš–ï¸';
                advice = 'ì•ˆì •ì„±ê³¼ ìˆ˜ìµì„±ì˜ ê· í˜•ì„ ì¶”êµ¬í•˜ëŠ” íˆ¬ììì…ë‹ˆë‹¤. í˜¼í•©í˜• í€ë“œë‚˜ ë°°ë‹¹ì£¼ íˆ¬ìê°€ ì í•©í•©ë‹ˆë‹¤.';
            } else if (totalScore <= 45) {
                type = 'ì ê·¹íˆ¬ìí˜•';
                typeEmoji = 'ğŸ“ˆ';
                advice = 'ë†’ì€ ìˆ˜ìµì„ ìœ„í•´ ìƒë‹¹í•œ ìœ„í—˜ì„ ê°ìˆ˜í•  ìˆ˜ ìˆëŠ” íˆ¬ììì…ë‹ˆë‹¤. ì£¼ì‹í˜• í€ë“œë‚˜ ê°œë³„ ì£¼ì‹ íˆ¬ìê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            } else {
                type = 'ê³µê²©íˆ¬ìí˜•';
                typeEmoji = 'ğŸš€';
                advice = 'ìµœê³  ìˆ˜ìµì„ ìœ„í•´ ë†’ì€ ìœ„í—˜ë„ ê°ìˆ˜í•˜ëŠ” íˆ¬ììì…ë‹ˆë‹¤. ì„±ì¥ì£¼, ì‹ í¥ì‹œì¥, ë ˆë²„ë¦¬ì§€ ìƒí’ˆ ë“± ê³µê²©ì  íˆ¬ìê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            }
            
            document.getElementById('investmentType').textContent = typeEmoji + ' ' + type;
            document.getElementById('investmentScore').textContent = `ì´ì : ${totalScore}ì `;
            document.getElementById('investmentAdvice').textContent = advice;
        }

        function calculateInheritanceAnalysis() {
            const inheritanceAmount = unformat(document.getElementById('inheritanceAmount').value || '0');
            const giftAmount = unformat(document.getElementById('giftAmount').value || '0');
            
            document.getElementById('totalInheritance').textContent = formatNumber(inheritanceAmount) + 'ì›';
            document.getElementById('totalGift').textContent = formatNumber(giftAmount) + 'ì›';
            
            let advice = '';
            const totalAmount = inheritanceAmount + giftAmount;
            
            if (totalAmount === 0) {
                advice = 'ğŸ“‹ ìƒì†Â·ì¦ì—¬ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.';
            } else if (totalAmount < 500000000) {
                advice = 'âœ… í˜„ì¬ ê·œëª¨ëŠ” ìƒì†ì„¸ ë¶€ë‹´ì´ í¬ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ë³¸ ê³µì œë¥¼ í™œìš©í•˜ë©´ ì„¸ê¸ˆì„ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            } else if (totalAmount < 1000000000) {
                advice = 'âš ï¸ ìƒì†Â·ì¦ì—¬ ê·œëª¨ê°€ ìˆìŠµë‹ˆë‹¤. ë°°ìš°ì ê³µì œ, ìë…€ ê³µì œ ë“±ì„ ìµœëŒ€í•œ í™œìš©í•˜ëŠ” ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.';
            } else {
                advice = 'ğŸš¨ ìƒì†Â·ì¦ì—¬ ê·œëª¨ê°€ í½ë‹ˆë‹¤. ì‚¬ì „ì¦ì—¬, ì‹ íƒ í™œìš©, ê°€ì—…ìŠ¹ê³„ ë“± ì¢…í•©ì ì¸ ì ˆì„¸ ì „ëµì´ í•„ìˆ˜ì…ë‹ˆë‹¤. ì „ë¬¸ê°€ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.';
            }
            
            document.getElementById('inheritanceAdvice').textContent = advice;
        }
        // ì¦ì—¬/ìƒì† êµ¬ë¶„ í† ê¸€
        function toggleTaxType() {
            const taxType = document.querySelector('input[name="taxType"]:checked').value;
            const inheritanceOnlyFields = document.getElementById('inheritanceOnlyFields');
            const funeralExpenseGroup = document.getElementById('funeralExpenseGroup');
            const donorLabel = document.getElementById('donorLabel');
            const recipientLabel = document.getElementById('recipientLabel');
            
            if (taxType === 'inheritance') {
                inheritanceOnlyFields.style.display = 'block';
                funeralExpenseGroup.style.display = 'block';
                donorLabel.textContent = 'í”¼ìƒì†ì¸ (ë§ì¸)';
                recipientLabel.textContent = 'ìƒì†ì¸';
            } else {
                inheritanceOnlyFields.style.display = 'none';
                funeralExpenseGroup.style.display = 'none';
                donorLabel.textContent = 'ì¦ì—¬ì';
                recipientLabel.textContent = 'ìˆ˜ì¦ì';
            }
        }

        // ì´ ì¬ì‚°ê°€ì•¡ ê³„ì‚°
        function calculateTaxTotal() {
            const propertyValue = unformat(document.getElementById('propertyValue').value || '0');
            const financialValue = unformat(document.getElementById('financialValue').value || '0');
            const otherValue = unformat(document.getElementById('otherValue').value || '0');
            const total = propertyValue + financialValue + otherValue;
            document.getElementById('totalPropertyValue').textContent = formatNumber(total) + 'ì›';
        }

        // ìƒì„¸ ì„¸ì•¡ ê³„ì‚° (êµ­ì„¸ì²­ í”Œë¡œìš° ì™„ë²½ ë°˜ì˜)
        function calculateDetailedTax() {
            const taxType = document.querySelector('input[name="taxType"]:checked').value;
            const relation = document.getElementById('taxRelation').value;
            const propertyValue = unformat(document.getElementById('propertyValue').value || '0');
            const financialValue = unformat(document.getElementById('financialValue').value || '0');
            const otherValue = unformat(document.getElementById('otherValue').value || '0');
            const taxExempt = unformat(document.getElementById('taxExempt').value || '0');
            const debtAmount = unformat(document.getElementById('debtAmount').value || '0');
            const funeralExpense = unformat(document.getElementById('funeralExpense').value || '0');
            const previousGiftAmount = unformat(document.getElementById('previousGiftAmount').value || '0');
            const recipientAge = parseInt(document.getElementById('recipientAge').value || '20');
            
            // â‘  ì´ ì¬ì‚°ê°€ì•¡
            const step1Total = propertyValue + financialValue + otherValue;
            
            if (step1Total === 0) {
                alert('ì¦ì—¬/ìƒì† ì¬ì‚°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // â‘¡ ë¹„ê³¼ì„¸ ë° ì±„ë¬´ ê³µì œ
            let step2Exempt = taxExempt + debtAmount;
            if (taxType === 'inheritance') {
                step2Exempt += Math.min(funeralExpense, 10000000); // ì¥ë¡€ë¹„ìš© ìµœëŒ€ 1ì²œë§Œì›
            }
            
            // â‘¢ ì‚¬ì „ì¦ì—¬ì¬ì‚° ê°€ì‚°
            const step3PreviousGift = previousGiftAmount;
            
            // â‘£ ê³¼ì„¸ê°€ì•¡
            const step4TaxableAmount = step1Total - step2Exempt + step3PreviousGift;
            
            // â‘¤ ê³µì œì•¡ ê³„ì‚°
            let step5Deduction = 0;
            let deductionDetails = '';
            
            if (taxType === 'gift') {
                // ì¦ì—¬ì¬ì‚°ê³µì œ
                if (relation === 'ë°°ìš°ì') {
                    step5Deduction = 600000000;
                    deductionDetails = 'â€¢ ë°°ìš°ìê³µì œ: 6ì–µì›';
                } else if (relation === 'ìë…€') {
                    step5Deduction = recipientAge < 19 ? 20000000 : 50000000;
                    deductionDetails = `â€¢ ì§ê³„ë¹„ì†ê³µì œ: ${formatNumber(step5Deduction)}ì› (${recipientAge < 19 ? 'ë¯¸ì„±ë…„' : 'ì„±ë…„'})`;
                } else if (relation === 'ì†ìë…€') {
                    step5Deduction = recipientAge < 19 ? 20000000 : 50000000;
                    deductionDetails = `â€¢ ì§ê³„ë¹„ì†ê³µì œ: ${formatNumber(step5Deduction)}ì› (${recipientAge < 19 ? 'ë¯¸ì„±ë…„' : 'ì„±ë…„'})`;
                } else if (relation === 'ë¶€ëª¨') {
                    step5Deduction = 50000000;
                    deductionDetails = 'â€¢ ì§ê³„ì¡´ì†ê³µì œ: 5ì²œë§Œì›';
                } else if (relation === 'ê¸°íƒ€ì¹œì¡±') {
                    step5Deduction = 10000000;
                    deductionDetails = 'â€¢ ê¸°íƒ€ì¹œì¡±ê³µì œ: 1ì²œë§Œì›';
                } else {
                    step5Deduction = 0;
                    deductionDetails = 'â€¢ ê³µì œì•¡: ì—†ìŒ';
                }
            } else {
                // ìƒì†ê³µì œ
                const heirCount = parseInt(document.getElementById('heirCount').value || '1');
                const hasDisability = document.getElementById('hasDisability').checked;
                const isElderly = document.getElementById('isElderly').checked;
                const spouseInheritance = unformat(document.getElementById('spouseInheritance').value || '0');
                
                // ê¸°ì´ˆê³µì œ
                const basicDeduction = 200000000;
                deductionDetails += `â€¢ ê¸°ì´ˆê³µì œ: 2ì–µì›\n`;
                
                // ì¸ì ê³µì œ
                let personalDeduction = 0;
                personalDeduction += heirCount * 50000000; // ìë…€ê³µì œ
                deductionDetails += `â€¢ ìë…€ê³µì œ: ${formatNumber(heirCount * 50000000)}ì› (${heirCount}ëª… Ã— 5ì²œë§Œì›)\n`;
                
                if (recipientAge < 19) {
                    const minorDeduction = (19 - recipientAge) * 10000000;
                    personalDeduction += minorDeduction;
                    deductionDetails += `â€¢ ë¯¸ì„±ë…„ìê³µì œ: ${formatNumber(minorDeduction)}ì›\n`;
                }
                
                if (isElderly) {
                    personalDeduction += 50000000;
                    deductionDetails += `â€¢ ì—°ë¡œìê³µì œ: 5ì²œë§Œì›\n`;
                }
                
                if (hasDisability) {
                    const disabilityDeduction = (85 - recipientAge) * 10000000;
                    personalDeduction += disabilityDeduction;
                    deductionDetails += `â€¢ ì¥ì• ì¸ê³µì œ: ${formatNumber(disabilityDeduction)}ì›\n`;
                }
                
                // ì¼ê´„ê³µì œ vs ê¸°ì´ˆ+ì¸ì ê³µì œ
                const lumpSumDeduction = 500000000;
                const standardDeduction = basicDeduction + personalDeduction;
                
                if (lumpSumDeduction > standardDeduction) {
                    step5Deduction = lumpSumDeduction;
                    deductionDetails = `â€¢ ì¼ê´„ê³µì œ: 5ì–µì› (ê¸°ì´ˆ+ì¸ì ê³µì œ ${formatNumber(standardDeduction)}ì› ëŒ€ì‹  ì„ íƒ)\n`;
                } else {
                    step5Deduction = standardDeduction;
                }
                
                // ë°°ìš°ìê³µì œ
                if (spouseInheritance > 0) {
                    const spouseDeduction = Math.max(500000000, Math.min(3000000000, spouseInheritance * 0.3 + 500000000));
                    step5Deduction += spouseDeduction;
                    deductionDetails += `â€¢ ë°°ìš°ìê³µì œ: ${formatNumber(spouseDeduction)}ì›\n`;
                }
                
                // ê¸ˆìœµì¬ì‚°ê³µì œ (ê°„ëµí™”)
                if (financialValue >= 20000000) {
                    const finDeduction = Math.min(200000000, financialValue - 20000000);
                    step5Deduction += finDeduction;
                    deductionDetails += `â€¢ ê¸ˆìœµì¬ì‚°ê³µì œ: ${formatNumber(finDeduction)}ì›\n`;
                }
            }
            
            // â‘¥ ê³¼ì„¸í‘œì¤€
            const step6TaxBase = Math.max(0, step4TaxableAmount - step5Deduction);
            
            // â‘¦ ì„¸ìœ¨ ì ìš©
            let step7Tax = 0;
            let taxRateInfo = '';
            if (step6TaxBase <= 100000000) {
                step7Tax = step6TaxBase * 0.1;
                taxRateInfo = '10% (ëˆ„ì§„ê³µì œ ì—†ìŒ)';
            } else if (step6TaxBase <= 500000000) {
                step7Tax = step6TaxBase * 0.2 - 10000000;
                taxRateInfo = '20% (ëˆ„ì§„ê³µì œ 1ì²œë§Œì›)';
            } else if (step6TaxBase <= 1000000000) {
                step7Tax = step6TaxBase * 0.3 - 60000000;
                taxRateInfo = '30% (ëˆ„ì§„ê³µì œ 6ì²œë§Œì›)';
            } else if (step6TaxBase <= 3000000000) {
                step7Tax = step6TaxBase * 0.4 - 160000000;
                taxRateInfo = '40% (ëˆ„ì§„ê³µì œ 1.6ì–µì›)';
            } else {
                step7Tax = step6TaxBase * 0.5 - 460000000;
                taxRateInfo = '50% (ëˆ„ì§„ê³µì œ 4.6ì–µì›)';
            }
            
            // â‘§ ì„¸ëŒ€ìƒëµ í• ì¦
            let step8Surcharge = 0;
            if (relation === 'ì†ìë…€') {
                if (recipientAge < 19 && step1Total > 2000000000) {
                    step8Surcharge = step7Tax * 0.4;
                } else {
                    step8Surcharge = step7Tax * 0.3;
                }
            }
            
            const step8Total = step7Tax + step8Surcharge;
            
            // â‘¨ ì„¸ì•¡ê³µì œ (ì‹ ê³ ì„¸ì•¡ê³µì œ 10%)
            const step9Credit = step8Total * 0.1;
            
            // â‘© ìµœì¢… ë‚©ë¶€ì„¸ì•¡
            const step10FinalTax = step8Total - step9Credit;
            
            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('taxResultPanel').style.display = 'block';
            document.getElementById('result1TotalProperty').textContent = formatNumber(step1Total) + 'ì›';
            document.getElementById('result2Exempt').textContent = formatNumber(step2Exempt) + 'ì›';
            document.getElementById('result3PreviousGift').textContent = formatNumber(step3PreviousGift) + 'ì›';
            document.getElementById('result4TaxableAmount').textContent = formatNumber(step4TaxableAmount) + 'ì›';
            document.getElementById('result5Deduction').textContent = formatNumber(step5Deduction) + 'ì›';
            document.getElementById('result6TaxBase').textContent = formatNumber(step6TaxBase) + 'ì›';
            document.getElementById('result7TaxRate').textContent = taxRateInfo;
            document.getElementById('result8Surcharge').textContent = step8Surcharge > 0 ? formatNumber(step8Surcharge) + 'ì›' : 'í•´ë‹¹ì—†ìŒ';
            document.getElementById('result9Credit').textContent = formatNumber(step9Credit) + 'ì›';
            document.getElementById('result10FinalTax').textContent = formatNumber(step10FinalTax) + 'ì›';
            
            // ê³µì œ ìƒì„¸ë‚´ì—­ í‘œì‹œ
            if (deductionDetails) {
                document.getElementById('deductionDetail').style.display = 'block';
                document.getElementById('deductionDetailContent').innerHTML = deductionDetails.replace(/\n/g, '<br>');
            }
            
            // ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ (ì¦ì—¬ë§Œ)
            if (taxType === 'gift') {
                calculateScenarios(step1Total, relation, recipientAge, previousGiftAmount);
            } else {
                document.getElementById('scenarioComparison').style.display = 'none';
            }
            
            // ì¶”ì²œ ì „ëµ
            generateTaxStrategy(step1Total, step10FinalTax, relation, recipientAge, taxType);
        }
        function calculateOverallAnalysis() {
            const name = document.getElementById('name').value || 'ê³ ê°ëª…';
            
            let scores = [];
            let summaryText = `${name}ë‹˜ì˜ ì¢…í•© ì¬ë¬´ ê±´ê°•ë„ í‰ê°€\n\n`;
            
            // ì¬ë¬´í˜„í™© ì ìˆ˜
            calculateFinancialAnalysis();
            const totalAssets = unformat(document.getElementById('totalAssets').textContent);
            const totalDebt = unformat(document.getElementById('totalDebt').textContent);
            const debtRatio = totalAssets > 0 ? (totalDebt / totalAssets * 100) : 0;
            let financialScore = 0;
            if (debtRatio < 30) financialScore = 10;
            else if (debtRatio < 50) financialScore = 7;
            else if (debtRatio < 70) financialScore = 5;
            else financialScore = 3;
            scores.push(financialScore);
            summaryText += `1. ì¬ë¬´ ê±´ê°•ë„: ${financialScore}/10ì \n`;
            
            // ì€í‡´ ì¤€ë¹„ ì ìˆ˜
            const retirementScore = parseInt(document.getElementById('retirementScore').textContent || '0');
            scores.push(retirementScore);
            summaryText += `2. ì€í‡´ ì¤€ë¹„ë„: ${retirementScore}/10ì \n`;
            
            // ë³´í—˜ ì ìˆ˜
            const insurancePremium = unformat(document.getElementById('totalInsurancePremium').textContent);
            const income = unformat(document.getElementById('income').value || '0');
            const premiumRatio = income > 0 ? (insurancePremium / income * 100) : 0;
            let insuranceScore = 0;
            if (premiumRatio > 0 && premiumRatio < 10) insuranceScore = 10;
            else if (premiumRatio < 15) insuranceScore = 7;
            else if (premiumRatio === 0) insuranceScore = 5;
            else insuranceScore = 3;
            scores.push(insuranceScore);
            summaryText += `3. ë³´í—˜ ì ì •ì„±: ${insuranceScore}/10ì \n`;
            
            const avgScore = scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1) : 0;
            
            document.getElementById('overallScore').textContent = avgScore + 'ì ';
            
            let overallAdvice = '';
            if (avgScore >= 8) {
                overallAdvice = `âœ… í›Œë¥­í•©ë‹ˆë‹¤! ${name}ë‹˜ì˜ ì „ë°˜ì ì¸ ì¬ë¬´ ìƒíƒœê°€ ë§¤ìš° ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ì¬ì˜ ê³„íšì„ ìœ ì§€í•˜ì‹œë©´ ë©ë‹ˆë‹¤.`;
            } else if (avgScore >= 6) {
                overallAdvice = `âš ï¸ ${name}ë‹˜ì˜ ì¬ë¬´ ìƒíƒœëŠ” ì–‘í˜¸í•˜ë‚˜ ì¼ë¶€ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. ì·¨ì•½ ë¶€ë¶„ì„ ë³´ì™„í•˜ë©´ ë”ìš± ì•ˆì •ì ì¸ ì¬ë¬´ êµ¬ì¡°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            } else {
                overallAdvice = `ğŸš¨ ${name}ë‹˜ì˜ ì¬ë¬´ ìƒíƒœì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì²´ê³„ì ì¸ ì¬ë¬´ ì„¤ê³„ì™€ ì „ëµ ìˆ˜ë¦½ì´ ì‹œê¸‰í•©ë‹ˆë‹¤.`;
            }
            
            document.getElementById('comprehensiveAnalysis').innerHTML = `
                <h3 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--secondary);">ğŸ“‹ ì¢…í•© í‰ê°€</h3>
                <p style="line-height: 1.8; color: var(--text); white-space: pre-wrap;">${summaryText}</p>
                <div style="margin-top: 1.5rem; padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid var(--primary);">
                    <p style="line-height: 1.8; color: var(--text);">${overallAdvice}</p>
                </div>
            `;
        }

        // ë™ì  ìš”ì†Œ ìƒì„± í•¨ìˆ˜ë“¤
        function addRealEstate() {
            const container = document.getElementById('realEstateContainer');
            const html = `
                <div class="dynamic-container" id="realEstate_${realEstateCount}">
                    <button class="btn-remove" onclick="removeElement('realEstate_${realEstateCount}')">Ã—</button>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ë¶€ë™ì‚° ì¢…ë¥˜</label>
                            <select id="realEstateType_${realEstateCount}">
                                <option value="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</option>
                                <option value="ë‹¨ë…ì£¼íƒ">ë‹¨ë…ì£¼íƒ</option>
                                <option value="ë¹Œë¼">ë¹Œë¼/ì—°ë¦½</option>
                                <option value="ìƒê°€">ìƒê°€</option>
                                <option value="í† ì§€">í† ì§€</option>
                                <option value="ì˜¤í”¼ìŠ¤í…”">ì˜¤í”¼ìŠ¤í…”</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>í‰ê°€ì•¡</label>
                            <div class="input-field">
                                <input type="text" id="realEstateValue_${realEstateCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateFinancialAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>ì†Œì¬ì§€</label>
                        <input type="text" id="realEstateLocation_${realEstateCount}" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            realEstateCount++;
        }

        function addFinancialAsset() {
            const container = document.getElementById('financialAssetsContainer');
            const html = `
                <div class="dynamic-container" id="financialAsset_${financialAssetCount}">
                    <button class="btn-remove" onclick="removeElement('financialAsset_${financialAssetCount}')">Ã—</button>
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="retirementAsset_${financialAssetCount}" onchange="calculateRetirementAnalysis()" style="width: auto; height: auto;">
                            <span>ğŸ’° ì´ ìì‚°ì„ ì€í‡´ìê¸ˆìœ¼ë¡œ ì‚¬ìš© ì˜ˆì •</span>
                        </label>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ìì‚° ì¢…ë¥˜</label>
                            <select id="assetType_${financialAssetCount}">
                                <option value="ì˜ˆê¸ˆ">ì˜ˆê¸ˆ</option>
                                <option value="ì ê¸ˆ">ì ê¸ˆ</option>
                                <option value="ì£¼ì‹">ì£¼ì‹</option>
                                <option value="í€ë“œ">í€ë“œ</option>
                                <option value="ì±„ê¶Œ">ì±„ê¶Œ</option>
                                <option value="ETF">ETF</option>
                                <option value="ISA">ISA</option>
                                <option value="IRP">IRP</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>ì”ì•¡</label>
                            <div class="input-field">
                                <input type="text" id="assetBalance_${financialAssetCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateFinancialAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ê¸ˆìœµê¸°ê´€</label>
                            <input type="text" id="assetInstitution_${financialAssetCount}" placeholder="ì˜ˆ: ì‹ í•œì€í–‰">
                        </div>
                        <div class="input-group">
                            <label>ì˜ˆìƒ ìˆ˜ìµë¥  (ì—°)</label>
                            <div class="input-field">
                                <input type="number" id="assetRate_${financialAssetCount}" step="0.1" value="3.0" onchange="calculateRetirementAnalysis()">
                                <span>%</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            financialAssetCount++;
        }

        function addDebt() {
            const container = document.getElementById('debtContainer');
            const html = `
                <div class="dynamic-container" id="debt_${debtCount}">
                    <button class="btn-remove" onclick="removeElement('debt_${debtCount}')">Ã—</button>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ëŒ€ì¶œ ì¢…ë¥˜</label>
                            <select id="debtType_${debtCount}">
                                <option value="ì£¼íƒë‹´ë³´ëŒ€ì¶œ">ì£¼íƒë‹´ë³´ëŒ€ì¶œ</option>
                                <option value="ì‹ ìš©ëŒ€ì¶œ">ì‹ ìš©ëŒ€ì¶œ</option>
                                <option value="ìë™ì°¨ëŒ€ì¶œ">ìë™ì°¨ëŒ€ì¶œ</option>
                                <option value="í•™ìê¸ˆëŒ€ì¶œ">í•™ìê¸ˆëŒ€ì¶œ</option>
                                <option value="ì „ì„¸ìê¸ˆëŒ€ì¶œ">ì „ì„¸ìê¸ˆëŒ€ì¶œ</option>
                                <option value="ì‚¬ì—…ìëŒ€ì¶œ">ì‚¬ì—…ìëŒ€ì¶œ</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>ì”ì•¡</label>
                            <div class="input-field">
                                <input type="text" id="debtBalance_${debtCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateFinancialAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ê¸ˆìœµê¸°ê´€</label>
                            <input type="text" id="debtInstitution_${debtCount}" placeholder="ì˜ˆ: êµ­ë¯¼ì€í–‰">
                        </div>
                        <div class="input-group">
                            <label>ì´ììœ¨ (ì—°)</label>
                            <div class="input-field">
                                <input type="number" id="debtRate_${debtCount}" step="0.1" value="4.5">
                                <span>%</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            debtCount++;
        }

        function addMonthlyIncome() {
            const container = document.getElementById('monthlyIncomeContainer');
            const html = `
                <div class="dynamic-container" id="monthlyIncome_${monthlyIncomeCount}">
                    <button class="btn-remove" onclick="removeElement('monthlyIncome_${monthlyIncomeCount}')">Ã—</button>
                    <div class="two-col">
                        <div class="input-group">
                            <label>í•­ëª©</label>
                            <select id="incomeCategory_${monthlyIncomeCount}" onchange="toggleCustomInput('incomeCategory_${monthlyIncomeCount}', 'customIncomeCategory_${monthlyIncomeCount}')">
                                ${incomeCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                            </select>
                            <input type="text" id="customIncomeCategory_${monthlyIncomeCount}" placeholder="í•­ëª© ì…ë ¥" style="display: none; margin-top: 0.5rem;">
                        </div>
                        <div class="input-group">
                            <label>ê¸ˆì•¡</label>
                            <div class="input-field">
                                <input type="text" id="incomeAmount_${monthlyIncomeCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateFinancialAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            monthlyIncomeCount++;
        }

        function addMonthlyExpense() {
            const container = document.getElementById('monthlyExpenseContainer');
            const html = `
                <div class="dynamic-container" id="monthlyExpense_${monthlyExpenseCount}">
                    <button class="btn-remove" onclick="removeElement('monthlyExpense_${monthlyExpenseCount}')">Ã—</button>
                    <div class="two-col">
                        <div class="input-group">
                            <label>í•­ëª©</label>
                            <select id="expenseCategory_${monthlyExpenseCount}" onchange="toggleCustomInput('expenseCategory_${monthlyExpenseCount}', 'customExpenseCategory_${monthlyExpenseCount}')">
                                ${expenseCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                            </select>
                            <input type="text" id="customExpenseCategory_${monthlyExpenseCount}" placeholder="í•­ëª© ì…ë ¥" style="display: none; margin-top: 0.5rem;">
                        </div>
                        <div class="input-group">
                            <label>ê¸ˆì•¡</label>
                            <div class="input-field">
                                <input type="text" id="expenseAmount_${monthlyExpenseCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateFinancialAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            monthlyExpenseCount++;
        }

        function addInsurance() {
            const container = document.getElementById('insuranceContainer');
            const html = `
                <div class="dynamic-container" id="insurance_${insuranceCount}">
                    <button class="btn-remove" onclick="removeElement('insurance_${insuranceCount}')">Ã—</button>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ë³´í—˜ ì¢…ë¥˜</label>
                            <select id="insuranceType_${insuranceCount}" onchange="toggleCustomInput('insuranceType_${insuranceCount}', 'customInsuranceType_${insuranceCount}')">
                                ${insuranceTypes.map(type => `<option value="${type}">${type}</option>`).join('')}
                            </select>
                            <input type="text" id="customInsuranceType_${insuranceCount}" placeholder="ë³´í—˜ ì¢…ë¥˜ ì…ë ¥" style="display: none; margin-top: 0.5rem;">
                        </div>
                        <div class="input-group">
                            <label>ë³´í—˜ì‚¬</label>
                            <input type="text" id="insuranceCompany_${insuranceCount}" placeholder="ì˜ˆ: ì‚¼ì„±ìƒëª…">
                        </div>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ë³´í—˜ë£Œ (ì›”)</label>
                            <div class="input-field">
                                <input type="text" id="insurancePremium_${insuranceCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateInsuranceAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ë³´ì¥ ê¸ˆì•¡</label>
                            <div class="input-field">
                                <input type="text" id="insuranceCoverage_${insuranceCount}" inputmode="numeric" oninput="formatInputNumber(this);">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            insuranceCount++;
        }

        function addPension() {
            const container = document.getElementById('pensionContainer');
            const html = `
                <div class="dynamic-container" id="pension_${pensionCount}">
                    <button class="btn-remove" onclick="removeElement('pension_${pensionCount}')">Ã—</button>
                    <div class="input-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="retirementPension_${pensionCount}" onchange="calculateRetirementAnalysis()" style="width: auto; height: auto;">
                            <span>ğŸ’° ì´ ì—°ê¸ˆì„ ì€í‡´ìê¸ˆìœ¼ë¡œ ì‚¬ìš© ì˜ˆì •</span>
                        </label>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ì—°ê¸ˆ ì´ë¦„</label>
                            <input type="text" id="pensionName_${pensionCount}" placeholder="ì˜ˆ: ì—°ê¸ˆì €ì¶•ë³´í—˜">
                        </div>
                        <div class="input-group">
                            <label>ë³´í—˜ì‚¬</label>
                            <input type="text" id="pensionCompany_${pensionCount}" placeholder="ì˜ˆ: êµë³´ìƒëª…">
                        </div>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ì›” ë‚©ì…ì•¡</label>
                            <div class="input-field">
                                <input type="text" id="pensionPremium_${pensionCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateInsuranceAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ì˜ˆìƒ ì›” ìˆ˜ë ¹ì•¡</label>
                            <div class="input-field">
                                <input type="text" id="pensionReturn_${pensionCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateInsuranceAnalysis(); calculateRetirementAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            pensionCount++;
        }

        function addGoal() {
            const container = document.getElementById('goalContainer');
            const html = `
                <div class="dynamic-container" id="goal_${goalCount}">
                    <button class="btn-remove" onclick="removeElement('goal_${goalCount}')">Ã—</button>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ëª©í‘œëª…</label>
                            <input type="text" id="goalName_${goalCount}" placeholder="ì˜ˆ: ì£¼íƒêµ¬ì…">
                        </div>
                        <div class="input-group">
                            <label>ëª©í‘œ ê¸°ê°„</label>
                            <input type="month" id="goalDate_${goalCount}">
                        </div>
                    </div>
                    <div class="two-col">
                        <div class="input-group">
                            <label>ëª©í‘œ ê¸ˆì•¡</label>
                            <div class="input-field">
                                <input type="text" id="goalAmount_${goalCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateGoalAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>í˜„ì¬ ì¤€ë¹„ì•¡</label>
                            <div class="input-field">
                                <input type="text" id="currentSavings_${goalCount}" inputmode="numeric" oninput="formatInputNumber(this); calculateGoalAnalysis();">
                                <span>ì›</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            goalCount++;
        }

        function removeElement(id) {
            const element = document.getElementById(id);
            if (element) {
                element.remove();
                updateAnalysis();
            }
        }

        function toggleCustomInput(selectId, customInputId) {
            const select = document.getElementById(selectId);
            const customInput = document.getElementById(customInputId);
            if (select && customInput) {
                customInput.style.display = select.value === 'ì§ì ‘ì…ë ¥' ? 'block' : 'none';
            }
        }

        function formatInputNumber(input) {
            let value = input.value.replace(/,/g, '');
            if (!isNaN(value) && value !== '') {
                input.value = formatNumber(value);
            }
        }

        function generateInvestmentQuestions() {
            const container = document.getElementById('investmentQuestionsContainer');
            let html = '';
            
            investmentQuestions.forEach((question, qIndex) => {
                html += `
                    <div class="question-box">
                        <h4>Q${qIndex + 1}. ${question.q}</h4>
                        <div class="radio-group">
                `;
                
                question.options.forEach((option, oIndex) => {
                    html += `
                        <label>
                            <input type="radio" name="q${qIndex}" value="${option.score}" onchange="calculateInvestmentAnalysis()">
                            ${option.text}
                        </label>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        // ìƒì†/ì¦ì—¬ì„¸ ê³„ì‚° í•¨ìˆ˜
        function calculateTaxAnalysis() {
            const taxType = document.querySelector('input[name="taxType"]:checked').value;
            const relation = document.getElementById('taxRelation').value;
            const propertyValue = unformat(document.getElementById('propertyValue').value || '0');
            const financialValue = unformat(document.getElementById('financialValue').value || '0');
            const otherValue = unformat(document.getElementById('otherValue').value || '0');
            const previousGiftAmount = unformat(document.getElementById('previousGiftAmount').value || '0');
            const recipientAge = parseInt(document.getElementById('recipientAge').value || '20');
            
            const totalProperty = propertyValue + financialValue + otherValue;
            document.getElementById('totalPropertyValue').textContent = formatNumber(totalProperty) + 'ì›';
            
            if (totalProperty === 0) {
                alert('ì¦ì—¬/ìƒì† ì¬ì‚°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê´€ê³„ë³„ ê³µì œì•¡ (10ë…„ í•©ì‚°)
            let deduction = 0;
            if (relation === 'ë°°ìš°ì') {
                deduction = 600000000; // 6ì–µ
            } else if (relation === 'ìë…€') {
                deduction = recipientAge < 19 ? 20000000 : 50000000; // ë¯¸ì„±ë…„ 2ì²œë§Œì›, ì„±ë…„ 5ì²œë§Œì›
            } else if (relation === 'ì†ìë…€') {
                deduction = recipientAge < 19 ? 20000000 : 50000000;
            } else if (relation === 'ë¶€ëª¨') {
                deduction = 50000000;
            } else if (relation === 'ê¸°íƒ€ì¹œì¡±') {
                deduction = 10000000;
            } else {
                deduction = 0;
            }
            
            // ê³¼ì„¸í‘œì¤€ ê³„ì‚°
            const taxBase = Math.max(0, totalProperty + previousGiftAmount - deduction);
            
            // ì„¸ìœ¨ ì ìš© (ëˆ„ì§„ì„¸ìœ¨)
            let taxAmount = 0;
            if (taxBase <= 100000000) {
                taxAmount = taxBase * 0.1;
            } else if (taxBase <= 500000000) {
                taxAmount = taxBase * 0.2 - 10000000;
            } else if (taxBase <= 1000000000) {
                taxAmount = taxBase * 0.3 - 60000000;
            } else if (taxBase <= 3000000000) {
                taxAmount = taxBase * 0.4 - 160000000;
            } else {
                taxAmount = taxBase * 0.5 - 460000000;
            }
            
            // ì„¸ëŒ€ìƒëµ í• ì¦ (ì†ìë…€)
            if (relation === 'ì†ìë…€') {
                if (recipientAge < 19 && totalProperty > 2000000000) {
                    taxAmount *= 1.4; // 40% í• ì¦
                } else {
                    taxAmount *= 1.3; // 30% í• ì¦
                }
            }
            
            // ì‹ ê³ ì„¸ì•¡ê³µì œ 10%
            taxAmount = taxAmount * 0.9;
            
            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('taxResultPanel').style.display = 'block';
            document.getElementById('resultTotalProperty').textContent = formatNumber(totalProperty) + 'ì›';
            document.getElementById('resultDeduction').textContent = formatNumber(deduction) + 'ì›';
            document.getElementById('resultPreviousGift').textContent = formatNumber(previousGiftAmount) + 'ì›';
            document.getElementById('resultTaxBase').textContent = formatNumber(taxBase) + 'ì›';
            document.getElementById('resultTaxAmount').textContent = formatNumber(taxAmount) + 'ì›';
            
            // ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
            calculateScenarios(totalProperty, relation, recipientAge, previousGiftAmount);
            
            // ì¶”ì²œ ì „ëµ
            generateTaxStrategy(totalProperty, taxAmount, relation, recipientAge);
        }
        
        function calculateScenarios(totalProperty, relation, recipientAge, previousGift) {
            // ì‹œë‚˜ë¦¬ì˜¤ 1: ì§ì ‘ ì¦ì—¬ (í˜„ì¬)
            const scenario1 = calculateSingleTax(totalProperty, relation, recipientAge, previousGift);
            
            // ì‹œë‚˜ë¦¬ì˜¤ 2: ë°°ìš°ì ê²½ìœ 
            let scenario2 = 0;
            if (relation !== 'ë°°ìš°ì') {
                const toSpouse = calculateSingleTax(totalProperty, 'ë°°ìš°ì', 40, 0);
                const fromSpouse = calculateSingleTax(totalProperty, relation, recipientAge, 0);
                scenario2 = toSpouse + fromSpouse;
            } else {
                scenario2 = scenario1;
            }
            
            // ì‹œë‚˜ë¦¬ì˜¤ 3: 10ë…„ ë¶„í• 
            const perYear = totalProperty / 10;
            const scenario3 = calculateSingleTax(perYear, relation, recipientAge, 0) * 10;
            
            document.getElementById('scenario1Amount').textContent = formatNumber(scenario1) + 'ì›';
            document.getElementById('scenario2Amount').textContent = formatNumber(scenario2) + 'ì›';
            document.getElementById('scenario3Amount').textContent = formatNumber(scenario3) + 'ì›';
            
            const savings2 = scenario1 - scenario2;
            const savings3 = scenario1 - scenario3;
            
            if (relation !== 'ë°°ìš°ì') {
                document.getElementById('scenario2Savings').textContent = savings2 > 0 ? `ì ˆì„¸ ${formatNumber(savings2)}ì›` : 'ë™ì¼';
            } else {
                document.getElementById('scenario2Savings').textContent = 'í•´ë‹¹ì—†ìŒ';
            }
            
            document.getElementById('scenario3Savings').textContent = savings3 > 0 ? `ì ˆì„¸ ${formatNumber(savings3)}ì›` : 'ë™ì¼';
            
            document.getElementById('scenarioComparison').style.display = 'block';
        }
        
        function calculateSingleTax(amount, relation, age, previousGift) {
            let deduction = 0;
            if (relation === 'ë°°ìš°ì') deduction = 600000000;
            else if (relation === 'ìë…€' || relation === 'ì†ìë…€') deduction = age < 19 ? 20000000 : 50000000;
            else if (relation === 'ë¶€ëª¨') deduction = 50000000;
            else if (relation === 'ê¸°íƒ€ì¹œì¡±') deduction = 10000000;
            
            const taxBase = Math.max(0, amount + previousGift - deduction);
            let tax = 0;
            
            if (taxBase <= 100000000) tax = taxBase * 0.1;
            else if (taxBase <= 500000000) tax = taxBase * 0.2 - 10000000;
            else if (taxBase <= 1000000000) tax = taxBase * 0.3 - 60000000;
            else if (taxBase <= 3000000000) tax = taxBase * 0.4 - 160000000;
            else tax = taxBase * 0.5 - 460000000;
            
            if (relation === 'ì†ìë…€') {
                tax *= (age < 19 && amount > 2000000000) ? 1.4 : 1.3;
            }
            
            return tax * 0.9; // ì‹ ê³ ì„¸ì•¡ê³µì œ
        }
        
        function generateTaxStrategy(totalProperty, taxAmount, relation, age) {
            const content = document.getElementById('taxStrategyContent');
            let strategy = '';
            
            if (totalProperty < 100000000) {
                strategy = `
                    âœ… <strong>ì†Œì•¡ ì¦ì—¬ ì „ëµ</strong><br>
                    â€¢ í˜„ì¬ ì¬ì‚° ê·œëª¨ëŠ” ì„¸ê¸ˆ ë¶€ë‹´ì´ í¬ì§€ ì•ŠìŠµë‹ˆë‹¤<br>
                    â€¢ ê¸°ë³¸ ê³µì œë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ì ˆì„¸ ê°€ëŠ¥<br>
                    â€¢ 10ë…„ ë‹¨ìœ„ë¡œ ë¶„í• í•˜ë©´ ì„¸ê¸ˆ 0ì›ë„ ê°€ëŠ¥
                `;
            } else if (totalProperty < 500000000) {
                strategy = `
                    âš ï¸ <strong>ì¤‘ê°„ ê·œëª¨ ì¦ì—¬ ì „ëµ</strong><br>
                    â€¢ 10ë…„ ë¶„í•  ì¦ì—¬ë¡œ ${formatNumber(taxAmount * 0.5)}ì› ì´ìƒ ì ˆì„¸ ê°€ëŠ¥<br>
                    â€¢ ${age < 19 ? 'ìë…€ê°€ ì„±ë…„ì´ ëœ í›„' : 'ì§€ê¸ˆ ë°”ë¡œ'} ì¦ì—¬ ì‹œì‘ ê¶Œì¥<br>
                    â€¢ ë°°ìš°ìë¥¼ ê²½ìœ í•˜ë©´ ì¶”ê°€ ì ˆì„¸ ê°€ëŠ¥
                `;
            } else {
                strategy = `
                    ğŸš¨ <strong>ê³ ì•¡ ì¦ì—¬ ì „ëµ (ì „ë¬¸ê°€ ìƒë‹´ í•„ìˆ˜)</strong><br>
                    â€¢ <strong>10ë…„ ë¶„í•  ì¦ì—¬</strong>: ë§¤ë…„ ${formatNumber(totalProperty / 10)}ì›ì”©<br>
                    â€¢ <strong>ë°°ìš°ì ê²½ìœ  ì¦ì—¬</strong>: 1ë‹¨ê³„ ì ˆì„¸ íš¨ê³¼<br>
                    â€¢ <strong>ì‹ íƒ í™œìš©</strong>: ì¶”ê°€ ì ˆì„¸ ë° ì¦ì—¬ ì·¨ì†Œ ë°©ì§€<br>
                    â€¢ <strong>ê°€ì—…ìŠ¹ê³„ íŠ¹ë¡€</strong>: í•´ë‹¹ ì‹œ ìµœëŒ€ 100ì–µ í•œë„<br><br>
                    âš¡ ì˜ˆìƒ ì ˆì„¸ì•¡: ìµœëŒ€ ${formatNumber(taxAmount * 0.7)}ì›
                `;
            }
            
            content.innerHTML = strategy;
            
            // ìµœì  ì‹¤í–‰ ë°©ì•ˆ
            if (totalProperty >= 100000000) {
                const optimalPlan = document.getElementById('optimalPlan');
                const optimalContent = document.getElementById('optimalPlanContent');
                optimalPlan.style.display = 'block';
                
                const yearlyAmount = totalProperty / 10;
                optimalContent.innerHTML = `
                    <strong>ğŸ“… 10ê°œë…„ ì¦ì—¬ í”Œëœ</strong><br><br>
                    <strong>1ë‹¨ê³„ (1-3ë…„ì°¨)</strong><br>
                    â€¢ ë§¤ë…„ ${formatNumber(yearlyAmount)}ì›ì”© ì¦ì—¬<br>
                    â€¢ ì˜ˆìƒ ì„¸ê¸ˆ: ì—° ${formatNumber(calculateSingleTax(yearlyAmount, relation, age, 0))}ì›<br><br>
                    
                    <strong>2ë‹¨ê³„ (4-7ë…„ì°¨)</strong><br>
                    â€¢ ë™ì¼ ê¸ˆì•¡ ì§€ì† ì¦ì—¬<br>
                    â€¢ 10ë…„ í•©ì‚° ê³¼ì„¸ë¡œ ëˆ„ì  ê´€ë¦¬<br><br>
                    
                    <strong>3ë‹¨ê³„ (8-10ë…„ì°¨)</strong><br>
                    â€¢ ì”ì—¬ ê¸ˆì•¡ ì™„ë£Œ<br>
                    â€¢ ì´ ì ˆì„¸ì•¡: <strong style="color: #dc2626;">${formatNumber(taxAmount - calculateSingleTax(yearlyAmount, relation, age, 0) * 10)}ì›</strong>
                `;
            }
        }

        // PDF ìƒì„± í•¨ìˆ˜ (ìŠ¤íƒ€ì¼ 1: í´ë˜ì‹ í”„ë¡œí˜ì…”ë„)
function generatePDF() {
    // ì¸ì‡„ ì „ í™•ì¸
    if (!document.getElementById('name').value) {
        alert('ê³ ê°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // í˜„ì¬ ìƒíƒœ ì €ì¥
    const originalStep = currentStep;
    const stepStates = {};
    
    // ëª¨ë“  stepê³¼ analysisë¥¼ ê°•ì œë¡œ ë³´ì´ê²Œ ì„¤ì •
    for (let i = 1; i <= 8; i++) {
        const stepEl = document.getElementById(`step${i}`);
        const analysisEl = document.getElementById(`analysis${i}`);
        
        if (stepEl) {
            stepStates[`step${i}`] = stepEl.style.display;
            stepEl.style.display = 'block';
        }
        if (analysisEl) {
            stepStates[`analysis${i}`] = analysisEl.style.display;
            analysisEl.style.display = 'block';
        }
    }
    
    // ì¸ì‡„ ì‹¤í–‰
    window.print();
    
    // ì¸ì‡„ ì™„ë£Œ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì› (ì•½ê°„ì˜ ì§€ì—° í›„)
    setTimeout(() => {
        for (let i = 1; i <= 8; i++) {
            const stepEl = document.getElementById(`step${i}`);
            const analysisEl = document.getElementById(`analysis${i}`);
            
            if (stepEl && stepStates[`step${i}`] !== undefined) {
                stepEl.style.display = i === originalStep ? 'block' : 'none';
            }
            if (analysisEl && stepStates[`analysis${i}`] !== undefined) {
                analysisEl.style.display = i === originalStep ? 'block' : 'none';
            }
        }
    }, 1000);
}

// ì¸ì‡„ìš© CSS ë™ì  ì¶”ê°€
function addPrintStyles() {
    const printCSS = `
        <style id="printStyles">
        @media print {
            /* í˜ì´ì§€ ì„¤ì • */
            @page {
                size: A4;
                margin: 15mm;
            }
            
            /* ë¶ˆí•„ìš”í•œ ìš”ì†Œ ìˆ¨ê¸°ê¸° */
            header, .toolbar, .step-indicator, 
            .btn-add, .btn-remove, .btn, 
            footer, .progress-bar-container,
            .save-status {
                display: none !important;
            }
            
            /* ë©”ì¸ ê·¸ë¦¬ë“œ ì¸ì‡„ìš© ë ˆì´ì•„ì›ƒ */
            .main-grid {
                display: block !important;
                grid-template-columns: none !important;
            }
            
            /* ì…ë ¥ ì„¹ì…˜ê³¼ ë¶„ì„ ì„¹ì…˜ ëª¨ë‘ í‘œì‹œ */
            .input-section, .analysis-section {
                display: block !important;
                width: 100% !important;
            }
            
            /* ë¶„ì„ ì„¹ì…˜ì€ ì…ë ¥ ì„¹ì…˜ ë’¤ì— ë°°ì¹˜ */
            .analysis-section {
                margin-top: 30px !important;
            }
            
            /* ê° ë¶„ì„ ì¹´ë“œë„ í˜ì´ì§€ ë¸Œë ˆì´í¬ ê³ ë ¤ */
            .analysis-section .card {
                page-break-inside: avoid;
                margin-bottom: 20px !important;
            }
            
            /* ê° Step ì¹´ë“œ ìŠ¤íƒ€ì¼ë§ */
            .card {
                page-break-inside: avoid;
                margin-bottom: 20px !important;
                border: 1px solid #ddd !important;
                box-shadow: none !important;
            }
            
            /* Step ì œëª© ìŠ¤íƒ€ì¼ë§ */
            .card h2 {
                background: #f8f9fa !important;
                padding: 10px 15px !important;
                margin: -24px -24px 20px -24px !important;
                color: #2C3E50 !important;
                border-bottom: 2px solid #e9ecef !important;
            }
            
            /* ë™ì  ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ë§ */
            .dynamic-container {
                border: 1px solid #e9ecef !important;
                background: #fafbfc !important;
                margin-bottom: 15px !important;
                page-break-inside: avoid;
            }
            
            /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ë§ */
            input, select, textarea {
                border: 1px solid #ddd !important;
                background: white !important;
                color: #333 !important;
                font-size: 12px !important;
            }
            
            /* 2ì—´ ë ˆì´ì•„ì›ƒ ìœ ì§€ */
            .two-col {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 10px !important;
            }
            
            /* ì€í‡´ ë ˆì´ì•„ì›ƒ */
            .retirement-layout {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 15px !important;
            }
            
            /* ìš”ì•½ ì •ë³´ ìŠ¤íƒ€ì¼ë§ */
            .summary-grid {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }
            
            .result-grid {
                display: grid !important;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)) !important;
                gap: 10px !important;
            }
            
            .result-box, .profile-summary {
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                color: #333 !important;
            }
            
            /* í˜ì´ì§€ ë¸Œë ˆì´í¬ */
            #step2, #step4, #step6, #step8 {
                page-break-before: always;
            }
            
            /* íˆ¬ìì„±í–¥ ì§ˆë¬¸ ìŠ¤íƒ€ì¼ë§ */
            .question-box {
                border: 1px solid #e9ecef !important;
                background: white !important;
                margin-bottom: 10px !important;
                page-break-inside: avoid;
            }
            
            .radio-group label {
                border: 1px solid #e9ecef !important;
                background: #f8f9fa !important;
                margin-bottom: 3px !important;
                padding: 8px !important;
                font-size: 11px !important;
            }
            
            /* ìƒ‰ìƒ ì¡°ì • */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* í°íŠ¸ í¬ê¸° ì¡°ì • */
            body {
                font-size: 12px !important;
                line-height: 1.4 !important;
            }
            
            h2 {
                font-size: 16px !important;
            }
            
            h3 {
                font-size: 14px !important;
            }
            
            label {
                font-size: 11px !important;
            }
        }
        </style>
    `;
    
    // ê¸°ì¡´ ì¸ì‡„ ìŠ¤íƒ€ì¼ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
    const existingStyle = document.getElementById('printStyles');
    if (existingStyle) {
        existingStyle.remove();
    }
    
    document.head.insertAdjacentHTML('beforeend', printCSS);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì‡„ ìŠ¤íƒ€ì¼ ì¶”ê°€
document.addEventListener('DOMContentLoaded', addPrintStyles);

        // AI ì†”ë£¨ì…˜ ìƒì„±
        function generateAISolution() {
            const name = document.getElementById('name').value || 'ê³ ê°ë‹˜';
            const age = calculateAge(document.getElementById('birthDate').value);
            const totalAssets = unformat(document.getElementById('totalAssets').textContent);
            const netAssets = unformat(document.getElementById('netAssets').textContent);
            const monthlySurplus = unformat(document.getElementById('monthlySurplus').textContent);
            const retirementScore = document.getElementById('retirementScore').textContent;
            
            let summary = `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${name}ë‹˜ì˜ ì¬ë¬´ í˜„í™© Summary
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ê¸°ë³¸ ì •ë³´
- ë‚˜ì´: ë§Œ ${age}ì„¸
- ì´ ìì‚°: ${formatNumber(totalAssets)}ì›
- ìˆœìì‚°: ${formatNumber(netAssets)}ì›
- ì›” ì‰ì—¬ê¸ˆ: ${formatNumber(monthlySurplus)}ì›

ğŸ“ˆ ì¬ë¬´ ê±´ê°•ë„ í‰ê°€
`;
            
            if (netAssets > 0 && monthlySurplus > 0) {
                summary += `âœ… ì¬ë¬´ ìƒíƒœ ì–‘í˜¸ - ìˆœìì‚°ê³¼ ì›” ì‰ì—¬ê¸ˆ ëª¨ë‘ í”ŒëŸ¬ìŠ¤\n`;
            } else if (netAssets > 0) {
                summary += `âš ï¸ ì£¼ì˜ í•„ìš” - ìˆœìì‚°ì€ ì–‘í˜¸í•˜ë‚˜ ì›” ì‰ì—¬ê¸ˆ ë¶€ì¡±\n`;
            } else {
                summary += `ğŸš¨ ê¸´ê¸‰ ê°œì„  í•„ìš” - ë¶€ì±„ê°€ ìì‚°ì„ ì´ˆê³¼\n`;
            }
            
            summary += `\nğŸ¯ ì€í‡´ ì¤€ë¹„ë„: ${retirementScore}\n`;
            
            if (parseInt(retirementScore) >= 8) {
                summary += `âœ… ì€í‡´ ì¤€ë¹„ ìš°ìˆ˜ - í˜„ì¬ ê³„íš ìœ ì§€\n`;
            } else if (parseInt(retirementScore) >= 5) {
                summary += `âš ï¸ ì€í‡´ ì¤€ë¹„ ë³´í†µ - ì¶”ê°€ ì €ì¶• í•„ìš”\n`;
            } else {
                summary += `ğŸš¨ ì€í‡´ ì¤€ë¹„ ë¶€ì¡± - ì ê·¹ì  ëŒ€ì‘ í•„ìš”\n`;
            }
            
            summary += `\nğŸ’¡ í•µì‹¬ ì œì•ˆì‚¬í•­
1. ${monthlySurplus > 0 ? 'ì›” ì‰ì—¬ê¸ˆì„ í™œìš©í•œ ì¶”ê°€ ì €ì¶• ì‹¤í–‰' : 'ì§€ì¶œ êµ¬ì¡°ì¡°ì •ì„ í†µí•œ ì‰ì—¬ê¸ˆ í™•ë³´'}
2. ${parseInt(retirementScore) < 8 ? 'ì€í‡´ ì¤€ë¹„ ìì‚° í™•ëŒ€ í•„ìš”' : 'í˜„ì¬ ì€í‡´ ê³„íš ìœ ì§€'}
3. ì •ê¸°ì ì¸ ì¬ë¬´ ì ê²€ìœ¼ë¡œ ëª©í‘œ ë‹¬ì„± ëª¨ë‹ˆí„°ë§

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
            
            document.getElementById('aiSolutionResult').style.display = 'block';
            document.getElementById('aiSolutionText').textContent = summary;
        }

function collectFormData(containerId) {
    const container = document.getElementById(containerId);
    if (!container) return {};
    
    const data = {};
    const inputs = container.querySelectorAll('input, select, textarea');
    const processedRadios = new Set();
    
    inputs.forEach(input => {
        if (input.id || input.name) {
            if (input.type === 'checkbox') {
                data[input.id] = input.checked;
            } else if (input.type === 'radio') {
                if (!processedRadios.has(input.name)) {
                    const checked = container.querySelector(`input[name="${input.name}"]:checked`);
                    if (checked) {
                        data[input.name] = checked.value;
                    }
                    processedRadios.add(input.name);
                }
            } else if (input.id) {
                data[input.id] = input.value;
            }
        }
    });
    
    return data;
}

function saveData() {
    const allData = {
        timestamp: new Date().toISOString(),
        step1: {
            meetingDate: document.getElementById('meetingDate').value,
            name: document.getElementById('name').value,
            phone1: document.getElementById('phone1').value,
            phone2: document.getElementById('phone2').value,
            gender: document.getElementById('gender').value,
            birthDate: document.getElementById('birthDate').value,
            income: document.getElementById('income').value,
            companyName: document.getElementById('companyName').value,
            occupation: document.getElementById('occupation').value,
            customOccupation: document.getElementById('customOccupation').value,
            addressType: document.getElementById('addressType').value,
            address: document.getElementById('address').value,
            maritalStatus: document.getElementById('maritalStatus').value,
            childrenCount: document.getElementById('childrenCount').value,
            spouseBirthDate: document.getElementById('spouseBirthDate').value,
            spouseOccupation: document.getElementById('spouseOccupation').value,
            spouseCustomOccupation: document.getElementById('spouseCustomOccupation').value,
            spouseIncome: document.getElementById('spouseIncome').value,
            spouseCompanyName: document.getElementById('spouseCompanyName').value,
            futurePlan: document.getElementById('futurePlan').value,
            mainInterest: document.getElementById('mainInterest').value
        },
        step2: {
            realEstate: [],
            financialAssets: [],
            debts: [],
            monthlyIncome: [],
            monthlyExpense: []
        },
        step3: {
            insurance: [],
            pension: []
        },
        step4: {
            retirementAge: document.getElementById('retirementAge').value,
            lifeExpectancy: document.getElementById('lifeExpectancy').value,
            retirementMonthlyExpense: document.getElementById('retirementMonthlyExpense').value,
            inflationRate: document.getElementById('inflationRate').value,
            nationalPension: document.getElementById('nationalPension').value,
            spouseNationalPension: document.getElementById('spouseNationalPension').value
        },
        step5: {
            goals: []
        },
        step6: collectFormData('investmentQuestionsContainer'),
        step7: {
            taxType: document.querySelector('input[name="taxType"]:checked')?.value || 'gift',
            donor: document.getElementById('donor').value,
            recipient: document.getElementById('recipient').value,
            taxRelation: document.getElementById('taxRelation').value,
            propertyValue: document.getElementById('propertyValue').value,
            financialValue: document.getElementById('financialValue').value,
            otherValue: document.getElementById('otherValue').value,
            taxExempt: document.getElementById('taxExempt').value,
            debtAmount: document.getElementById('debtAmount').value,
            funeralExpense: document.getElementById('funeralExpense').value,
            previousGiftAmount: document.getElementById('previousGiftAmount').value,
            previousGiftYear: document.getElementById('previousGiftYear').value,
            recipientAge: document.getElementById('recipientAge').value,
            heirCount: document.getElementById('heirCount').value,
            hasDisability: document.getElementById('hasDisability').checked,
            isElderly: document.getElementById('isElderly').checked,
            spouseInheritance: document.getElementById('spouseInheritance').value
        },
        step8: {
            finalSummary: document.getElementById('finalSummary').value
        },
        counts: {
            realEstateCount,
            financialAssetCount,
            debtCount,
            monthlyIncomeCount,
            monthlyExpenseCount,
            insuranceCount,
            pensionCount,
            goalCount
        }
    };
    
    // Step2 ë™ì  ë°ì´í„° ì €ì¥
    for (let i = 0; i < realEstateCount; i++) {
        const container = document.getElementById(`realEstate_${i}`);
        if (container) {
            allData.step2.realEstate.push({
                type: document.getElementById(`realEstateType_${i}`)?.value,
                value: document.getElementById(`realEstateValue_${i}`)?.value,
                location: document.getElementById(`realEstateLocation_${i}`)?.value
            });
        }
    }
    
    for (let i = 0; i < financialAssetCount; i++) {
        const container = document.getElementById(`financialAsset_${i}`);
        if (container) {
            allData.step2.financialAssets.push({
                retirementAsset: document.getElementById(`retirementAsset_${i}`)?.checked,
                type: document.getElementById(`assetType_${i}`)?.value,
                balance: document.getElementById(`assetBalance_${i}`)?.value,
                institution: document.getElementById(`assetInstitution_${i}`)?.value,
                rate: document.getElementById(`assetRate_${i}`)?.value
            });
        }
    }
    
    for (let i = 0; i < debtCount; i++) {
        const container = document.getElementById(`debt_${i}`);
        if (container) {
            allData.step2.debts.push({
                type: document.getElementById(`debtType_${i}`)?.value,
                balance: document.getElementById(`debtBalance_${i}`)?.value,
                institution: document.getElementById(`debtInstitution_${i}`)?.value,
                rate: document.getElementById(`debtRate_${i}`)?.value
            });
        }
    }
    
    for (let i = 0; i < monthlyIncomeCount; i++) {
        const container = document.getElementById(`monthlyIncome_${i}`);
        if (container) {
            allData.step2.monthlyIncome.push({
                category: document.getElementById(`incomeCategory_${i}`)?.value,
                customCategory: document.getElementById(`customIncomeCategory_${i}`)?.value,
                amount: document.getElementById(`incomeAmount_${i}`)?.value
            });
        }
    }
    
    for (let i = 0; i < monthlyExpenseCount; i++) {
        const container = document.getElementById(`monthlyExpense_${i}`);
        if (container) {
            allData.step2.monthlyExpense.push({
                category: document.getElementById(`expenseCategory_${i}`)?.value,
                customCategory: document.getElementById(`customExpenseCategory_${i}`)?.value,
                amount: document.getElementById(`expenseAmount_${i}`)?.value
            });
        }
    }
    
    // Step3 ë™ì  ë°ì´í„° ì €ì¥
    for (let i = 0; i < insuranceCount; i++) {
        const container = document.getElementById(`insurance_${i}`);
        if (container) {
            allData.step3.insurance.push({
                type: document.getElementById(`insuranceType_${i}`)?.value,
                customType: document.getElementById(`customInsuranceType_${i}`)?.value,
                company: document.getElementById(`insuranceCompany_${i}`)?.value,
                premium: document.getElementById(`insurancePremium_${i}`)?.value,
                coverage: document.getElementById(`insuranceCoverage_${i}`)?.value
            });
        }
    }
    
    for (let i = 0; i < pensionCount; i++) {
        const container = document.getElementById(`pension_${i}`);
        if (container) {
            allData.step3.pension.push({
                retirementPension: document.getElementById(`retirementPension_${i}`)?.checked,
                name: document.getElementById(`pensionName_${i}`)?.value,
                company: document.getElementById(`pensionCompany_${i}`)?.value,
                premium: document.getElementById(`pensionPremium_${i}`)?.value,
                returnAmount: document.getElementById(`pensionReturn_${i}`)?.value
            });
        }
    }
    
    // Step5 ë™ì  ë°ì´í„° ì €ì¥
    for (let i = 0; i < goalCount; i++) {
        const container = document.getElementById(`goal_${i}`);
        if (container) {
            allData.step5.goals.push({
                name: document.getElementById(`goalName_${i}`)?.value,
                date: document.getElementById(`goalDate_${i}`)?.value,
                amount: document.getElementById(`goalAmount_${i}`)?.value,
                currentSavings: document.getElementById(`currentSavings_${i}`)?.value
            });
        }
    }
    
const name = document.getElementById('name').value || 'ê³ ê°';
const date = new Date().toLocaleDateString('sv-SE'); 
const fileName = `FM_${name}_${date}.fmd`;  // â† .jsonì„ .fmdë¡œ ë³€ê²½

const json = JSON.stringify(allData, null, 2);
// ì•”í˜¸í™” ì¶”ê°€
const encrypted = CryptoJS.AES.encrypt(json, 'FM-Secret-Key-2025').toString();
const blob = new Blob([encrypted], { type: 'application/octet-stream' });  // â† type ë³€ê²½
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showSaveStatus('ì €ì¥ ì™„ë£Œ!');
}

function loadData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.fmd';  // â† .jsonì„ .fmdë¡œ ë³€ê²½
    input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                // ë³µí˜¸í™” ì¶”ê°€
                const encrypted = event.target.result;
                const decrypted = CryptoJS.AES.decrypt(encrypted, 'FM-Secret-Key-2025');
                const json = decrypted.toString(CryptoJS.enc.Utf8);
                const data = JSON.parse(json);
                
                // Step1 ë³µì›
if (data.step1) {
    Object.keys(data.step1).forEach(key => {
        const el = document.getElementById(key);
        if (el) el.value = data.step1[key] || '';
    });
    
    // ë°°ìš°ì ì„¹ì…˜ í‘œì‹œ
    if (data.step1.maritalStatus === 'ê¸°í˜¼') {
        document.getElementById('spouseSection').style.display = 'block';
        document.getElementById('spouseNationalPensionGroup').style.display = 'block';
    }
    
    // ì§ì—… ì§ì ‘ì…ë ¥
    if (data.step1.occupation === 'ì§ì ‘ì…ë ¥') {
        document.getElementById('customOccupation').style.display = 'block';
    }
    if (data.step1.spouseOccupation === 'ì§ì ‘ì…ë ¥') {
        document.getElementById('spouseCustomOccupation').style.display = 'block';
    }
const phone1 = document.getElementById('phone1').value;
const phone2 = document.getElementById('phone2').value;
if (phone1 && phone2) {
    const fullPhone = `010-${phone1}-${phone2}`;
    document.getElementById('phoneCallLink').href = `tel:${fullPhone}`;
    document.getElementById('phoneCallLink').style.display = 'inline-flex';
    document.getElementById('displayPhone').textContent = fullPhone;
}    
}          
                // Step2 ë³µì›
                if (data.step2 && data.counts) {
                    // ê¸°ì¡´ í•­ëª© ì œê±°
                    document.getElementById('realEstateContainer').innerHTML = '';
                    document.getElementById('financialAssetsContainer').innerHTML = '';
                    document.getElementById('debtContainer').innerHTML = '';
                    document.getElementById('monthlyIncomeContainer').innerHTML = '';
                    document.getElementById('monthlyExpenseContainer').innerHTML = '';
                    
                    realEstateCount = 0;
                    financialAssetCount = 0;
                    debtCount = 0;
                    monthlyIncomeCount = 0;
                    monthlyExpenseCount = 0;
                    
                    // ë¶€ë™ì‚° ë³µì›
                    data.step2.realEstate.forEach(item => {
                        addRealEstate();
                        const i = realEstateCount - 1;
                        if (item.type) document.getElementById(`realEstateType_${i}`).value = item.type;
                        if (item.value) document.getElementById(`realEstateValue_${i}`).value = item.value;
                        if (item.location) document.getElementById(`realEstateLocation_${i}`).value = item.location;
                    });
                    
                    // ê¸ˆìœµìì‚° ë³µì›
                    data.step2.financialAssets.forEach(item => {
                        addFinancialAsset();
                        const i = financialAssetCount - 1;
                        if (item.retirementAsset) document.getElementById(`retirementAsset_${i}`).checked = item.retirementAsset;
                        if (item.type) document.getElementById(`assetType_${i}`).value = item.type;
                        if (item.balance) document.getElementById(`assetBalance_${i}`).value = item.balance;
                        if (item.institution) document.getElementById(`assetInstitution_${i}`).value = item.institution;
                        if (item.rate) document.getElementById(`assetRate_${i}`).value = item.rate;
                    });
                    
                    // ë¶€ì±„ ë³µì›
                    data.step2.debts.forEach(item => {
                        addDebt();
                        const i = debtCount - 1;
                        if (item.type) document.getElementById(`debtType_${i}`).value = item.type;
                        if (item.balance) document.getElementById(`debtBalance_${i}`).value = item.balance;
                        if (item.institution) document.getElementById(`debtInstitution_${i}`).value = item.institution;
                        if (item.rate) document.getElementById(`debtRate_${i}`).value = item.rate;
                    });
                    
                    // ì›”ìˆ˜ì… ë³µì›
                    data.step2.monthlyIncome.forEach(item => {
                        addMonthlyIncome();
                        const i = monthlyIncomeCount - 1;
                        if (item.category) {
                            document.getElementById(`incomeCategory_${i}`).value = item.category;
                            if (item.category === 'ì§ì ‘ì…ë ¥') {
                                document.getElementById(`customIncomeCategory_${i}`).style.display = 'block';
                                if (item.customCategory) document.getElementById(`customIncomeCategory_${i}`).value = item.customCategory;
                            }
                        }
                        if (item.amount) document.getElementById(`incomeAmount_${i}`).value = item.amount;
                    });
                    
                    // ì›”ì§€ì¶œ ë³µì›
                    data.step2.monthlyExpense.forEach(item => {
                        addMonthlyExpense();
                        const i = monthlyExpenseCount - 1;
                        if (item.category) {
                            document.getElementById(`expenseCategory_${i}`).value = item.category;
                            if (item.category === 'ì§ì ‘ì…ë ¥') {
                                document.getElementById(`customExpenseCategory_${i}`).style.display = 'block';
                                if (item.customCategory) document.getElementById(`customExpenseCategory_${i}`).value = item.customCategory;
                            }
                        }
                        if (item.amount) document.getElementById(`expenseAmount_${i}`).value = item.amount;
                    });
                }
                
                // Step3 ë³µì›
                if (data.step3) {
                    document.getElementById('insuranceContainer').innerHTML = '';
                    document.getElementById('pensionContainer').innerHTML = '';
                    insuranceCount = 0;
                    pensionCount = 0;
                    
                    // ë³´í—˜ ë³µì›
                    data.step3.insurance.forEach(item => {
                        addInsurance();
                        const i = insuranceCount - 1;
                        if (item.type) {
                            document.getElementById(`insuranceType_${i}`).value = item.type;
                            if (item.type === 'ì§ì ‘ì…ë ¥') {
                                document.getElementById(`customInsuranceType_${i}`).style.display = 'block';
                                if (item.customType) document.getElementById(`customInsuranceType_${i}`).value = item.customType;
                            }
                        }
                        if (item.company) document.getElementById(`insuranceCompany_${i}`).value = item.company;
                        if (item.premium) document.getElementById(`insurancePremium_${i}`).value = item.premium;
                        if (item.coverage) document.getElementById(`insuranceCoverage_${i}`).value = item.coverage;
                    });
                    
                    // ì—°ê¸ˆ ë³µì›
                    data.step3.pension.forEach(item => {
                        addPension();
                        const i = pensionCount - 1;
                        if (item.retirementPension) document.getElementById(`retirementPension_${i}`).checked = item.retirementPension;
                        if (item.name) document.getElementById(`pensionName_${i}`).value = item.name;
                        if (item.company) document.getElementById(`pensionCompany_${i}`).value = item.company;
                        if (item.premium) document.getElementById(`pensionPremium_${i}`).value = item.premium;
                        if (item.returnAmount) document.getElementById(`pensionReturn_${i}`).value = item.returnAmount;
                    });
                }
                
                // Step4 ë³µì›
                if (data.step4) {
                    Object.keys(data.step4).forEach(key => {
                        const el = document.getElementById(key);
                        if (el) el.value = data.step4[key] || '';
                    });
                }
                
                // Step5 ë³µì›
                if (data.step5) {
                    document.getElementById('goalContainer').innerHTML = '';
                    goalCount = 0;
                    
                    data.step5.goals.forEach(item => {
                        addGoal();
                        const i = goalCount - 1;
                        if (item.name) document.getElementById(`goalName_${i}`).value = item.name;
                        if (item.date) document.getElementById(`goalDate_${i}`).value = item.date;
                        if (item.amount) document.getElementById(`goalAmount_${i}`).value = item.amount;
                        if (item.currentSavings) document.getElementById(`currentSavings_${i}`).value = item.currentSavings;
                    });
                }
                
                // Step6 ë³µì› (íˆ¬ìì„±í–¥)
                if (data.step6) {
                    Object.keys(data.step6).forEach(key => {
                        const radio = document.querySelector(`input[name="${key}"][value="${data.step6[key]}"]`);
                        if (radio) radio.checked = true;
                    });
                }
                
                // Step7 ë³µì›
                if (data.step7) {
                    // ì¦ì—¬/ìƒì† íƒ€ì…
                    if (data.step7.taxType) {
                        const taxTypeRadio = document.querySelector(`input[name="taxType"][value="${data.step7.taxType}"]`);
                        if (taxTypeRadio) {
                            taxTypeRadio.checked = true;
                            toggleTaxType();
                        }
                    }
                    
                    // ë‚˜ë¨¸ì§€ í•„ë“œ
                    Object.keys(data.step7).forEach(key => {
                        if (key === 'taxType') return;
                        const el = document.getElementById(key);
                        if (el) {
                            if (el.type === 'checkbox') {
                                el.checked = data.step7[key];
                            } else {
                                el.value = data.step7[key] || '';
                            }
                        }
                    });
                }
                
                // Step8 ë³µì›
                if (data.step8) {
                    Object.keys(data.step8).forEach(key => {
                        const el = document.getElementById(key);
                        if (el) el.value = data.step8[key] || '';
                    });
                }
                
                updateAnalysis();
                showSaveStatus('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!');
                alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
                alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        };
        reader.readAsText(file);
    };
    input.click();
}
        function showSaveStatus(message = 'ì €ì¥ë¨') {
            const status = document.getElementById('saveStatus');
            status.textContent = message;
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 2000);
        }

        function refreshPage() {
            if (confirm('ëª¨ë“  ì…ë ¥ ë‚´ìš©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                location.reload();
            }
        }

        function goToMain() {
            if (confirm('ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = '/';
            }
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ëª¨ë°”ì¼ ê²½ê³  ìƒíƒœ ì´ˆê¸°í™”
                sessionStorage.removeItem('mobileWarningClosed');
                window.location.href = '/logout';
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ëª¨ë°”ì¼ ê°ì§€ ë° ê²½ê³  í‘œì‹œ
            function checkMobileAccess() {
                if (sessionStorage.getItem('mobileWarningClosed') === 'true') {
                    return;
                }
                
                const isMobile = window.innerWidth < 768;
                const mobileWarning = document.getElementById('mobileWarning');
                
                if (isMobile) {
                    mobileWarning.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                } else {
                    mobileWarning.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            }
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ í™•ì¸
            checkMobileAccess();
            
            // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œì—ë„ í™•ì¸
            window.addEventListener('resize', checkMobileAccess);

            // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ë¯¸íŒ…ì¼ìì— ìë™ ì„¤ì •
            const today = new Date().toLocaleDateString('sv-SE');
            document.getElementById('meetingDate').value = today;
            
            // Step íƒ­ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.step').forEach(step => {
                step.addEventListener('click', function() {
                    const stepNum = parseInt(this.getAttribute('data-step'));
                    switchStep(stepNum);
                });
            });
            
            // íˆ´ë°” ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('saveBtn').addEventListener('click', saveData);
            document.getElementById('loadBtn').addEventListener('click', loadData);
            document.getElementById('refreshBtn').addEventListener('click', refreshPage);
            document.getElementById('mainBtn').addEventListener('click', goToMain);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Step 1 ì´ë²¤íŠ¸
            document.getElementById('birthDate').addEventListener('change', function() {
                const age = calculateAge(this.value);
                document.getElementById('ageDisplay').textContent = age > 0 ? `(ë§Œ ${age}ì„¸)` : '';
                updateAnalysis();
            });
            
            document.getElementById('spouseBirthDate').addEventListener('change', function() {
                const age = calculateAge(this.value);
                document.getElementById('spouseAgeDisplay').textContent = age > 0 ? `(ë§Œ ${age}ì„¸)` : '';
            });
            
            document.getElementById('occupation').addEventListener('change', function() {
                toggleCustomInput('occupation', 'customOccupation');
            });
            
            document.getElementById('spouseOccupation').addEventListener('change', function() {
                toggleCustomInput('spouseOccupation', 'spouseCustomOccupation');
            });
            
            document.getElementById('maritalStatus').addEventListener('change', function() {
                const spouseSection = document.getElementById('spouseSection');
                const spouseNationalPensionGroup = document.getElementById('spouseNationalPensionGroup');
                
                if (this.value === 'ê¸°í˜¼') {
                    spouseSection.style.display = 'block';
                    spouseNationalPensionGroup.style.display = 'block';
                    
                    const gender = document.getElementById('gender').value;
                    const spouseGender = gender === 'ë‚¨' ? 'ì—¬' : 'ë‚¨';
                    document.getElementById('spouseGender').value = spouseGender;
                } else {
                    spouseSection.style.display = 'none';
                    spouseNationalPensionGroup.style.display = 'none';
                }
            });
            // Step 1 ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì¶”ê°€
['name', 'birthDate', 'maritalStatus', 'childrenCount', 'occupation', 
 'customOccupation', 'income', 'companyName', 'meetingDate'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
        el.addEventListener('input', updateStep1Analysis);
        el.addEventListener('change', updateStep1Analysis);
    }
});
            document.getElementById('gender').addEventListener('change', function() {
                if (document.getElementById('maritalStatus').value === 'ê¸°í˜¼') {
                    const spouseGender = this.value === 'ë‚¨' ? 'ì—¬' : 'ë‚¨';
                    document.getElementById('spouseGender').value = spouseGender;
                }
            });
            

// ì „í™”ë²ˆí˜¸ ì—…ë°ì´íŠ¸
['name', 'phone1', 'phone2'].forEach(id => {
    document.getElementById(id).addEventListener('input', function() {
        const name = document.getElementById('name').value;
        const phone1 = document.getElementById('phone1').value;
        const phone2 = document.getElementById('phone2').value;
        
        if (phone1 && phone2) {
            const fullPhone = `010-${phone1}-${phone2}`;
            document.getElementById('phoneCallLink').href = `tel:${fullPhone}`;
            document.getElementById('phoneCallLink').style.display = 'inline-flex';
            document.getElementById('displayPhone').textContent = fullPhone;
        } else {
            document.getElementById('phoneCallLink').style.display = 'none';
        }
        
        updateAnalysis();
    });
});
            // Step 2 ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('addRealEstate').addEventListener('click', addRealEstate);
            document.getElementById('addFinancialAsset').addEventListener('click', addFinancialAsset);
            document.getElementById('addDebt').addEventListener('click', addDebt);
            document.getElementById('addMonthlyIncome').addEventListener('click', addMonthlyIncome);
            document.getElementById('addMonthlyExpense').addEventListener('click', addMonthlyExpense);
            
            // Step 3 ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('addInsurance').addEventListener('click', addInsurance);
            document.getElementById('addPension').addEventListener('click', addPension);
            
            // Step 4 ì´ë²¤íŠ¸
            ['retirementAge', 'lifeExpectancy', 'retirementMonthlyExpense', 'inflationRate', 
             'nationalPension', 'spouseNationalPension'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', calculateRetirementAnalysis);
                }
            });
            
            // Step 5 ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('addGoal').addEventListener('click', addGoal);
            
            // Step 6: íˆ¬ìì„±í–¥ ì§ˆë¬¸ ìƒì„±
            generateInvestmentQuestions();
            
            // Step 7: ìƒì†/ì¦ì—¬ì„¸ ê³„ì‚°
            
            // Step 8 ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('generateAISolution').addEventListener('click', generateAISolution);
            document.getElementById('generatePDFReport').addEventListener('click', generatePDF);
            
            // ì´ˆê¸° ë¶„ì„ ì‹¤í–‰
            updateAnalysis();
        });
    </script>
<div style="position: absolute; left: -9999px;">
    <canvas id="assetsChart" width="400" height="200"></canvas>
</div>
</body>
</html>
