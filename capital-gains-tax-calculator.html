<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ì–‘ë„ì†Œë“ì„¸ ì™„ì „ ê³„ì‚°ê¸° - KFPC</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #fff3e0 0%, #e8eaf6 100%);
            min-height: 100vh;
            padding: 1rem;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2rem;
            font-weight: 900;
            color: #e65100;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .header {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #ff6f00;
        }

        .info-box {
            background: #fff3e0;
            border-left: 4px solid #ff6f00;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }

        .info-box p {
            color: #e65100;
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0.25rem 0;
        }

        .warning-badge {
            display: inline-block;
            background: #d32f2f;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .law-badge {
            display: inline-block;
            background: #1976d2;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 0.3rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.25rem;
        }

        .form-table {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .section-header {
            background: linear-gradient(135deg, #ff6f00 0%, #e65100 100%);
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .form-row {
            display: grid;
            grid-template-columns: 250px 1fr;
            border-bottom: 1px solid #e0e0e0;
            min-height: 60px;
        }

        .form-label {
            background: #f8f9fa;
            padding: 1rem;
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #333;
            border-right: 1px solid #e0e0e0;
        }

        .form-label.required::before {
            content: '*';
            color: #d32f2f;
            margin-right: 0.25rem;
            font-weight: 700;
        }

        .form-content {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .input-field {
            padding: 0.5rem 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #ff6f00;
            box-shadow: 0 0 0 3px rgba(255,111,0,0.1);
        }

        .input-number {
            width: 200px;
            text-align: right;
        }

        .input-date {
            width: auto;
            min-width: 150px;
        }

        select.input-field {
            cursor: pointer;
            background: white;
        }

        .unit {
            color: #666;
            font-size: 0.9rem;
        }

        .help-text {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.5;
            margin-top: 0.5rem;
            width: 100%;
        }

        .law-reference {
            font-size: 0.8rem;
            color: #1976d2;
            font-weight: 600;
            margin-top: 0.25rem;
            width: 100%;
        }

        .btn-primary {
            padding: 0.6rem 1.5rem;
            background: #ff6f00;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-primary:hover {
            background: #e65100;
            transform: translateY(-1px);
        }

        .btn-secondary {
            padding: 0.6rem 1.5rem;
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .calculate-btn {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, #ff6f00 0%, #bf360c 100%);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 2rem;
            box-shadow: 0 4px 15px rgba(255,111,0,0.3);
            transition: all 0.3s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,111,0,0.4);
        }

        .result-summary {
            background: linear-gradient(135deg, #ff6f00 0%, #bf360c 100%);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(255,111,0,0.3);
            padding: 2rem;
            color: white;
            margin: 1.5rem 0;
        }

        .result-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .result-amount {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }

        .result-note {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .detail-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .detail-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .detail-row.total {
            font-weight: 700;
            font-size: 1.15rem;
            border-top: 2px solid #e0e0e0;
            margin-top: 0.5rem;
            padding-top: 1rem;
        }

        .detail-label {
            color: #555;
        }

        .detail-value {
            font-weight: 600;
            color: #ff6f00;
        }

        .explanation {
            background: #fff3e0;
            border-left: 3px solid #ff6f00;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
        }

        .explanation-title {
            font-weight: 700;
            color: #e65100;
            margin-bottom: 0.5rem;
        }

        .explanation-text {
            color: #f57c00;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .warning-box {
            background: #fff8e1;
            border: 2px solid #ffd54f;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1.5rem;
        }

        .warning-box strong {
            color: #f57f17;
            display: block;
            margin-bottom: 0.5rem;
        }

        .warning-box p {
            color: #f57f17;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            -webkit-overflow-scrolling: touch;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ff6f00;
            margin-bottom: 1rem;
        }

        .modal-body {
            color: #333;
            line-height: 1.8;
        }

        .modal-body h3 {
            color: #ff6f00;
            margin: 1.5rem 0 0.75rem 0;
            font-size: 1.1rem;
        }

        .modal-body ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
        }

        .modal-btn {
            width: 100%;
            padding: 1rem;
            background: #ff6f00;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1.5rem;
        }

        .chart-container {
            margin: 1.5rem 0;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }

        .footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            color: #666;
            font-size: 0.85rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            padding: 2rem 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .logo {
                font-size: 1.5rem;
            }

            .header {
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.4rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-label {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .input-number {
                width: 100%;
            }

            .result-amount {
                font-size: 2rem;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        /* ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 40px;
            height: 40px;
            background: #ff6f00;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(230, 81, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .close-btn:hover {
            background: #e65100;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(230, 81, 0, 0.5);
        }

        .close-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div id="guideModal" class="modal active">
        <div class="modal-content">
            <div class="modal-header">ğŸ  ì–‘ë„ì†Œë“ì„¸ ì™„ì „ ê³„ì‚°ê¸° ì‚¬ìš© ê°€ì´ë“œ</div>
            <div class="modal-body">
                <p><strong>í™˜ì˜í•©ë‹ˆë‹¤!</strong> ì´ ê³„ì‚°ê¸°ëŠ” 2025ë…„ í˜„í–‰ ì„¸ë²•ì˜ ëª¨ë“  ê·œì •ì„ ë°˜ì˜í•œ ì™„ì „íŒì…ë‹ˆë‹¤.</p>
                
                <h3>âœ¨ ì™„ì „íŒì˜ íŠ¹ì§•</h3>
                <ul>
                    <li>âœ… 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ ì •í™•í•œ ê³„ì‚° (12ì–µ ì´í•˜/ì´ˆê³¼)</li>
                    <li>âœ… ë‹¤ì£¼íƒ ì¤‘ê³¼ì„¸ìœ¨ êµ¬ê°„ë³„ ì •í™•í•œ ê°€ì‚° (+20~30%p)</li>
                    <li>âœ… ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ (1ì£¼íƒ ìµœëŒ€ 80%, ì¼ë°˜ ìµœëŒ€ 30%)</li>
                    <li>âœ… ë‹¨ê¸°ë³´ìœ  ì¤‘ê³¼ (1ë…„ ë¯¸ë§Œ 70%, 2ë…„ ë¯¸ë§Œ 60%)</li>
                    <li>âœ… ë¹„ì‚¬ì—…ìš©í† ì§€ ì¤‘ê³¼ (+10%p)</li>
                    <li>âœ… ë¯¸ë“±ê¸° ì¤‘ê³¼ (70% ë‹¨ì¼ì„¸ìœ¨)</li>
                    <li>âœ… ì˜ˆì •ì‹ ê³  ì„¸ì•¡ê³µì œ (10%)</li>
                    <li>âœ… ì–‘ë„ì†Œë“ê¸°ë³¸ê³µì œ (ì—° 250ë§Œì›)</li>
                    <li>âœ… ê´€ë ¨ ë²•ë¥  ì¡°í•­ í‘œì‹œ</li>
                </ul>
                
                <h3>ğŸ’¡ ì…ë ¥ ìˆœì„œ</h3>
                <ul>
                    <li><strong>1ë‹¨ê³„:</strong> ì–‘ë„ì¼ì, ì·¨ë“ì¼ì ì…ë ¥</li>
                    <li><strong>2ë‹¨ê³„:</strong> ìì‚° ì¢…ë¥˜ ë° 1ì„¸ëŒ€ ì£¼íƒìˆ˜ ì„ íƒ</li>
                    <li><strong>3ë‹¨ê³„:</strong> ì–‘ë„ê°€ì•¡, ì·¨ë“ê°€ì•¡, í•„ìš”ê²½ë¹„ ì…ë ¥</li>
                    <li><strong>4ë‹¨ê³„:</strong> ë³´ìœ /ê±°ì£¼ê¸°ê°„ í™•ì¸</li>
                    <li><strong>5ë‹¨ê³„:</strong> ì¡°ì •ëŒ€ìƒì§€ì—­, ì¤‘ê³¼ ì—¬ë¶€ ì„ íƒ</li>
                </ul>

                <h3>âš ï¸ ì¤‘ìš” ì‚¬í•­</h3>
                <ul>
                    <li>ëª¨ë“  ê¸ˆì•¡ì€ <strong>ì›í™”(â‚©)</strong> ê¸°ì¤€ì…ë‹ˆë‹¤.</li>
                    <li>ìë™ìœ¼ë¡œ ì²œë‹¨ìœ„ ì½¤ë§ˆê°€ í‘œì‹œë©ë‹ˆë‹¤.</li>
                    <li>í•„ìˆ˜ ì…ë ¥ í•­ëª©ì—ëŠ” <strong style="color: #d32f2f;">*</strong> í‘œì‹œê°€ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ëŠ” ë³´ìœ  2ë…„ + ê±°ì£¼ 2ë…„ ìš”ê±´ì„ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤.</li>
                    <li>ì¡°ì •ëŒ€ìƒì§€ì—­ ë‹¤ì£¼íƒì€ ì¤‘ê³¼ì„¸ìœ¨ì´ ì ìš©ë©ë‹ˆë‹¤.</li>
                    <li>ìˆ«ì ì…ë ¥ë€ì€ í´ë¦­í•˜ë©´ ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
                </ul>

                <p style="margin-top: 1.5rem; color: #d32f2f; font-weight: 600;">
                    â€» ì •í™•í•œ ì„¸ì•¡ ì‚°ì •ì€ ì„¸ë¬´ì‚¬ ë“± ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </p>
            </div>
            <button class="modal-btn" onclick="closeGuide()">í™•ì¸í•˜ê³  ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div class="container">
        <div class="logo">KFPC</div>

        <div class="header">
            <button class="close-btn" onclick="closeWindow()" title="ë‹«ê¸°">Ã—</button>
            <h1 class="page-title">
                ì–‘ë„ì†Œë“ì„¸ ì™„ì „ ê³„ì‚°ê¸°
                <span class="warning-badge">ì„¸ë²• ì™„ì „ ì¤€ìˆ˜</span>
            </h1>
            <div class="info-box">
                <p>âœ… 2025ë…„ í˜„í–‰ ì„¸ë²• 100% ë°˜ì˜ | ëª¨ë“  ì¤‘ê³¼ ê·œì • í¬í•¨ | ì •í™•í•œ êµ¬ê°„ë³„ ê³„ì‚°</p>
            </div>
        </div>

        <div class="form-table">
            <div class="section-header">ğŸ“… ê¸°ë³¸ ì •ë³´</div>
            
            <div class="form-row">
                <div class="form-label required">ì–‘ë„ì¼ì</div>
                <div class="form-content">
                    <input type="date" id="transferDate" class="input-field input-date">
                    <div class="help-text">ë¶€ë™ì‚°ì„ ì–‘ë„í•œ ë‚ ì§œ (ì”ê¸ˆ ìˆ˜ë ¹ì¼ ë˜ëŠ” ë“±ê¸°ì ‘ìˆ˜ì¼)</div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ98ì¡° ì œ1í•­</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label required">ì·¨ë“ì¼ì</div>
                <div class="form-content">
                    <input type="date" id="acquireDate" class="input-field input-date">
                    <div class="help-text">ë¶€ë™ì‚°ì„ ì·¨ë“í•œ ë‚ ì§œ (ì”ê¸ˆ ì§€ê¸‰ì¼ ë˜ëŠ” ë“±ê¸°ì ‘ìˆ˜ì¼)</div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ98ì¡° ì œ2í•­</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label required">ìì‚° ì¢…ë¥˜</div>
                <div class="form-content">
                    <select id="assetType" class="input-field" onchange="updateAssetType()">
                        <option value="house">ì£¼íƒ</option>
                        <option value="land">í† ì§€</option>
                        <option value="building">ìƒê°€Â·ì˜¤í”¼ìŠ¤í…”</option>
                        <option value="other">ê¸°íƒ€</option>
                    </select>
                    <div class="help-text">ì–‘ë„í•˜ëŠ” ë¶€ë™ì‚°ì˜ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”. ì£¼íƒì€ ë‹¨ë…Â·ë‹¤ê°€êµ¬Â·ì•„íŒŒíŠ¸Â·ì—°ë¦½Â·ë‹¤ì„¸ëŒ€ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.</div>
                </div>
            </div>

            <div class="form-row" id="houseCountRow">
                <div class="form-label required">1ì„¸ëŒ€ ì£¼íƒìˆ˜</div>
                <div class="form-content">
                    <select id="houseCount" class="input-field" onchange="updateHouseCount()">
                        <option value="1">1ì£¼íƒ (ë¹„ê³¼ì„¸ ê²€í† )</option>
                        <option value="2">2ì£¼íƒ</option>
                        <option value="3">3ì£¼íƒ ì´ìƒ</option>
                    </select>
                    <div class="help-text">ì–‘ë„ì¼ í˜„ì¬ 1ì„¸ëŒ€ê°€ ë³´ìœ í•œ ì£¼íƒìˆ˜ (ë¶„ì–‘ê¶ŒÂ·ì…ì£¼ê¶Œ í¬í•¨, ì§€ë¶„ ì†Œìœ ë„ 1ì£¼íƒìœ¼ë¡œ ê³„ì‚°)</div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ89ì¡°, ì†Œë“ì„¸ë²• ì‹œí–‰ë ¹ ì œ154ì¡°</div>
                </div>
            </div>
        </div>

        <div class="form-table">
            <div class="section-header">ğŸ’° ê±°ë˜ ê¸ˆì•¡</div>

            <div class="form-row">
                <div class="form-label required">ì–‘ë„ê°€ì•¡</div>
                <div class="form-content">
                    <input type="tel" id="transferPrice" class="input-field input-number" value="0">
                    <span class="unit">ì›</span>
                    <div class="help-text">ì‹¤ì œ ì–‘ë„(ë§¤ë„) ê¸ˆì•¡ (ì‹¤ê±°ë˜ê°€, ë¶€ê°€ê°€ì¹˜ì„¸ ë³„ë„)</div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ96ì¡° ì œ1í•­ - ì–‘ë„ê°€ì•¡ì€ ì–‘ë„ ë‹¹ì‹œì˜ ì‹¤ì§€ê±°ë˜ê°€ì•¡</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label required">ì·¨ë“ê°€ì•¡</div>
                <div class="form-content">
                    <input type="tel" id="acquirePrice" class="input-field input-number" value="0">
                    <span class="unit">ì›</span>
                    <div class="help-text">ì‹¤ì œ ì·¨ë“(ë§¤ìˆ˜) ê¸ˆì•¡ + ì·¨ë“ì„¸ + ë“±ë¡ì„¸ + ë²•ë¬´ì‚¬ë¹„ìš© + ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ë“±</div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ97ì¡° ì œ1í•­ - ì·¨ë“ê°€ì•¡ì€ ì·¨ë“ ë‹¹ì‹œì˜ ì‹¤ì§€ê±°ë˜ê°€ì•¡</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">í•„ìš”ê²½ë¹„</div>
                <div class="form-content">
                    <input type="tel" id="expenses" class="input-field input-number" value="0">
                    <span class="unit">ì›</span>
                    <div class="help-text">
                        ìë³¸ì  ì§€ì¶œ(ê°œëŸ‰ë¹„, ì‹ ì¶•Â·ì¦ì¶•Â·ê°œì¶•Â·ìˆ˜ì„ ë¹„), ì–‘ë„ ì¤‘ê°œìˆ˜ìˆ˜ë£Œ, ì¸ì§€ëŒ€, ê´‘ê³ ë¹„ ë“±<br>
                        <strong>â€» ì£¼ì˜:</strong> ì¼ë°˜ ìˆ˜ì„ ë¹„, ê´€ë¦¬ë¹„ëŠ” ë¶ˆí¬í•¨
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ97ì¡° ì œ1í•­ ì œ2í˜¸ - ìë³¸ì  ì§€ì¶œì•¡ ë° ì–‘ë„ë¹„</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">ì–‘ë„ì†Œë“ê¸°ë³¸ê³µì œ</div>
                <div class="form-content">
                    <input type="tel" id="basicDeduction" class="input-field input-number" value="2,500,000">
                    <span class="unit">ì›</span>
                    <div class="help-text">
                        ì¸ë³„ ì—°ê°„ 250ë§Œì› í•œë„ (ë¯¸ë“±ê¸° ì–‘ë„ ì œì™¸)<br>
                        ì—¬ëŸ¬ ìì‚° ì–‘ë„ ì‹œ í•©ì‚°í•˜ì—¬ 250ë§Œì›ê¹Œì§€ë§Œ ê³µì œ
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ95ì¡° - ì–‘ë„ì†Œë“ê¸ˆì•¡ì—ì„œ ì—° 250ë§Œì› ê³µì œ</div>
                </div>
            </div>
        </div>

        <div class="form-table">
            <div class="section-header">ğŸ“† ë³´ìœ /ê±°ì£¼ ê¸°ê°„</div>

            <div class="form-row">
                <div class="form-label">ë³´ìœ ê¸°ê°„</div>
                <div class="form-content">
                    <input type="text" id="holdYears" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">ë…„</span>
                    <div class="help-text">ì·¨ë“ì¼ë¶€í„° ì–‘ë„ì¼ê¹Œì§€ì˜ ê¸°ê°„ (ìë™ ê³„ì‚°, ì†Œìˆ˜ì  í‘œì‹œ)</div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì‹œí–‰ë ¹ ì œ162ì¡° - ë³´ìœ ê¸°ê°„ ê³„ì‚°</div>
                </div>
            </div>

            <div class="form-row" id="residenceRow">
                <div class="form-label">ê±°ì£¼ê¸°ê°„</div>
                <div class="form-content">
                    <input type="tel" id="residenceYears" class="input-field input-number" value="0">
                    <span class="unit">ë…„</span>
                    <div class="help-text">
                        ì‹¤ì œ ê±°ì£¼í•œ ê¸°ê°„ (1ì„¸ëŒ€ 1ì£¼íƒ ì¥íŠ¹ê³µì œìš©, ì†Œìˆ˜ì  ê°€ëŠ¥)<br>
                        <strong>â€» ì£¼ë¯¼ë“±ë¡ ì „ì…ì¼ ê¸°ì¤€</strong>ìœ¼ë¡œ ê³„ì‚°
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì‹œí–‰ë ¹ ì œ167ì¡°ì˜3 - ê±°ì£¼ê¸°ê°„ ì‚°ì •</div>
                </div>
            </div>
        </div>

        <div class="form-table" id="exemptSection" style="display: none;">
            <div class="section-header">ğŸ¡ 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸</div>

            <div class="form-row">
                <div class="form-label">ë¹„ê³¼ì„¸ ìš”ê±´ ì¶©ì¡±</div>
                <div class="form-content">
                    <select id="exemptQualified" class="input-field">
                        <option value="no">ì•„ë‹ˆì˜¤ (ê³¼ì„¸ëŒ€ìƒ)</option>
                        <option value="yes">ì˜ˆ (ë¹„ê³¼ì„¸ ì ìš©)</option>
                    </select>
                    <div class="help-text">
                        <strong>ë¹„ê³¼ì„¸ ìš”ê±´ (ì†Œë“ì„¸ë²• ì œ89ì¡°):</strong><br>
                        â‘  ë³´ìœ ê¸°ê°„ 2ë…„ ì´ìƒ<br>
                        â‘¡ ê±°ì£¼ê¸°ê°„ 2ë…„ ì´ìƒ (ì¡°ì •ì§€ì—­ '17.8.3 ì´í›„ ì·¨ë“ë¶„)<br>
                        â‘¢ ì–‘ë„ê°€ì•¡ 12ì–µì› ì´í•˜ (ì´ˆê³¼ì‹œ ë¶€ë¶„ ê³¼ì„¸)<br>
                        â‘£ 1ì„¸ëŒ€ 1ì£¼íƒ (ì¼ì‹œì  2ì£¼íƒ ë“± ì˜ˆì™¸ ìˆìŒ)
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ89ì¡° ì œ1í•­ ì œ3í˜¸ - 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸</div>
                </div>
            </div>

            <div class="form-row" id="highPriceRow" style="display: none;">
                <div class="form-label">ê³ ê°€ì£¼íƒ ê³¼ì„¸ ë¶€ë¶„</div>
                <div class="form-content">
                    <input type="text" id="highPriceTaxable" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">ì›</span>
                    <div class="help-text">
                        ì–‘ë„ê°€ì•¡ 12ì–µ ì´ˆê³¼ë¶„ì— ëŒ€í•œ ê³¼ì„¸ëŒ€ìƒ ì–‘ë„ì°¨ìµ<br>
                        <strong>ê³„ì‚°ì‹:</strong> ì–‘ë„ì°¨ìµ Ã— (ì–‘ë„ê°€ì•¡ - 12ì–µ) / ì–‘ë„ê°€ì•¡
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ89ì¡° ì œ1í•­ ì œ3í˜¸ ë‹¨ì„œ - ê³ ê°€ì£¼íƒ ë¶€ë¶„ê³¼ì„¸</div>
                </div>
            </div>
        </div>

        <div class="form-table">
            <div class="section-header">âš¡ ì¤‘ê³¼ ê·œì •</div>

            <div class="form-row">
                <div class="form-label">ì¡°ì •ëŒ€ìƒì§€ì—­</div>
                <div class="form-content">
                    <select id="regulated" class="input-field">
                        <option value="no">ì•„ë‹ˆì˜¤</option>
                        <option value="yes">ì˜ˆ</option>
                    </select>
                    <div class="help-text">
                        ì–‘ë„ ë¶€ë™ì‚°ì´ ì¡°ì •ëŒ€ìƒì§€ì—­ì— ìœ„ì¹˜í•˜ëŠ”ì§€ ì—¬ë¶€<br>
                        (ì„œìš¸ ì „ì—­, ê²½ê¸° ì¼ë¶€, ì„¸ì¢… ì¼ë¶€ ë“± - êµ­í† ë¶€ ê³ ì‹œ í™•ì¸)
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ104ì¡° - ì¡°ì •ëŒ€ìƒì§€ì—­ ë‹¤ì£¼íƒì ì¤‘ê³¼</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">ë¯¸ë“±ê¸° ì–‘ë„</div>
                <div class="form-content">
                    <select id="unregistered" class="input-field">
                        <option value="no">ì•„ë‹ˆì˜¤</option>
                        <option value="yes">ì˜ˆ (70% ë‹¨ì¼ì„¸ìœ¨)</option>
                    </select>
                    <div class="help-text">
                        ì·¨ë“ í›„ ì†Œìœ ê¶Œì´ì „ë“±ê¸°ë¥¼ í•˜ì§€ ì•Šê³  ì–‘ë„í•œ ê²½ìš°<br>
                        <strong>â€» ì¤‘ê³¼ì„¸ìœ¨ 70% ë‹¨ì¼ì„¸ìœ¨ ì ìš©, ì¥íŠ¹ê³µì œÂ·ê¸°ë³¸ê³µì œ ë°°ì œ</strong>
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ104ì¡° ì œ1í•­ ì œ1í˜¸ - ë¯¸ë“±ê¸° ì–‘ë„ 70% ì¤‘ê³¼</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">ë¹„ì‚¬ì—…ìš©í† ì§€</div>
                <div class="form-content">
                    <select id="nonBusinessLand" class="input-field">
                        <option value="no">ì•„ë‹ˆì˜¤</option>
                        <option value="yes">ì˜ˆ (+10%p ì¤‘ê³¼)</option>
                    </select>
                    <div class="help-text">
                        ì†Œë“ì„¸ë²• ì œ104ì¡°ì˜3 ë¹„ì‚¬ì—…ìš©í† ì§€ í•´ë‹¹ ì—¬ë¶€<br>
                        (ë‚˜ëŒ€ì§€, ì¡ì¢…ì§€ ë“±ìœ¼ë¡œ 3ë…„ ì´ìƒ ë°©ì¹˜í•œ í† ì§€)
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ104ì¡°ì˜3 - ë¹„ì‚¬ì—…ìš©í† ì§€ 10%p ì¤‘ê³¼</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">ì˜ˆì •ì‹ ê³  ì—¬ë¶€</div>
                <div class="form-content">
                    <select id="preliminary" class="input-field">
                        <option value="no">ì•„ë‹ˆì˜¤</option>
                        <option value="yes">ì˜ˆ (10% ì„¸ì•¡ê³µì œ)</option>
                    </select>
                    <div class="help-text">
                        ì–‘ë„ì¼ì´ ì†í•˜ëŠ” ë‹¬ì˜ ë§ì¼ë¶€í„° 2ê°œì›” ì´ë‚´ ì˜ˆì •ì‹ ê³ <br>
                        (ì˜ˆ: 3ì›” ì–‘ë„ ì‹œ 5ì›” 31ì¼ê¹Œì§€ ì‹ ê³ )
                    </div>
                    <div class="law-reference">ì†Œë“ì„¸ë²• ì œ105ì¡°, ì œ114ì¡° - ì˜ˆì •ì‹ ê³  10% ê³µì œ</div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button type="button" class="btn-secondary" style="padding: 1rem 3rem;" onclick="resetForm()">ì´ˆê¸°í™”</button>
            <button type="button" class="calculate-btn" style="flex: 1; max-width: 400px; margin: 0;" onclick="calculate()">ğŸ’ ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div id="resultSection" style="display: none;">
            <div class="result-summary">
                <div class="result-title">ğŸ’° ìµœì¢… ë‚©ë¶€í•  ì–‘ë„ì†Œë“ì„¸</div>
                <div class="result-amount" id="finalTaxAmount">0 ì›</div>
                <div class="result-note" id="taxNote">ì†Œë“ì„¸ + ì§€ë°©ì†Œë“ì„¸(10%)</div>
            </div>

            <div class="explanation">
                <div class="explanation-title">ğŸ“Œ ê³„ì‚° ê²°ê³¼ ìš”ì•½</div>
                <div class="explanation-text" id="summaryText">
                </div>
            </div>

            <div class="detail-card">
                <div class="detail-title">ğŸ“Š ìƒì„¸ ê³„ì‚° ë‚´ì—­</div>
                <div id="detailContent"></div>
            </div>

            <div class="detail-card">
                <div class="detail-title">ğŸ“ˆ ì„¸ì•¡ êµ¬ì„±</div>
                <div class="chart-container">
                    <canvas id="taxChart"></canvas>
                </div>
            </div>

            <div class="detail-card">
                <div class="detail-title">ğŸ“‹ ì–‘ë„ì†Œë“ì„¸ ì„¸ìœ¨í‘œ (2025ë…„ í˜„í–‰)</div>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">ê³¼ì„¸í‘œì¤€</th>
                            <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ddd;">ì„¸ìœ¨</th>
                            <th style="padding: 0.75rem; text-align: right; border-bottom: 2px solid #ddd;">ëˆ„ì§„ê³µì œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">1,200ë§Œì› ì´í•˜</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">6%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">-</td></tr>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">1,200ë§Œì› ì´ˆê³¼ ~ 4,600ë§Œì›</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">15%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">108ë§Œì›</td></tr>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">4,600ë§Œì› ì´ˆê³¼ ~ 8,800ë§Œì›</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">24%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">522ë§Œì›</td></tr>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">8,800ë§Œì› ì´ˆê³¼ ~ 1.5ì–µì›</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">35%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">1,490ë§Œì›</td></tr>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">1.5ì–µì› ì´ˆê³¼ ~ 3ì–µì›</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">38%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">1,940ë§Œì›</td></tr>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">3ì–µì› ì´ˆê³¼ ~ 5ì–µì›</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">40%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">2,740ë§Œì›</td></tr>
                        <tr><td style="padding: 0.75rem; border-bottom: 1px solid #eee;">5ì–µì› ì´ˆê³¼ ~ 10ì–µì›</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">42%</td>
                            <td style="padding: 0.75rem; text-align: right; border-bottom: 1px solid #eee;">3,740ë§Œì›</td></tr>
                        <tr><td style="padding: 0.75rem;">10ì–µì› ì´ˆê³¼</td>
                            <td style="padding: 0.75rem; text-align: right;">45%</td>
                            <td style="padding: 0.75rem; text-align: right;">6,740ë§Œì›</td></tr>
                    </tbody>
                </table>
                <div style="margin-top: 1rem; font-size: 0.85rem; color: #666;">
                    â€» ì†Œë“ì„¸ë²• ì œ55ì¡°, 104ì¡° - ê¸°ë³¸ì„¸ìœ¨ ë° ì¤‘ê³¼ì„¸ìœ¨
                </div>
            </div>
        </div>

        <div class="warning-box">
            <strong>âš ï¸ ì¤‘ìš” ìœ ì˜ì‚¬í•­</strong>
            <p>
                â€¢ ë³¸ ê³„ì‚°ê¸°ëŠ” 2025ë…„ í˜„í–‰ ì„¸ë²•ì„ ê¸°ì¤€ìœ¼ë¡œ ì œì‘ë˜ì—ˆìœ¼ë©°, ì£¼ìš” ì¤‘ê³¼ ê·œì •ì„ í¬í•¨í•©ë‹ˆë‹¤.<br>
                â€¢ ì‹¤ì œ ì„¸ì•¡ì€ ê°œë³„ ì‚¬ì•ˆì˜ íŠ¹ìˆ˜ì„±, ê°ë©´ ê·œì • ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                â€¢ ë¶„ì–‘ê¶ŒÂ·ì…ì£¼ê¶Œ, ì¡°í•©ì›ì…ì£¼ê¶Œ ë“± íŠ¹ìˆ˜ ìì‚°ì€ ë³„ë„ ê·œì •ì´ ì ìš©ë©ë‹ˆë‹¤.<br>
                â€¢ ë¹„ì‚¬ì—…ìš©í† ì§€, 1ë…„ ë¯¸ë§Œ ë‹¨ê¸°ë³´ìœ , ë¯¸ë“±ê¸° ì–‘ë„ ì‹œ ì¤‘ê³¼ì„¸ê°€ ì ìš©ë©ë‹ˆë‹¤.<br>
                â€¢ ì •í™•í•œ ì„¸ì•¡ ì‚°ì • ë° ì‹ ê³ ë¥¼ ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ ì„¸ë¬´ì‚¬ ë“± ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.<br>
                â€¢ <strong>ì–‘ë„ì†Œë“ì„¸ ì‹ ê³ ê¸°í•œ:</strong> ì˜ˆì •ì‹ ê³  2ê°œì›” ì´ë‚´, í™•ì •ì‹ ê³  ìµë…„ 5ì›” 31ì¼ê¹Œì§€
            </p>
        </div>

        <div class="footer">
            Copyright Â© 2025 KFPC Co., Ltd. All Rights Reserved.<br>
            ë³¸ ê³„ì‚°ê¸°ëŠ” ì†Œë“ì„¸ë²• ë° ê´€ë ¨ ë²•ë ¹ì— ê·¼ê±°í•˜ì—¬ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <script>
        let taxChart = null;

        function closeGuide() {
            document.getElementById('guideModal').classList.remove('active');
        }

        function formatNumber(num) {
            return Math.floor(num).toLocaleString('ko-KR');
        }

        // ì‹¤ì‹œê°„ ìˆ«ì í¬ë§·íŒ…
        function formatInputRealtime(input) {
            let cursorPos = input.selectionStart;
            let oldValue = input.value;
            
            let value = input.value.replace(/[^0-9.]/g, '');
            
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            if (value !== '') {
                if (value.includes('.')) {
                    const [intPart, decPart] = value.split('.');
                    const num = parseFloat(intPart);
                    if (!isNaN(num)) {
                        value = num.toLocaleString('ko-KR') + '.' + decPart;
                    }
                } else {
                    const num = parseFloat(value);
                    if (!isNaN(num)) {
                        value = num.toLocaleString('ko-KR');
                    }
                }
            }
            
            input.value = value;
            
            let commaChange = (value.slice(0, cursorPos).match(/,/g) || []).length - 
                             (oldValue.slice(0, cursorPos).match(/,/g) || []).length;
            input.setSelectionRange(cursorPos + commaChange, cursorPos + commaChange);
        }

        function restrictToNumbers(e) {
            const key = e.key;
            const ctrlKey = e.ctrlKey || e.metaKey;
            
            if (
                /^[0-9]$/.test(key) ||
                key === 'Backspace' ||
                key === 'Delete' ||
                key === 'Tab' ||
                key === 'ArrowLeft' ||
                key === 'ArrowRight' ||
                key === 'ArrowUp' ||
                key === 'ArrowDown' ||
                key === 'Home' ||
                key === 'End' ||
                (ctrlKey && (key === 'a' || key === 'c' || key === 'v' || key === 'x' || key === 'A' || key === 'C' || key === 'V' || key === 'X'))
            ) {
                return true;
            }
            
            if (key === '.' && e.target.id === 'residenceYears') {
                return true;
            }
            
            e.preventDefault();
            return false;
        }

        function handlePaste(e) {
            e.preventDefault();
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            const numericValue = pastedText.replace(/[^0-9.]/g, '');
            
            const parts = numericValue.split('.');
            let cleanValue = parts[0];
            if (parts.length > 1 && e.target.id === 'residenceYears') {
                cleanValue += '.' + parts[1];
            }
            
            document.execCommand('insertText', false, cleanValue);
        }

        function parseValue(value) {
            if (typeof value === 'string') {
                return parseFloat(value.replace(/,/g, '')) || 0;
            }
            return parseFloat(value) || 0;
        }

        function updateAssetType() {
            const assetType = document.getElementById('assetType').value;
            const houseCountRow = document.getElementById('houseCountRow');
            const exemptSection = document.getElementById('exemptSection');
            const residenceRow = document.getElementById('residenceRow');
            
            if (assetType === 'house') {
                houseCountRow.style.display = 'grid';
                residenceRow.style.display = 'grid';
                updateHouseCount();
            } else {
                houseCountRow.style.display = 'none';
                exemptSection.style.display = 'none';
                residenceRow.style.display = 'none';
            }
        }

        function updateHouseCount() {
            const houseCount = document.getElementById('houseCount').value;
            const exemptSection = document.getElementById('exemptSection');
            
            if (houseCount === '1') {
                exemptSection.style.display = 'block';
            } else {
                exemptSection.style.display = 'none';
            }
        }

        function calculateHoldingPeriod() {
            const transferDate = new Date(document.getElementById('transferDate').value);
            const acquireDate = new Date(document.getElementById('acquireDate').value);
            
            if (transferDate && acquireDate && !isNaN(transferDate) && !isNaN(acquireDate)) {
                if (transferDate < acquireDate) {
                    alert('ì–‘ë„ì¼ìê°€ ì·¨ë“ì¼ìë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    document.getElementById('transferDate').value = '';
                    document.getElementById('holdYears').value = '';
                    return;
                }
                const diffTime = Math.abs(transferDate - acquireDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const years = (diffDays / 365.25).toFixed(2);
                document.getElementById('holdYears').value = years;
            }
        }

        document.getElementById('transferDate').addEventListener('change', calculateHoldingPeriod);
        document.getElementById('acquireDate').addEventListener('change', calculateHoldingPeriod);

        // ìˆ«ì ì…ë ¥ í•„ë“œ ì„¤ì •
        const numericFields = ['transferPrice', 'acquirePrice', 'expenses', 'basicDeduction', 'residenceYears'];
        numericFields.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', function(e) {
                    formatInputRealtime(this);
                });
                
                el.addEventListener('keydown', restrictToNumbers);
                el.addEventListener('paste', handlePaste);
                
                el.addEventListener('focus', function() {
                    if (this.value === '0') {
                        this.value = '';
                    }
                });
                
                el.addEventListener('blur', function() {
                    if (this.value === '' || this.value === '.') {
                        this.value = '0';
                    }
                });
            }
        });

        function resetForm() {
            if (confirm('ì…ë ¥í•œ ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                location.reload();
            }
        }

        function calculate() {
            try {
                const transferPrice = parseValue(document.getElementById('transferPrice').value);
                const acquirePrice = parseValue(document.getElementById('acquirePrice').value);
                const expenses = parseValue(document.getElementById('expenses').value);
                const basicDeduction = parseValue(document.getElementById('basicDeduction').value);
                
                if (transferPrice <= 0 || acquirePrice <= 0) {
                    alert('ì–‘ë„ê°€ì•¡ê³¼ ì·¨ë“ê°€ì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (transferPrice <= acquirePrice) {
                    alert('ì–‘ë„ê°€ì•¡ì´ ì·¨ë“ê°€ì•¡ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìœ¼ë©´ ì–‘ë„ì°¨ìµì´ ì—†ì–´ ì„¸ê¸ˆì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                const assetType = document.getElementById('assetType').value;
                const houseCount = document.getElementById('houseCount').value;
                const holdYears = parseFloat(document.getElementById('holdYears').value) || 0;
                const residenceYears = parseFloat(parseValue(document.getElementById('residenceYears').value)) || 0;
                
                const exemptQualified = document.getElementById('exemptQualified').value;
                const regulated = document.getElementById('regulated').value;
                const unregistered = document.getElementById('unregistered').value;
                const nonBusinessLand = document.getElementById('nonBusinessLand').value;
                const preliminary = document.getElementById('preliminary').value;

                const capitalGain = Math.max(0, transferPrice - acquirePrice - expenses);

                let taxableGain = capitalGain;
                let exemptAmount = 0;
                let highPriceAdjust = false;

                if (assetType === 'house' && houseCount === '1') {
                    if (exemptQualified === 'yes') {
                        if (transferPrice <= 1200000000) {
                            displayExemptResult(transferPrice, acquirePrice, expenses, capitalGain);
                            return;
                        } else {
                            highPriceAdjust = true;
                            const ratio = (transferPrice - 1200000000) / transferPrice;
                            taxableGain = Math.round(capitalGain * ratio);
                            exemptAmount = capitalGain - taxableGain;
                            document.getElementById('highPriceRow').style.display = 'grid';
                            document.getElementById('highPriceTaxable').value = formatNumber(taxableGain);
                        }
                    }
                }

                let ltDeduction = 0;
                let ltRate = 0;

                if (assetType === 'house' && houseCount === '1') {
                    const holdRate = Math.min(0.40, Math.floor(holdYears) * 0.04);
                    const residenceRate = Math.min(0.40, Math.floor(residenceYears) * 0.04);
                    ltRate = holdRate + residenceRate;
                } else if (holdYears >= 3) {
                    if (holdYears >= 15) ltRate = 0.30;
                    else if (holdYears >= 10) ltRate = 0.30;
                    else if (holdYears >= 9) ltRate = 0.27;
                    else if (holdYears >= 8) ltRate = 0.24;
                    else if (holdYears >= 7) ltRate = 0.21;
                    else if (holdYears >= 6) ltRate = 0.18;
                    else if (holdYears >= 5) ltRate = 0.15;
                    else if (holdYears >= 4) ltRate = 0.12;
                    else if (holdYears >= 3) ltRate = 0.10;
                }

                if (assetType === 'house' && (houseCount === '2' || houseCount === '3') && regulated === 'yes') {
                    ltRate = 0;
                }

                ltDeduction = Math.round(taxableGain * ltRate);

                const taxableIncome = Math.max(0, taxableGain - ltDeduction);
                const finalBasicDeduction = (unregistered === 'yes') ? 0 : basicDeduction;
                const taxBase = Math.max(0, taxableIncome - finalBasicDeduction);

                let incomeTax = 0;
                let taxNote = '';

                if (unregistered === 'yes') {
                    incomeTax = Math.round(taxBase * 0.70);
                    taxNote = 'ë¯¸ë“±ê¸° ì¤‘ê³¼ (70% ë‹¨ì¼ì„¸ìœ¨)';
                } else if (assetType === 'house' && holdYears < 1) {
                    incomeTax = Math.round(taxBase * 0.70);
                    taxNote = 'ë‹¨ê¸°ë³´ìœ  ì¤‘ê³¼ (1ë…„ ë¯¸ë§Œ, 70%)';
                } else if (assetType === 'house' && holdYears < 2) {
                    incomeTax = Math.round(taxBase * 0.60);
                    taxNote = 'ë‹¨ê¸°ë³´ìœ  ì¤‘ê³¼ (2ë…„ ë¯¸ë§Œ, 60%)';
                } else {
                    incomeTax = calculateProgressiveTax(taxBase);
                    taxNote = 'ê¸°ë³¸ì„¸ìœ¨ (ëˆ„ì§„)';

                    if (assetType === 'house' && regulated === 'yes') {
                        let surchargeRate = 0;
                        if (houseCount === '3') {
                            surchargeRate = 0.30;
                            taxNote += ' + 3ì£¼íƒ ì¤‘ê³¼ (+30%p)';
                        } else if (houseCount === '2') {
                            surchargeRate = 0.20;
                            taxNote += ' + 2ì£¼íƒ ì¤‘ê³¼ (+20%p)';
                        }
                        
                        if (surchargeRate > 0) {
                            const surcharge = calculateSurcharge(taxBase, surchargeRate);
                            incomeTax += surcharge;
                        }
                    }

                    if (nonBusinessLand === 'yes') {
                        const surcharge = calculateSurcharge(taxBase, 0.10);
                        incomeTax += surcharge;
                        taxNote += ' + ë¹„ì‚¬ì—…ìš©í† ì§€ ì¤‘ê³¼ (+10%p)';
                    }
                }

                let preliminaryDeduction = 0;
                if (preliminary === 'yes') {
                    preliminaryDeduction = Math.round(incomeTax * 0.10);
                    incomeTax = Math.max(0, incomeTax - preliminaryDeduction);
                }

                const localTax = Math.round(incomeTax * 0.10);
                const totalTax = incomeTax + localTax;

                displayResults({
                    transferPrice, acquirePrice, expenses, capitalGain,
                    exemptAmount, taxableGain, ltRate, ltDeduction,
                    finalBasicDeduction, taxableIncome, taxBase,
                    incomeTax, localTax, totalTax, taxNote,
                    preliminaryDeduction, highPriceAdjust
                });

            } catch (error) {
                alert('ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nëª¨ë“  ì…ë ¥ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\n\nì˜¤ë¥˜: ' + error.message);
            }
        }

        function calculateProgressiveTax(base) {
            if (base <= 0) return 0;
            if (base <= 12000000) return Math.round(base * 0.06);
            if (base <= 46000000) return Math.round(base * 0.15 - 1080000);
            if (base <= 88000000) return Math.round(base * 0.24 - 5220000);
            if (base <= 150000000) return Math.round(base * 0.35 - 14900000);
            if (base <= 300000000) return Math.round(base * 0.38 - 19400000);
            if (base <= 500000000) return Math.round(base * 0.40 - 27400000);
            if (base <= 1000000000) return Math.round(base * 0.42 - 37400000);
            return Math.round(base * 0.45 - 67400000);
        }

        function calculateSurcharge(base, rate) {
            let surcharge = 0;
            
            if (base > 1000000000) {
                surcharge += (base - 1000000000) * rate;
                base = 1000000000;
            }
            if (base > 500000000) {
                surcharge += (base - 500000000) * rate;
                base = 500000000;
            }
            if (base > 300000000) {
                surcharge += (base - 300000000) * rate;
                base = 300000000;
            }
            if (base > 150000000) {
                surcharge += (base - 150000000) * rate;
                base = 150000000;
            }
            if (base > 88000000) {
                surcharge += (base - 88000000) * rate;
                base = 88000000;
            }
            if (base > 46000000) {
                surcharge += (base - 46000000) * rate;
                base = 46000000;
            }
            if (base > 12000000) {
                surcharge += (base - 12000000) * rate;
                base = 12000000;
            }
            if (base > 0) {
                surcharge += base * rate;
            }
            
            return Math.round(surcharge);
        }

        function displayExemptResult(transferPrice, acquirePrice, expenses, capitalGain) {
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('finalTaxAmount').textContent = '0 ì› (ë¹„ê³¼ì„¸)';
            document.getElementById('taxNote').textContent = '1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ ì ìš©';
            
            const summary = `ì–‘ë„ê°€ì•¡ ${formatNumber(transferPrice)}ì›ì´ 12ì–µì› ì´í•˜ì´ê³ , ë³´ìœ Â·ê±°ì£¼ ìš”ê±´ì„ ì¶©ì¡±í•˜ì—¬ 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ê°€ ì ìš©ë©ë‹ˆë‹¤. ì–‘ë„ì°¨ìµ ${formatNumber(capitalGain)}ì› ì „ì•¡ì´ ë¹„ê³¼ì„¸ ì²˜ë¦¬ë©ë‹ˆë‹¤.`;
            document.getElementById('summaryText').textContent = summary;

            let html = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #ff6f00; margin-bottom: 1rem;">âœ… 1ì„¸ëŒ€ 1ì£¼íƒ ë¹„ê³¼ì„¸ ì ìš©</h3>
                    <div class="detail-row"><span>ì–‘ë„ê°€ì•¡</span><span>${formatNumber(transferPrice)} ì›</span></div>
                    <div class="detail-row"><span>ì·¨ë“ê°€ì•¡</span><span>${formatNumber(acquirePrice)} ì›</span></div>
                    <div class="detail-row"><span>í•„ìš”ê²½ë¹„</span><span>${formatNumber(expenses)} ì›</span></div>
                    <div class="detail-row total"><span>ì–‘ë„ì°¨ìµ</span><span>${formatNumber(capitalGain)} ì›</span></div>
                    <div class="detail-row" style="background: #e8f5e9; margin-top: 1rem;">
                        <span style="color: #2e7d32; font-weight: 700;">ë¹„ê³¼ì„¸ ê¸ˆì•¡</span>
                        <span style="color: #2e7d32; font-weight: 700;">${formatNumber(capitalGain)} ì›</span>
                    </div>
                    <div class="detail-row total"><span>ë‚©ë¶€ì„¸ì•¡</span><span>0 ì›</span></div>
                </div>
                <div style="background: #e3f2fd; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                    <div style="color: #1565c0; font-size: 0.9rem; line-height: 1.6;">
                        <strong>âœ” ì†Œë“ì„¸ë²• ì œ89ì¡° ì œ1í•­ ì œ3í˜¸</strong><br>
                        1ì„¸ëŒ€ 1ì£¼íƒìœ¼ë¡œì„œ ë³´ìœ ê¸°ê°„ 2ë…„ ì´ìƒ, ê±°ì£¼ê¸°ê°„ 2ë…„ ì´ìƒ(ì¡°ì •ì§€ì—­), ì–‘ë„ê°€ì•¡ 12ì–µì› ì´í•˜ì˜ ìš”ê±´ì„ ì¶©ì¡±í•˜ì—¬ ì–‘ë„ì†Œë“ì„¸ê°€ ë¹„ê³¼ì„¸ë©ë‹ˆë‹¤.
                    </div>
                </div>
            `;

            document.getElementById('detailContent').innerHTML = html;

            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function displayResults(r) {
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('finalTaxAmount').textContent = formatNumber(r.totalTax) + ' ì›';
            document.getElementById('taxNote').textContent = r.taxNote;
            
            let summary = `ì–‘ë„ê°€ì•¡ ${formatNumber(r.transferPrice)}ì›ì—ì„œ ì·¨ë“ê°€ì•¡ ${formatNumber(r.acquirePrice)}ì›ê³¼ í•„ìš”ê²½ë¹„ ${formatNumber(r.expenses)}ì›ì„ ì°¨ê°í•˜ì—¬ ì–‘ë„ì°¨ìµ ${formatNumber(r.capitalGain)}ì›ì´ ì‚°ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. `;
            
            if (r.exemptAmount > 0) {
                summary += `ê³ ê°€ì£¼íƒìœ¼ë¡œ ${formatNumber(r.exemptAmount)}ì›ì€ ë¹„ê³¼ì„¸ë˜ê³ , `;
            }
            
            if (r.ltDeduction > 0) {
                summary += `ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ ${formatNumber(r.ltDeduction)}ì›(${(r.ltRate*100).toFixed(0)}%)ì„ ì ìš©í•˜ê³ , `;
            }
            
            summary += `ê³¼ì„¸í‘œì¤€ ${formatNumber(r.taxBase)}ì›ì— ëŒ€í•´ ${r.taxNote}ì´(ê°€) ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. `;
            
            if (r.preliminaryDeduction > 0) {
                summary += `ì˜ˆì •ì‹ ê³  ì„¸ì•¡ê³µì œ ${formatNumber(r.preliminaryDeduction)}ì›ì´ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤. `;
            }
            
            summary += `ìµœì¢… ë‚©ë¶€ì„¸ì•¡ì€ ${formatNumber(r.totalTax)}ì›ì…ë‹ˆë‹¤.`;
            
            document.getElementById('summaryText').textContent = summary;

            let html = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #ff6f00; margin-bottom: 1rem;">1ï¸âƒ£ ì–‘ë„ì°¨ìµ</h3>
                    <div class="detail-row"><span>ì–‘ë„ê°€ì•¡</span><span>${formatNumber(r.transferPrice)} ì›</span></div>
                    <div class="detail-row"><span>(-) ì·¨ë“ê°€ì•¡</span><span>${formatNumber(r.acquirePrice)} ì›</span></div>
                    <div class="detail-row"><span>(-) í•„ìš”ê²½ë¹„</span><span>${formatNumber(r.expenses)} ì›</span></div>
                    <div class="detail-row total"><span>ì–‘ë„ì°¨ìµ</span><span>${formatNumber(r.capitalGain)} ì›</span></div>
            `;

            if (r.exemptAmount > 0) {
                html += `
                    <div class="detail-row" style="background: #e8f5e9; margin-top: 0.5rem;">
                        <span style="color: #2e7d32;">(-) ë¹„ê³¼ì„¸ ë¶€ë¶„ (12ì–µ ì´í•˜)</span>
                        <span style="color: #2e7d32;">${formatNumber(r.exemptAmount)} ì›</span>
                    </div>
                    <div class="detail-row total"><span>ê³¼ì„¸ëŒ€ìƒ ì–‘ë„ì°¨ìµ</span><span>${formatNumber(r.taxableGain)} ì›</span></div>
                `;
            }

            html += `</div>`;

            if (r.ltDeduction > 0) {
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: #ff6f00; margin-bottom: 1rem;">2ï¸âƒ£ ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ</h3>
                        <div class="detail-row"><span>ê³µì œìœ¨</span><span>${(r.ltRate * 100).toFixed(0)}%</span></div>
                        <div class="detail-row total"><span>ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ</span><span>${formatNumber(r.ltDeduction)} ì›</span></div>
                        <div style="background: #e3f2fd; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.5rem; font-size: 0.85rem; color: #1565c0;">
                            ì†Œë“ì„¸ë²• ì œ95ì¡° - ì¥ê¸°ë³´ìœ íŠ¹ë³„ê³µì œ
                        </div>
                    </div>
                `;
            }

            html += `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #ff6f00; margin-bottom: 1rem;">3ï¸âƒ£ ê³¼ì„¸í‘œì¤€</h3>
                    <div class="detail-row"><span>ê³¼ì„¸ëŒ€ìƒ ì†Œë“</span><span>${formatNumber(r.taxableIncome)} ì›</span></div>
                    <div class="detail-row"><span>(-) ì–‘ë„ì†Œë“ê¸°ë³¸ê³µì œ</span><span>${formatNumber(r.finalBasicDeduction)} ì›</span></div>
                    <div class="detail-row total"><span>ê³¼ì„¸í‘œì¤€</span><span>${formatNumber(r.taxBase)} ì›</span></div>
                </div>

                <div>
                    <h3 style="color: #ff6f00; margin-bottom: 1rem;">4ï¸âƒ£ ì„¸ì•¡ ê³„ì‚°</h3>
                    <div class="detail-row"><span>ì‚°ì¶œ ì†Œë“ì„¸ (${r.taxNote})</span><span>${formatNumber(r.incomeTax + (r.preliminaryDeduction || 0))} ì›</span></div>
            `;

            if (r.preliminaryDeduction > 0) {
                html += `<div class="detail-row" style="color: #43a047;"><span>(-) ì˜ˆì •ì‹ ê³  ì„¸ì•¡ê³µì œ (10%)</span><span>${formatNumber(r.preliminaryDeduction)} ì›</span></div>`;
            }

            html += `
                    <div class="detail-row total"><span>ì†Œë“ì„¸</span><span>${formatNumber(r.incomeTax)} ì›</span></div>
                    <div class="detail-row"><span>ì§€ë°©ì†Œë“ì„¸ (10%)</span><span>${formatNumber(r.localTax)} ì›</span></div>
                    <div class="detail-row total"><span>ìµœì¢… ë‚©ë¶€ì„¸ì•¡</span><span>${formatNumber(r.totalTax)} ì›</span></div>
                    <div style="background: #e3f2fd; padding: 0.75rem; border-radius: 0.5rem; margin-top: 1rem; font-size: 0.85rem; color: #1565c0;">
                        <strong>ê´€ë ¨ ë²•ë ¹:</strong> ì†Œë“ì„¸ë²• ì œ55ì¡°, ì œ104ì¡°, ì œ105ì¡°, ì œ114ì¡°<br>
                        ì§€ë°©ì„¸ë²• ì œ103ì¡°ì˜3 - ì§€ë°©ì†Œë“ì„¸
                    </div>
                </div>
            `;

            document.getElementById('detailContent').innerHTML = html;

            drawChart(r);

            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function drawChart(r) {
            const ctx = document.getElementById('taxChart').getContext('2d');
            if (taxChart) taxChart.destroy();
            
            const labels = ['ì–‘ë„ì°¨ìµ', 'ì¥íŠ¹ê³µì œ', 'ê¸°ë³¸ê³µì œ', 'ê³¼ì„¸í‘œì¤€', 'ì†Œë“ì„¸', 'ì§€ë°©ì„¸', 'ì´ì„¸ì•¡'];
            const data = [
                r.capitalGain,
                r.ltDeduction,
                r.finalBasicDeduction,
                r.taxBase,
                r.incomeTax,
                r.localTax,
                r.totalTax
            ];
            
            taxChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ê¸ˆì•¡ (ì›)',
                        data: data,
                        backgroundColor: [
                            '#ff6f00',
                            '#43a047',
                            '#1e88e5',
                            '#ffa726',
                            '#ef5350',
                            '#ab47bc',
                            '#d32f2f'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    return ctx.label + ': ' + formatNumber(ctx.parsed.y) + 'ì›';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + 'ì›';
                                }
                            }
                        }
                    }
                }
            });
        }

        window.onload = function() {
            updateAssetType();
            calculateHoldingPeriod();
        };
    </script>

<script>
// ë‹«ê¸° ë²„íŠ¼ í•¨ìˆ˜
function closeWindow() {
    if (confirm('ì°½ì„ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        window.close();
        setTimeout(function() {
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = 'about:blank';
            }
        }, 100);
    }
}
</script>
</body>
</html>