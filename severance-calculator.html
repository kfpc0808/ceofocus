<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>퇴직금·퇴직소득세 완전 계산기 - KFPC</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #e3f2fd 100%);
            min-height: 100vh;
            padding: 1rem;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2rem;
            font-weight: 900;
            color: #2e7d32;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .header {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #43a047;
        }

        .info-box {
            background: #e8f5e9;
            border-left: 4px solid #43a047;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }

        .info-box p {
            color: #2e7d32;
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0.25rem 0;
        }

        .law-reference {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            font-size: 0.8rem;
            color: #e65100;
        }

        .warning-badge {
            display: inline-block;
            background: #f57c00;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .form-table {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .section-header {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .form-row {
            display: grid;
            grid-template-columns: 250px 1fr;
            border-bottom: 1px solid #e0e0e0;
            min-height: 60px;
        }

        .form-label {
            background: #f8f9fa;
            padding: 1rem;
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #333;
            border-right: 1px solid #e0e0e0;
        }

        .form-label.required::before {
            content: '*';
            color: #d32f2f;
            margin-right: 0.25rem;
            font-weight: 700;
        }

        .form-content {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .input-field {
            padding: 0.5rem 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #43a047;
            box-shadow: 0 0 0 3px rgba(67,160,71,0.1);
        }

        .input-number {
            width: 200px;
            text-align: right;
        }

        .input-date {
            width: 150px;
        }

        select.input-field {
            cursor: pointer;
            background: white;
        }

        .unit {
            color: #666;
            font-size: 0.9rem;
        }

        .help-text {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.8;
            margin-top: 0.5rem;
            width: 100%;
        }

        /* 법령 조항 스타일 - help-text 안에 있을 때 */
        .help-text > .law-reference,
        .help-text .law-reference {
            background-color: #fff8e1;
            border-left: 3px solid #ffb74d;
            padding: 0.5rem 0.75rem;
            border-radius: 0.3rem;
            margin: 0.75rem 0 0.25rem 0;
            font-size: 0.75rem;
            color: #ef6c00;
            display: block;
            line-height: 1.5;
        }

        .tooltip-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #43a047;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: help;
            margin-left: 0.25rem;
        }

        .btn-primary {
            padding: 0.6rem 1.5rem;
            background: #43a047;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-primary:hover {
            background: #2e7d32;
            transform: translateY(-1px);
        }

        .btn-secondary {
            padding: 0.6rem 1.5rem;
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .calculate-btn {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, #43a047 0%, #1b5e20 100%);
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 2rem;
            box-shadow: 0 4px 15px rgba(67,160,71,0.3);
            transition: all 0.3s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67,160,71,0.4);
        }

        .result-summary {
            background: linear-gradient(135deg, #43a047 0%, #1b5e20 100%);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(67,160,71,0.3);
            padding: 2rem;
            color: white;
            margin: 1.5rem 0;
        }

        .result-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .result-amount {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
        }

        .result-note {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .detail-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
        }

        .detail-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .detail-row.total {
            font-weight: 700;
            font-size: 1.15rem;
            border-top: 2px solid #e0e0e0;
            margin-top: 0.5rem;
            padding-top: 1rem;
        }

        .detail-label {
            color: #555;
        }

        .detail-value {
            font-weight: 600;
            color: #43a047;
        }

        .explanation {
            background: #e8f5e9;
            border-left: 3px solid #43a047;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
        }

        .explanation-title {
            font-weight: 700;
            color: #2e7d32;
            margin-bottom: 0.5rem;
        }

        .explanation-text {
            color: #388e3c;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .warning-box {
            background: #fff8e1;
            border: 2px solid #ffd54f;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1.5rem;
        }

        .warning-box strong {
            color: #f57f17;
            display: block;
            margin-bottom: 0.5rem;
        }

        .warning-box p {
            color: #f57f17;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            -webkit-overflow-scrolling: touch;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #43a047;
            margin-bottom: 1rem;
        }

        .modal-body {
            color: #333;
            line-height: 1.8;
        }

        .modal-body h3 {
            color: #43a047;
            margin: 1.5rem 0 0.75rem 0;
            font-size: 1.1rem;
        }

        .modal-body ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
        }

        .modal-btn {
            width: 100%;
            padding: 1rem;
            background: #43a047;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1.5rem;
        }

        .chart-container {
            margin: 1.5rem 0;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }

        .footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            color: #666;
            font-size: 0.85rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            padding: 2rem 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .logo {
                font-size: 1.5rem;
            }

            .header {
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.4rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-label {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .input-number {
                width: 100%;
            }

            .result-amount {
                font-size: 2rem;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- 사용 가이드 모달 -->
    <div id="guideModal" class="modal active">
        <div class="modal-content">
            <div class="modal-header">💼 퇴직금·퇴직소득세 완전 계산기 사용 가이드</div>
            <div class="modal-body">
                <p><strong>환영합니다!</strong> 이 계산기는 2025년 현행 법령의 모든 규정을 반영한 완전판입니다.</p>
                
                <h3>✨ 완전판의 특징</h3>
                <ul>
                    <li>✅ 퇴직급여보장법 제8조에 따른 정확한 계산</li>
                    <li>✅ 소득세법 제22조, 제48조 적용 (근속연수공제)</li>
                    <li>✅ 환산급여 및 환산급여별 공제 (소득세법 시행령 제40조)</li>
                    <li>✅ 2025년 조세특례제한법 제88조의4 감면 60% 적용</li>
                    <li>✅ 지방소득세법 제3조에 따른 지방소득세 10%</li>
                    <li>✅ 중간정산 퇴직금 차감 (근로자퇴직급여 보장법 제8조)</li>
                    <li>✅ 명예퇴직 위로금 비과세 한도 (소득세법 제12조)</li>
                </ul>
                
                <h3>💡 입력 순서</h3>
                <ul>
                    <li><strong>1단계:</strong> 입사일, 퇴사일 입력</li>
                    <li><strong>2단계:</strong> 퇴직 전 3개월 급여 입력 (평균임금 계산)</li>
                    <li><strong>3단계:</strong> 중간정산 퇴직금이 있다면 입력</li>
                    <li><strong>4단계:</strong> 명예퇴직 위로금이 있다면 입력</li>
                </ul>

                <h3>📋 퇴직금 계산 공식</h3>
                <ul>
                    <li><strong>근로자퇴직급여 보장법 제8조:</strong> 1일 평균임금 × 30일 × (재직일수 ÷ 365)</li>
                    <li>1년 미만 근무자도 비례 지급</li>
                    <li>평균임금 = 퇴직 전 3개월 급여 총액 ÷ 3개월 일수 (약 92일)</li>
                </ul>

                <h3>⚠️ 중요 사항</h3>
                <ul>
                    <li>모든 금액은 <strong>원화(₩)</strong> 기준입니다.</li>
                    <li>자동으로 천단위 콤마가 표시됩니다.</li>
                    <li><strong>숫자 입력 필드는 모바일에서 숫자 키패드가 나타납니다.</strong></li>
                    <li>필수 입력 항목에는 <strong style="color: #d32f2f;">*</strong> 표시가 있습니다.</li>
                    <li>2025년 퇴직소득세는 60% 감면이 적용됩니다.</li>
                    <li>중간정산 퇴직금은 공제되며, 근속연수 계산시 차감됩니다.</li>
                </ul>

                <p style="margin-top: 1.5rem; color: #d32f2f; font-weight: 600;">
                    ※ 정확한 금액 산정은 노무사 등 전문가와 상담하시기 바랍니다.
                </p>
            </div>
            <button class="modal-btn" onclick="closeGuide()">확인하고 시작하기</button>
        </div>
    </div>

    <div class="container">
        <!-- 로고 -->
        <div class="logo">KFPC</div>

        <!-- 헤더 -->
        <div class="header">
            <h1 class="page-title">
                퇴직금·퇴직소득세 완전 계산기
                <span class="warning-badge">2025년 법령 준수</span>
            </h1>
            <div class="info-box">
                <p>✅ 2025년 현행 법령 100% 반영 | 퇴직소득세 60% 감면 적용 | 정확한 계산</p>
            </div>
            <div class="law-reference">
                📜 법적 근거: 근로자퇴직급여 보장법 제8조, 소득세법 제22조·제48조, 조세특례제한법 제88조의4
            </div>
        </div>

        <!-- 기본 정보 -->
        <div class="form-table">
            <div class="section-header">📅 기본 정보</div>
            
            <div class="form-row">
                <div class="form-label required">입사일</div>
                <div class="form-content">
                    <input type="date" id="hireDate" class="input-field input-date">
                    <div class="help-text">
                        회사에 입사한 날짜<br>
                        <span class="law-reference">근로자퇴직급여 보장법 제8조 제1항: 계속근로기간 1년에 대하여 30일분 이상의 평균임금</span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label required">퇴사일</div>
                <div class="form-content">
                    <input type="date" id="retireDate" class="input-field input-date">
                    <div class="help-text">회사에서 퇴사하는 날짜</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">재직일수</div>
                <div class="form-content">
                    <input type="text" id="workDays" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">일</span>
                    <div class="help-text">입사일부터 퇴사일까지의 일수 (자동 계산)</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">근속연수</div>
                <div class="form-content">
                    <input type="text" id="workYears" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">년</span>
                    <div class="help-text">재직일수 ÷ 365 (자동 계산)</div>
                </div>
            </div>
        </div>

        <!-- 평균임금 계산 -->
        <div class="form-table">
            <div class="section-header">💰 평균임금 계산 (퇴직 전 3개월)</div>

            <div class="form-row">
                <div class="form-label required">퇴직 전 3개월 급여 총액</div>
                <div class="form-content">
                    <input type="tel" id="totalSalary" class="input-field input-number" value="0">
                    <span class="unit">원</span>
                    <div class="help-text">
                        <strong>퇴직일 이전 3개월간 지급된 임금 총액</strong><br>
                        포함 항목: 기본급, 상여금, 수당(식대, 교통비, 가족수당 등), 성과급<br>
                        제외 항목: 퇴직금, 경조사비, 실비변상 성격의 지급액<br>
                        예시: 월 300만원 × 3개월 = 9,000,000원<br>
                        <span class="law-reference">근로기준법 제2조: 평균임금이란 이를 산정하여야 할 사유가 발생한 날 이전 3개월 동안에 그 근로자에게 지급된 임금의 총액을 그 기간의 총일수로 나눈 금액</span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">1일 평균임금</div>
                <div class="form-content">
                    <input type="text" id="avgDailyWage" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">원</span>
                    <div class="help-text">3개월 급여 총액 ÷ 92일 (3개월 약 92일 기준)</div>
                </div>
            </div>
        </div>

        <!-- 퇴직금 -->
        <div class="form-table">
            <div class="section-header">🎁 퇴직금</div>

            <div class="form-row">
                <div class="form-label">퇴직금 (세전)</div>
                <div class="form-content">
                    <input type="text" id="severancePay" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">원</span>
                    <div class="help-text">
                        <strong>1일 평균임금 × 30일 × (재직일수 ÷ 365)</strong><br>
                        1년 미만 근무시에도 비례 지급됩니다.<br>
                        <span class="law-reference">근로자퇴직급여 보장법 제8조: 계속근로기간 1년에 대하여 30일분 이상의 평균임금을 퇴직금으로 지급</span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">중간정산 퇴직금
                    <span class="tooltip-icon" title="과거에 중간정산으로 수령한 퇴직금">?</span>
                </div>
                <div class="form-content">
                    <input type="tel" id="midSeverance" class="input-field input-number" value="0">
                    <span class="unit">원</span>
                    <div class="help-text">
                        과거에 중간정산으로 지급받은 퇴직금 (있는 경우만 입력)<br>
                        <span class="law-reference">근로자퇴직급여 보장법 제8조 제2항: 중간정산한 경우 그 이후의 퇴직금 산정 시 차감</span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">중간정산 근속연수
                    <span class="tooltip-icon" title="중간정산 대상이 된 근속연수">?</span>
                </div>
                <div class="form-content">
                    <input type="tel" id="midYears" class="input-field input-number" value="0" step="0.01">
                    <span class="unit">년</span>
                    <div class="help-text">
                        중간정산 대상 근속연수 (퇴직소득세 계산시 차감)<br>
                        예: 10년 근무 후 5년차에 중간정산했다면 5.00년 입력
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">최종 퇴직금</div>
                <div class="form-content">
                    <input type="text" id="finalSeverance" class="input-field input-number" readonly style="background: #f5f5f5;">
                    <span class="unit">원</span>
                    <div class="help-text">퇴직금 - 중간정산 퇴직금</div>
                </div>
            </div>
        </div>

        <!-- 비과세 항목 -->
        <div class="form-table">
            <div class="section-header">📋 비과세 항목</div>

            <div class="form-row">
                <div class="form-label">명예퇴직 위로금
                    <span class="tooltip-icon" title="명예퇴직시 받는 위로금">?</span>
                </div>
                <div class="form-content">
                    <input type="tel" id="honoraryPay" class="input-field input-number" value="0">
                    <span class="unit">원</span>
                    <div class="help-text">
                        <strong>명예퇴직 위로금 비과세 한도:</strong><br>
                        • 근속연수 20년 이상: 최대 1억원<br>
                        • 근속연수 10년 이상: 최대 8천만원<br>
                        • 근속연수 5년 이상: 최대 5천만원<br>
                        <span class="law-reference">소득세법 제12조 제3호 바목: 근로자가 명예퇴직이나 조기퇴직의 요건을 갖추어 퇴직함으로써 받는 소득으로서 대통령령으로 정하는 한도 내의 금액</span>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-label">기타 비과세 퇴직금
                    <span class="tooltip-icon" title="법령에 따른 비과세 퇴직금">?</span>
                </div>
                <div class="form-content">
                    <input type="tel" id="otherExempt" class="input-field input-number" value="0">
                    <span class="unit">원</span>
                    <div class="help-text">
                        공무원·군인 등 법령에 따른 비과세 퇴직금<br>
                        (해당사항이 없으면 0원)
                    </div>
                </div>
            </div>
        </div>

        <!-- 버튼 영역 -->
        <div class="action-buttons">
            <button type="button" class="btn-secondary" style="padding: 1rem 3rem;" onclick="resetForm()">초기화</button>
            <button type="button" class="calculate-btn" style="flex: 1; max-width: 400px; margin: 0;" onclick="calculate()">💎 퇴직금·세금 계산하기</button>
        </div>

        <!-- 결과 영역 -->
        <div id="resultSection" style="display: none;">
            <div class="result-summary">
                <div class="result-title">💰 실수령 퇴직금</div>
                <div class="result-amount" id="netAmount">0 원</div>
                <div class="result-note">퇴직금 - 퇴직소득세 - 지방소득세</div>
            </div>

            <div class="explanation">
                <div class="explanation-title">📌 계산 결과 요약</div>
                <div class="explanation-text" id="summaryText">
                </div>
            </div>

            <div class="detail-card">
                <div class="detail-title">📊 상세 계산 내역</div>
                <div id="detailContent"></div>
            </div>

            <div class="detail-card">
                <div class="detail-title">📈 퇴직금 구성</div>
                <div class="chart-container">
                    <canvas id="severanceChart"></canvas>
                </div>
            </div>

            <div class="detail-card">
                <div class="detail-title">📋 퇴직소득세 계산 구조</div>
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">단계</th>
                            <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">내용</th>
                            <th style="padding: 0.75rem; text-align: left; border-bottom: 2px solid #ddd;">법적 근거</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">1단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">퇴직소득금액 = 퇴직금 - 비과세</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 제22조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">2단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">근속연수공제 = 5년 이하 (연 100만원) + 5년 초과 (연 150만원)</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 제48조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">3단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">환산급여 = (퇴직소득 - 근속연수공제) × 12 ÷ 근속연수</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 시행령 제40조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">4단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">환산급여별 공제 (구간별 차등)</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 시행령 제40조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">5단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">과세표준 = 환산급여 - 환산급여별공제</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 제55조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">6단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">환산산출세액 = 과세표준 × 세율 (6~45%)</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 제55조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">7단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">산출세액 = 환산산출세액 × 근속연수 ÷ 12</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">소득세법 시행령 제40조</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;">8단계</td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee;"><strong style="color: #d32f2f;">2025년 감면 60% 적용</strong></td>
                            <td style="padding: 0.75rem; border-bottom: 1px solid #eee; font-size: 0.8rem;">조세특례제한법 제88조의4</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem;">9단계</td>
                            <td style="padding: 0.75rem;">지방소득세 = 퇴직소득세 × 10%</td>
                            <td style="padding: 0.75rem; font-size: 0.8rem;">지방세법 제3조</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="warning-box">
            <strong>⚠️ 중요 유의사항</strong>
            <p>
                • 본 계산기는 2025년 현행 법령을 기준으로 제작되었습니다.<br>
                • 2025년 퇴직소득세 감면율 60%가 적용됩니다. (2023년 80% → 2024년 70% → 2025년 60%)<br>
                • 평균임금 계산시 상여금, 수당 등을 모두 포함해야 합니다.<br>
                • 중간정산 퇴직금은 근속연수 계산시 차감되며, 세금 계산에 영향을 줍니다.<br>
                • 정확한 금액 산정을 위해서는 반드시 노무사 등 전문가와 상담하시기 바랍니다.<br>
                • 퇴직금 지급 기한: 퇴직일로부터 14일 이내 (근로기준법 제36조)<br>
                • 본 계산기는 참고용이며, 실제 세액은 개인의 상황에 따라 달라질 수 있습니다.
            </p>
        </div>

        <div class="footer">
            Copyright © 2025 KFPC Co., Ltd. All Rights Reserved.<br>
            본 계산기는 교육 및 참고 목적으로만 사용되어야 합니다.
        </div>
    </div>

    <script>
        let severanceChart = null;

        function closeGuide() {
            document.getElementById('guideModal').classList.remove('active');
        }

        function formatNumber(num) {
            return Math.floor(num).toLocaleString('ko-KR');
        }

        // 실시간 숫자 포맷팅 (콤마 자동 추가)
        function formatInputRealtime(input) {
            let cursorPos = input.selectionStart;
            let oldValue = input.value;
            
            let value = input.value.replace(/[^0-9.]/g, '');
            
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            if (value !== '') {
                if (value.includes('.')) {
                    const [intPart, decPart] = value.split('.');
                    const num = parseFloat(intPart);
                    if (!isNaN(num)) {
                        value = num.toLocaleString('ko-KR') + '.' + decPart;
                    }
                } else {
                    const num = parseFloat(value);
                    if (!isNaN(num)) {
                        value = num.toLocaleString('ko-KR');
                    }
                }
            }
            
            input.value = value;
            
            let commaChange = (value.slice(0, cursorPos).match(/,/g) || []).length - 
                             (oldValue.slice(0, cursorPos).match(/,/g) || []).length;
            input.setSelectionRange(cursorPos + commaChange, cursorPos + commaChange);
        }

        function restrictToNumbers(e) {
            const key = e.key;
            const ctrlKey = e.ctrlKey || e.metaKey;
            
            if (
                /^[0-9]$/.test(key) ||
                key === 'Backspace' ||
                key === 'Delete' ||
                key === 'Tab' ||
                key === 'ArrowLeft' ||
                key === 'ArrowRight' ||
                key === 'ArrowUp' ||
                key === 'ArrowDown' ||
                key === 'Home' ||
                key === 'End' ||
                (ctrlKey && (key === 'a' || key === 'c' || key === 'v' || key === 'x' || key === 'A' || key === 'C' || key === 'V' || key === 'X'))
            ) {
                return true;
            }
            
            if (key === '.' && e.target.id === 'midYears') {
                return true;
            }
            
            e.preventDefault();
            return false;
        }

        function handlePaste(e) {
            e.preventDefault();
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            const numericValue = pastedText.replace(/[^0-9.]/g, '');
            
            const parts = numericValue.split('.');
            let cleanValue = parts[0];
            if (parts.length > 1 && e.target.id === 'midYears') {
                cleanValue += '.' + parts[1];
            }
            
            document.execCommand('insertText', false, cleanValue);
        }

        function parseValue(value) {
            if (typeof value === 'string') {
                return parseFloat(value.replace(/,/g, '')) || 0;
            }
            return parseFloat(value) || 0;
        }

        function calculateWorkDays() {
            const hireDate = new Date(document.getElementById('hireDate').value);
            const retireDate = new Date(document.getElementById('retireDate').value);
            
            if (hireDate && retireDate && !isNaN(hireDate) && !isNaN(retireDate)) {
                if (retireDate < hireDate) {
                    alert('퇴사일은 입사일보다 이후여야 합니다.');
                    document.getElementById('retireDate').value = '';
                    return;
                }
                
                const diffTime = Math.abs(retireDate - hireDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                const years = (diffDays / 365).toFixed(2);
                
                document.getElementById('workDays').value = formatNumber(diffDays);
                document.getElementById('workYears').value = years;
                
                calculateAvgWage();
            }
        }

        function calculateAvgWage() {
            const totalSalary = parseValue(document.getElementById('totalSalary').value);
            const avgDailyWage = Math.round(totalSalary / 92);
            document.getElementById('avgDailyWage').value = formatNumber(avgDailyWage);
            calculateSeverance();
        }

        function calculateSeverance() {
            const avgDailyWage = parseValue(document.getElementById('avgDailyWage').value);
            const workDays = parseValue(document.getElementById('workDays').value);
            
            const severancePay = Math.round(avgDailyWage * 30 * (workDays / 365));
            document.getElementById('severancePay').value = formatNumber(severancePay);
            
            const midSeverance = parseValue(document.getElementById('midSeverance').value);
            const finalSeverance = Math.max(0, severancePay - midSeverance);
            document.getElementById('finalSeverance').value = formatNumber(finalSeverance);
        }

        document.getElementById('hireDate').addEventListener('change', calculateWorkDays);
        document.getElementById('retireDate').addEventListener('change', calculateWorkDays);

        const numericFields = ['totalSalary', 'midSeverance', 'midYears', 'honoraryPay', 'otherExempt'];
        numericFields.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', function(e) {
                    formatInputRealtime(this);
                    if (id === 'totalSalary') calculateAvgWage();
                    if (id === 'midSeverance') calculateSeverance();
                });
                
                el.addEventListener('keydown', restrictToNumbers);
                el.addEventListener('paste', handlePaste);
                
                el.addEventListener('focus', function() {
                    if (this.value === '0') {
                        this.value = '';
                    }
                });
                
                el.addEventListener('blur', function() {
                    if (this.value === '' || this.value === '.') {
                        this.value = '0';
                    }
                });
            }
        });

        function resetForm() {
            if (confirm('입력한 내용을 모두 초기화하시겠습니까?')) {
                location.reload();
            }
        }

        function calculate() {
            try {
                const workYears = parseFloat(document.getElementById('workYears').value) || 0;
                const severancePay = parseValue(document.getElementById('severancePay').value);
                const midSeverance = parseValue(document.getElementById('midSeverance').value);
                const midYears = parseFloat(parseValue(document.getElementById('midYears').value)) || 0;
                
                if (workYears <= 0 || severancePay <= 0) {
                    alert('입사일, 퇴사일, 급여 정보를 입력해주세요.');
                    return;
                }

                if (midYears > workYears) {
                    alert('중간정산 근속연수는 전체 근속연수보다 클 수 없습니다.');
                    return;
                }

                const honoraryPay = parseValue(document.getElementById('honoraryPay').value);
                const otherExempt = parseValue(document.getElementById('otherExempt').value);

                let honoraryExempt = 0;
                if (honoraryPay > 0) {
                    if (workYears >= 20) {
                        honoraryExempt = Math.min(honoraryPay, 100000000);
                    } else if (workYears >= 10) {
                        honoraryExempt = Math.min(honoraryPay, 80000000);
                    } else if (workYears >= 5) {
                        honoraryExempt = Math.min(honoraryPay, 50000000);
                    } else {
                        alert('명예퇴직 위로금 비과세는 근속연수 5년 이상부터 적용됩니다.');
                        honoraryExempt = 0;
                    }
                }

                const finalSeverance = Math.max(0, severancePay - midSeverance);
                const totalExempt = honoraryExempt + otherExempt;
                const taxableSeverance = Math.max(0, finalSeverance - totalExempt);
                const taxableYears = Math.max(1, workYears - midYears);

                let yearDeduction = 0;
                if (taxableYears <= 5) {
                    yearDeduction = Math.floor(taxableYears) * 1000000;
                } else {
                    yearDeduction = 5000000 + (Math.floor(taxableYears) - 5) * 1500000;
                }

                const afterDeduction = Math.max(0, taxableSeverance - yearDeduction);
                const convertedSalary = Math.round(afterDeduction * 12 / taxableYears);

                let convertedDeduction = 0;
                if (convertedSalary <= 8000000) {
                    convertedDeduction = convertedSalary;
                } else if (convertedSalary <= 70000000) {
                    convertedDeduction = 8000000 + (convertedSalary - 8000000) * 0.60;
                } else if (convertedSalary <= 100000000) {
                    convertedDeduction = 45200000 + (convertedSalary - 70000000) * 0.55;
                } else if (convertedSalary <= 300000000) {
                    convertedDeduction = 61700000 + (convertedSalary - 100000000) * 0.45;
                } else {
                    convertedDeduction = 151700000 + (convertedSalary - 300000000) * 0.35;
                }
                convertedDeduction = Math.round(convertedDeduction);

                const taxBase = Math.max(0, convertedSalary - convertedDeduction);

                let convertedTax = 0;
                if (taxBase <= 12000000) {
                    convertedTax = taxBase * 0.06;
                } else if (taxBase <= 46000000) {
                    convertedTax = taxBase * 0.15 - 1080000;
                } else if (taxBase <= 88000000) {
                    convertedTax = taxBase * 0.24 - 5220000;
                } else if (taxBase <= 150000000) {
                    convertedTax = taxBase * 0.35 - 14900000;
                } else if (taxBase <= 300000000) {
                    convertedTax = taxBase * 0.38 - 19400000;
                } else if (taxBase <= 500000000) {
                    convertedTax = taxBase * 0.40 - 27400000;
                } else if (taxBase <= 1000000000) {
                    convertedTax = taxBase * 0.42 - 47400000;
                } else {
                    convertedTax = taxBase * 0.45 - 97400000;
                }
                convertedTax = Math.round(convertedTax);

                const calculatedTax = Math.round(convertedTax * taxableYears / 12);
                const taxReduction = Math.round(calculatedTax * 0.60);
                const incomeTax = calculatedTax - taxReduction;
                const localTax = Math.round(incomeTax * 0.10);
                const totalTax = incomeTax + localTax;
                const netAmount = finalSeverance - totalTax;

                displayResults({
                    workYears, severancePay, midSeverance, finalSeverance,
                    honoraryPay, honoraryExempt, otherExempt, totalExempt,
                    taxableSeverance, taxableYears, yearDeduction,
                    convertedSalary, convertedDeduction, taxBase,
                    convertedTax, calculatedTax, taxReduction,
                    incomeTax, localTax, totalTax, netAmount
                });

            } catch (error) {
                alert('계산 중 오류가 발생했습니다.\n모든 입력값을 확인해주세요.\n\n오류: ' + error.message);
            }
        }

        function displayResults(r) {
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('netAmount').textContent = formatNumber(r.netAmount) + ' 원';
            
            let summary = `재직기간 ${r.workYears.toFixed(2)}년에 대한 퇴직금 ${formatNumber(r.severancePay)}원이 산출되었습니다. `;
            
            if (r.midSeverance > 0) {
                summary += `중간정산 ${formatNumber(r.midSeverance)}원을 차감하여 최종 퇴직금은 ${formatNumber(r.finalSeverance)}원입니다. `;
            }
            
            if (r.totalExempt > 0) {
                summary += `비과세 ${formatNumber(r.totalExempt)}원을 제외하고, `;
            }
            
            summary += `과세대상 퇴직소득 ${formatNumber(r.taxableSeverance)}원에 대해 근속연수공제 ${formatNumber(r.yearDeduction)}원을 적용했습니다. `;
            summary += `퇴직소득세 ${formatNumber(r.incomeTax)}원(2025년 60% 감면 적용)과 지방소득세 ${formatNumber(r.localTax)}원을 차감하여, 최종 실수령액은 ${formatNumber(r.netAmount)}원입니다.`;
            
            document.getElementById('summaryText').textContent = summary;

            let html = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #43a047; margin-bottom: 1rem;">1️⃣ 퇴직금</h3>
                    <div class="detail-row"><span>퇴직금 (세전)</span><span>${formatNumber(r.severancePay)} 원</span></div>
            `;

            if (r.midSeverance > 0) {
                html += `<div class="detail-row"><span>(-) 중간정산 퇴직금</span><span>${formatNumber(r.midSeverance)} 원</span></div>`;
            }

            html += `<div class="detail-row total"><span>최종 퇴직금</span><span>${formatNumber(r.finalSeverance)} 원</span></div>`;

            if (r.totalExempt > 0) {
                html += `
                    <div class="detail-row" style="background: #e8f5e9; margin-top: 0.5rem;">
                        <span style="color: #2e7d32;">(-) 비과세 금액</span>
                        <span style="color: #2e7d32;">${formatNumber(r.totalExempt)} 원</span>
                    </div>
                `;
                if (r.honoraryExempt > 0) {
                    html += `<div class="detail-row" style="padding-left: 2rem;"><span>명예퇴직 위로금 비과세</span><span>${formatNumber(r.honoraryExempt)} 원</span></div>`;
                }
                if (r.otherExempt > 0) {
                    html += `<div class="detail-row" style="padding-left: 2rem;"><span>기타 비과세</span><span>${formatNumber(r.otherExempt)} 원</span></div>`;
                }
            }

            html += `<div class="detail-row total"><span>과세대상 퇴직소득</span><span>${formatNumber(r.taxableSeverance)} 원</span></div></div>`;

            html += `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #43a047; margin-bottom: 1rem;">2️⃣ 퇴직소득세 계산</h3>
                    <div class="detail-row"><span>과세대상 근속연수</span><span>${r.taxableYears.toFixed(2)} 년</span></div>
                    <div class="detail-row"><span>근속연수공제 (소득세법 제48조)</span><span>${formatNumber(r.yearDeduction)} 원</span></div>
                    <div class="detail-row"><span>환산급여 (시행령 제40조)</span><span>${formatNumber(r.convertedSalary)} 원</span></div>
                    <div class="detail-row"><span>환산급여별 공제 (시행령 제40조)</span><span>${formatNumber(r.convertedDeduction)} 원</span></div>
                    <div class="detail-row total"><span>과세표준 (소득세법 제55조)</span><span>${formatNumber(r.taxBase)} 원</span></div>
                    <div class="detail-row"><span>환산산출세액</span><span>${formatNumber(r.convertedTax)} 원</span></div>
                    <div class="detail-row"><span>산출세액 (×${r.taxableYears.toFixed(2)}년÷12)</span><span>${formatNumber(r.calculatedTax)} 원</span></div>
                    <div class="detail-row" style="background: #e3f2fd;">
                        <span style="color: #1976d2; font-weight: 700;">(-) 2025년 감면 60% (조특법 제88조의4)</span>
                        <span style="color: #1976d2; font-weight: 700;">${formatNumber(r.taxReduction)} 원</span>
                    </div>
                    <div class="detail-row total"><span>퇴직소득세</span><span>${formatNumber(r.incomeTax)} 원</span></div>
                    <div class="detail-row"><span>지방소득세 10% (지방세법 제3조)</span><span>${formatNumber(r.localTax)} 원</span></div>
                </div>

                <div>
                    <h3 style="color: #43a047; margin-bottom: 1rem;">3️⃣ 최종 실수령액</h3>
                    <div class="detail-row"><span>최종 퇴직금</span><span>${formatNumber(r.finalSeverance)} 원</span></div>
                    <div class="detail-row"><span>(-) 총 세금</span><span>${formatNumber(r.totalTax)} 원</span></div>
                    <div class="detail-row total" style="background: #e8f5e9;">
                        <span style="color: #2e7d32; font-weight: 900;">실수령액</span>
                        <span style="color: #2e7d32; font-weight: 900;">${formatNumber(r.netAmount)} 원</span>
                    </div>
                </div>
            `;

            document.getElementById('detailContent').innerHTML = html;
            drawChart(r);

            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function drawChart(r) {
            const ctx = document.getElementById('severanceChart').getContext('2d');
            if (severanceChart) severanceChart.destroy();
            
            const labels = ['최종 퇴직금', '퇴직소득세', '지방소득세', '실수령액'];
            const data = [r.finalSeverance, r.incomeTax, r.localTax, r.netAmount];
            
            severanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '금액 (원)',
                        data: data,
                        backgroundColor: [
                            '#43a047',
                            '#ef5350',
                            '#ab47bc',
                            '#2e7d32'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    return ctx.label + ': ' + formatNumber(ctx.parsed.y) + '원';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + '원';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>