<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Master í†µí•© ê´€ë¦¬ì V24 (ë ˆì´ì•„ì›ƒ ë™ê¸°í™”)</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- SheetJS (ì—‘ì…€ ë‹¤ìš´ë¡œë“œìš©) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0c2c54;
            --secondary-color: #f5f6fa;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --text-color: #2c3e50;
            --border-color: #dee2e6;
            --sidebar-width: 250px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--secondary-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            font-size: 0.9rem;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary-color);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0; top: 0;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            z-index: 100;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            text-decoration: none;
        }

        .nav-menu { list-style: none; flex: 1; }
        .nav-item { margin-bottom: 0.25rem; }
        .nav-link {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.6rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255, 255, 255, 0.1); color: white; }
        .admin-profile {
            padding: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex; align-items: center; gap: 0.75rem;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { margin-left: var(--sidebar-width); flex: 1; padding: 1.5rem; }
        
        /* ê³ ì • ìƒë‹¨ ë°” */
        .top-bar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            padding: 0.75rem 1.5rem;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        .top-bar-date { color: #666; font-size: 0.9rem; }
        .top-bar-buttons { display: flex; gap: 0.5rem; }
        .page-header { margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .page-title { font-size: 1.5rem; color: var(--primary-color); font-weight: 700; }

        /* ìƒë‹¨ ë²„íŠ¼ ê·¸ë£¹ */
        .top-buttons { display: flex; gap: 0.5rem; align-items: center; }

        .card {
            background: white; border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 1.2rem; margin-bottom: 1.2rem;
        }

        /* íƒ­ ì»¨í…ì¸  ì œì–´ */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ì„œë¸Œ íƒ­ */
        .sub-nav { display: flex; gap: 0.5rem; margin-bottom: 1rem; border-bottom: 2px solid #e9ecef; padding-bottom: 0; overflow-x: auto; }
        .sub-nav-item { padding: 0.5rem 0.8rem; cursor: pointer; font-weight: 600; color: #6c757d; border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.2s; white-space: nowrap; font-size: 0.9rem; }
        .sub-nav-item:hover { color: var(--primary-color); }
        .sub-nav-item.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; animation: fadeIn 0.3s ease; }

        /* ë²„íŠ¼ */
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; text-decoration: none; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-secondary { background: var(--accent-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border-color); color: var(--text-color); }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* í…Œì´ë¸” */
        .table-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; flex-wrap: wrap; gap: 0.8rem; }
        .table-controls h3 { font-size: 1.1rem; margin: 0; }
        .search-box { display: flex; gap: 0.4rem; align-items: center; }
        .search-box input { padding: 0.4rem; border: 1px solid #dee2e6; border-radius: 4px; min-width: 200px; font-size: 0.85rem; }
        
        .table-container { overflow-x: auto; min-height: 200px; }
        table { width: 100%; border-collapse: collapse; margin-top: 0.2rem; min-width: 800px; font-size: 0.85rem; }
        th { background: #f8f9fa; color: var(--primary-color); padding: 0.6rem 0.5rem; text-align: left; font-weight: 600; border-bottom: 2px solid var(--border-color); white-space: nowrap; }
        td { padding: 0.5rem 0.5rem; border-bottom: 1px solid #eee; vertical-align: middle; white-space: nowrap; }
        .clickable-cell { cursor: pointer; color: var(--primary-color); font-weight: 600; text-decoration: underline; text-underline-offset: 2px; }
        
        .pagination { display: flex; justify-content: center; gap: 0.3rem; margin-top: 1rem; align-items: center; }
        .page-btn { padding: 0.3rem 0.6rem; border: 1px solid #dee2e6; background: white; border-radius: 4px; cursor: pointer; min-width: 28px; text-align: center; font-size: 0.85rem; }
        .page-btn:hover { background: #e9ecef; }
        .page-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* í¼ */
        .form-group { margin-bottom: 0.8rem; }
        .form-group label { display: block; margin-bottom: 0.3rem; font-weight: 600; color: var(--primary-color); font-size: 0.9rem; }
        .form-control { width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.9rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; }

        /* ì—ë””í„° */
        .editor-container { border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden; }
        .editor-toolbar { background: #f8f9fa; border-bottom: 1px solid var(--border-color); padding: 0.4rem; display: flex; gap: 0.4rem; align-items: center; }
        .editor-btn { background: white; border: 1px solid #dee2e6; border-radius: 3px; width: 26px; height: 26px; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; font-size: 0.8rem; }
        .editor-content { min-height: 300px; padding: 0.8rem; outline: none; overflow-y: auto; background: white; font-size: 0.9rem; line-height: 1.5; }
        .color-picker { width: 26px; height: 26px; padding: 0; border: none; cursor: pointer; }

        /* ëª¨ë‹¬ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 800px; border-radius: 8px; padding: 1.5rem; max-height: 90vh; overflow-y: auto; }

        /* ë°°ì§€ ë° ê¸°íƒ€ */
        .tab-btn-group { display: flex; gap: 0.4rem; margin-bottom: 0.8rem; border-bottom: 1px solid #eee; padding-bottom: 0.8rem; }
        .badge { padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 3px; }
        .badge-blue { background: #e3f2fd; color: #1565c0; }
        .badge-green { background: #e8f5e9; color: #2e7d32; }
        .badge-red { background: #ffebee; color: #c62828; }
        .badge-gray { background: #f1f3f5; color: #495057; }
        .badge-warning { background: var(--warning-bg); color: var(--warning-text); }
        .badge-point { background: #fff8e1; color: #f57f17; border: 1px solid #ffecb3; }
        .badge-purple { background: #f3e5f5; color: #7b1fa2; }
        .password-display { font-family: monospace; background: #f8f9fa; padding: 2px 6px; border-radius: 3px; border: 1px solid #dee2e6; color: #d63384; font-weight: bold; font-size: 0.85rem; }
        .status-card { display: flex; align-items: center; gap: 0.8rem; background: #fff; padding: 1.2rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; }
        .status-card div div:first-child { font-size: 0.85rem; }
        .status-card div div:last-child { font-size: 1.3rem; }
    </style>
</head>
<body>

    <!-- ì‚¬ì´ë“œë°” -->
    <nav class="sidebar">
        <a href="#" class="logo"><i class="ph ph-briefcase-metal"></i> Fin.Master</a>
        <ul class="nav-menu">
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link active" data-tab="dashboard" onclick="switchTab('dashboard')"><i class="ph ph-squares-four"></i> ëŒ€ì‹œë³´ë“œ</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="users" onclick="switchTab('users')"><i class="ph ph-users"></i> íšŒì› ê´€ë¦¬</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="payment" onclick="switchTab('payment')"><i class="ph ph-credit-card"></i> ê²°ì œÂ·í¬ì¸íŠ¸</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="prompts" onclick="switchTab('prompts')"><i class="ph ph-robot"></i> AI í”„ë¡¬í”„íŠ¸</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="suggestions" onclick="switchTab('suggestions')"><i class="ph ph-mailbox"></i> ì œì•ˆ/ê±´ì˜</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="notices" onclick="switchTab('notices')"><i class="ph ph-megaphone"></i> ê³µì§€ì‚¬í•­</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="admins" onclick="switchTab('admins')"><i class="ph ph-user-gear"></i> ê´€ë¦¬ì ê´€ë¦¬</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="terms" onclick="switchTab('terms')"><i class="ph ph-scroll"></i> ì•½ê´€ ë° ì •ì±…</a></li>
            <li class="nav-item"><a href="javascript:void(0)" class="nav-link" data-tab="bizinfo-cache" onclick="switchTab('bizinfo-cache')"><i class="ph ph-database"></i> ê¸°ì—…ë§ˆë‹¹ ìºì‹œ</a></li>
        </ul>
        <div class="admin-profile">
            <i class="ph ph-user-circle" style="font-size: 2rem;"></i>
            <div><div style="font-weight: 600;">ìµœê³ ê´€ë¦¬ì</div><div style="font-size: 0.8rem; opacity: 0.7;">Online</div></div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <!-- ê³ ì • ìƒë‹¨ ë°” -->
        <div class="top-bar">
            <div class="top-bar-date"><i class="ph ph-calendar"></i> <span id="topBarDate"></span></div>
            <div class="top-bar-buttons">
                <button class="btn btn-secondary" onclick="location.href='index.html'"><i class="ph ph-house"></i> ë©”ì¸</button>
                <button class="btn btn-danger" onclick="logout()"><i class="ph ph-sign-out"></i> ë¡œê·¸ì•„ì›ƒ</button>
                <a href="https://console.cloud.google.com/apis/api/generativelanguage.googleapis.com/metrics" target="_blank" class="btn btn-outline" style="color: #4285F4; border-color: #4285F4;"><i class="ph ph-google-logo"></i> API ì¡°íšŒ</a>
            </div>
        </div>

        <!-- 1. ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="tab-content active">
            <div class="page-header">
                <h1 class="page-title">ëŒ€ì‹œë³´ë“œ</h1>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                <div class="status-card"><div class="status-icon" style="background: #e3f2fd; color: #1565c0;"><i class="ph ph-users"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì „ì²´ íšŒì›</div><div style="font-size: 1.3rem; font-weight: 700;" id="statTotalUsers">0</div></div></div>
                <div class="status-card"><div class="status-icon" style="background: #ffebee; color: #c62828;"><i class="ph ph-warning-circle"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì‹ ê·œ ì‹ ì²­ ëŒ€ê¸°</div><div style="font-size: 1.3rem; font-weight: 700; color: var(--danger-color);" id="statPending">0</div></div></div>
                <div class="status-card"><div class="status-icon" style="background: #e8f5e9; color: #2e7d32;"><i class="ph ph-credit-card"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì´ë²ˆë‹¬ ê²°ì œì™„ë£Œ</div><div style="font-size: 1.3rem; font-weight: 700;">0ê±´</div></div></div>
                <div class="status-card"><div class="status-icon" style="background: #fff8e1; color: #f57f17;"><i class="ph ph-coins"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì´ ë°œí–‰ í¬ì¸íŠ¸</div><div style="font-size: 1.3rem; font-weight: 700;">0 P</div></div></div>
            </div>
        </div>

        <!-- 2. íšŒì› ê´€ë¦¬ -->
        <div id="users" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">íšŒì› ê´€ë¦¬</h1>
                <div class="top-buttons">
                    <button class="btn btn-primary" onclick="openRegisterModal()"><i class="ph ph-user-plus"></i> ìˆ˜ë™ íšŒì› ë“±ë¡</button>
                </div>
            </div>

            <!-- ê°€ì… ì‹ ì²­ ë‚´ì—­ (Firebase ì—°ë™) -->
            <div class="card" style="border-left: 4px solid var(--accent-color);">
                <div class="table-controls">
                    <h3>ğŸ“ ê°€ì… ì‹ ì²­ ë‚´ì—­ (ìŠ¹ì¸ ëŒ€ê¸°) - ì‹¤ì‹œê°„ ì—°ë™</h3>
                    <div style="display:flex; gap:0.5rem;">
                        <div class="search-box"><input type="text" id="pendingSearch" placeholder="ì´ë¦„, ì§€ì—­, ì—°ë½ì²˜ ê²€ìƒ‰" onkeyup="renderUsers()"></div>
                        <button class="btn btn-success btn-sm" onclick="exportTableToExcel('pendingTable', 'ê°€ì…ì‹ ì²­ë‚´ì—­')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="pendingTable">
                        <thead>
                            <tr>
                                <th>ì‹ ì²­ì¼ì‹œ</th>
                                <th>ì„±ëª…</th>
                                <th>ì†Œì†/ì§í•¨</th>
                                <th>ì§€ì—­</th>
                                <th>ì—°ë½ì²˜</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ìœ í˜•</th>
                                <th>ê°€ì…ë¹„</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="pendingTableBody"></tbody>
                    </table>
                </div>
                <div id="pendingPagination" class="pagination"></div>
            </div>
            
            <!-- ì „ì²´ íšŒì› ëª©ë¡ -->
            <div class="card">
                <div class="table-controls">
                    <h3>ì „ì²´ íšŒì› ëª©ë¡</h3>
                    <div style="display:flex; gap:0.5rem;">
                        <button class="btn btn-danger btn-sm" onclick="deleteSelectedUsers()"><i class="ph ph-trash"></i> ì„ íƒ ì‚­ì œ</button>
                        <div class="search-box"><input type="text" id="userSearch" placeholder="ì•„ì´ë””, ì´ë¦„ ê²€ìƒ‰" onkeyup="renderUsers()"></div>
                        <button class="btn btn-success btn-sm" onclick="exportTableToExcel('userTable', 'ì „ì²´íšŒì›ëª©ë¡')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="userTable">
                        <thead><tr><th style="width:40px;"><input type="checkbox" id="selectAllUsers" onchange="toggleSelectAllUsers()"></th><th>No</th><th>ì•„ì´ë””</th><th>ì„±ëª…</th><th>ë¹„ë°€ë²ˆí˜¸</th><th>ì†Œì†/ì§í•¨</th><th>ì§€ì—­</th><th>ìœ í˜•</th><th>ì—°ë½ì²˜/ë©”ì¼</th><th>ê°€ì…ë¹„</th><th>ì›” ê²°ì œì•¡</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
                <div id="userPagination" class="pagination"></div>
            </div>
        </div>

        <!-- 3. ê²°ì œ ë° í¬ì¸íŠ¸ ê´€ë¦¬ -->
        <div id="payment" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">ê²°ì œ ë° í¬ì¸íŠ¸ ê´€ë¦¬</h1>
                <button class="btn btn-secondary" onclick="runBatchSimulation()"><i class="ph ph-play-circle"></i> ì •ê¸° ê²°ì œ ì¼ê´„ ì‹¤í–‰</button>
            </div>

            <div class="sub-nav">
                <div class="sub-nav-item active" onclick="switchSubTab(this, 'payment-status-view')">ê²°ì œ í˜„í™© ë° ì´ë ¥</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-points-view')">í¬ì¸íŠ¸ ì´ìš© ë‚´ì—­</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-usage_analysis-view')">í¬ì¸íŠ¸ ì‚¬ìš© ë¶„ì„</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-expiration-view')">í¬ì¸íŠ¸ ì†Œë©¸ ê´€ë¦¬</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-unpaid-view')">ë¯¸ê²°ì œ/ì—°ì²´ ê´€ë¦¬</div>
            </div>

            <div id="payment-status-view" class="sub-tab-content active">
                <div class="card">
                    <div class="table-controls">
                        <h3>ğŸ’³ ì´ë²ˆë‹¬ ê²°ì œ í˜„í™©</h3>
                        <div style="display:flex; gap:0.5rem;">
                            <div class="search-box"><input type="text" id="paymentSearch" placeholder="ê²€ìƒ‰..." onkeyup="renderPaymentHistory()"></div>
                            <button class="btn btn-success btn-sm" onclick="exportTableToExcel('paymentTable', 'ê²°ì œí˜„í™©')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                        </div>
                    </div>
                    <div class="table-container"><table id="paymentTable"><thead><tr><th>ê²°ì œì¼ì‹œ</th><th>ì•„ì´ë””</th><th>ì„±ëª…</th><th>ê²°ì œ ê¸ˆì•¡</th><th>ìœ í˜•</th><th>ê²°ê³¼</th></tr></thead><tbody id="paymentHistoryBody"></tbody></table></div>
                    <div id="paymentPagination" class="pagination"></div>
                </div>
            </div>
            
            <div id="payment-points-view" class="sub-tab-content">
                <div class="card">
                    <div class="table-controls">
                        <h3>ğŸ“Š í¬ì¸íŠ¸ ë¡œê·¸</h3>
                        <div style="display:flex; gap:0.5rem;">
                            <div class="search-box"><input type="text" id="pointSearch" placeholder="ê²€ìƒ‰..." onkeyup="renderPointLogs()"></div>
                            <button class="btn btn-success btn-sm" onclick="exportTableToExcel('pointTable', 'í¬ì¸íŠ¸ë¡œê·¸')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                        </div>
                    </div>
                    <div class="table-container"><table id="pointTable"><thead><tr><th>ì¼ì‹œ</th><th>ì•„ì´ë””</th><th>ì„±ëª…</th><th>êµ¬ë¶„</th><th>ë‚´ìš©</th><th>ë³€ë™</th><th>ì”ì•¡</th></tr></thead><tbody id="pointLogsBody"></tbody></table></div>
                    <div id="pointPagination" class="pagination"></div>
                </div>
            </div>
            
            <div id="payment-usage_analysis-view" class="sub-tab-content">
                <div class="card">
                    <div class="table-controls">
                        <h3>ğŸ“ˆ í¬ì¸íŠ¸ ì‚¬ìš© ë¶„ì„</h3>
                        <button class="btn btn-success btn-sm" onclick="exportTableToExcel('usageTable', 'ì‚¬ìš©ë¶„ì„')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                    </div>
                    <div class="table-container"><table id="usageTable" style="text-align: center;"><thead><tr><th rowspan="2">íšŒì›ì •ë³´</th><th rowspan="2">ëŒ€ìƒ ì›”</th><th colspan="2" style="background:#e3f2fd">ìš”ì•½ë¶„ì„(500P)</th><th colspan="2" style="background:#e8f5e9">ìƒì„¸ë¶„ì„(2000P)</th><th rowspan="2">ì´ í¬ì¸íŠ¸</th></tr><tr><th>íšŸìˆ˜</th><th>ì°¨ê°ì•¡</th><th>íšŸìˆ˜</th><th>ì°¨ê°ì•¡</th></tr></thead><tbody id="usageStatsBody"></tbody></table></div>
                </div>
            </div>
            <div id="payment-expiration-view" class="sub-tab-content"><div class="card"><p>ì†Œë©¸ ì˜ˆì • ëª©ë¡ (ì¤€ë¹„ì¤‘)</p></div></div>
            <div id="payment-unpaid-view" class="sub-tab-content"><div class="card"><p>ë¯¸ê²°ì œ íšŒì› ëª©ë¡ (ì¤€ë¹„ì¤‘)</p></div></div>
        </div>

        <!-- 4. í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ íƒ­ -->
        <div id="prompts" class="tab-content">
            <div class="page-header"><h1 class="page-title">AI í”„ë¡¬í”„íŠ¸ ê´€ë¦¬</h1></div>
            <div class="sub-nav">
                <div class="sub-nav-item active" onclick="switchSubTab(this, 'prompt-company')">ê¸°ì—…ë§ˆë‹¹</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'prompt-ceo')">CEO Focus</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'prompt-guarantee')">ë³´ì¥ë¶„ì„</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'prompt-ff')">FF</div>
            </div>
            <div id="prompt-company" class="sub-tab-content active">
                <div class="card">
                    <h3>ğŸ­ ê¸°ì—…ë§ˆë‹¹</h3>
                    <div class="form-group">
                        <textarea id="promptCompanyText" class="form-control" style="min-height: 400px; font-family: monospace;" placeholder="ê¸°ì—…ë§ˆë‹¹ AI í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="savePrompt('company')"><i class="ph ph-floppy-disk"></i> ì €ì¥</button>
                </div>
            </div>
            <div id="prompt-ceo" class="sub-tab-content">
                <div class="card">
                    <h3>ğŸ‘” CEO Focus</h3>
                    <div class="form-group">
                        <textarea id="promptCeoText" class="form-control" style="min-height: 400px; font-family: monospace;" placeholder="CEO Focus AI í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="savePrompt('ceo')"><i class="ph ph-floppy-disk"></i> ì €ì¥</button>
                </div>
            </div>
            <div id="prompt-guarantee" class="sub-tab-content">
                <div class="card">
                    <h3>ğŸ›¡ï¸ ë³´ì¥ë¶„ì„</h3>
                    <div class="form-group">
                        <textarea id="promptGuaranteeText" class="form-control" style="min-height: 400px; font-family: monospace;" placeholder="ë³´ì¥ë¶„ì„ AI í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="savePrompt('guarantee')"><i class="ph ph-floppy-disk"></i> ì €ì¥</button>
                </div>
            </div>
            <div id="prompt-ff" class="sub-tab-content">
                <div class="card">
                    <h3>ğŸ“Š FF (Fact Finding)</h3>
                    <div class="form-group">
                        <textarea id="promptFfText" class="form-control" style="min-height: 400px; font-family: monospace;" placeholder="FF AI í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="savePrompt('ff')"><i class="ph ph-floppy-disk"></i> ì €ì¥</button>
                </div>
            </div>
        </div>

        <!-- 5. ì œì•ˆ/ê±´ì˜ -->
        <div id="suggestions" class="tab-content">
            <div class="page-header"><h1 class="page-title">ì œì•ˆ / ê±´ì˜ì‚¬í•­</h1></div>
            <div class="card">
                <div class="table-controls"><h3>ëª©ë¡</h3><button class="btn btn-success btn-sm" onclick="exportTableToExcel('suggestTable', 'ì œì•ˆê±´ì˜')">ì—‘ì…€</button></div>
                <div class="table-container"><table id="suggestTable"><thead><tr><th>No</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ì‘ì„±ì¼</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead><tbody id="suggestionTableBody"></tbody></table></div>
                <div id="suggestionPagination" class="pagination"></div>
            </div>
        </div>

        <!-- 6. ê³µì§€ì‚¬í•­ -->
        <div id="notices" class="tab-content">
            <div class="page-header"><h1 class="page-title">ê³µì§€ì‚¬í•­ ê´€ë¦¬</h1><button class="btn btn-primary" onclick="openNoticeModal()"><i class="ph ph-plus"></i> ìƒˆ ê³µì§€ ë“±ë¡</button></div>
            <div class="card">
                <div class="table-controls"><h3>ë“±ë¡ëœ ê³µì§€ì‚¬í•­</h3><div class="search-box"><input type="text" id="noticeSearch" placeholder="ì œëª© ê²€ìƒ‰" onkeyup="renderNotices()"></div></div>
                <div class="table-container"><table id="noticeTable"><thead><tr><th style="width: 50px;">No</th><th>ì œëª©</th><th>ë“±ë¡ì¼ì</th><th>ì²¨ë¶€íŒŒì¼</th><th>ê´€ë¦¬</th></tr></thead><tbody id="noticeTableBody"></tbody></table></div>
                <div id="noticePagination" class="pagination"></div>
            </div>
        </div>

        <!-- 7. ê´€ë¦¬ì ê´€ë¦¬ -->
        <div id="admins" class="tab-content">
            <div class="page-header"><h1 class="page-title">ê´€ë¦¬ì ê³„ì • ê´€ë¦¬</h1><button class="btn btn-primary" onclick="openAdminModal()"><i class="ph ph-plus"></i> ì¶”ê°€</button></div>
            <div class="card">
                <p style="margin-bottom:1rem; color:#666; font-size:0.9rem;">âš ï¸ ê´€ë¦¬ì ê³„ì •ì€ ëª¨ë“  í”„ë¡œê·¸ë¨ì„ ë¬´ë£Œ/ë¬´ì œí•œìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="table-container"><table><thead><tr><th>ì•„ì´ë””</th><th>ì´ë¦„</th><th>ê¶Œí•œ</th><th>ë¹„ë°€ë²ˆí˜¸</th><th style="width:120px;">ê´€ë¦¬</th></tr></thead><tbody id="adminTableBody"></tbody></table></div>
            </div>
        </div>

        <!-- 8. ì•½ê´€ -->
        <div id="terms" class="tab-content">
            <div class="page-header"><h1 class="page-title">ì•½ê´€ ë° ì •ì±… ê´€ë¦¬</h1></div>
            <div class="card">
                <div class="tab-btn-group"><button class="btn btn-primary active" id="btn-term-service" onclick="loadTerm('service')">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</button><button class="btn btn-outline" id="btn-term-privacy" onclick="loadTerm('privacy')">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</button><button class="btn btn-outline" id="btn-term-marketing" onclick="loadTerm('marketing')">ë§ˆì¼€íŒ… ìˆ˜ì‹ ë™ì˜</button></div>
                <div class="form-group"><textarea class="form-control" id="termEditor" style="min-height: 500px; font-family: monospace; line-height: 1.6;"></textarea></div>
                <button class="btn btn-primary" onclick="saveTerms()">ì €ì¥</button>
            </div>
        </div>

        <!-- ê¸°ì—…ë§ˆë‹¹ ìºì‹œ ê´€ë¦¬ -->
        <div id="bizinfo-cache" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">ê¸°ì—…ë§ˆë‹¹ ìºì‹œ ê´€ë¦¬</h1>
                <div class="top-buttons">
                    <button class="btn btn-outline" onclick="refreshCacheStatus()"><i class="ph ph-arrows-clockwise"></i> ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>
            
            <!-- ìºì‹œ ìƒíƒœ ì¹´ë“œ -->
            <div class="card">
                <h3 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="ph ph-chart-bar"></i> ìºì‹œ í˜„í™©</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="background: #e8f5e9; padding: 1.2rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: 700; color: #27ae60;" id="cache-total-count">-</div>
                        <div style="font-size: 0.85rem; color: #666;">ì €ì¥ëœ ê³µê³  ìˆ˜</div>
                    </div>
                    <div style="background: #e3f2fd; padding: 1.2rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1rem; font-weight: 600; color: #1976d2;" id="cache-last-updated">-</div>
                        <div style="font-size: 0.85rem; color: #666;">ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì‹œê°„</div>
                    </div>
                    <div style="background: #fff3e0; padding: 1.2rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1rem; font-weight: 600; color: #f57c00;" id="cache-triggered-by">-</div>
                        <div style="font-size: 0.85rem; color: #666;">ìˆ˜ì§‘ ë°©ì‹</div>
                    </div>
                </div>
            </div>
            
            <!-- ì•¡ì…˜ ë²„íŠ¼ ì¹´ë“œ -->
            <div class="card">
                <h3 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="ph ph-gear"></i> ìºì‹œ ê´€ë¦¬</h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="manualFetchBizinfo()" id="btn-manual-fetch">
                        <i class="ph ph-cloud-arrow-down"></i> ìˆ˜ë™ ìˆ˜ì§‘ ì‹¤í–‰
                    </button>
                    <button class="btn btn-success" onclick="downloadCacheExcel()" id="btn-download-excel" style="background: #27ae60;">
                        <i class="ph ph-microsoft-excel-logo"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                    </button>
                    <button class="btn" onclick="deleteClosedPrograms()" id="btn-delete-closed" style="background: #fd7e14; color: white;">
                        <i class="ph ph-trash"></i> ë§ˆê° ê³µê³  ì‚­ì œ
                    </button>
                    <button class="btn" onclick="deleteAllPrograms()" id="btn-delete-all" style="background: #e74c3c; color: white;">
                        <i class="ph ph-trash"></i> ì „ì²´ ê³µê³  ì‚­ì œ
                    </button>
                </div>
                <p style="margin-top: 1rem; font-size: 0.85rem; color: #666;">
                    <i class="ph ph-info"></i> ìë™ ìˆ˜ì§‘ì€ 1ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰ë©ë‹ˆë‹¤. ìˆ˜ë™ ìˆ˜ì§‘ì€ ì¦‰ì‹œ ê¸°ì—…ë§ˆë‹¹ì—ì„œ ìµœì‹  ê³µê³ ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
                </p>
            </div>
            
            <!-- ìˆ˜ì§‘ ë¡œê·¸ -->
            <div class="card">
                <h3 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="ph ph-list-bullets"></i> ìµœê·¼ ì‘ì—… ë¡œê·¸</h3>
                <div id="cache-log" style="background: #f8f9fa; padding: 1rem; border-radius: 6px; font-family: monospace; font-size: 0.85rem; max-height: 150px; overflow-y: auto;">
                    <div style="color: #666;">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ ìˆ˜ì§‘ì„ ì‹¤í–‰í•´ë³´ì„¸ìš”.</div>
                </div>
            </div>
            
            <!-- ê³µê³  ëª©ë¡ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; flex-wrap: wrap; gap: 0.5rem;">
                    <h3 style="color: var(--primary-color); margin: 0;"><i class="ph ph-list-dashes"></i> ê³µê³  ëª©ë¡</h3>
                    <button class="btn btn-outline" onclick="loadCachePrograms()" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;"><i class="ph ph-arrows-clockwise"></i> ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <!-- ê²€ìƒ‰ í•„í„° ì˜ì—­ -->
                <div style="background: #f8f9fa; padding: 0.8rem; border-radius: 6px; margin-bottom: 1rem;">
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
                        <input type="text" id="cache-search" placeholder="ğŸ” í†µí•©ê²€ìƒ‰ (ê³µê³ ëª…, ê¸°ê´€, ë‚´ìš©)" oninput="filterCachePrograms()" style="padding: 0.4rem 0.8rem; border-radius: 4px; border: 1px solid #ddd; font-size: 0.85rem; flex: 1; min-width: 200px;">
                        <select id="cache-category-filter" onchange="filterCachePrograms()" style="padding: 0.4rem; border-radius: 4px; border: 1px solid #ddd; font-size: 0.85rem;">
                            <option value="">ì „ì²´ ë¶„ì•¼</option>
                        </select>
                        <select id="cache-org-filter" onchange="filterCachePrograms()" style="padding: 0.4rem; border-radius: 4px; border: 1px solid #ddd; font-size: 0.85rem;">
                            <option value="">ì „ì²´ ê¸°ê´€</option>
                        </select>
                        <select id="cache-status-filter" onchange="filterCachePrograms()" style="padding: 0.4rem; border-radius: 4px; border: 1px solid #ddd; font-size: 0.85rem;">
                            <option value="">ì „ì²´ ìƒíƒœ</option>
                            <option value="open">ì ‘ìˆ˜ì¤‘</option>
                            <option value="closed">ë§ˆê°</option>
                        </select>
                        <button class="btn btn-outline" onclick="resetCacheFilters()" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">ì´ˆê¸°í™”</button>
                    </div>
                    <div id="cache-filter-info" style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;"></div>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table" id="cache-programs-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">No</th>
                                <th style="min-width: 250px;">ê³µê³ ëª…</th>
                                <th style="width: 120px;">ì£¼ê´€ê¸°ê´€</th>
                                <th style="width: 120px;">ìˆ˜í–‰ê¸°ê´€</th>
                                <th style="width: 80px;">ì§€ì›ë¶„ì•¼</th>
                                <th style="width: 130px;">ì‹ ì²­ê¸°ê°„</th>
                                <th style="width: 90px;">ë“±ë¡ì¼</th>
                                <th style="width: 50px;">ğŸ“„</th>
                                <th style="width: 70px;">ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody id="cache-programs-tbody">
                            <tr><td colspan="9" style="text-align: center; color: #999; padding: 2rem;">ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ìœ„ì˜ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="cache-pagination" style="margin-top: 1rem; display: flex; justify-content: center; gap: 0.5rem; flex-wrap: wrap; align-items: center;"></div>
            </div>
        </div>
    </main>
    
    <!-- ëª¨ë‹¬: ê³µê³  ìƒì„¸ë³´ê¸° -->
    <div id="programDetailModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                <h3 style="margin: 0; color: var(--primary-color);"><i class="ph ph-file-text"></i> ê³µê³  ìƒì„¸ì •ë³´</h3>
                <button onclick="document.getElementById('programDetailModal').style.display='none'" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</button>
            </div>
            <div id="programDetailContent" style="max-height: 70vh; overflow-y: auto;">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
            <div style="margin-top: 1.5rem; display: flex; gap: 0.5rem; justify-content: flex-end;">
                <button class="btn btn-outline" onclick="document.getElementById('programDetailModal').style.display='none'">ë‹«ê¸°</button>
                <a id="programDetailLink" href="#" target="_blank" class="btn btn-primary"><i class="ph ph-arrow-square-out"></i> ìƒì„¸í˜ì´ì§€ ë°”ë¡œê°€ê¸°</a>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ID ë°œê¸‰ ë° ê°€ì… ìŠ¹ì¸ (ìˆ˜ì •ë¨) -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ‘¥ íšŒì› ìŠ¹ì¸ ë° ID ë°œê¸‰</h3>
            <p style="font-size:0.9rem; color:#666; margin-bottom:1rem;">ì‹ ì²­ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ID/ë¹„ë°€ë²ˆí˜¸ ë° ê¶Œí•œì„ ì„¤ì •í•˜ì„¸ìš”.</p>
            <form id="registerForm">
                <!-- ì‹ ì²­ ì •ë³´ (Read-Only: ë ˆì´ì•„ì›ƒ ë™ê¸°í™”) -->
                <div style="background:#f8f9fa; padding:1rem; border-radius:6px; margin-bottom:1rem; border:1px solid #eee;">
                    <h4 style="margin-bottom:0.5rem; font-size:0.9rem; color:var(--primary-color);">[ì‹ ì²­ì ì •ë³´]</h4>
                    <div class="form-row">
                        <div class="form-group"><label>ì„±ëª…</label><input type="text" id="newUserName" class="form-control" readonly style="background:white"></div>
                        <div class="form-group"><label>ì†Œì†ì‚¬</label><input type="text" id="newUserCompany" class="form-control" readonly style="background:white"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>ì§í•¨</label><input type="text" id="newUserTitle" class="form-control" readonly style="background:white"></div>
                        <div class="form-group"><label>ì§€ì—­</label><input type="text" id="newUserRegion" class="form-control" readonly style="background:white"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>ì—°ë½ì²˜</label><input type="text" id="newUserPhone" class="form-control" readonly style="background:white"></div>
                        <div class="form-group"><label>ì´ë©”ì¼</label><input type="text" id="newUserEmail" class="form-control" readonly style="background:white"></div>
                    </div>
                </div>

                <!-- ê´€ë¦¬ì ì„¤ì • -->
                <div style="padding:1rem; border:1px solid #dee2e6; border-radius:6px;">
                    <h4 style="margin-bottom:0.5rem; font-size:0.9rem; color:var(--accent-color);">[ê´€ë¦¬ì ì„¤ì •]</h4>
                    <div class="form-row"><div class="form-group"><label>ì•„ì´ë”” (ìƒì„±)</label><input type="text" id="newUserId" class="form-control" placeholder="ì˜ˆ: FP2025001" required></div><div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)</label><input type="text" id="newUserPw" class="form-control" value="123456" required minlength="6"></div></div>
                    <div class="form-row">
                        <div class="form-group"><label>íšŒì› ìœ í˜•</label><select id="newUserType" class="form-control"><option value="inner">ì´ë„ˆ</option><option value="branch">ì§€ì‚¬ì¥</option><option value="consultant_home">ì»¨í™ˆ</option><option value="non_member">ë¹„íšŒì›</option></select></div>
                        <div class="form-group"><label>ê°€ì…ë¹„</label><select id="regFeeStatus" class="form-control"><option value="unpaid" selected style="color:red;">ë¯¸ì…ê¸ˆ</option><option value="paid" style="color:green;">ì…ê¸ˆì™„ë£Œ</option></select></div>
                    </div>
                    <div class="form-group"><label>ì›” ê²°ì œì•¡</label><input type="number" id="newUserFee" class="form-control" value="10000"></div>
                </div>
                <div class="flex-between" style="margin-top:1rem;"><button type="button" class="btn btn-outline" onclick="document.getElementById('registerModal').style.display='none'">ì·¨ì†Œ</button><button type="submit" class="btn btn-primary">ìŠ¹ì¸ ë° ìƒì„±</button></div>
            </form>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ê³µì§€ì‚¬í•­ ë“±ë¡/ìˆ˜ì • -->
    <div id="noticeModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="noticeModalTitle">ğŸ“¢ ìƒˆ ê³µì§€ ë“±ë¡</h3>
            <form id="noticeForm">
                <input type="hidden" id="noticeDocId">
                <div class="form-group">
                    <label>ì œëª© *</label>
                    <input type="text" id="noticeTitle" class="form-control" placeholder="ê³µì§€ì‚¬í•­ ì œëª©" required>
                </div>
                <div class="form-group">
                    <label>ë‚´ìš© *</label>
                    <textarea id="noticeContent" class="form-control" style="min-height: 200px;" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                </div>
                <div class="form-group">
                    <label>ì²¨ë¶€íŒŒì¼ URL (ì„ íƒ)</label>
                    <input type="text" id="noticeFileUrl" class="form-control" placeholder="https://...">
                </div>
                <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:1rem;">
                    <button type="button" class="btn btn-outline" onclick="closeNoticeModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary"><i class="ph ph-floppy-disk"></i> ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ê´€ë¦¬ì ì¶”ê°€ -->
    <div id="adminModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>ğŸ” ê´€ë¦¬ì ê³„ì • ì¶”ê°€</h3>
            <p style="font-size:0.85rem; color:#666; margin-bottom:1rem;">ê´€ë¦¬ì ê³„ì •ì€ ëª¨ë“  í”„ë¡œê·¸ë¨ì„ <b style="color:#27ae60;">ë¬´ë£Œ/ë¬´ì œí•œ</b>ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <form id="adminForm">
                <div class="form-group">
                    <label>ì•„ì´ë”” *</label>
                    <input type="text" id="adminUserId" class="form-control" placeholder="ê´€ë¦¬ì ì•„ì´ë””" required>
                </div>
                <div class="form-group">
                    <label>ì´ë¦„ *</label>
                    <input type="text" id="adminUserName" class="form-control" placeholder="ê´€ë¦¬ì ì´ë¦„" required>
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸ * (6ì ì´ìƒ)</label>
                    <input type="text" id="adminUserPw" class="form-control" value="admin123" required minlength="6">
                </div>
                <div class="form-group">
                    <label>ê¶Œí•œ</label>
                    <select id="adminRole" class="form-control">
                        <option value="super_admin">ìµœê³ ê´€ë¦¬ì</option>
                        <option value="admin">ì¼ë°˜ê´€ë¦¬ì</option>
                    </select>
                </div>
                <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:1rem;">
                    <button type="button" class="btn btn-outline" onclick="closeAdminModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary"><i class="ph ph-user-plus"></i> ìƒì„±</button>
                </div>
            </form>
        </div>
    </div>

    <!-- â˜… íšŒì› ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="userEditModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3><i class="ph ph-user-gear"></i> íšŒì› ì •ë³´ ìˆ˜ì •</h3>
            <form id="userEditForm">
                <input type="hidden" id="editUserId">
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <!-- ì™¼ìª½ ì»¬ëŸ¼ -->
                    <div>
                        <div class="form-group">
                            <label>ì•„ì´ë””</label>
                            <input type="text" id="editUserLoginId" class="form-control" readonly style="background:#f5f5f5;">
                        </div>
                        <div class="form-group">
                            <label>ì´ë¦„ *</label>
                            <input type="text" id="editUserName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸</label>
                            <div style="display:flex; gap:0.5rem;">
                                <input type="text" id="editUserPassword" class="form-control" placeholder="ë³€ê²½ ì‹œ ì…ë ¥ (6ì ì´ìƒ)">
                                <button type="button" class="btn btn-sm btn-outline" onclick="resetEditPassword()">ì´ˆê¸°í™”</button>
                            </div>
                            <small style="color:#888;">ë¹„ì›Œë‘ë©´ ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ ìœ ì§€</small>
                        </div>
                        <div class="form-group">
                            <label>ì—°ë½ì²˜</label>
                            <input type="text" id="editUserPhone" class="form-control" placeholder="010-0000-0000">
                        </div>
                        <div class="form-group">
                            <label>ì´ë©”ì¼</label>
                            <input type="email" id="editUserEmail" class="form-control" placeholder="email@example.com">
                        </div>
                    </div>
                    
                    <!-- ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ -->
                    <div>
                        <div class="form-group">
                            <label>ì†Œì†</label>
                            <input type="text" id="editUserCompany" class="form-control" placeholder="íšŒì‚¬/ì†Œì†">
                        </div>
                        <div class="form-group">
                            <label>ì§í•¨</label>
                            <input type="text" id="editUserJobTitle" class="form-control" placeholder="ì§í•¨/ì§ì±…">
                        </div>
                        <div class="form-group">
                            <label>ì§€ì—­</label>
                            <select id="editUserRegion" class="form-control">
                                <option value="">ì„ íƒ</option>
                                <option value="ì„œìš¸">ì„œìš¸</option>
                                <option value="ê²½ê¸°">ê²½ê¸°</option>
                                <option value="ì¸ì²œ">ì¸ì²œ</option>
                                <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                                <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                                <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                                <option value="ëŒ€ì „">ëŒ€ì „</option>
                                <option value="ìš¸ì‚°">ìš¸ì‚°</option>
                                <option value="ì„¸ì¢…">ì„¸ì¢…</option>
                                <option value="ê°•ì›">ê°•ì›</option>
                                <option value="ì¶©ë¶">ì¶©ë¶</option>
                                <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                                <option value="ì „ë¶">ì „ë¶</option>
                                <option value="ì „ë‚¨">ì „ë‚¨</option>
                                <option value="ê²½ë¶">ê²½ë¶</option>
                                <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                                <option value="ì œì£¼">ì œì£¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>íšŒì› ìœ í˜•</label>
                            <select id="editUserType" class="form-control">
                                <option value="ì§€ì‚¬">ì§€ì‚¬</option>
                                <option value="ì´ë„ˆ">ì´ë„ˆ</option>
                                <option value="ì»¨í™ˆ">ì»¨í™ˆ</option>
                                <option value="ë¹„íšŒì›">ë¹„íšŒì›</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ìƒíƒœ</label>
                            <select id="editUserStatus" class="form-control">
                                <option value="active">í™œì„±</option>
                                <option value="inactive">ë¹„í™œì„±</option>
                                <option value="suspended">ì •ì§€</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- í•˜ë‹¨ ê²°ì œ ì •ë³´ -->
                <div style="border-top: 1px solid #eee; padding-top: 1rem; margin-top: 1rem;">
                    <h4 style="font-size: 0.95rem; margin-bottom: 0.8rem;"><i class="ph ph-credit-card"></i> ê²°ì œ ì •ë³´</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>ê°€ì…ë¹„ ìƒíƒœ</label>
                            <select id="editRegFeeStatus" class="form-control">
                                <option value="unpaid">ë¯¸ë‚©</option>
                                <option value="paid">ë‚©ë¶€</option>
                                <option value="exempt">ë©´ì œ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì›” ê²°ì œì•¡</label>
                            <input type="number" id="editMonthlyFee" class="form-control" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>ë³´ìœ  í¬ì¸íŠ¸</label>
                            <input type="number" id="editPoints" class="form-control" placeholder="0">
                        </div>
                    </div>
                </div>
                
                <div style="display:flex; gap:0.5rem; justify-content:flex-end; margin-top:1.5rem;">
                    <button type="button" class="btn btn-danger" onclick="deleteUserFromModal()" style="margin-right:auto;"><i class="ph ph-trash"></i> ì‚­ì œ</button>
                    <button type="button" class="btn btn-outline" onclick="closeUserEditModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary"><i class="ph ph-floppy-disk"></i> ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>

    <script>
        // --- 1. Firebase ì´ˆê¸°í™” ---
        const firebaseConfig = {
            apiKey: "AIzaSyDbufefZCVqCY8QQppcdQFoqVFpMriv1m0",
            authDomain: "kfpc-company-support-project.firebaseapp.com",
            databaseURL: "https://kfpc-company-support-project-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kfpc-company-support-project",
            storageBucket: "kfpc-company-support-project.firebasestorage.app",
            messagingSenderId: "101260933373",
            appId: "1:101260933373:web:3436176f9ca2560056d914"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const functions = firebase.app().functions('asia-northeast3');  // â˜… Cloud Functions ì´ˆê¸°í™” (region ì§€ì •)
        const ADMIN_SECRET = 'finmaster-admin-2024';  // â˜… ê´€ë¦¬ì ë¹„ë°€í‚¤

        // --- 2. ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ---
        function exportTableToExcel(tableId, filename = '') {
            const table = document.getElementById(tableId);
            const wb = XLSX.utils.table_to_book(table, {sheet: "Sheet1"});
            XLSX.writeFile(wb, filename ? `${filename}.xlsx` : 'data.xlsx');
        }

        // --- 3. ë„¤ë¹„ê²Œì´ì…˜ ë° ê³µí†µ ---
        function logout() { 
            sessionStorage.removeItem('adminLoggedIn');
            alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.'); 
            location.href='login.html'; 
        }

        function switchTab(tabId) {
            try {
                console.log('switchTab í˜¸ì¶œ:', tabId);
                // ëª¨ë“  nav-linkì—ì„œ active ì œê±°
                document.querySelectorAll('.nav-menu .nav-link').forEach(el => el.classList.remove('active'));
                // ëª¨ë“  tab-contentì—ì„œ active ì œê±°
                document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                // í´ë¦­í•œ ë©”ë‰´ì— active ì¶”ê°€
                const clickedLink = document.querySelector('.nav-link[data-tab="' + tabId + '"]');
                if (clickedLink) clickedLink.classList.add('active');
                // í•´ë‹¹ íƒ­ ì½˜í…ì¸  í‘œì‹œ
                const tabContent = document.getElementById(tabId);
                if (tabContent) tabContent.classList.add('active');
                
                // ê¸°ì—…ë§ˆë‹¹ ìºì‹œ íƒ­ ì§„ì… ì‹œ ìë™ ìƒíƒœ ì¡°íšŒ
                if (tabId === 'bizinfo-cache') {
                    refreshCacheStatus();
                }
            } catch(e) {
                console.error('switchTab ì˜¤ë¥˜:', e);
            }
        }
        function switchSubTab(element, viewId) {
            element.parentElement.querySelectorAll('.sub-nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            element.parentElement.parentElement.querySelectorAll('.sub-tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        // --- 4. ë°ì´í„° ë¡œì§ (Firebase ì—°ë™) ---
        let pendingApps = [];
        let users = [];
        // (ê²°ì œ/ë¡œê·¸ ë“±ì€ ì•„ì§ ë”ë¯¸ ìœ ì§€ - í•„ìš” ì‹œ DB ì—°ê²° ê°€ëŠ¥)
        let payments = [];
        let pointLogs = [];
        
        // â˜… ê´€ë¦¬ì ì¸ì¦ ì²´í¬ ë° Firebase ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function checkAdminAndInitialize() {
            try {
                // 1. sessionStorage ê´€ë¦¬ì ë¡œê·¸ì¸ ì²´í¬
                if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
                    alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    location.href = 'login.html';
                    return;
                }
                
                console.log('âœ… ê´€ë¦¬ì ì¸ì¦ í™•ì¸ë¨');
                
                // 2. Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘
                initializeFirebaseListeners();
            } catch(e) {
                console.error('checkAdminAndInitialize ì˜¤ë¥˜:', e);
            }
        }
        
        function initializeFirebaseListeners() {
            try {
                // [ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ] ê°€ì… ì‹ ì²­ ë‚´ì—­ (account_requests)
                db.collection('account_requests').orderBy('requestedAt', 'desc').onSnapshot((snapshot) => {
                    pendingApps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderUsers();
                    const statPending = document.getElementById('statPending');
                    if (statPending) statPending.innerText = pendingApps.length;
                }, (error) => {
                    console.error('account_requests ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                });

                // [ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ] íšŒì› ëª©ë¡ (users)
                db.collection('users').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                    users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderUsers();
                    const statTotalUsers = document.getElementById('statTotalUsers');
                    if (statTotalUsers) statTotalUsers.innerText = users.length;
                }, (error) => {
                    console.error('users ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                });
                
                // â˜… ì¶”ê°€ ë¦¬ìŠ¤ë„ˆë“¤
                initNoticesListener();  // ê³µì§€ì‚¬í•­
                initAdminsListener();   // ê´€ë¦¬ì
                loadPrompts();          // AI í”„ë¡¬í”„íŠ¸ ë¡œë“œ
            } catch(e) {
                console.error('initializeFirebaseListeners ì˜¤ë¥˜:', e);
            }
        }

        // --- ë Œë”ë§ í•¨ìˆ˜ (í˜ì´ì§•/ê²€ìƒ‰ í¬í•¨) ---
        const PAGE_SIZE = 15;
        const state = { users: {page:1, search:''}, pending: {page:1, search:''}, payments: {page:1, search:''}, points: {page:1, search:''} };

        function filterAndPaginate(data, stateKey) {
            const s = state[stateKey];
            const filtered = data.filter(item => { if (!s.search) return true; return Object.values(item).some(val => String(val).toLowerCase().includes(s.search.toLowerCase())); });
            const totalPages = Math.ceil(filtered.length / PAGE_SIZE) || 1;
            if (s.page > totalPages) s.page = totalPages;
            const start = (s.page - 1) * PAGE_SIZE;
            const paged = filtered.slice(start, start + PAGE_SIZE);
            return { paged, totalPages, totalCount: filtered.length };
        }

        function renderPaginationControls(containerId, stateKey, totalPages, renderFn) {
            const container = document.getElementById(containerId);
            let html = `<button class="page-btn" onclick="changePage('${stateKey}',${state[stateKey].page-1})" ${state[stateKey].page===1?'disabled':''}>Prev</button>`;
            for(let i=1; i<=totalPages; i++) { html+=`<button class="page-btn ${i===state[stateKey].page?'active':''}" onclick="changePage('${stateKey}',${i})">${i}</button>`; }
            html+=`<button class="page-btn" onclick="changePage('${stateKey}',${state[stateKey].page+1})" ${state[stateKey].page===totalPages?'disabled':''}>Next</button>`;
            container.innerHTML=html;
            window.changePage=(key,p)=>{if(p<1||p>totalPages)return; state[key].page=p; renderFn();}
        }

        function renderUsers() {
            // ì—˜ë¦¬ë¨¼íŠ¸ ì¡´ì¬ ì—¬ë¶€ ì²´í¬
            const pendingSearchEl = document.getElementById('pendingSearch');
            const userSearchEl = document.getElementById('userSearch');
            const pBody = document.getElementById('pendingTableBody');
            const uBody = document.getElementById('userTableBody');
            
            if (!pBody || !uBody) return; // ì—˜ë¦¬ë¨¼íŠ¸ê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
            
            // 1. ëŒ€ê¸°ì ëª©ë¡
            state.pending.search = pendingSearchEl ? pendingSearchEl.value : '';
            const pRes = filterAndPaginate(pendingApps, 'pending');
            
            if(pRes.totalCount === 0) pBody.innerHTML = '<tr><td colspan="9" style="text-align:center;">ëŒ€ê¸° ë‚´ì—­ ì—†ìŒ</td></tr>';
            else {
                pBody.innerHTML = pRes.paged.map(app => {
                    const dateStr = app.requestedAt ? new Date(app.requestedAt.seconds * 1000).toLocaleString() : '-';
                    return `<tr>
                        <td>${dateStr}</td>
                        <td>${app.name}</td>
                        <td>${app.company} ${app.position}</td>
                        <td>${app.region}</td>
                        <td>${app.phone}</td>
                        <td>${app.email}</td>
                        <td><span class="badge badge-gray">ë¯¸ì§€ì •</span></td>
                        <td><span class="badge badge-red">ë¯¸ì…ê¸ˆ</span></td>
                        <td><button class="btn btn-primary btn-sm" onclick="openIssueIdModal('${app.id}')">IDë°œê¸‰</button></td>
                    </tr>`;
                }).join('');
            }
            renderPaginationControls('pendingPagination', 'pending', pRes.totalPages, renderUsers);

            // 2. ì „ì²´ íšŒì› ëª©ë¡ (ê´€ë¦¬ì ì œì™¸)
            state.users.search = userSearchEl ? userSearchEl.value : '';
            
            // â˜… ê´€ë¦¬ì(admin)ëŠ” íšŒì› ëª©ë¡ì—ì„œ ì œì™¸
            const nonAdminUsers = users.filter(u => u.type !== 'admin' && u.role !== 'admin' && !u.isAdmin);
            const uRes = filterAndPaginate(nonAdminUsers, 'users');
            
            uBody.innerHTML = uRes.paged.map((u, idx) => {
                // â˜… ê°€ì…ë¹„ ìƒíƒœ (regFeeStatus ì‚¬ìš©)
                let feeBadge = '<span class="badge badge-red">ë¯¸ë‚©</span>';
                if (u.regFeeStatus === 'paid') {
                    feeBadge = '<span class="badge badge-green">ë‚©ë¶€</span>';
                } else if (u.regFeeStatus === 'exempt') {
                    feeBadge = '<span class="badge badge-gray">ë©´ì œ</span>';
                }
                
                // â˜… ìƒíƒœ í•œê¸€ í‘œì‹œ
                const statusMap = {'active': 'í™œì„±', 'inactive': 'ë¹„í™œì„±', 'suspended': 'ì •ì§€'};
                const statusText = statusMap[u.status] || u.status || '-';
                let statusBadge = '<span class="badge badge-green">' + statusText + '</span>';
                if (u.status === 'inactive') {
                    statusBadge = '<span class="badge badge-gray">' + statusText + '</span>';
                } else if (u.status === 'suspended') {
                    statusBadge = '<span class="badge badge-red">' + statusText + '</span>';
                }
                
                // â˜… ìœ í˜• í‘œì‹œ (í•œê¸€ ê·¸ëŒ€ë¡œ ë˜ëŠ” ë§¤í•‘)
                const typeDisplay = u.type || '-';
                
                const fee = u.monthlyFee ? u.monthlyFee.toLocaleString() : '0';
                
                // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ: ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ ì´ˆê¸°ê°’ ë˜ëŠ” "ë³€ê²½ë¨"
                let pwDisplay = '-';
                if (u.password) {
                    pwDisplay = `<span class="password-display">${u.password}</span>`;
                } else if (u.isPasswordChanged === false) {
                    pwDisplay = '<span class="password-display">123456</span>';
                } else {
                    pwDisplay = '<span style="color:#888; font-size:0.8rem;">ë³€ê²½ë¨</span>';
                }
                
                return `<tr>
                    <td><input type="checkbox" class="user-checkbox" value="${u.id}" data-userid="${u.userId}"></td>
                    <td>${idx+1}</td>
                    <td class="clickable-cell">${u.userId || '-'}</td>
                    <td>${u.name || '-'}</td>
                    <td>${pwDisplay}</td>
                    <td>${u.company || ''} ${u.jobTitle || ''}</td>
                    <td>${u.region || '-'}</td>
                    <td><span class="badge badge-gray">${typeDisplay}</span></td>
                    <td>${u.phone || '-'}<br><span style="color:#888;font-size:0.8rem">${u.email || '-'}</span></td>
                    <td>${feeBadge}</td>
                    <td style="font-weight:bold; color:var(--accent-color);">${fee}</td>
                    <td>${statusBadge}</td>
                    <td><button class="btn btn-outline btn-sm" onclick="openUserEditModal('${u.id}')"><i class="ph ph-pencil-simple"></i> ìˆ˜ì •</button></td>
                </tr>`;
            }).join('');
            renderPaginationControls('userPagination', 'users', uRes.totalPages, renderUsers);
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì´ˆê¸°í™”
            const selectAllEl = document.getElementById('selectAllUsers');
            if (selectAllEl) selectAllEl.checked = false;
            
            // ëŒ€ì‹œë³´ë“œ íšŒì› ìˆ˜ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì ì œì™¸)
            document.getElementById('statTotalUsers').innerText = nonAdminUsers.length;
        }

        // --- 5. ë¡œì§ í•¨ìˆ˜: ìŠ¹ì¸ ë° ë“±ë¡ ---
        function openIssueIdModal(docId) {
            const app = pendingApps.find(a => a.id === docId);
            if(!app) return;

            document.getElementById('newUserName').value = app.name;
            document.getElementById('newUserPhone').value = app.phone;
            document.getElementById('newUserEmail').value = app.email;
            document.getElementById('newUserRegion').value = app.region;
            document.getElementById('newUserCompany').value = app.company;
            document.getElementById('newUserTitle').value = app.position; // position -> title ë§¤í•‘
            
            document.getElementById('newUserId').value = ''; 
            document.getElementById('newUserPw').value = '123456';
            document.getElementById('newUserType').value = 'inner'; 
            document.getElementById('regFeeStatus').value = 'unpaid'; 
            
            document.getElementById('registerForm').dataset.docId = docId; // DB ë¬¸ì„œ ID ì €ì¥
            document.getElementById('registerModal').style.display = 'flex';
        }

        function openRegisterModal() {
            document.getElementById('registerForm').reset();
            document.querySelectorAll('#registerForm input[readonly]').forEach(el => {
                el.removeAttribute('readonly');
                el.style.background = 'white';
            });
            delete document.getElementById('registerForm').dataset.docId;
            document.getElementById('registerModal').style.display = 'flex';
        }

        document.getElementById('registerForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const docId = this.dataset.docId;
            
            const userId = document.getElementById('newUserId').value.trim();
            const password = document.getElementById('newUserPw').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!userId) {
                alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (password.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            try {
                // â˜… 1. Secondary Firebase Appìœ¼ë¡œ Auth ì‚¬ìš©ì ìƒì„± (ê´€ë¦¬ì ì„¸ì…˜ ìœ ì§€)
                const secondaryApp = firebase.initializeApp(firebaseConfig, 'Secondary');
                const secondaryAuth = secondaryApp.auth();
                
                // ì´ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (login.htmlê³¼ ë™ì¼í•œ ë°©ì‹)
                const authEmail = `${userId}@system.local`;
                
                // Firebase Authì— ì‚¬ìš©ì ìƒì„±
                const userCredential = await secondaryAuth.createUserWithEmailAndPassword(authEmail, password);
                const createdUser = userCredential.user;
                const uid = createdUser.uid;
                
                console.log('âœ… Firebase Auth ì‚¬ìš©ì ìƒì„± ì™„ë£Œ:', uid);
                
                // Secondary ì•± ë¡œê·¸ì•„ì›ƒ (ê´€ë¦¬ì ì„¸ì…˜ì— ì˜í–¥ ì—†ìŒ)
                await secondaryAuth.signOut();
                await secondaryApp.delete();
                
                // â˜… 2. Firestore users ì»¬ë ‰ì…˜ì— ì €ì¥ (UIDë¥¼ ë¬¸ì„œ IDë¡œ ì‚¬ìš©)
                const newUser = {
                    userId: userId,
                    password: password,  // â˜… ë¹„ë°€ë²ˆí˜¸ ì €ì¥ (ê´€ë¦¬ì ì¡°íšŒìš©)
                    name: document.getElementById('newUserName').value, 
                    phone: document.getElementById('newUserPhone').value,
                    email: document.getElementById('newUserEmail').value,
                    region: document.getElementById('newUserRegion').value,
                    company: document.getElementById('newUserCompany').value, 
                    jobTitle: document.getElementById('newUserTitle').value,
                    type: document.getElementById('newUserType').value, 
                    monthlyFee: parseInt(document.getElementById('newUserFee').value) || 0,
                    feeStatus: document.getElementById('regFeeStatus').value, 
                    status: 'active',
                    pointBalance: 0,
                    isPasswordChanged: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // UIDë¥¼ ë¬¸ì„œ IDë¡œ ì‚¬ìš©í•˜ì—¬ ì €ì¥ (login.htmlê³¼ ì—°ë™)
                await db.collection('users').doc(uid).set(newUser);
                console.log('âœ… Firestore users ì €ì¥ ì™„ë£Œ');

                // â˜… 3. ìŠ¹ì¸ ê±´ì´ë©´ ìš”ì²­ ë‚´ì—­ ì‚­ì œ
                if(docId) {
                    await db.collection('account_requests').doc(docId).delete();
                    console.log('âœ… account_requests ì‚­ì œ ì™„ë£Œ');
                }

                document.getElementById('registerModal').style.display='none';
                alert('âœ… íšŒì› ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì•„ì´ë””: ' + userId + '\nì„ì‹œ ë¹„ë°€ë²ˆí˜¸: ' + password + '\n\níšŒì›ì—ê²Œ ì•ˆë‚´í•´ì£¼ì„¸ìš”.');
                
            } catch(err) {
                console.error('íšŒì› ìƒì„± ì˜¤ë¥˜:', err);
                
                // Secondary App ì •ë¦¬
                try {
                    const secondaryApp = firebase.app('Secondary');
                    if (secondaryApp) {
                        await secondaryApp.auth().signOut();
                        await secondaryApp.delete();
                    }
                } catch(e) {}
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬
                let errorMsg = 'ì˜¤ë¥˜ ë°œìƒ: ' + err.message;
                if (err.code === 'auth/email-already-in-use') {
                    errorMsg = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                } else if (err.code === 'auth/weak-password') {
                    errorMsg = 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. 6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                }
                alert(errorMsg);
            }
        });

        // --- ê¸°íƒ€ ë¡œì§ (ê²°ì œ, í¬ì¸íŠ¸ ë“±ì€ ë”ë¯¸ ìœ ì§€) ---
        function renderPaymentHistory() { /* ê¸°ì¡´ ë¡œì§ ìœ ì§€ */ }
        function renderPointLogs() { /* ê¸°ì¡´ ë¡œì§ ìœ ì§€ */ }
        function runBatchSimulation() { alert('ê²°ì œ ì‹œë®¬ë ˆì´ì…˜'); }
        function loadTerm(t) { document.getElementById('termEditor').value = t + ' ë‚´ìš©...'; }
        function saveTerms() { alert('ì €ì¥ë¨'); }
        
        // â˜… ì „ì²´ ì„ íƒ/í•´ì œ
        function toggleSelectAllUsers() {
            const selectAll = document.getElementById('selectAllUsers');
            const checkboxes = document.querySelectorAll('.user-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
        }
        
        // â˜… ì„ íƒëœ íšŒì› ì‚­ì œ
        async function deleteSelectedUsers() {
            const checkboxes = document.querySelectorAll('.user-checkbox:checked');
            
            if (checkboxes.length === 0) {
                alert('ì‚­ì œí•  íšŒì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const userIds = Array.from(checkboxes).map(cb => cb.dataset.userid).join(', ');
            
            if (!confirm(`ì„ íƒí•œ ${checkboxes.length}ëª…ì˜ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëŒ€ìƒ: ${userIds}`)) return;
            if (!confirm(`âš ï¸ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;
            
            try {
                const batch = db.batch();
                
                checkboxes.forEach(cb => {
                    const docRef = db.collection('users').doc(cb.value);
                    batch.delete(docRef);
                });
                
                await batch.commit();
                
                alert(`âœ… ${checkboxes.length}ëª…ì˜ íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nâš ï¸ Firebase Auth ê³„ì •ì€ Consoleì—ì„œ ì§ì ‘ ì‚­ì œí•´ì£¼ì„¸ìš”.`);
                
                // ì „ì²´ ì„ íƒ í•´ì œ
                document.getElementById('selectAllUsers').checked = false;
                
            } catch (err) {
                console.error('ì¼ê´„ ì‚­ì œ ì˜¤ë¥˜:', err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        }
        
        // ==================== íšŒì› ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ ====================
        let currentEditUserId = null;
        
        function openUserEditModal(docId) {
            const user = users.find(u => u.id === docId);
            if (!user) {
                alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            currentEditUserId = docId;
            
            // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('editUserId').value = docId;
            document.getElementById('editUserLoginId').value = user.userId || '';
            document.getElementById('editUserName').value = user.name || '';
            document.getElementById('editUserPassword').value = ''; // ë¹„ë°€ë²ˆí˜¸ëŠ” ë¹„ì›Œë‘ 
            document.getElementById('editUserPhone').value = user.phone || '';
            document.getElementById('editUserEmail').value = user.email || '';
            document.getElementById('editUserCompany').value = user.company || '';
            document.getElementById('editUserJobTitle').value = user.jobTitle || '';
            document.getElementById('editUserRegion').value = user.region || '';
            document.getElementById('editUserType').value = user.type || 'ì´ë„ˆ';
            document.getElementById('editUserStatus').value = user.status || 'active';
            document.getElementById('editRegFeeStatus').value = user.regFeeStatus || 'unpaid';
            document.getElementById('editMonthlyFee').value = user.monthlyFee || 0;
            document.getElementById('editPoints').value = user.points || 0;
            
            // ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸ í‘œì‹œ
            let pwHint = '';
            if (user.password) {
                pwHint = `í˜„ì¬: ${user.password}`;
            } else if (user.isPasswordChanged === false) {
                pwHint = 'í˜„ì¬: 123456 (ì´ˆê¸°ê°’)';
            } else {
                pwHint = 'í˜„ì¬: ë³€ê²½ë¨';
            }
            document.getElementById('editUserPassword').placeholder = pwHint;
            
            document.getElementById('userEditModal').style.display = 'flex';
        }
        
        function closeUserEditModal() {
            document.getElementById('userEditModal').style.display = 'none';
            currentEditUserId = null;
        }
        
        function resetEditPassword() {
            document.getElementById('editUserPassword').value = '123456';
        }
        
        async function deleteUserFromModal() {
            const user = users.find(u => u.id === currentEditUserId);
            if (!user) return;
            
            if (!confirm(`âš ï¸ [${user.name}] íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;
            if (!confirm(`ë§ˆì§€ë§‰ í™•ì¸: [${user.userId}] ê³„ì •ì„ ì‚­ì œí•©ë‹ˆë‹¤.`)) return;
            
            try {
                const deleteUserFn = functions.httpsCallable('deleteUser');
                await deleteUserFn({ uid: currentEditUserId, adminSecret: ADMIN_SECRET });
                
                alert(`âœ… íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                closeUserEditModal();
            } catch (err) {
                console.error('íšŒì› ì‚­ì œ ì˜¤ë¥˜:', err);
                // í´ë°±: Firestoreë§Œ ì‚­ì œ
                try {
                    await db.collection('users').doc(currentEditUserId).delete();
                    alert(`âœ… íšŒì› ì •ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    closeUserEditModal();
                } catch (e) {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + e.message);
                }
            }
        }
        
        async function saveUserEdit(e) {
            e.preventDefault();
            
            const docId = document.getElementById('editUserId').value;
            const newPassword = document.getElementById('editUserPassword').value.trim();
            
            // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            if (newPassword && newPassword.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            try {
                // ì—…ë°ì´íŠ¸í•  ë°ì´í„° ì¤€ë¹„
                const updateData = {
                    name: document.getElementById('editUserName').value.trim(),
                    phone: document.getElementById('editUserPhone').value.trim(),
                    email: document.getElementById('editUserEmail').value.trim(),
                    company: document.getElementById('editUserCompany').value.trim(),
                    jobTitle: document.getElementById('editUserJobTitle').value.trim(),
                    region: document.getElementById('editUserRegion').value,
                    type: document.getElementById('editUserType').value,
                    status: document.getElementById('editUserStatus').value,
                    regFeeStatus: document.getElementById('editRegFeeStatus').value,
                    monthlyFee: parseInt(document.getElementById('editMonthlyFee').value) || 0,
                    points: parseInt(document.getElementById('editPoints').value) || 0,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ë˜ì—ˆìœ¼ë©´ ë³€ê²½
                if (newPassword) {
                    try {
                        const changePassword = functions.httpsCallable('changeUserPassword');
                        await changePassword({ uid: docId, newPassword: newPassword, adminSecret: ADMIN_SECRET });
                        updateData.password = newPassword;
                        updateData.isPasswordChanged = true;
                    } catch (pwErr) {
                        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', pwErr);
                        // í´ë°±: Firestoreë§Œ ì—…ë°ì´íŠ¸
                        updateData.password = newPassword;
                        updateData.isPasswordChanged = true;
                    }
                }
                
                // Firestore ì—…ë°ì´íŠ¸
                await db.collection('users').doc(docId).update(updateData);
                
                alert('âœ… íšŒì› ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeUserEditModal();
                
            } catch (err) {
                console.error('íšŒì› ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        }
        
        // â˜… íšŒì› ê´€ë¦¬ ëª¨ë‹¬ (ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ/ìˆ˜ì •, ì‚­ì œ ë“±) - ê¸°ì¡´ ìœ ì§€
        function openUserManageModal(docId) {
            const user = users.find(u => u.id === docId);
            if (!user) {
                alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ
            let pwInfo = 'ë¯¸ì €ì¥';
            if (user.password) {
                pwInfo = user.password;
            } else if (user.isPasswordChanged === false) {
                pwInfo = '123456 (ì´ˆê¸°ê°’)';
            } else {
                pwInfo = 'ë³€ê²½ë¨ (í™•ì¸ë¶ˆê°€)';
            }
            
            const action = prompt(
                `[${user.name}] íšŒì› ê´€ë¦¬\n\n` +
                `ì•„ì´ë””: ${user.userId}\n` +
                `í˜„ì¬ ë¹„ë°€ë²ˆí˜¸: ${pwInfo}\n` +
                `ì—°ë½ì²˜: ${user.phone || '-'}\n` +
                `ì´ë©”ì¼: ${user.email || '-'}\n\n` +
                `ì‹¤í–‰í•  ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”:\n` +
                `1 = ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • (ì§ì ‘ ì…ë ¥)\n` +
                `2 = ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” (123456)\n` +
                `3 = íšŒì› ì‚­ì œ\n` +
                `4 = ì·¨ì†Œ`
            );
            
            if (action === '1') {
                changeUserPassword(docId, user);
            } else if (action === '2') {
                resetUserPassword(docId, user);
            } else if (action === '3') {
                deleteUser(docId, user);
            }
        }
        
        // â˜… ë¹„ë°€ë²ˆí˜¸ ì§ì ‘ ìˆ˜ì •
        async function changeUserPassword(docId, user) {
            const newPassword = prompt(
                `[${user.name}] ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥\n\n` +
                `í˜„ì¬ ì•„ì´ë””: ${user.userId}\n` +
                `í˜„ì¬ ë¹„ë°€ë²ˆí˜¸: ${user.password || 'ë¯¸ì €ì¥'}\n\n` +
                `ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (6ì ì´ìƒ):`
            );
            
            if (!newPassword) return;
            
            if (newPassword.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`ë¹„ë°€ë²ˆí˜¸ë¥¼ "${newPassword}"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                // â˜… Cloud Function í˜¸ì¶œí•˜ì—¬ Firebase Auth + Firestore ë™ì‹œ ë³€ê²½
                const changePassword = functions.httpsCallable('changeUserPassword');
                const result = await changePassword({ uid: docId, newPassword: newPassword, adminSecret: ADMIN_SECRET });
                
                alert(`âœ… ë¹„ë°€ë²ˆí˜¸ê°€ "${newPassword}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ì œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                
            } catch (err) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', err);
                
                // Cloud Functionsê°€ ì—†ìœ¼ë©´ Firestoreë§Œ ì—…ë°ì´íŠ¸ (í´ë°±)
                if (err.code === 'functions/not-found' || err.message.includes('not found')) {
                    try {
                        await db.collection('users').doc(docId).update({
                            password: newPassword,
                            isPasswordChanged: true,
                            passwordChangedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        alert(`âš ï¸ Cloud Functionsê°€ ë°°í¬ë˜ì§€ ì•Šì•„ Firestoreë§Œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n` +
                              `ì‹¤ì œ ë¡œê·¸ì¸ì„ ìœ„í•´ Firebase Consoleì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ê±°ë‚˜,\n` +
                              `Cloud Functionsë¥¼ ë°°í¬í•´ì£¼ì„¸ìš”.`);
                    } catch (e) {
                        alert('ì˜¤ë¥˜ ë°œìƒ: ' + e.message);
                    }
                } else {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + (err.message || err));
                }
            }
        }
        
        // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
        async function resetUserPassword(docId, user) {
            if (!confirm(`[${user.name}] íšŒì›ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ 123456ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                // â˜… Cloud Function í˜¸ì¶œ
                const changePassword = functions.httpsCallable('changeUserPassword');
                await changePassword({ uid: docId, newPassword: '123456', adminSecret: ADMIN_SECRET });
                
                // isPasswordChangedë¥¼ falseë¡œ ì„¤ì • (ì²« ë¡œê·¸ì¸ ì‹œ ë³€ê²½ ìœ ë„)
                await db.collection('users').doc(docId).update({
                    isPasswordChanged: false
                });
                
                alert(`âœ… ë¹„ë°€ë²ˆí˜¸ê°€ 123456ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n\níšŒì›ì´ ë¡œê·¸ì¸ ì‹œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ ìš”ì²­ë°›ìŠµë‹ˆë‹¤.`);
                
            } catch (err) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ì˜¤ë¥˜:', err);
                
                // Cloud Functions ì—†ìœ¼ë©´ Firestoreë§Œ ì—…ë°ì´íŠ¸
                if (err.code === 'functions/not-found' || err.message.includes('not found')) {
                    try {
                        await db.collection('users').doc(docId).update({
                            password: '123456',
                            isPasswordChanged: false,
                            passwordResetAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        alert(`âš ï¸ Cloud Functionsê°€ ë°°í¬ë˜ì§€ ì•Šì•„ Firestoreë§Œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n` +
                              `ì‹¤ì œ ë¡œê·¸ì¸ì„ ìœ„í•´ Firebase Consoleì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                    } catch (e) {
                        alert('ì˜¤ë¥˜ ë°œìƒ: ' + e.message);
                    }
                } else {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + (err.message || err));
                }
            }
        }
        
        // íšŒì› ì‚­ì œ
        async function deleteUser(docId, user) {
            if (!confirm(`âš ï¸ ì •ë§ë¡œ [${user.name}] íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) return;
            if (!confirm(`ë§ˆì§€ë§‰ í™•ì¸: [${user.userId}] ê³„ì •ì„ ì‚­ì œí•©ë‹ˆë‹¤.`)) return;
            
            try {
                // â˜… Cloud Function í˜¸ì¶œ (Firebase Auth + Firestore ë™ì‹œ ì‚­ì œ)
                const deleteUserFn = functions.httpsCallable('deleteUser');
                await deleteUserFn({ uid: docId, adminSecret: ADMIN_SECRET });
                
                alert(`âœ… íšŒì›ì´ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                      
            } catch (err) {
                console.error('íšŒì› ì‚­ì œ ì˜¤ë¥˜:', err);
                
                // Cloud Functions ì—†ìœ¼ë©´ Firestoreë§Œ ì‚­ì œ
                if (err.code === 'functions/not-found' || err.message.includes('not found')) {
                    try {
                        await db.collection('users').doc(docId).delete();
                        alert(`âš ï¸ Cloud Functionsê°€ ë°°í¬ë˜ì§€ ì•Šì•„ Firestoreë§Œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n` +
                              `Firebase Auth ê³„ì •ì€ Consoleì—ì„œ ì§ì ‘ ì‚­ì œí•´ì£¼ì„¸ìš”.`);
                    } catch (e) {
                        alert('ì˜¤ë¥˜ ë°œìƒ: ' + e.message);
                    }
                } else {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + (err.message || err));
                }
            }
        }

        // ==================== AI í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ====================
        let prompts = {};
        
        // í”„ë¡¬í”„íŠ¸ ë¡œë“œ
        async function loadPrompts() {
            try {
                const doc = await db.collection('settings').doc('prompts').get();
                if (doc.exists) {
                    prompts = doc.data();
                    document.getElementById('promptCompanyText').value = prompts.company || '';
                    document.getElementById('promptCeoText').value = prompts.ceo || '';
                    document.getElementById('promptGuaranteeText').value = prompts.guarantee || '';
                    document.getElementById('promptFfText').value = prompts.ff || '';
                }
            } catch (err) {
                console.error('í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', err);
            }
        }
        
        // í”„ë¡¬í”„íŠ¸ ì €ì¥
        async function savePrompt(type) {
            const textareaId = {
                'company': 'promptCompanyText',
                'ceo': 'promptCeoText',
                'guarantee': 'promptGuaranteeText',
                'ff': 'promptFfText'
            };
            
            const content = document.getElementById(textareaId[type]).value;
            
            try {
                await db.collection('settings').doc('prompts').set({
                    ...prompts,
                    [type]: content,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                prompts[type] = content;
                alert('âœ… í”„ë¡¬í”„íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (err) {
                console.error('í”„ë¡¬í”„íŠ¸ ì €ì¥ ì˜¤ë¥˜:', err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        }

        // ==================== ê³µì§€ì‚¬í•­ ê´€ë¦¬ ====================
        let notices = [];
        
        // ê³µì§€ì‚¬í•­ ë¦¬ìŠ¤ë„ˆ
        function initNoticesListener() {
            db.collection('notices').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                notices = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderNotices();
            }, (error) => {
                console.error('notices ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
            });
        }
        
        // ê³µì§€ì‚¬í•­ ë Œë”ë§
        function renderNotices() {
            const searchEl = document.getElementById('noticeSearch');
            const tbody = document.getElementById('noticeTableBody');
            if (!tbody) return;
            
            const search = searchEl ? searchEl.value.toLowerCase() : '';
            const filtered = notices.filter(n => !search || (n.title && n.title.toLowerCase().includes(search)));
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            tbody.innerHTML = filtered.map((n, idx) => {
                const dateStr = n.createdAt ? new Date(n.createdAt.seconds * 1000).toLocaleDateString() : '-';
                const fileLink = n.fileUrl ? `<a href="${n.fileUrl}" target="_blank" class="btn btn-outline btn-sm">ğŸ“ ë³´ê¸°</a>` : '-';
                return `<tr>
                    <td>${filtered.length - idx}</td>
                    <td style="text-align:left; max-width:300px; overflow:hidden; text-overflow:ellipsis;">${n.title || '-'}</td>
                    <td>${dateStr}</td>
                    <td>${fileLink}</td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="editNotice('${n.id}')">ìˆ˜ì •</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteNotice('${n.id}')">ì‚­ì œ</button>
                    </td>
                </tr>`;
            }).join('');
        }
        
        // ê³µì§€ì‚¬í•­ ëª¨ë‹¬ ì—´ê¸°
        function openNoticeModal() {
            document.getElementById('noticeModalTitle').textContent = 'ğŸ“¢ ìƒˆ ê³µì§€ ë“±ë¡';
            document.getElementById('noticeForm').reset();
            document.getElementById('noticeDocId').value = '';
            document.getElementById('noticeModal').style.display = 'flex';
        }
        
        function closeNoticeModal() {
            document.getElementById('noticeModal').style.display = 'none';
        }
        
        // ê³µì§€ì‚¬í•­ ìˆ˜ì •
        function editNotice(docId) {
            const notice = notices.find(n => n.id === docId);
            if (!notice) return;
            
            document.getElementById('noticeModalTitle').textContent = 'ğŸ“¢ ê³µì§€ ìˆ˜ì •';
            document.getElementById('noticeDocId').value = docId;
            document.getElementById('noticeTitle').value = notice.title || '';
            document.getElementById('noticeContent').value = notice.content || '';
            document.getElementById('noticeFileUrl').value = notice.fileUrl || '';
            document.getElementById('noticeModal').style.display = 'flex';
        }
        
        // ê³µì§€ì‚¬í•­ ì‚­ì œ
        async function deleteNotice(docId) {
            if (!confirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await db.collection('notices').doc(docId).delete();
                alert('âœ… ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (err) {
                console.error('ê³µì§€ì‚¬í•­ ì‚­ì œ ì˜¤ë¥˜:', err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        }
        
        // ê³µì§€ì‚¬í•­ í¼ ì œì¶œ
        document.getElementById('noticeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const docId = document.getElementById('noticeDocId').value;
            const title = document.getElementById('noticeTitle').value.trim();
            const content = document.getElementById('noticeContent').value.trim();
            const fileUrl = document.getElementById('noticeFileUrl').value.trim();
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const data = {
                    title: title,
                    content: content,
                    fileUrl: fileUrl || null,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (docId) {
                    // ìˆ˜ì •
                    await db.collection('notices').doc(docId).update(data);
                    alert('âœ… ê³µì§€ì‚¬í•­ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ì‹ ê·œ ë“±ë¡
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('notices').add(data);
                    alert('âœ… ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                closeNoticeModal();
            } catch (err) {
                console.error('ê³µì§€ì‚¬í•­ ì €ì¥ ì˜¤ë¥˜:', err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        });

        // ==================== ê´€ë¦¬ì ê´€ë¦¬ ====================
        let admins = [];
        
        // ê´€ë¦¬ì ë¦¬ìŠ¤ë„ˆ
        function initAdminsListener() {
            db.collection('admins').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                admins = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAdmins();
            }, (error) => {
                console.error('admins ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
            });
        }
        
        // ê´€ë¦¬ì ë Œë”ë§
        function renderAdmins() {
            const tbody = document.getElementById('adminTableBody');
            if (!tbody) return;
            
            const roleMap = { 'super_admin': 'ìµœê³ ê´€ë¦¬ì', 'admin': 'ì¼ë°˜ê´€ë¦¬ì' };
            
            // â˜… í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ ê´€ë¦¬ì (login.htmlì—ì„œ ì‚¬ìš©)
            const defaultAdmin = {
                userId: 'admin',
                password: 'kfpc0808',
                name: 'ê¸°ë³¸ ê´€ë¦¬ì',
                role: 'super_admin',
                isDefault: true
            };
            
            let html = `<tr style="background:#fff8e1;">
                <td><strong>${defaultAdmin.userId}</strong> <span class="badge badge-warning">ê¸°ë³¸</span></td>
                <td>${defaultAdmin.name}</td>
                <td><span class="badge badge-purple">ìµœê³ ê´€ë¦¬ì</span></td>
                <td><span class="password-display">${defaultAdmin.password}</span></td>
                <td><span style="color:#888; font-size:0.8rem;">ì‚­ì œ ë¶ˆê°€</span></td>
            </tr>`;
            
            // Firebaseì—ì„œ ê°€ì ¸ì˜¨ ê´€ë¦¬ì ëª©ë¡ (admins ì»¬ë ‰ì…˜ + users ì»¬ë ‰ì…˜ì˜ admin)
            // users ì»¬ë ‰ì…˜ì—ì„œ admin íƒ€ì… ì‚¬ìš©ìë„ í‘œì‹œ
            const adminUsers = users.filter(u => u.type === 'admin' || u.role === 'admin' || u.isAdmin);
            
            // admins ì»¬ë ‰ì…˜ê³¼ users ì»¬ë ‰ì…˜ í•©ì¹˜ê¸° (ì¤‘ë³µ ì œê±°)
            const allAdmins = [...admins];
            adminUsers.forEach(au => {
                if (!allAdmins.find(a => a.userId === au.userId)) {
                    allAdmins.push(au);
                }
            });
            
            // â˜… í•˜ë“œì½”ë”©ëœ 'admin'ê³¼ ì¤‘ë³µë˜ëŠ” í•­ëª© ì œì™¸
            const filteredAdmins = allAdmins.filter(a => a.userId !== 'admin');
            
            if (filteredAdmins.length > 0) {
                html += filteredAdmins.map(a => {
                    const dateStr = a.createdAt ? new Date(a.createdAt.seconds * 1000).toLocaleDateString() : '-';
                    const roleBadge = a.role === 'super_admin' 
                        ? '<span class="badge badge-purple">ìµœê³ ê´€ë¦¬ì</span>' 
                        : '<span class="badge badge-blue">ì¼ë°˜ê´€ë¦¬ì</span>';
                    
                    // â˜… ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ (í´ë¦­ ì‹œ ìˆ˜ì • ê°€ëŠ¥)
                    let pwDisplay = '-';
                    if (a.password) {
                        pwDisplay = `<span class="password-display" style="cursor:pointer;" onclick="editAdminPassword('${a.id}', '${a.userId}', '${a.password}')" title="í´ë¦­í•˜ì—¬ ìˆ˜ì •">${a.password}</span>`;
                    } else {
                        pwDisplay = `<button class="btn btn-outline btn-sm" onclick="editAdminPassword('${a.id}', '${a.userId}', '')">ì„¤ì •</button>`;
                    }
                    
                    return `<tr>
                        <td><strong>${a.userId || '-'}</strong></td>
                        <td>${a.name || '-'}</td>
                        <td>${roleBadge}</td>
                        <td>${pwDisplay}</td>
                        <td>
                            <button class="btn btn-outline btn-sm" onclick="editAdminPassword('${a.id}', '${a.userId}', '${a.password || ''}')">ìˆ˜ì •</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteAdmin('${a.id}', '${a.userId}')">ì‚­ì œ</button>
                        </td>
                    </tr>`;
                }).join('');
            }
            
            tbody.innerHTML = html;
        }
        
        // â˜… ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •
        async function editAdminPassword(docId, userId, currentPassword) {
            const newPassword = prompt(
                `[${userId}] ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •\n\n` +
                `í˜„ì¬ ë¹„ë°€ë²ˆí˜¸: ${currentPassword || 'ë¯¸ì„¤ì •'}\n\n` +
                `ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (6ì ì´ìƒ):`
            );
            
            if (!newPassword) return;
            
            if (newPassword.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`ë¹„ë°€ë²ˆí˜¸ë¥¼ "${newPassword}"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                // â˜… Cloud Function í˜¸ì¶œ
                const changePassword = functions.httpsCallable('changeUserPassword');
                await changePassword({ uid: docId, newPassword: newPassword, adminSecret: ADMIN_SECRET });
                
                // admins ì»¬ë ‰ì…˜ë„ ì—…ë°ì´íŠ¸
                await db.collection('admins').doc(docId).update({
                    password: newPassword
                }).catch(() => {});
                
                alert(`âœ… ë¹„ë°€ë²ˆí˜¸ê°€ "${newPassword}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
            } catch (err) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', err);
                
                // Cloud Functions ì—†ìœ¼ë©´ Firestoreë§Œ ì—…ë°ì´íŠ¸
                if (err.code === 'functions/not-found' || err.message.includes('not found')) {
                    try {
                        await db.collection('admins').doc(docId).update({ password: newPassword }).catch(() => {});
                        await db.collection('users').doc(docId).update({ password: newPassword }).catch(() => {});
                        
                        alert(`âš ï¸ Cloud Functionsê°€ ë°°í¬ë˜ì§€ ì•Šì•„ Firestoreë§Œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n` +
                              `ì‹¤ì œ ë¡œê·¸ì¸ì„ ìœ„í•´ Firebase Consoleì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                    } catch (e) {
                        alert('ì˜¤ë¥˜ ë°œìƒ: ' + e.message);
                    }
                } else {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + (err.message || err));
                }
            }
        }
        
        // ê´€ë¦¬ì ëª¨ë‹¬ ì—´ê¸°
        function openAdminModal() {
            document.getElementById('adminForm').reset();
            document.getElementById('adminUserPw').value = 'admin123';
            document.getElementById('adminModal').style.display = 'flex';
        }
        
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }
        
        // ê´€ë¦¬ì ì‚­ì œ
        async function deleteAdmin(docId, userId) {
            if (!confirm(`ê´€ë¦¬ì [${userId}]ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            try {
                // admins ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
                await db.collection('admins').doc(docId).delete().catch(() => {});
                
                // users ì»¬ë ‰ì…˜ì—ì„œë„ ì‚­ì œ
                await db.collection('users').doc(docId).delete().catch(() => {});
                
                alert('âœ… ê´€ë¦¬ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nâš ï¸ Firebase Auth ê³„ì •ì€ Consoleì—ì„œ ì§ì ‘ ì‚­ì œí•´ì£¼ì„¸ìš”.');
            } catch (err) {
                console.error('ê´€ë¦¬ì ì‚­ì œ ì˜¤ë¥˜:', err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        }
        
        // ê´€ë¦¬ì í¼ ì œì¶œ
        document.getElementById('adminForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('adminUserId').value.trim();
            const name = document.getElementById('adminUserName').value.trim();
            const password = document.getElementById('adminUserPw').value;
            const role = document.getElementById('adminRole').value;
            
            if (!userId || !name) {
                alert('ì•„ì´ë””ì™€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (password.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            try {
                // 1. Firebase Authì— ì‚¬ìš©ì ìƒì„±
                const secondaryApp = firebase.initializeApp(firebaseConfig, 'SecondaryAdmin');
                const secondaryAuth = secondaryApp.auth();
                
                const authEmail = `${userId}@system.local`;
                const userCredential = await secondaryAuth.createUserWithEmailAndPassword(authEmail, password);
                const uid = userCredential.user.uid;
                
                await secondaryAuth.signOut();
                await secondaryApp.delete();
                
                // 2. admins ì»¬ë ‰ì…˜ì— ì €ì¥
                await db.collection('admins').doc(uid).set({
                    userId: userId,
                    name: name,
                    password: password,  // â˜… ë¹„ë°€ë²ˆí˜¸ ì €ì¥
                    role: role,
                    isAdmin: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // 3. users ì»¬ë ‰ì…˜ì—ë„ ì €ì¥ (role: adminìœ¼ë¡œ)
                await db.collection('users').doc(uid).set({
                    userId: userId,
                    name: name,
                    password: password,  // â˜… ë¹„ë°€ë²ˆí˜¸ ì €ì¥
                    role: 'admin',
                    type: 'admin',
                    isAdmin: true,
                    isPasswordChanged: true,
                    status: 'active',
                    pointBalance: 999999999, // ë¬´ì œí•œ í¬ì¸íŠ¸
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                closeAdminModal();
                alert(`âœ… ê´€ë¦¬ì ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì•„ì´ë””: ${userId}\në¹„ë°€ë²ˆí˜¸: ${password}\n\nì´ ê³„ì •ì€ ëª¨ë“  í”„ë¡œê·¸ë¨ì„ ë¬´ë£Œ/ë¬´ì œí•œìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                
            } catch (err) {
                console.error('ê´€ë¦¬ì ìƒì„± ì˜¤ë¥˜:', err);
                
                try {
                    const secondaryApp = firebase.app('SecondaryAdmin');
                    if (secondaryApp) {
                        await secondaryApp.auth().signOut();
                        await secondaryApp.delete();
                    }
                } catch(e) {}
                
                let errorMsg = 'ì˜¤ë¥˜ ë°œìƒ: ' + err.message;
                if (err.code === 'auth/email-already-in-use') {
                    errorMsg = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                }
                alert(errorMsg);
            }
        });

        // ============================================================
        // ê¸°ì—…ë§ˆë‹¹ ìºì‹œ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        // ============================================================
        
        let cacheLogMessages = [];
        
        function addCacheLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const colors = {
                'info': '#666',
                'success': '#27ae60',
                'error': '#e74c3c',
                'warning': '#f39c12'
            };
            cacheLogMessages.unshift(`<div style="color: ${colors[type]};">[${timestamp}] ${message}</div>`);
            if (cacheLogMessages.length > 20) cacheLogMessages.pop();
            document.getElementById('cache-log').innerHTML = cacheLogMessages.join('');
        }
        
        async function refreshCacheStatus() {
            try {
                addCacheLog('ìºì‹œ ìƒíƒœ ì¡°íšŒ ì¤‘...', 'info');
                
                const getBizinfoCacheStatus = functions.httpsCallable('getBizinfoCacheStatus');
                const result = await getBizinfoCacheStatus();
                
                if (result.data.success) {
                    const status = result.data.status;
                    document.getElementById('cache-total-count').textContent = (status.totalCount || 0).toLocaleString() + 'ê°œ';
                    document.getElementById('cache-last-updated').textContent = status.lastUpdated || 'ì •ë³´ì—†ìŒ';
                    document.getElementById('cache-triggered-by').textContent = status.triggeredBy || 'ìë™ìˆ˜ì§‘';
                    addCacheLog(`ìºì‹œ ìƒíƒœ ì¡°íšŒ ì™„ë£Œ: ${status.totalCount}ê°œ ê³µê³ `, 'success');
                    
                    // ê³µê³  ëª©ë¡ë„ í•¨ê»˜ ë¡œë“œ
                    await loadCachePrograms();
                } else {
                    addCacheLog('ìºì‹œ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨: ' + (result.data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }
            } catch (error) {
                console.error('ìºì‹œ ìƒíƒœ ì¡°íšŒ ì˜¤ë¥˜:', error);
                addCacheLog('ìºì‹œ ìƒíƒœ ì¡°íšŒ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        async function manualFetchBizinfo() {
            const btn = document.getElementById('btn-manual-fetch');
            const originalText = btn.innerHTML;
            
            if (!confirm('ê¸°ì—…ë§ˆë‹¹ì—ì„œ ê³µê³ ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìˆ˜ì§‘ì— 1~2ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                btn.disabled = true;
                btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> ìˆ˜ì§‘ ì¤‘...';
                addCacheLog('ìˆ˜ë™ ìˆ˜ì§‘ ì‹œì‘...', 'warning');
                
                // ğŸ”¥ íƒ€ì„ì•„ì›ƒ 10ë¶„ ì„¤ì • (ê¸°ë³¸ê°’ 70ì´ˆ â†’ 600ì´ˆ)
                const manualBizinfoFetch = functions.httpsCallable('manualBizinfoFetch', { timeout: 600000 });
                const result = await manualBizinfoFetch();
                
                if (result.data.success) {
                    addCacheLog(`âœ… ìˆ˜ë™ ìˆ˜ì§‘ ì™„ë£Œ: ${result.data.count}ê°œ ê³µê³  ì €ì¥`, 'success');
                    alert(`ìˆ˜ì§‘ ì™„ë£Œ!\n\n${result.data.count}ê°œ ê³µê³ ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    refreshCacheStatus();
                } else {
                    addCacheLog('âŒ ìˆ˜ë™ ìˆ˜ì§‘ ì‹¤íŒ¨: ' + (result.data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                    alert('ìˆ˜ì§‘ ì‹¤íŒ¨: ' + (result.data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                console.error('ìˆ˜ë™ ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                addCacheLog('âŒ ìˆ˜ë™ ìˆ˜ì§‘ ì˜¤ë¥˜: ' + error.message, 'error');
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        async function downloadCacheExcel() {
            const btn = document.getElementById('btn-download-excel');
            const originalText = btn.innerHTML;
            
            try {
                btn.disabled = true;
                btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> ì¤€ë¹„ ì¤‘...';
                addCacheLog('ì—‘ì…€ ë°ì´í„° ì¤€ë¹„ ì¤‘...', 'info');
                
                const getCachedPrograms = functions.httpsCallable('getCachedPrograms');
                const result = await getCachedPrograms();
                
                if (!result.data.success || !result.data.programs || result.data.programs.length === 0) {
                    addCacheLog('ë‹¤ìš´ë¡œë“œí•  ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    alert('ì €ì¥ëœ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.\n\në¨¼ì € ìˆ˜ë™ ìˆ˜ì§‘ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const programs = result.data.programs;
                addCacheLog(`${programs.length}ê°œ ê³µê³  ì—‘ì…€ ë³€í™˜ ì¤‘...`, 'info');
                
                // ì—‘ì…€ìš© ë°ì´í„° ë³€í™˜
                const excelData = programs.map((p, idx) => ({
                    'ë²ˆí˜¸': idx + 1,
                    'ê³µê³ ëª…': p.name || '',
                    'ì£¼ê´€ê¸°ê´€': p.organization || '',
                    'ìˆ˜í–‰ê¸°ê´€': p.executor || '',
                    'ì§€ì›ë¶„ì•¼': p.category || '',
                    'ì§€ì›ëŒ€ìƒ': p.target || '',
                    'ì‚¬ì—…ê°œìš”': p.description || '',
                    'ì‹ ì²­ê¸°ê°„': p.applicationPeriod || '',
                    'ì ‘ìˆ˜ì¤‘': p.isOpen ? 'O' : 'X',
                    'í•´ì‹œíƒœê·¸': p.hashTags || '',
                    'ìƒì„¸URL': p.detailUrl || '',
                    'ì‹ ì²­URL': p.applicationUrl || '',
                    'ì²¨ë¶€íŒŒì¼URL': p.attachmentUrl || ''
                }));
                
                // SheetJSë¡œ ì—‘ì…€ ìƒì„±
                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ê¸°ì—…ë§ˆë‹¹ê³µê³ ');
                
                // ì—´ ë„ˆë¹„ ì„¤ì •
                ws['!cols'] = [
                    { wch: 5 },   // ë²ˆí˜¸
                    { wch: 50 },  // ê³µê³ ëª…
                    { wch: 20 },  // ì£¼ê´€ê¸°ê´€
                    { wch: 20 },  // ìˆ˜í–‰ê¸°ê´€
                    { wch: 15 },  // ì§€ì›ë¶„ì•¼
                    { wch: 20 },  // ì§€ì›ëŒ€ìƒ
                    { wch: 60 },  // ì‚¬ì—…ê°œìš”
                    { wch: 25 },  // ì‹ ì²­ê¸°ê°„
                    { wch: 8 },   // ì ‘ìˆ˜ì¤‘
                    { wch: 30 },  // í•´ì‹œíƒœê·¸
                    { wch: 50 },  // ìƒì„¸URL
                    { wch: 50 },  // ì‹ ì²­URL
                    { wch: 50 }   // ì²¨ë¶€íŒŒì¼URL
                ];
                
                // ë‹¤ìš´ë¡œë“œ
                const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
                XLSX.writeFile(wb, `ê¸°ì—…ë§ˆë‹¹ê³µê³ _${today}.xlsx`);
                
                addCacheLog(`âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${programs.length}ê°œ ê³µê³ `, 'success');
                
            } catch (error) {
                console.error('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                addCacheLog('âŒ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
                alert('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // ë§ˆê° ê³µê³  ì‚­ì œ í•¨ìˆ˜
        async function deleteClosedPrograms() {
            if (!confirm('ë§ˆê°ëœ ê³µê³ ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            const btn = document.getElementById('btn-delete-closed');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> ì‚­ì œ ì¤‘...';
            
            try {
                addCacheLog('ë§ˆê° ê³µê³  ì¡°íšŒ ì¤‘...', 'info');
                
                // ëª¨ë“  ê³µê³  ê°€ì ¸ì˜¤ê¸°
                const snapshot = await db.collection('bizinfo_cache').get();
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let closedIds = [];
                
                snapshot.forEach(doc => {
                    if (doc.id === '_meta') return;
                    
                    const data = doc.data();
                    const period = data.applicationPeriod || '';
                    
                    if (!period || !period.includes('~')) {
                        closedIds.push(doc.id); // ê¸°ê°„ ì—†ìœ¼ë©´ ë§ˆê°ìœ¼ë¡œ ê°„ì£¼
                        return;
                    }
                    
                    const endDateStr = period.split('~')[1].trim();
                    if (endDateStr.length >= 8) {
                        const endDate = new Date(
                            endDateStr.substring(0, 4) + '-' +
                            endDateStr.substring(4, 6) + '-' +
                            endDateStr.substring(6, 8)
                        );
                        
                        if (endDate < today) {
                            closedIds.push(doc.id);
                        }
                    }
                });
                
                if (closedIds.length === 0) {
                    addCacheLog('ì‚­ì œí•  ë§ˆê° ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    alert('ì‚­ì œí•  ë§ˆê° ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                addCacheLog(`ë§ˆê° ê³µê³  ${closedIds.length}ê°œ ì‚­ì œ ì‹œì‘...`, 'info');
                
                // Batchë¡œ ì‚­ì œ (450ê°œì”©)
                let batch = db.batch();
                let deletedCount = 0;
                
                for (const docId of closedIds) {
                    batch.delete(db.collection('bizinfo_cache').doc(docId));
                    deletedCount++;
                    
                    if (deletedCount % 450 === 0) {
                        await batch.commit();
                        addCacheLog(`${deletedCount}ê°œ ì‚­ì œ ì™„ë£Œ...`, 'info');
                        batch = db.batch();
                    }
                }
                
                await batch.commit();
                
                addCacheLog(`âœ… ë§ˆê° ê³µê³  ${deletedCount}ê°œ ì‚­ì œ ì™„ë£Œ!`, 'success');
                alert(`ë§ˆê° ê³µê³  ${deletedCount}ê°œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await refreshCacheStatus();
                
            } catch (error) {
                console.error('ë§ˆê° ê³µê³  ì‚­ì œ ì˜¤ë¥˜:', error);
                addCacheLog('âŒ ì‚­ì œ ì˜¤ë¥˜: ' + error.message, 'error');
                alert('ì‚­ì œ ì˜¤ë¥˜: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // ì „ì²´ ê³µê³  ì‚­ì œ í•¨ìˆ˜
        async function deleteAllPrograms() {
            const confirmText = prompt('âš ï¸ ê²½ê³ : ëª¨ë“  ê³µê³ ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤!\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì‚­ì œí•˜ë ¤ë©´ "ì „ì²´ì‚­ì œ"ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            
            if (confirmText !== 'ì „ì²´ì‚­ì œ') {
                alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const btn = document.getElementById('btn-delete-all');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> ì‚­ì œ ì¤‘...';
            
            try {
                addCacheLog('ì „ì²´ ê³µê³  ì‚­ì œ ì‹œì‘...', 'warning');
                
                // ëª¨ë“  ê³µê³  ê°€ì ¸ì˜¤ê¸°
                const snapshot = await db.collection('bizinfo_cache').get();
                
                let allIds = [];
                snapshot.forEach(doc => {
                    if (doc.id !== '_meta') {
                        allIds.push(doc.id);
                    }
                });
                
                if (allIds.length === 0) {
                    addCacheLog('ì‚­ì œí•  ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                    alert('ì‚­ì œí•  ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                addCacheLog(`ì „ì²´ ê³µê³  ${allIds.length}ê°œ ì‚­ì œ ì‹œì‘...`, 'warning');
                
                // Batchë¡œ ì‚­ì œ (450ê°œì”©)
                let batch = db.batch();
                let deletedCount = 0;
                
                for (const docId of allIds) {
                    batch.delete(db.collection('bizinfo_cache').doc(docId));
                    deletedCount++;
                    
                    if (deletedCount % 450 === 0) {
                        await batch.commit();
                        addCacheLog(`${deletedCount}ê°œ ì‚­ì œ ì™„ë£Œ...`, 'info');
                        batch = db.batch();
                    }
                }
                
                await batch.commit();
                
                // _meta ë¬¸ì„œë„ ì‚­ì œ
                await db.collection('bizinfo_cache').doc('_meta').delete();
                
                addCacheLog(`âœ… ì „ì²´ ê³µê³  ${deletedCount}ê°œ ì‚­ì œ ì™„ë£Œ!`, 'success');
                alert(`ì „ì²´ ê³µê³  ${deletedCount}ê°œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nìˆ˜ë™ ìˆ˜ì§‘ì„ ì‹¤í–‰í•˜ì—¬ ìµœì‹  ê³µê³ ë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”.`);
                
                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await refreshCacheStatus();
                
            } catch (error) {
                console.error('ì „ì²´ ê³µê³  ì‚­ì œ ì˜¤ë¥˜:', error);
                addCacheLog('âŒ ì‚­ì œ ì˜¤ë¥˜: ' + error.message, 'error');
                alert('ì‚­ì œ ì˜¤ë¥˜: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        // ============================================================
        // ê³µê³  ëª©ë¡ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        // ============================================================
        
        let allCachePrograms = [];
        let filteredCachePrograms = [];
        let cacheProgramsPage = 1;
        const cacheProgramsPerPage = 15;
        
        async function loadCachePrograms() {
            try {
                addCacheLog('ê³µê³  ëª©ë¡ ë¡œë”© ì¤‘...', 'info');
                
                const getCachedPrograms = functions.httpsCallable('getCachedPrograms');
                const result = await getCachedPrograms();
                
                if (result.data.success && result.data.programs) {
                    allCachePrograms = result.data.programs;
                    filteredCachePrograms = [...allCachePrograms];
                    
                    // ë¶„ì•¼ í•„í„° ì˜µì…˜ ìƒì„±
                    const categories = [...new Set(allCachePrograms.map(p => p.category || '').filter(c => c))].sort();
                    const categorySelect = document.getElementById('cache-category-filter');
                    categorySelect.innerHTML = '<option value="">ì „ì²´ ë¶„ì•¼</option>' + 
                        categories.map(c => `<option value="${c}">${c}</option>`).join('');
                    
                    // ì£¼ê´€ê¸°ê´€ í•„í„° ì˜µì…˜ ìƒì„±
                    const orgs = [...new Set(allCachePrograms.map(p => p.organization || '').filter(o => o))].sort();
                    const orgSelect = document.getElementById('cache-org-filter');
                    orgSelect.innerHTML = '<option value="">ì „ì²´ ê¸°ê´€</option>' + 
                        orgs.slice(0, 50).map(o => `<option value="${o}">${o.length > 15 ? o.substring(0, 15) + '...' : o}</option>`).join('');
                    
                    cacheProgramsPage = 1;
                    renderCacheProgramsTable();
                    updateFilterInfo();
                    addCacheLog(`âœ… ê³µê³  ëª©ë¡ ë¡œë“œ ì™„ë£Œ: ${allCachePrograms.length}ê°œ`, 'success');
                } else {
                    document.getElementById('cache-programs-tbody').innerHTML = 
                        '<tr><td colspan="6" style="text-align: center; color: #999; padding: 2rem;">ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ ìˆ˜ì§‘ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.</td></tr>';
                    addCacheLog('ê³µê³  ì—†ìŒ', 'warning');
                }
            } catch (error) {
                console.error('ê³µê³  ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                addCacheLog('âŒ ê³µê³  ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        function filterCachePrograms() {
            const searchText = document.getElementById('cache-search').value.toLowerCase().trim();
            const category = document.getElementById('cache-category-filter').value;
            const org = document.getElementById('cache-org-filter').value;
            const status = document.getElementById('cache-status-filter').value;
            
            filteredCachePrograms = allCachePrograms.filter(p => {
                // í†µí•© ê²€ìƒ‰ (ê³µê³ ëª…, ê¸°ê´€, ì‚¬ì—…ê°œìš”, í•´ì‹œíƒœê·¸)
                const matchSearch = !searchText || 
                    (p.name || '').toLowerCase().includes(searchText) ||
                    (p.organization || '').toLowerCase().includes(searchText) ||
                    (p.executor || '').toLowerCase().includes(searchText) ||
                    (p.description || '').toLowerCase().includes(searchText) ||
                    (p.target || '').toLowerCase().includes(searchText) ||
                    (p.hashTags || '').toLowerCase().includes(searchText);
                
                // ë¶„ì•¼ í•„í„°
                const matchCategory = !category || (p.category || '') === category;
                
                // ì£¼ê´€ê¸°ê´€ í•„í„°
                const matchOrg = !org || (p.organization || '') === org;
                
                // ìƒíƒœ í•„í„° (ì ‘ìˆ˜ì¤‘/ë§ˆê°)
                let matchStatus = true;
                if (status === 'open') matchStatus = p.isOpen === true;
                else if (status === 'closed') matchStatus = p.isOpen === false;
                
                return matchSearch && matchCategory && matchOrg && matchStatus;
            });
            
            cacheProgramsPage = 1;
            renderCacheProgramsTable();
            updateFilterInfo();
        }
        
        function resetCacheFilters() {
            document.getElementById('cache-search').value = '';
            document.getElementById('cache-category-filter').value = '';
            document.getElementById('cache-org-filter').value = '';
            document.getElementById('cache-status-filter').value = '';
            filteredCachePrograms = [...allCachePrograms];
            cacheProgramsPage = 1;
            renderCacheProgramsTable();
            updateFilterInfo();
        }
        
        function updateFilterInfo() {
            const total = allCachePrograms.length;
            const filtered = filteredCachePrograms.length;
            const openCount = filteredCachePrograms.filter(p => p.isOpen).length;
            const closedCount = filtered - openCount;
            
            let infoText = `ì „ì²´ ${total.toLocaleString()}ê°œ`;
            if (filtered !== total) {
                infoText += ` ì¤‘ <strong>${filtered.toLocaleString()}ê°œ</strong> í‘œì‹œ`;
            }
            infoText += ` (ì ‘ìˆ˜ì¤‘: ${openCount}ê°œ, ë§ˆê°: ${closedCount}ê°œ)`;
            
            document.getElementById('cache-filter-info').innerHTML = infoText;
        }
        
        function renderCacheProgramsTable() {
            const tbody = document.getElementById('cache-programs-tbody');
            const startIdx = (cacheProgramsPage - 1) * cacheProgramsPerPage;
            const endIdx = startIdx + cacheProgramsPerPage;
            const pageData = filteredCachePrograms.slice(startIdx, endIdx);
            
            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #999; padding: 2rem;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                document.getElementById('cache-pagination').innerHTML = '';
                return;
            }
            
            tbody.innerHTML = pageData.map((p, idx) => {
                const isOpen = p.isOpen;
                const statusBadge = isOpen 
                    ? '<span style="background: #27ae60; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">ì ‘ìˆ˜ì¤‘</span>'
                    : '<span style="background: #999; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">ë§ˆê°</span>';
                
                // ë“±ë¡ì¼ í¬ë§·íŒ…
                let regDateStr = '-';
                if (p.registeredDate) {
                    regDateStr = (p.registeredDate || '').substring(0, 10);
                }
                
                // ê³µê³ ë¬¸ ìœ ë¬´ í‘œì‹œ
                const hasPDF = p.printFileUrl || p.attachmentUrl;
                const pdfIcon = hasPDF 
                    ? '<span title="ê³µê³ ë¬¸ ìˆìŒ" style="color: #27ae60;">ğŸ“„</span>'
                    : '<span title="ê³µê³ ë¬¸ ì—†ìŒ" style="color: #ccc;">-</span>';
                
                return `<tr onclick="openProgramDetailModal('${p.id}')" style="cursor: pointer;">
                    <td>${startIdx + idx + 1}</td>
                    <td style="color: var(--accent-color); font-weight: 500;">${(p.name || '').substring(0, 50)}${(p.name || '').length > 50 ? '...' : ''}</td>
                    <td>${(p.organization || '').substring(0, 12)}${(p.organization || '').length > 12 ? '...' : ''}</td>
                    <td style="font-size: 0.8rem;">${(p.executor || '').substring(0, 12)}${(p.executor || '').length > 12 ? '...' : ''}</td>
                    <td>${p.category || '-'}</td>
                    <td style="font-size: 0.8rem;">${p.applicationPeriod || '-'}</td>
                    <td style="font-size: 0.8rem; color: #666;">${regDateStr}</td>
                    <td>${pdfIcon}</td>
                    <td>${statusBadge}</td>
                </tr>`;
            }).join('');
            
            renderCachePagination();
        }
        
        function renderCachePagination() {
            const totalPages = Math.ceil(filteredCachePrograms.length / cacheProgramsPerPage);
            const pagination = document.getElementById('cache-pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = `<span style="color: #666; font-size: 0.85rem;">ì´ ${filteredCachePrograms.length}ê°œ</span>`;
                return;
            }
            
            let html = '';
            
            // ì´ì „ ë²„íŠ¼
            html += `<button class="btn btn-outline" onclick="goToCachePage(${cacheProgramsPage - 1})" ${cacheProgramsPage === 1 ? 'disabled' : ''} style="padding: 0.3rem 0.6rem; font-size: 0.8rem;">ì´ì „</button>`;
            
            // í˜ì´ì§€ ë²ˆí˜¸
            const startPage = Math.max(1, cacheProgramsPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="btn ${i === cacheProgramsPage ? 'btn-primary' : 'btn-outline'}" onclick="goToCachePage(${i})" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;">${i}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            html += `<button class="btn btn-outline" onclick="goToCachePage(${cacheProgramsPage + 1})" ${cacheProgramsPage === totalPages ? 'disabled' : ''} style="padding: 0.3rem 0.6rem; font-size: 0.8rem;">ë‹¤ìŒ</button>`;
            
            html += `<span style="color: #666; font-size: 0.85rem; margin-left: 0.5rem;">ì´ ${filteredCachePrograms.length}ê°œ</span>`;
            
            pagination.innerHTML = html;
        }
        
        function goToCachePage(page) {
            const totalPages = Math.ceil(filteredCachePrograms.length / cacheProgramsPerPage);
            if (page < 1 || page > totalPages) return;
            cacheProgramsPage = page;
            renderCacheProgramsTable();
        }
        
        function openProgramDetailModal(programId) {
            const program = allCachePrograms.find(p => p.id === programId);
            if (!program) return;
            
            const content = document.getElementById('programDetailContent');
            content.innerHTML = `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: var(--primary-color); font-size: 1.1rem;">${program.name || 'ê³µê³ ëª… ì—†ìŒ'}</h4>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${program.isOpen 
                            ? '<span style="background: #27ae60; color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.8rem;">ì ‘ìˆ˜ì¤‘</span>'
                            : '<span style="background: #999; color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.8rem;">ë§ˆê°</span>'}
                        <span style="background: var(--accent-color); color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.8rem;">${program.category || 'ë¶„ì•¼ ì—†ìŒ'}</span>
                    </div>
                </div>
                
                <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666; width: 100px;">ì£¼ê´€ê¸°ê´€</td>
                        <td style="padding: 0.7rem;">${program.organization || '-'}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666;">ìˆ˜í–‰ê¸°ê´€</td>
                        <td style="padding: 0.7rem;">${program.executor || '-'}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666;">ì§€ì›ëŒ€ìƒ</td>
                        <td style="padding: 0.7rem;">${program.target || '-'}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666;">ì‹ ì²­ê¸°ê°„</td>
                        <td style="padding: 0.7rem;">${program.applicationPeriod || '-'}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666; vertical-align: top;">ì‚¬ì—…ê°œìš”</td>
                        <td style="padding: 0.7rem; line-height: 1.6;">${program.description || '-'}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666;">í•´ì‹œíƒœê·¸</td>
                        <td style="padding: 0.7rem;">${program.hashTags || '-'}</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666;">ì¡°íšŒìˆ˜</td>
                        <td style="padding: 0.7rem;">${(program.views || 0).toLocaleString()}íšŒ</td>
                    </tr>
                    ${program.attachmentUrl ? `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.7rem; font-weight: 600; color: #666;">ì²¨ë¶€íŒŒì¼</td>
                        <td style="padding: 0.7rem;"><a href="${program.attachmentUrl}" target="_blank" style="color: var(--accent-color);">ğŸ“ ${program.attachmentName || 'ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ'}</a></td>
                    </tr>` : ''}
                </table>
            `;
            
            const detailLink = document.getElementById('programDetailLink');
            // detailUrlì´ ìˆê³  httpë¡œ ì‹œì‘í•˜ëŠ” ìœ íš¨í•œ URLì¸ ê²½ìš°ë§Œ í‘œì‹œ
            let validDetailUrl = null;
            if (program.detailUrl && program.detailUrl.startsWith('http')) {
                validDetailUrl = program.detailUrl;
            } else if (program.id) {
                // detailUrlì´ ì—†ìœ¼ë©´ ê¸°ì—…ë§ˆë‹¹ ê¸°ë³¸ URLë¡œ ìƒì„±
                validDetailUrl = `https://www.bizinfo.go.kr/web/lay1/bbs/S1T122C128/AS/74/view.do?pblancId=${program.id}`;
            }
            
            if (validDetailUrl) {
                detailLink.href = validDetailUrl;
                detailLink.style.display = 'inline-flex';
            } else {
                detailLink.style.display = 'none';
            }
            
            document.getElementById('programDetailModal').style.display = 'flex';
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            try {
                console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
                
                // ìƒë‹¨ ë°” ë‚ ì§œ ì„¤ì •
                document.getElementById('topBarDate').textContent = new Date().toLocaleDateString('ko-KR', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });
                
                // â˜… ê´€ë¦¬ì ì¸ì¦ ì²´í¬ í›„ Firebase ë¦¬ìŠ¤ë„ˆ ì‹œì‘
                checkAdminAndInitialize();
                
                // â˜… íšŒì› ìˆ˜ì • í¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
                document.getElementById('userEditForm').addEventListener('submit', saveUserEdit);
                
            } catch(e) {
                console.error('window.onload ì˜¤ë¥˜:', e);
            }
        }
    </script>
</body>
</html>