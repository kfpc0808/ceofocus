<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Master í†µí•© ê´€ë¦¬ì V24 (ë ˆì´ì•„ì›ƒ ë™ê¸°í™”)</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- SheetJS (ì—‘ì…€ ë‹¤ìš´ë¡œë“œìš©) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0c2c54;
            --secondary-color: #f5f6fa;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --text-color: #2c3e50;
            --border-color: #dee2e6;
            --sidebar-width: 250px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--secondary-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            font-size: 0.9rem;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary-color);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0; top: 0;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            z-index: 100;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            text-decoration: none;
        }

        .nav-menu { list-style: none; flex: 1; }
        .nav-item { margin-bottom: 0.25rem; }
        .nav-link {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.6rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255, 255, 255, 0.1); color: white; }
        .admin-profile {
            padding: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex; align-items: center; gap: 0.75rem;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { margin-left: var(--sidebar-width); flex: 1; padding: 1.5rem; }
        .page-header { margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        
        /* ê³ ì • ìƒë‹¨ ë°” */
        .top-bar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            padding: 0.75rem 1.5rem;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        .top-bar-date { color: #666; font-size: 0.9rem; }
        .top-bar-buttons { display: flex; gap: 0.5rem; }
        .page-title { font-size: 1.5rem; color: var(--primary-color); font-weight: 700; }

        /* ìƒë‹¨ ë²„íŠ¼ ê·¸ë£¹ */
        .top-buttons { display: flex; gap: 0.5rem; align-items: center; }

        .card {
            background: white; border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 1.2rem; margin-bottom: 1.2rem;
        }

        /* íƒ­ ì»¨í…ì¸  ì œì–´ */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ì„œë¸Œ íƒ­ */
        .sub-nav { display: flex; gap: 0.5rem; margin-bottom: 1rem; border-bottom: 2px solid #e9ecef; padding-bottom: 0; overflow-x: auto; }
        .sub-nav-item { padding: 0.5rem 0.8rem; cursor: pointer; font-weight: 600; color: #6c757d; border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.2s; white-space: nowrap; font-size: 0.9rem; }
        .sub-nav-item:hover { color: var(--primary-color); }
        .sub-nav-item.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; animation: fadeIn 0.3s ease; }

        /* ë²„íŠ¼ */
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; text-decoration: none; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.75rem; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-secondary { background: var(--accent-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border-color); color: var(--text-color); }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* í…Œì´ë¸” */
        .table-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem; flex-wrap: wrap; gap: 0.8rem; }
        .table-controls h3 { font-size: 1.1rem; margin: 0; }
        .search-box { display: flex; gap: 0.4rem; align-items: center; }
        .search-box input { padding: 0.4rem; border: 1px solid #dee2e6; border-radius: 4px; min-width: 200px; font-size: 0.85rem; }
        
        .table-container { overflow-x: auto; min-height: 200px; }
        table { width: 100%; border-collapse: collapse; margin-top: 0.2rem; min-width: 800px; font-size: 0.85rem; }
        th { background: #f8f9fa; color: var(--primary-color); padding: 0.6rem 0.5rem; text-align: left; font-weight: 600; border-bottom: 2px solid var(--border-color); white-space: nowrap; }
        td { padding: 0.5rem 0.5rem; border-bottom: 1px solid #eee; vertical-align: middle; white-space: nowrap; }
        .clickable-cell { cursor: pointer; color: var(--primary-color); font-weight: 600; text-decoration: underline; text-underline-offset: 2px; }
        
        .pagination { display: flex; justify-content: center; gap: 0.3rem; margin-top: 1rem; align-items: center; }
        .page-btn { padding: 0.3rem 0.6rem; border: 1px solid #dee2e6; background: white; border-radius: 4px; cursor: pointer; min-width: 28px; text-align: center; font-size: 0.85rem; }
        .page-btn:hover { background: #e9ecef; }
        .page-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* í¼ */
        .form-group { margin-bottom: 0.8rem; }
        .form-group label { display: block; margin-bottom: 0.3rem; font-weight: 600; color: var(--primary-color); font-size: 0.9rem; }
        .form-control { width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.9rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; }

        /* ì—ë””í„° */
        .editor-container { border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden; }
        .editor-toolbar { background: #f8f9fa; border-bottom: 1px solid var(--border-color); padding: 0.4rem; display: flex; gap: 0.4rem; align-items: center; }
        .editor-btn { background: white; border: 1px solid #dee2e6; border-radius: 3px; width: 26px; height: 26px; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; font-size: 0.8rem; }
        .editor-content { min-height: 300px; padding: 0.8rem; outline: none; overflow-y: auto; background: white; font-size: 0.9rem; line-height: 1.5; }
        .color-picker { width: 26px; height: 26px; padding: 0; border: none; cursor: pointer; }

        /* ëª¨ë‹¬ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 800px; border-radius: 8px; padding: 1.5rem; max-height: 90vh; overflow-y: auto; }

        /* ë°°ì§€ ë° ê¸°íƒ€ */
        .tab-btn-group { display: flex; gap: 0.4rem; margin-bottom: 0.8rem; border-bottom: 1px solid #eee; padding-bottom: 0.8rem; }
        .badge { padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 3px; }
        .badge-blue { background: #e3f2fd; color: #1565c0; }
        .badge-green { background: #e8f5e9; color: #2e7d32; }
        .badge-red { background: #ffebee; color: #c62828; }
        .badge-gray { background: #f1f3f5; color: #495057; }
        .badge-warning { background: var(--warning-bg); color: var(--warning-text); }
        .badge-point { background: #fff8e1; color: #f57f17; border: 1px solid #ffecb3; }
        .badge-purple { background: #f3e5f5; color: #7b1fa2; }
        .password-display { font-family: monospace; background: #f8f9fa; padding: 2px 6px; border-radius: 3px; border: 1px solid #dee2e6; color: #d63384; font-weight: bold; font-size: 0.85rem; }
        .status-card { display: flex; align-items: center; gap: 0.8rem; background: #fff; padding: 1.2rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; }
        .status-card div div:first-child { font-size: 0.85rem; }
        .status-card div div:last-child { font-size: 1.3rem; }
    </style>
</head>
<body>

    <!-- ì‚¬ì´ë“œë°” -->
    <nav class="sidebar">
        <a href="#" class="logo"><i class="ph ph-briefcase-metal"></i> Fin.Master</a>
        <ul class="nav-menu">
            <li class="nav-item"><a class="nav-link active" onclick="switchTab('dashboard')"><i class="ph ph-squares-four"></i> ëŒ€ì‹œë³´ë“œ</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('users')"><i class="ph ph-users"></i> íšŒì› ê´€ë¦¬</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('payment')"><i class="ph ph-credit-card"></i> ê²°ì œÂ·í¬ì¸íŠ¸</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('prompts')"><i class="ph ph-robot"></i> AI í”„ë¡¬í”„íŠ¸</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('suggestions')"><i class="ph ph-mailbox"></i> ì œì•ˆ/ê±´ì˜</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('notices')"><i class="ph ph-megaphone"></i> ê³µì§€ì‚¬í•­</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('admins')"><i class="ph ph-user-gear"></i> ê´€ë¦¬ì ê´€ë¦¬</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('terms')"><i class="ph ph-scroll"></i> ì•½ê´€ ë° ì •ì±…</a></li>
            <li class="nav-item"><a class="nav-link" onclick="switchTab('bizinfo')"><i class="ph ph-building-office"></i> ì§€ì›ì‚¬ì—…</a></li>
        </ul>
        <div class="admin-profile">
            <i class="ph ph-user-circle" style="font-size: 2rem;"></i>
            <div><div style="font-weight: 600;">ìµœê³ ê´€ë¦¬ì</div><div style="font-size: 0.8rem; opacity: 0.7;">Online</div></div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <!-- ê³ ì • ìƒë‹¨ ë°” -->
        <div class="top-bar">
            <div class="top-bar-date"><i class="ph ph-calendar"></i> <span id="currentDate"></span></div>
            <div class="top-bar-buttons">
                <button class="btn btn-secondary" onclick="location.href='index.html'"><i class="ph ph-house"></i> ë©”ì¸</button>
                <button class="btn btn-danger" onclick="logout()"><i class="ph ph-sign-out"></i> ë¡œê·¸ì•„ì›ƒ</button>
                <a href="https://console.cloud.google.com/apis/api/generativelanguage.googleapis.com/metrics" target="_blank" class="btn btn-outline" style="color: #4285F4; border-color: #4285F4;"><i class="ph ph-google-logo"></i> API ì¡°íšŒ</a>
            </div>
        </div>

        <!-- 1. ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="tab-content active">
            <div class="page-header">
                <h1 class="page-title">ëŒ€ì‹œë³´ë“œ</h1>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                <div class="status-card"><div class="status-icon" style="background: #e3f2fd; color: #1565c0;"><i class="ph ph-users"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì „ì²´ íšŒì›</div><div style="font-size: 1.3rem; font-weight: 700;" id="statTotalUsers">0</div></div></div>
                <div class="status-card"><div class="status-icon" style="background: #ffebee; color: #c62828;"><i class="ph ph-warning-circle"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì‹ ê·œ ì‹ ì²­ ëŒ€ê¸°</div><div style="font-size: 1.3rem; font-weight: 700; color: var(--danger-color);" id="statPending">0</div></div></div>
                <div class="status-card"><div class="status-icon" style="background: #e8f5e9; color: #2e7d32;"><i class="ph ph-credit-card"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì´ë²ˆë‹¬ ê²°ì œì™„ë£Œ</div><div style="font-size: 1.3rem; font-weight: 700;">0ê±´</div></div></div>
                <div class="status-card"><div class="status-icon" style="background: #fff8e1; color: #f57f17;"><i class="ph ph-coins"></i></div><div><div style="font-size: 0.85rem; color: #666;">ì´ ë°œí–‰ í¬ì¸íŠ¸</div><div style="font-size: 1.3rem; font-weight: 700;">0 P</div></div></div>
            </div>
        </div>

        <!-- 2. íšŒì› ê´€ë¦¬ -->
        <div id="users" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">íšŒì› ê´€ë¦¬</h1>
                <div class="top-buttons">
                    <button class="btn btn-primary" onclick="openRegisterModal()"><i class="ph ph-user-plus"></i> ìˆ˜ë™ íšŒì› ë“±ë¡</button>
                </div>
            </div>

            <!-- ê°€ì… ì‹ ì²­ ë‚´ì—­ (Firebase ì—°ë™) -->
            <div class="card" style="border-left: 4px solid var(--accent-color);">
                <div class="table-controls">
                    <h3>ğŸ“ ê°€ì… ì‹ ì²­ ë‚´ì—­ (ìŠ¹ì¸ ëŒ€ê¸°) - ì‹¤ì‹œê°„ ì—°ë™</h3>
                    <div style="display:flex; gap:0.5rem;">
                        <div class="search-box"><input type="text" id="pendingSearch" placeholder="ì´ë¦„, ì§€ì—­, ì—°ë½ì²˜ ê²€ìƒ‰" onkeyup="renderUsers()"></div>
                        <button class="btn btn-success btn-sm" onclick="exportTableToExcel('pendingTable', 'ê°€ì…ì‹ ì²­ë‚´ì—­')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="pendingTable">
                        <thead>
                            <tr>
                                <th>ì‹ ì²­ì¼ì‹œ</th>
                                <th>ì„±ëª…</th>
                                <th>ì†Œì†/ì§í•¨</th>
                                <th>ì§€ì—­</th>
                                <th>ì—°ë½ì²˜</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ìœ í˜•</th>
                                <th>ê°€ì…ë¹„</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="pendingTableBody"></tbody>
                    </table>
                </div>
                <div id="pendingPagination" class="pagination"></div>
            </div>
            
            <!-- ì „ì²´ íšŒì› ëª©ë¡ -->
            <div class="card">
                <div class="table-controls">
                    <h3>ì „ì²´ íšŒì› ëª©ë¡</h3>
                    <div style="display:flex; gap:0.5rem;">
                        <div class="search-box"><input type="text" id="userSearch" placeholder="ì•„ì´ë””, ì´ë¦„ ê²€ìƒ‰" onkeyup="renderUsers()"></div>
                        <button class="btn btn-success btn-sm" onclick="exportTableToExcel('userTable', 'ì „ì²´íšŒì›ëª©ë¡')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="userTable">
                        <thead><tr><th>No</th><th>ì•„ì´ë””</th><th>ì„±ëª…</th><th>ì†Œì†/ì§í•¨</th><th>ì§€ì—­</th><th>ìœ í˜•</th><th>ì—°ë½ì²˜/ë©”ì¼</th><th>ê°€ì…ë¹„</th><th>ì›” ê²°ì œì•¡</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
                <div id="userPagination" class="pagination"></div>
            </div>
        </div>

        <!-- 3. ê²°ì œ ë° í¬ì¸íŠ¸ ê´€ë¦¬ -->
        <div id="payment" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">ê²°ì œ ë° í¬ì¸íŠ¸ ê´€ë¦¬</h1>
                <button class="btn btn-secondary" onclick="runBatchSimulation()"><i class="ph ph-play-circle"></i> ì •ê¸° ê²°ì œ ì¼ê´„ ì‹¤í–‰</button>
            </div>

            <div class="sub-nav">
                <div class="sub-nav-item active" onclick="switchSubTab(this, 'payment-status-view')">ê²°ì œ í˜„í™© ë° ì´ë ¥</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-points-view')">í¬ì¸íŠ¸ ì´ìš© ë‚´ì—­</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-usage_analysis-view')">í¬ì¸íŠ¸ ì‚¬ìš© ë¶„ì„</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-expiration-view')">í¬ì¸íŠ¸ ì†Œë©¸ ê´€ë¦¬</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'payment-unpaid-view')">ë¯¸ê²°ì œ/ì—°ì²´ ê´€ë¦¬</div>
            </div>

            <div id="payment-status-view" class="sub-tab-content active">
                <div class="card">
                    <div class="table-controls">
                        <h3>ğŸ’³ ì´ë²ˆë‹¬ ê²°ì œ í˜„í™©</h3>
                        <div style="display:flex; gap:0.5rem;">
                            <div class="search-box"><input type="text" id="paymentSearch" placeholder="ê²€ìƒ‰..." onkeyup="renderPaymentHistory()"></div>
                            <button class="btn btn-success btn-sm" onclick="exportTableToExcel('paymentTable', 'ê²°ì œí˜„í™©')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                        </div>
                    </div>
                    <div class="table-container"><table id="paymentTable"><thead><tr><th>ê²°ì œì¼ì‹œ</th><th>ì•„ì´ë””</th><th>ì„±ëª…</th><th>ê²°ì œ ê¸ˆì•¡</th><th>ìœ í˜•</th><th>ê²°ê³¼</th></tr></thead><tbody id="paymentHistoryBody"></tbody></table></div>
                    <div id="paymentPagination" class="pagination"></div>
                </div>
            </div>
            
            <div id="payment-points-view" class="sub-tab-content">
                <div class="card">
                    <div class="table-controls">
                        <h3>ğŸ“Š í¬ì¸íŠ¸ ë¡œê·¸</h3>
                        <div style="display:flex; gap:0.5rem;">
                            <div class="search-box"><input type="text" id="pointSearch" placeholder="ê²€ìƒ‰..." onkeyup="renderPointLogs()"></div>
                            <button class="btn btn-success btn-sm" onclick="exportTableToExcel('pointTable', 'í¬ì¸íŠ¸ë¡œê·¸')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                        </div>
                    </div>
                    <div class="table-container"><table id="pointTable"><thead><tr><th>ì¼ì‹œ</th><th>ì•„ì´ë””</th><th>ì„±ëª…</th><th>êµ¬ë¶„</th><th>ë‚´ìš©</th><th>ë³€ë™</th><th>ì”ì•¡</th></tr></thead><tbody id="pointLogsBody"></tbody></table></div>
                    <div id="pointPagination" class="pagination"></div>
                </div>
            </div>
            
            <div id="payment-usage_analysis-view" class="sub-tab-content">
                <div class="card">
                    <div class="table-controls">
                        <h3>ğŸ“ˆ í¬ì¸íŠ¸ ì‚¬ìš© ë¶„ì„</h3>
                        <button class="btn btn-success btn-sm" onclick="exportTableToExcel('usageTable', 'ì‚¬ìš©ë¶„ì„')"><i class="ph ph-file-xls"></i> ì—‘ì…€</button>
                    </div>
                    <div class="table-container"><table id="usageTable" style="text-align: center;"><thead><tr><th rowspan="2">íšŒì›ì •ë³´</th><th rowspan="2">ëŒ€ìƒ ì›”</th><th colspan="2" style="background:#e3f2fd">ìš”ì•½ë¶„ì„(500P)</th><th colspan="2" style="background:#e8f5e9">ìƒì„¸ë¶„ì„(2000P)</th><th rowspan="2">ì´ í¬ì¸íŠ¸</th></tr><tr><th>íšŸìˆ˜</th><th>ì°¨ê°ì•¡</th><th>íšŸìˆ˜</th><th>ì°¨ê°ì•¡</th></tr></thead><tbody id="usageStatsBody"></tbody></table></div>
                </div>
            </div>
            <div id="payment-expiration-view" class="sub-tab-content"><div class="card"><p>ì†Œë©¸ ì˜ˆì • ëª©ë¡ (ì¤€ë¹„ì¤‘)</p></div></div>
            <div id="payment-unpaid-view" class="sub-tab-content"><div class="card"><p>ë¯¸ê²°ì œ íšŒì› ëª©ë¡ (ì¤€ë¹„ì¤‘)</p></div></div>
        </div>

        <!-- 4. í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ íƒ­ -->
        <div id="prompts" class="tab-content">
            <div class="page-header"><h1 class="page-title">AI í”„ë¡¬í”„íŠ¸ ê´€ë¦¬</h1></div>
            <div class="sub-nav">
                <div class="sub-nav-item active" onclick="switchSubTab(this, 'prompt-company')">ê¸°ì—…ë§ˆë‹¹</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'prompt-ceo')">CEO Focus</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'prompt-guarantee')">ë³´ì¥ë¶„ì„</div>
                <div class="sub-nav-item" onclick="switchSubTab(this, 'prompt-ff')">FF</div>
            </div>
            <div id="prompt-company" class="sub-tab-content active"><div class="card"><h3>ğŸ­ ê¸°ì—…ë§ˆë‹¹</h3><div class="form-group"><textarea class="form-control" style="min-height: 400px; font-family: monospace;">System Instruction...</textarea></div><button class="btn btn-primary">ì €ì¥</button></div></div>
            <!-- ë‚˜ë¨¸ì§€ íƒ­ ë™ì¼ -->
        </div>

        <!-- 5. ì œì•ˆ/ê±´ì˜ -->
        <div id="suggestions" class="tab-content">
            <div class="page-header"><h1 class="page-title">ì œì•ˆ / ê±´ì˜ì‚¬í•­</h1></div>
            <div class="card">
                <div class="table-controls"><h3>ëª©ë¡</h3><button class="btn btn-success btn-sm" onclick="exportTableToExcel('suggestTable', 'ì œì•ˆê±´ì˜')">ì—‘ì…€</button></div>
                <div class="table-container"><table id="suggestTable"><thead><tr><th>No</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ì‘ì„±ì¼</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead><tbody id="suggestionTableBody"></tbody></table></div>
                <div id="suggestionPagination" class="pagination"></div>
            </div>
        </div>

        <!-- 6. ê³µì§€ì‚¬í•­ -->
        <div id="notices" class="tab-content">
            <div class="page-header"><h1 class="page-title">ê³µì§€ì‚¬í•­ ê´€ë¦¬</h1><button class="btn btn-primary" onclick="openNoticeModal()">ìƒˆ ê³µì§€ ë“±ë¡</button></div>
            <div class="card">
                <div class="table-controls"><h3>ë“±ë¡ëœ ê³µì§€ì‚¬í•­</h3><div class="search-box"><input type="text" id="noticeSearch" placeholder="ì œëª© ê²€ìƒ‰" onkeyup="renderNotices()"></div></div>
                <div class="table-container"><table id="noticeTable"><thead><tr><th style="width: 50px;">No</th><th>ì œëª©</th><th>ë“±ë¡ì¼ì</th><th>ì²¨ë¶€íŒŒì¼</th><th>ê´€ë¦¬</th></tr></thead><tbody id="noticeTableBody"></tbody></table></div>
                <div id="noticePagination" class="pagination"></div>
            </div>
        </div>

        <!-- 7. ê´€ë¦¬ì ê´€ë¦¬ -->
        <div id="admins" class="tab-content">
            <div class="page-header"><h1 class="page-title">ê´€ë¦¬ì ê³„ì • ê´€ë¦¬</h1><button class="btn btn-primary">ì¶”ê°€</button></div>
            <div class="card">
                <div class="table-container"><table><thead><tr><th>ì•„ì´ë””</th><th>ì´ë¦„</th><th>ê¶Œí•œ</th><th>ê´€ë¦¬</th></tr></thead><tbody id="adminTableBody"></tbody></table></div>
            </div>
        </div>

        <!-- 8. ì•½ê´€ -->
        <div id="terms" class="tab-content">
            <div class="page-header"><h1 class="page-title">ì•½ê´€ ë° ì •ì±… ê´€ë¦¬</h1></div>
            <div class="card">
                <div class="tab-btn-group"><button class="btn btn-primary active" id="btn-term-service" onclick="loadTerm('service')">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</button><button class="btn btn-outline" id="btn-term-privacy" onclick="loadTerm('privacy')">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</button><button class="btn btn-outline" id="btn-term-marketing" onclick="loadTerm('marketing')">ë§ˆì¼€íŒ… ìˆ˜ì‹ ë™ì˜</button></div>
                <div class="form-group"><textarea class="form-control" id="termEditor" style="min-height: 500px; font-family: monospace; line-height: 1.6;"></textarea></div>
                <button class="btn btn-primary" onclick="saveTerms()">ì €ì¥</button>
            </div>
        </div>

        <!-- ì§€ì›ì‚¬ì—… ê´€ë¦¬ íƒ­ -->
        <div id="bizinfo" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">ì •ë¶€ ì§€ì›ì‚¬ì—… ê´€ë¦¬</h1>
                <div style="display:flex; gap:0.5rem;">
                    <button class="btn btn-outline" onclick="loadBizInfoPrograms()"><i class="ph ph-arrows-clockwise"></i> ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-primary" onclick="exportTableToExcel('bizinfoTable', 'ì§€ì›ì‚¬ì—…ëª©ë¡')"><i class="ph ph-file-xls"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
            
            <!-- í•„í„° ì˜ì—­ -->
            <div class="card" style="margin-bottom:1rem;">
                <div style="display:flex; gap:1rem; flex-wrap:wrap; align-items:center;">
                    <div class="form-group" style="margin:0;">
                        <select id="bizinfoCategoryFilter" class="form-control" onchange="filterBizInfoTable()">
                            <option value="">ì „ì²´ ë¶„ì•¼</option>
                            <option value="ê¸ˆìœµ">ê¸ˆìœµ</option>
                            <option value="ê¸°ìˆ ">ê¸°ìˆ </option>
                            <option value="ì¸ë ¥">ì¸ë ¥</option>
                            <option value="ìˆ˜ì¶œ">ìˆ˜ì¶œ</option>
                            <option value="ë‚´ìˆ˜">ë‚´ìˆ˜</option>
                            <option value="ì°½ì—…">ì°½ì—…</option>
                            <option value="ê²½ì˜">ê²½ì˜</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <select id="bizinfoStatusFilter" class="form-control" onchange="filterBizInfoTable()">
                            <option value="">ì „ì²´ ìƒíƒœ</option>
                            <option value="open">ì§„í–‰ì¤‘</option>
                            <option value="closed">ë§ˆê°</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0; flex:1; min-width:200px;">
                        <input type="text" id="bizinfoSearchInput" class="form-control" placeholder="ê³µê³ ëª… ê²€ìƒ‰..." oninput="filterBizInfoTable()">
                    </div>
                    <span id="bizinfoCount" style="font-weight:600; color:var(--primary-color);"></span>
                </div>
            </div>
            
            <!-- í…Œì´ë¸” -->
            <div class="table-container">
                <table id="bizinfoTable">
                    <thead>
                        <tr>
                            <th style="width:50px;">No</th>
                            <th>ê³µê³ ëª…</th>
                            <th>ì†Œê´€ê¸°ê´€</th>
                            <th>ìˆ˜í–‰ê¸°ê´€</th>
                            <th>ë¶„ì•¼</th>
                            <th>ì§€ì›ëŒ€ìƒ</th>
                            <th>ì‹ ì²­ê¸°ê°„</th>
                            <th>ë“±ë¡ì¼</th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="bizinfoTableBody">
                        <tr><td colspan="9" style="text-align:center; padding:2rem;">ë¡œë”© ì¤‘...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- ëª¨ë‹¬: ID ë°œê¸‰ ë° ê°€ì… ìŠ¹ì¸ (ìˆ˜ì •ë¨) -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ‘¥ íšŒì› ìŠ¹ì¸ ë° ID ë°œê¸‰</h3>
            <p style="font-size:0.9rem; color:#666; margin-bottom:1rem;">ì‹ ì²­ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ID/ë¹„ë°€ë²ˆí˜¸ ë° ê¶Œí•œì„ ì„¤ì •í•˜ì„¸ìš”.</p>
            <form id="registerForm">
                <!-- ì‹ ì²­ ì •ë³´ (Read-Only: ë ˆì´ì•„ì›ƒ ë™ê¸°í™”) -->
                <div style="background:#f8f9fa; padding:1rem; border-radius:6px; margin-bottom:1rem; border:1px solid #eee;">
                    <h4 style="margin-bottom:0.5rem; font-size:0.9rem; color:var(--primary-color);">[ì‹ ì²­ì ì •ë³´]</h4>
                    <div class="form-row">
                        <div class="form-group"><label>ì„±ëª…</label><input type="text" id="newUserName" class="form-control" readonly style="background:white"></div>
                        <div class="form-group"><label>ì†Œì†ì‚¬</label><input type="text" id="newUserCompany" class="form-control" readonly style="background:white"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>ì§í•¨</label><input type="text" id="newUserTitle" class="form-control" readonly style="background:white"></div>
                        <div class="form-group"><label>ì§€ì—­</label><input type="text" id="newUserRegion" class="form-control" readonly style="background:white"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>ì—°ë½ì²˜</label><input type="text" id="newUserPhone" class="form-control" readonly style="background:white"></div>
                        <div class="form-group"><label>ì´ë©”ì¼</label><input type="text" id="newUserEmail" class="form-control" readonly style="background:white"></div>
                    </div>
                </div>

                <!-- ê´€ë¦¬ì ì„¤ì • -->
                <div style="padding:1rem; border:1px solid #dee2e6; border-radius:6px;">
                    <h4 style="margin-bottom:0.5rem; font-size:0.9rem; color:var(--accent-color);">[ê´€ë¦¬ì ì„¤ì •]</h4>
                    <div class="form-row"><div class="form-group"><label>ì•„ì´ë”” (ìƒì„±)</label><input type="text" id="newUserId" class="form-control" placeholder="ì˜ˆ: FP2025001" required></div><div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="text" id="newUserPw" class="form-control" value="1234" required></div></div>
                    <div class="form-row">
                        <div class="form-group"><label>íšŒì› ìœ í˜•</label><select id="newUserType" class="form-control"><option value="inner">ì´ë„ˆ</option><option value="branch">ì§€ì‚¬ì¥</option><option value="consultant_home">ì»¨í™ˆ</option><option value="non_member">ë¹„íšŒì›</option></select></div>
                        <div class="form-group"><label>ê°€ì…ë¹„</label><select id="regFeeStatus" class="form-control"><option value="unpaid" selected style="color:red;">ë¯¸ì…ê¸ˆ</option><option value="paid" style="color:green;">ì…ê¸ˆì™„ë£Œ</option></select></div>
                    </div>
                    <div class="form-group"><label>ì›” ê²°ì œì•¡</label><input type="number" id="newUserFee" class="form-control" value="10000"></div>
                </div>
                <div class="flex-between" style="margin-top:1rem;"><button type="button" class="btn btn-outline" onclick="document.getElementById('registerModal').style.display='none'">ì·¨ì†Œ</button><button type="submit" class="btn btn-primary">ìŠ¹ì¸ ë° ìƒì„±</button></div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>

    <script>
        // --- 1. Firebase ì´ˆê¸°í™” ---
        const firebaseConfig = {
            apiKey: "AIzaSyDbufefZCVqCY8QQppcdQFoqVFpMriv1m0",
            authDomain: "kfpc-company-support-project.firebaseapp.com",
            databaseURL: "https://kfpc-company-support-project-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kfpc-company-support-project",
            storageBucket: "kfpc-company-support-project.firebasestorage.app",
            messagingSenderId: "101260933373",
            appId: "1:101260933373:web:3436176f9ca2560056d914"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const functions = firebase.app().functions('asia-northeast3'); // ë¦¬ì „ ì„¤ì •

        // --- 2. ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ---
        function exportTableToExcel(tableId, filename = '') {
            const table = document.getElementById(tableId);
            const wb = XLSX.utils.table_to_book(table, {sheet: "Sheet1"});
            XLSX.writeFile(wb, filename ? `${filename}.xlsx` : 'data.xlsx');
        }

        // --- 3. ë„¤ë¹„ê²Œì´ì…˜ ë° ê³µí†µ ---
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString();
        function logout() { alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.'); location.href='login.html'; }

        function switchTab(tabId) {
            document.querySelectorAll('.nav-menu .nav-link').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            event.target.closest('.nav-link').classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        function switchSubTab(element, viewId) {
            element.parentElement.querySelectorAll('.sub-nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            element.parentElement.parentElement.querySelectorAll('.sub-tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        // --- 4. ë°ì´í„° ë¡œì§ (Firebase ì—°ë™) ---
        let pendingApps = [];
        let users = [];
        // (ê²°ì œ/ë¡œê·¸ ë“±ì€ ì•„ì§ ë”ë¯¸ ìœ ì§€ - í•„ìš” ì‹œ DB ì—°ê²° ê°€ëŠ¥)
        let payments = [];
        let pointLogs = [];

        // [ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ] ê°€ì… ì‹ ì²­ ë‚´ì—­ (account_requests)
        db.collection('account_requests').orderBy('requestedAt', 'desc').onSnapshot((snapshot) => {
            pendingApps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            // ê°€ì…ì‹ ì²­ ëª©ë¡ì´ ê°±ì‹ ë˜ë©´ í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            if(document.getElementById('users').style.display !== 'none') renderUsers();
            
            // ëŒ€ì‹œë³´ë“œ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById('statPending').innerText = pendingApps.length;
        });

        // [ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ] íšŒì› ëª©ë¡ (users)
        db.collection('users').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
            users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            if(document.getElementById('users').style.display !== 'none') renderUsers();
            
            document.getElementById('statTotalUsers').innerText = users.length;
        });

        // --- ë Œë”ë§ í•¨ìˆ˜ (í˜ì´ì§•/ê²€ìƒ‰ í¬í•¨) ---
        const PAGE_SIZE = 15;
        const state = { users: {page:1, search:''}, pending: {page:1, search:''}, payments: {page:1, search:''}, points: {page:1, search:''} };

        function filterAndPaginate(data, stateKey) {
            const s = state[stateKey];
            const filtered = data.filter(item => { if (!s.search) return true; return Object.values(item).some(val => String(val).toLowerCase().includes(s.search.toLowerCase())); });
            const totalPages = Math.ceil(filtered.length / PAGE_SIZE) || 1;
            if (s.page > totalPages) s.page = totalPages;
            const start = (s.page - 1) * PAGE_SIZE;
            const paged = filtered.slice(start, start + PAGE_SIZE);
            return { paged, totalPages, totalCount: filtered.length };
        }

        function renderPaginationControls(containerId, stateKey, totalPages, renderFn) {
            const container = document.getElementById(containerId);
            let html = `<button class="page-btn" onclick="changePage('${stateKey}',${state[stateKey].page-1})" ${state[stateKey].page===1?'disabled':''}>Prev</button>`;
            for(let i=1; i<=totalPages; i++) { html+=`<button class="page-btn ${i===state[stateKey].page?'active':''}" onclick="changePage('${stateKey}',${i})">${i}</button>`; }
            html+=`<button class="page-btn" onclick="changePage('${stateKey}',${state[stateKey].page+1})" ${state[stateKey].page===totalPages?'disabled':''}>Next</button>`;
            container.innerHTML=html;
            window.changePage=(key,p)=>{if(p<1||p>totalPages)return; state[key].page=p; renderFn();}
        }

        function renderUsers() {
            // 1. ëŒ€ê¸°ì ëª©ë¡
            state.pending.search = document.getElementById('pendingSearch').value;
            const pRes = filterAndPaginate(pendingApps, 'pending');
            const pBody = document.getElementById('pendingTableBody');
            
            if(pRes.totalCount === 0) pBody.innerHTML = '<tr><td colspan="9" style="text-align:center;">ëŒ€ê¸° ë‚´ì—­ ì—†ìŒ</td></tr>';
            else {
                pBody.innerHTML = pRes.paged.map(app => {
                    const dateStr = app.requestedAt ? new Date(app.requestedAt.seconds * 1000).toLocaleString() : '-';
                    return `<tr>
                        <td>${dateStr}</td>
                        <td>${app.name}</td>
                        <td>${app.company} ${app.position}</td>
                        <td>${app.region}</td>
                        <td>${app.phone}</td>
                        <td>${app.email}</td>
                        <td><span class="badge badge-gray">ë¯¸ì§€ì •</span></td>
                        <td><span class="badge badge-red">ë¯¸ì…ê¸ˆ</span></td>
                        <td><button class="btn btn-primary btn-sm" onclick="openIssueIdModal('${app.id}')">IDë°œê¸‰</button></td>
                    </tr>`;
                }).join('');
            }
            renderPaginationControls('pendingPagination', 'pending', pRes.totalPages, renderUsers);

            // 2. ì „ì²´ íšŒì› ëª©ë¡
            state.users.search = document.getElementById('userSearch').value;
            const uRes = filterAndPaginate(users, 'users');
            const uBody = document.getElementById('userTableBody');
            
            uBody.innerHTML = uRes.paged.map((u, idx) => {
                const feeBadge = u.feeStatus === 'paid' ? '<span class="badge badge-green">ë‚©ë¶€</span>' : '<span class="badge badge-red">ë¯¸ë‚©</span>';
                const typeMap = {'inner': 'ì´ë„ˆ', 'branch': 'ì§€ì‚¬ì¥', 'consultant_home': 'ì»¨í™ˆ', 'non_member': 'ë¹„íšŒì›', 'general': 'ì¼ë°˜'};
                const fee = u.monthlyFee ? u.monthlyFee.toLocaleString() : '0';
                
                return `<tr>
                    <td>${idx+1}</td>
                    <td class="clickable-cell">${u.userId}</td>
                    <td>${u.name}</td>
                    <td>${u.company} ${u.jobTitle}</td>
                    <td>${u.region}</td>
                    <td><span class="badge badge-gray">${typeMap[u.type] || u.type}</span></td>
                    <td>${u.phone}<br><span style="color:#888;font-size:0.8rem">${u.email}</span></td>
                    <td>${feeBadge}</td>
                    <td style="font-weight:bold; color:var(--accent-color);">${fee}</td>
                    <td><span class="badge badge-green">${u.status}</span></td>
                    <td><button class="btn btn-outline btn-sm">ê´€ë¦¬</button></td>
                </tr>`;
            }).join('');
            renderPaginationControls('userPagination', 'users', uRes.totalPages, renderUsers);
        }

        // --- 5. ë¡œì§ í•¨ìˆ˜: ìŠ¹ì¸ ë° ë“±ë¡ ---
        function openIssueIdModal(docId) {
            const app = pendingApps.find(a => a.id === docId);
            if(!app) return;

            document.getElementById('newUserName').value = app.name;
            document.getElementById('newUserPhone').value = app.phone;
            document.getElementById('newUserEmail').value = app.email;
            document.getElementById('newUserRegion').value = app.region;
            document.getElementById('newUserCompany').value = app.company;
            document.getElementById('newUserTitle').value = app.position; // position -> title ë§¤í•‘
            
            document.getElementById('newUserId').value = ''; 
            document.getElementById('newUserPw').value = '1234';
            document.getElementById('newUserType').value = 'inner'; 
            document.getElementById('regFeeStatus').value = 'unpaid'; 
            
            document.getElementById('registerForm').dataset.docId = docId; // DB ë¬¸ì„œ ID ì €ì¥
            document.getElementById('registerModal').style.display = 'flex';
        }

        function openRegisterModal() {
            document.getElementById('registerForm').reset();
            document.querySelectorAll('#registerForm input[readonly]').forEach(el => {
                el.removeAttribute('readonly');
                el.style.background = 'white';
            });
            delete document.getElementById('registerForm').dataset.docId;
            document.getElementById('registerModal').style.display = 'flex';
        }

        document.getElementById('registerForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const docId = this.dataset.docId;
            
            const newUser = {
                userId: document.getElementById('newUserId').value,
                password: document.getElementById('newUserPw').value, // ì‹¤ì œë¡  ì•”í˜¸í™” í•„ìš”í•˜ì§€ë§Œ ì—¬ê¸°ì„  ì €ì¥
                name: document.getElementById('newUserName').value, 
                phone: document.getElementById('newUserPhone').value,
                email: document.getElementById('newUserEmail').value,
                region: document.getElementById('newUserRegion').value,
                company: document.getElementById('newUserCompany').value, 
                jobTitle: document.getElementById('newUserTitle').value,
                type: document.getElementById('newUserType').value, 
                monthlyFee: parseInt(document.getElementById('newUserFee').value),
                feeStatus: document.getElementById('regFeeStatus').value, 
                status: 'active',
                pointBalance: 0,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // 1. users ì»¬ë ‰ì…˜ì— ì¶”ê°€ (ID ì¤‘ë³µ ì²´í¬ ë“± ìƒëµ, ë°”ë¡œ ì¶”ê°€)
                // ì‹¤ì œë¡  auth.createUser ë“± í•„ìš”í•˜ì§€ë§Œ, DB ê´€ë¦¬ ìœ„ì£¼ë¡œ êµ¬í˜„
                await db.collection('users').add(newUser);

                // 2. ìŠ¹ì¸ ê±´ì´ë©´ ìš”ì²­ ë‚´ì—­ ì‚­ì œ
                if(docId) {
                    await db.collection('account_requests').doc(docId).delete();
                }

                document.getElementById('registerModal').style.display='none';
                alert('íšŒì› ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                // ë¦¬ìŠ¤ë„ˆê°€ ìˆì–´ì„œ renderUsers ìë™ í˜¸ì¶œë¨
                
            } catch(err) {
                console.error(err);
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            }
        });

        // --- ê¸°íƒ€ ë¡œì§ (ê²°ì œ, í¬ì¸íŠ¸ ë“±ì€ ë”ë¯¸ ìœ ì§€) ---
        function renderPaymentHistory() { /* ê¸°ì¡´ ë¡œì§ ìœ ì§€ */ }
        function renderPointLogs() { /* ê¸°ì¡´ ë¡œì§ ìœ ì§€ */ }
        function runBatchSimulation() { alert('ê²°ì œ ì‹œë®¬ë ˆì´ì…˜'); }
        function loadTerm(t) { document.getElementById('termEditor').value = t + ' ë‚´ìš©...'; }
        function saveTerms() { alert('ì €ì¥ë¨'); }

        // --- ì§€ì›ì‚¬ì—…(ê¸°ì—…ë§ˆë‹¹) ê´€ë¦¬ ---
        let allBizInfoPrograms = [];
        
        async function loadBizInfoPrograms() {
            const tbody = document.getElementById('bizinfoTableBody');
            tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; padding:2rem;"><i class="ph ph-spinner" style="animation: spin 1s linear infinite;"></i> ê¸°ì—…ë§ˆë‹¹ APIì—ì„œ ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>';
            
            try {
                const getBizInfoPrograms = functions.httpsCallable('getBizInfoPrograms');
                const result = await getBizInfoPrograms({});
                
                if (result.data && result.data.success) {
                    allBizInfoPrograms = result.data.programs || [];
                    renderBizInfoTable(allBizInfoPrograms);
                    console.log('âœ… ì§€ì›ì‚¬ì—… ë¡œë“œ ì™„ë£Œ:', allBizInfoPrograms.length + 'ê°œ');
                } else {
                    throw new Error(result.data?.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('âŒ ì§€ì›ì‚¬ì—… ë¡œë“œ ì˜¤ë¥˜:', error);
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; padding:2rem; color:red;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message + '</td></tr>';
            }
        }
        
        function renderBizInfoTable(programs) {
            const tbody = document.getElementById('bizinfoTableBody');
            document.getElementById('bizinfoCount').textContent = 'ì´ ' + programs.length + 'ê°œ';
            
            if (programs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center; padding:2rem;">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</td></tr>';
                return;
            }
            
            tbody.innerHTML = programs.map((p, idx) => {
                const statusBadge = p.isOpen 
                    ? '<span class="badge badge-green">ì§„í–‰ì¤‘</span>' 
                    : '<span class="badge badge-red">ë§ˆê°</span>';
                
                // ë“±ë¡ì¼ í¬ë§·íŒ…
                let regDate = p.registeredDate || '';
                if (regDate.length >= 10) {
                    regDate = regDate.substring(0, 10);
                }
                
                // ì‹ ì²­ê¸°ê°„ í¬ë§·íŒ…
                let period = p.applicationPeriod || '';
                if (period.includes('~')) {
                    const [start, end] = period.split('~').map(s => s.trim());
                    if (start.length === 8 && end.length === 8) {
                        period = start.substring(4,6) + '/' + start.substring(6,8) + ' ~ ' + end.substring(4,6) + '/' + end.substring(6,8);
                    }
                }
                
                return '<tr>' +
                    '<td style="text-align:center;">' + (idx + 1) + '</td>' +
                    '<td><a href="' + (p.detailUrl || '#') + '" target="_blank" style="color:var(--primary-color); text-decoration:none;">' + (p.name || '-') + '</a></td>' +
                    '<td>' + (p.organization || '-') + '</td>' +
                    '<td>' + (p.executor || '-') + '</td>' +
                    '<td><span class="badge badge-gray">' + (p.category || '-') + '</span></td>' +
                    '<td>' + (p.target || '-') + '</td>' +
                    '<td style="white-space:nowrap;">' + period + '</td>' +
                    '<td style="white-space:nowrap;">' + regDate + '</td>' +
                    '<td>' + statusBadge + '</td>' +
                '</tr>';
            }).join('');
        }
        
        function filterBizInfoTable() {
            const category = document.getElementById('bizinfoCategoryFilter').value;
            const status = document.getElementById('bizinfoStatusFilter').value;
            const search = document.getElementById('bizinfoSearchInput').value.toLowerCase();
            
            let filtered = allBizInfoPrograms;
            
            if (category) {
                filtered = filtered.filter(p => p.category === category);
            }
            if (status === 'open') {
                filtered = filtered.filter(p => p.isOpen === true);
            } else if (status === 'closed') {
                filtered = filtered.filter(p => p.isOpen === false);
            }
            if (search) {
                filtered = filtered.filter(p => (p.name || '').toLowerCase().includes(search));
            }
            
            renderBizInfoTable(filtered);
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            // ë¦¬ìŠ¤ë„ˆê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë©´ ìë™ìœ¼ë¡œ ë Œë”ë§í•¨
        }
    </script>
</body>
</html>