<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>웹푸시 발송시스템</title>
    
    <!-- Google OAuth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        /* ========================================== */
        /* iOS 사파리 최적화 전역 설정 */
        /* ========================================== */
        
        html {
            height: -webkit-fill-available;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
            -webkit-overflow-scrolling: touch;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: #ffffff;
            padding: 20px;
            /* iOS Safe Area 대응 */
            padding-left: max(20px, env(safe-area-inset-left));
            padding-right: max(20px, env(safe-area-inset-right));
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            /* 터치 스크롤 최적화 */
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* 상단 네비게이션 - 한 줄 가로 스크롤 */
        .top-nav {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            /* 하드웨어 가속 */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }
        
        /* PC/태블릿에서 우측 정렬 */
        @media (min-width: 768px) {
            .top-nav {
                justify-content: flex-end;
            }
        }
        
        .top-nav::-webkit-scrollbar {
            display: none;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            font-size: 12px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @-webkit-keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            -webkit-animation: pulse 2s infinite;
            flex-shrink: 0;
        }
        
        .status-dot.connected { background: #4CAF50; }
        .status-dot.disconnected { background: #ff6b6b; }
        
        .back-btn, .btn-nav {
            min-height: 36px;
            min-width: 36px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
            /* iOS 터치 최적화 */
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.2);
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .back-btn:hover, .btn-nav:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .drive-btn {
            min-height: 36px;
            padding: 4px 12px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .drive-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }
        
        .push-permission-btn {
            padding: 4px 12px;
            min-height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .push-permission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        /* 헤더 */
        h1 {
            text-align: center;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
        }
        
        .subtitle {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        /* 알림 배너 */
        .alert-banner {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .alert-banner.show {
            display: flex;
        }
        
        .alert-banner .icon {
            font-size: 24px;
        }
        
        .alert-banner .message {
            flex: 1;
            font-weight: 500;
        }
        
        .alert-banner .close-btn {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* 탭 버튼 - 한 줄 가로 스크롤, 왼쪽 정렬 */
        .tabs {
            display: flex;
            justify-content: flex-start;
            gap: 8px;
            margin-bottom: 30px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            padding: 4px 12px;
            min-height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }
        
        /* 카드 */
        .card {
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            color: #333333;
        }
        
        .card h2 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #1a237e;
            font-size: 20px;
        }
        
        .card p, .card label, .card small, .card div {
            color: #333333;
        }
        
        .card input, .card textarea, .card select {
            background: #f5f5f5 !important;
            border: 1px solid #ddd !important;
            color: #333333 !important;
        }
        
        .card input::placeholder, .card textarea::placeholder {
            color: #999999 !important;
        }
        
        /* 모달 내부 요소 스타일 */
        .modal-content label,
        .modal-content p,
        .modal-content div,
        .modal-content small,
        .modal-content span {
            color: #333333 !important;
        }
        
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            background: #f5f5f5 !important;
            border: 1px solid #ddd !important;
            color: #333333 !important;
        }
        
        .modal-content code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            color: #d63384;
        }
        
        /* 안내 박스 스타일 */
        .info-box {
            background: #e3f2fd !important;
            border-left: 4px solid #2196F3 !important;
            color: #1565c0 !important;
        }
        
        .warning-box {
            background: #fff3e0 !important;
            border-left: 4px solid #FFC107 !important;
            color: #e65100 !important;
        }
        
        .success-box {
            background: #e8f5e9 !important;
            border-left: 4px solid #4CAF50 !important;
            color: #2e7d32 !important;
        }
        
        /* 폼 */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
            color: #333333;
        }
        
        .form-group label .required {
            color: #ff6b6b;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            max-width: 100%;
            padding: 8px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            color: #333;
            font-size: 16px; /* 16px 이상 필수 - iOS 자동 줌 방지 */
            font-family: inherit;
            /* iOS 최적화 */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            /* 터치 최적화 */
            touch-action: manipulation;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666666;
            font-size: 12px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 4px 12px;
            min-height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.3s;
            white-space: nowrap;
            /* iOS 터치 최적화 */
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* 고객 선택 영역 */
        .selected-customers-info {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(76, 175, 80, 0.5);
        }
        
        .selected-count {
            font-weight: bold;
            font-size: 18px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* 고객 리스트 */
        .customer-search {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .customer-search input {
            flex: 1;
            min-width: 150px;
        }
        
        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .customer-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .customer-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }
        
        .customer-card.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
        }
        
        .customer-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .customer-info {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 3px;
        }
        
        /* 로그 테이블 */
        .log-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .log-filters select {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #333;
        }
        
        .log-table-container {
            max-height: 600px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 10px;
        }
        
        .log-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .log-item.success {
            border-left-color: #4CAF50;
        }
        
        .log-item.scheduled {
            border-left-color: #FFA500;
        }
        
        .log-item.failed {
            border-left-color: #ff6b6b;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .log-title {
            font-weight: bold;
            font-size: 15px;
        }
        
        .log-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .log-status.success {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }
        
        .log-status.scheduled {
            background: rgba(255, 165, 0, 0.3);
            color: #FFA500;
        }
        
        .log-status.failed {
            background: rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
        }
        
        .log-body {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        
        .log-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            opacity: 0.7;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* 템플릿 */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .template-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .template-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .template-preview {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 12px;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .template-actions {
            display: flex;
            gap: 8px;
        }
        
        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            /* iOS 스크롤 최적화 */
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
        
        .modal.active,
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: #ffffff !important;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            color: #333333;
            /* iOS 최적화 */
            -webkit-overflow-scrolling: touch;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .modal-header h2 {
            border: none;
            padding: 0;
            margin: 0;
            color: #1a237e;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e0e0e0;
            color: #333333;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }
        
        .modal-close:hover {
            background: #ff6b6b;
            color: white;
            border-color: #ff5252;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }
        
        /* 통계 대시보드 - 높이 50% 축소 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .stat-label {
            font-size: 11px;
            opacity: 0.8;
        }
        
        /* ========================================== */
        /* 반응형 미디어 쿼리 - iOS 디바이스 최적화 */
        /* ========================================== */
        
        /* iPhone 14 Pro Max, 13 Pro Max, 12 Pro Max (428px) */
        @media (max-width: 428px) {
            .container {
                padding: 0 15px;
            }
        }
        
        /* iPhone 14 Pro, 13 Pro, 12 Pro (390px) */
        @media (max-width: 414px) {
            h1 {
                font-size: clamp(1.5rem, 4.5vw, 2rem);
            }
            
            .card {
                padding: 20px 15px;
            }
            
            .tab-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
        
        /* iPhone 14, 13, 12 (375px) */
        @media (max-width: 390px) {
            body {
                padding: 15px;
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
            
            h1 {
                font-size: clamp(1.3rem, 4vw, 1.8rem);
                margin-bottom: 8px;
            }
            
            .subtitle {
                font-size: 13px;
            }
            
            .top-nav {
                padding: 12px 15px;
                margin-bottom: 20px;
            }
            
            .status-indicator {
                padding: 10px 15px;
                font-size: 12px;
            }
            
            .tabs {
                gap: 10px;
            }
            
            .tab-btn {
                padding: 10px 18px;
                font-size: 13px;
            }
        }
        
        /* iPhone SE 3세대, 8, 7 (375px) */
        @media (max-width: 375px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .card {
                padding: 18px 12px;
            }
            
            .form-group input,
            .form-group textarea,
            .form-group select {
                padding: 10px;
            }
        }
        
        /* iPhone SE 2세대, 12 mini, 13 mini (360px) */
        @media (max-width: 360px) {
            body {
                padding: 12px;
                padding-left: max(12px, env(safe-area-inset-left));
                padding-right: max(12px, env(safe-area-inset-right));
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .top-nav {
                padding: 10px 12px;
            }
            
            .tab-btn {
                padding: 8px 15px;
                font-size: 12px;
            }
            
            .stat-card {
                padding: 5px 8px;
                min-height: 35px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .stat-label {
                font-size: 10px;
            }
        }
        
        /* 공통 모바일 스타일 (768px 이하) */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                overflow-x: auto;
                justify-content: flex-start;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE/Edge */
            }
            
            .tabs::-webkit-scrollbar {
                display: none; /* Chrome, Safari */
            }
            
            .customer-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            /* 대시보드 카드 가로 배치 - 숫자 우측 */
            .stat-card {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 6px 10px;
                text-align: left;
                min-height: 40px;
            }
            
            .stat-value {
                order: 2;
                font-size: 18px;
                margin-bottom: 0;
            }
            
            .stat-label {
                order: 1;
                font-size: 11px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 20px 15px;
                max-height: 85vh;
            }
            
            /* 모바일에서 입력창 가로폭 최적화 */
            .form-group input,
            .form-group textarea,
            .form-group select {
                max-width: 100%;
                width: 100%;
            }
            
            /* 템플릿 제목 한 줄 처리 */
            #templatePreviewList [style*="font-size: 13px"] {
                font-size: 11px !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }
        
        /* 가로 모드 대응 */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.3rem;
                margin-bottom: 5px;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .modal-content {
                max-height: 80vh;
                padding: 15px;
            }
        }
        
        /* Safe Area 추가 지원 */
        @supports (padding: max(0px)) {
            .top-nav,
            .card {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
            }
            
            @media (max-width: 768px) {
                .top-nav,
                .card {
                    padding-left: max(15px, env(safe-area-inset-left));
                    padding-right: max(15px, env(safe-area-inset-right));
                }
            }
        }
        
        /* 스크롤바 스타일링 - iOS에서는 자동 숨김 */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            -webkit-transition: background 0.3s;
            transition: background 0.3s;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* iOS 네이티브 스크롤 동작 */
        .customer-grid,
        .log-table-container,
        .modal-content,
        .tabs {
            -webkit-overflow-scrolling: touch;
        }
        
        /* 로딩 인디케이터 */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.show {
            display: block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            -webkit-animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
    
        /* ========================================== */
        /* iOS 사파리 추가 최적화 */
        /* ========================================== */
        
        /* 모든 클릭 가능한 요소 터치 최적화 */
        button,
        a,
        [onclick],
        [role="button"],
        .btn,
        .tab-btn,
        .back-btn,
        .btn-nav,
        .drive-btn,
        .push-permission-btn {
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.15);
            touch-action: manipulation;
            -webkit-touch-callout: none;
        }
        
        /* Input 요소들 iOS 최적화 */
        input,
        textarea,
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 8px;
        }
        
        /* iOS에서 input 포커스 시 페이지 이동 방지 */
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        /* iOS에서 선택 텍스트 색상 */
        ::selection {
            background: rgba(102, 126, 234, 0.3);
            color: white;
        }
        
        ::-moz-selection {
            background: rgba(102, 126, 234, 0.3);
            color: white;
        }
        
        /* iOS에서 링크 하이라이트 제거 */
        a {
            -webkit-tap-highlight-color: transparent;
        }
        
        /* iOS 가로 스크롤 관성 스크롤 */
        .tabs,
        .customer-grid,
        .log-table-container {
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        
        /* iOS에서 고정 요소 플리커링 방지 */
        .modal,
        .alert-banner,
        .top-nav {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-perspective: 1000;
            perspective: 1000;
        }
        
        /* iOS 글꼴 렌더링 최적화 */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* iOS에서 버튼 클릭 시 깜빡임 방지 */
        .btn,
        button {
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }
        
        /* iOS에서 텍스트 크기 자동 조정 방지 */
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* 작은 화면에서 모달 최적화 */
        @media (max-width: 390px) {
            .modal-content {
                padding: 20px 12px;
                border-radius: 12px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
        }
        
        /* iPhone 노치 대응 - 추가 안전 영역 */
        @supports (padding: max(0px)) {
            body {
                padding-top: max(20px, env(safe-area-inset-top));
            }
            
            .modal {
                padding-top: max(20px, env(safe-area-inset-top));
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
        }
        
        /* iOS 다크모드 대응 (선택사항) */
        @media (prefers-color-scheme: dark) {
            /* 이미 다크 테마이므로 추가 조정 불필요 */
        }
        
        
        /* =============================================== */
        /* 고객 초대 시스템 모달 스타일 */
        /* =============================================== */
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            /* 스크롤바 스타일 */
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2);
        }
        
        /* 웹킷 브라우저 스크롤바 스타일 */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-content::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .modal-close:hover {
            background: rgba(255, 107, 107, 0.9);
            border-color: #ff5252;
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5);
        }
        
    
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .btn-primary {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        
        .btn-copy, .btn-delete {
            padding: 10px 16px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 2px;
        }
        
        .btn-copy {
            background: rgba(100, 181, 246, 0.8);
            color: white;
        }
        
        .btn-delete {
            background: rgba(239, 83, 80, 0.8);
            color: white;
        }
        
        .btn-copy:hover, .btn-delete:hover {
            transform: translateY(-2px);
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-pending {
            background: rgba(255, 152, 0, 0.3);
            color: #FFB74D;
        }
        
        .status-sent {
            background: rgba(33, 150, 243, 0.3);
            color: #64B5F6;
        }
        
        .status-subscribed {
            background: rgba(76, 175, 80, 0.3);
            color: #81C784;
        }
        
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(76, 175, 80, 0.95);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }
        
        .alert.error {
            background: rgba(244, 67, 54, 0.95);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* ========================================== */
        /* 사전 확인 시스템 스타일 (NEW) */
        /* ========================================== */
        
        .pending-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: bold;
            animation: pulse-badge 2s infinite;
            -webkit-animation: pulse-badge 2s infinite;
        }
        
        @keyframes pulse-badge {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        @-webkit-keyframes pulse-badge {
            0%, 100% { opacity: 1; -webkit-transform: scale(1); }
            50% { opacity: 0.8; -webkit-transform: scale(1.05); }
        }
        
        .scheduled-message-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
            position: relative;
            transition: all 0.3s;
        }
        
        .scheduled-message-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }
        
        .scheduled-message-card.pending-approval {
            border-left-color: #FFA500;
            background: rgba(255, 165, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.2);
        }
        
        .scheduled-message-card.approved {
            border-left-color: #4CAF50;
        }
        
        .scheduled-message-card.draft {
            border-left-color: #999;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .message-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            flex: 1;
            min-width: 200px;
        }
        
        .message-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .message-status.pending-approval {
            background: rgba(255, 165, 0, 0.3);
            color: #FFD700;
            animation: pulse-status 2s infinite;
            -webkit-animation: pulse-status 2s infinite;
        }
        
        @keyframes pulse-status {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 165, 0, 0.3); }
            50% { box-shadow: 0 0 15px rgba(255, 165, 0, 0.6); }
        }
        
        @-webkit-keyframes pulse-status {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 165, 0, 0.3); }
            50% { box-shadow: 0 0 15px rgba(255, 165, 0, 0.6); }
        }
        
        .message-status.approved {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }
        
        .message-status.draft {
            background: rgba(158, 158, 158, 0.3);
            color: #999;
        }
        
        .message-body {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        .message-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            font-size: 13px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-item .icon {
            font-size: 16px;
        }
        
        .message-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-approve {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 44px;
        }
        
        .btn-approve:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .btn-modify {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 44px;
        }
        
        .btn-modify:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }
        
        .btn-cancel {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 44px;
        }
        
        .btn-cancel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
        }
        
        .approval-alert {
            background: linear-gradient(135deg, #FFB74D 0%, #FFA726 100%);
            color: #5D4037;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }
        
        .approval-alert .icon {
            font-size: 24px;
        }
        
        .approval-alert .message {
            flex: 1;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.6;
        }
        
        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 15px;
        }
        
        .empty-state .text {
            font-size: 16px;
        }

    
        .btn-edit {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 2px;
            background: rgba(255, 193, 7, 0.8);
            color: white;
        }
        
        .btn-edit:hover {
            transform: translateY(-2px);
            background: rgba(255, 193, 7, 1);
        }

    
        /* =============================================== */
        /* iOS Safari 최적화 */
        /* =============================================== */
        
        /* iOS Safe Area (노치, Dynamic Island 대응) */
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* iOS 터치 하이라이트 제거 */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        /* iOS 텍스트 크기 자동 조정 방지 */
        body {
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* iOS 관성 스크롤 */
        .modal-content,
        .tab-content {
            -webkit-overflow-scrolling: touch;
        }
        
        /* iOS input 기본 스타일 제거 */
        input,
        textarea,
        select,
        button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 8px;
        }
        
        /* iOS input 포커스 시 줌 방지 (16px 이상) */
        input,
        textarea,
        select {
            font-size: 16px !important;
        }
        
        /* 터치 액션 최적화 */
        button,
        a,
        .btn,
        [onclick] {
            touch-action: manipulation;
            cursor: pointer;
        }
        
        /* iOS 모달 스크롤 고정 */
        body.modal-open {
            position: fixed;
            width: 100%;
            overflow: hidden;
        }
        
        /* iOS 100vh 이슈 해결 */
        .modal {
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        /* iOS 폰트 렌더링 개선 */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        
        /* =============================================== */
        /* 모바일 최적화 (iPhone 전용) */
        /* =============================================== */
        
        /* iPhone SE, Mini (375px) */
        @media (max-width: 390px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 20px !important;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 24px !important;
            }
            
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-btn {
                font-size: 12px;
                padding: 10px 12px;
                white-space: nowrap;
            }
        }
        
        /* iPhone Standard (390px - 428px) */
        @media (max-width: 428px) {
            /* 가이드 모달 모바일 최적화 */
            #guideModal .modal-content {
                padding: 15px !important;
                width: 98% !important;
            }
            
            #guideModal .modal-header {
                margin: -15px -15px 15px -15px !important;
                padding: 15px !important;
            }
            
            #guideModal h2 {
                font-size: clamp(1rem, 5vw, 1.3rem) !important;
                padding-right: 40px;
            }
            
            #guideModal h3 {
                font-size: clamp(0.95rem, 4.5vw, 1.2rem) !important;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            }
            
            .guide-content {
                padding: 2px 5px !important;
            }
            
            .guide-content > div {
                padding: 8px 10px !important;
                margin-bottom: 10px !important;
                border-radius: 10px !important;
            }
            
            .guide-content > div > div {
                padding: 8px 10px !important;
                border-radius: 6px !important;
            }
            
            .guide-content details {
                padding: 8px 10px !important;
            }
            
            .guide-content summary {
                font-size: clamp(0.9rem, 4vw, 1rem) !important;
                font-weight: bold !important;
            }
            
            .guide-content strong {
                color: #FFF59D !important;
            }
            
            #guideModal .modal-close {
                right: 10px !important;
                top: 10px !important;
                width: 32px !important;
                height: 32px !important;
                font-size: 24px !important;
            }
            
            /* 카드 스택 */
            .card {
                margin-bottom: 15px;
            }
            
            /* 버튼 터치 영역 확대 */
            button,
            .btn,
            .tab-btn {
                min-height: 44px;
                min-width: 44px;
                padding: 12px 20px;
            }
            
            /* 작은 버튼도 터치 가능하게 */
            .btn-edit,
            .btn-copy,
            .btn-delete {
                min-height: 40px;
                min-width: 40px;
                padding: 10px 14px;
                font-size: 14px;
            }
            
            /* 입력 필드 */
            input,
            textarea,
            select {
                min-height: 44px;
                font-size: 16px !important;
            }
            
            /* 테이블 가로 스크롤 */
            table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                white-space: nowrap;
            }
        }
        
        /* 가로 모드 (Landscape) */
        @media (max-height: 500px) and (orientation: landscape) {
            .modal-content {
                max-height: 85vh;
                overflow-y: auto;
            }
            
            h1 {
                font-size: 18px !important;
                margin-bottom: 10px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* iPad Mini, Air (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 90%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .tab-btn {
                font-size: 14px;
                padding: 12px 20px;
            }
        }
        
        /* 다크모드 대응 (iOS 13+) */
        @media (prefers-color-scheme: dark) {
            /* 이미 다크 테마이므로 유지 */
        }
        
        /* 고대비 모드 대응 (접근성) */
        @media (prefers-contrast: high) {
            button,
            .btn {
                border: 2px solid white;
            }
        }
        
        /* 모션 감소 모드 (접근성) */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- 상단 네비게이션 - 한 줄 가로 스크롤 -->
        <div class="top-nav">
            <button class="back-btn" onclick="location.href='index.html'">Main</button>
            
            <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">준비중</span>
            </div>
            
            <button class="push-permission-btn" id="pushPermissionBtn" onclick="requestPushPermission()">
                🔔 알림
            </button>
            <button class="drive-btn" id="driveBtn" onclick="connectDrive()">
                📁 Drive
            </button>
            <button class="btn-nav" onclick="loadAllData()">불러오기</button>
            <button class="btn-nav" onclick="saveAllData()">저장하기</button>
            <button class="btn-nav" onclick="openGuideModal()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">📖 가이드</button>
        </div>

        <!-- 헤더 -->
        <h1>웹푸시 발송시스템</h1>
        

        <!-- 알림 배너 -->
        <div class="alert-banner" id="alertBanner">
            <span class="icon">⚠️</span>
            <div class="message" id="alertMessage"></div>
            <button class="close-btn" onclick="closeAlert()">×</button>
        </div>

        <!-- 통계 대시보드 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="statCustomers">0</div>
                <div class="stat-label">등록 고객</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statMessages">0</div>
                <div class="stat-label">총 발송</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statScheduled">0</div>
                <div class="stat-label">예약 대기</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statSubscribers">0</div>
                <div class="stat-label">구독자</div>
            </div>
        </div>

        <!-- 탭 메뉴 - 한 줄 가로 스크롤, 왼쪽 정렬 -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('send', this)">📤 발송</button>
            <button class="tab-btn" onclick="switchTab('scheduled', this)">⏰ 예약 <span id="pendingBadge" class="pending-badge" style="display:none;">0</span></button>
            <button class="tab-btn" onclick="switchTab('customers', this)">👥 고객관리</button>
            <button class="tab-btn" onclick="switchTab('anniversary', this)">🎂 기념일</button>
            <button class="tab-btn" onclick="switchTab('log', this)">📋 로그</button>
            <button class="tab-btn" onclick="switchTab('template', this)">📝 템플릿</button>
            <button class="tab-btn" onclick="switchTab('import', this)">📥 가져오기</button>
            <button class="tab-btn" onclick="switchTab('settings', this)">⚙️ 설정</button>
        </div>

        <!-- 메시지 발송 탭 -->
        <div id="sendTab" class="tab-content">
            <div class="card">
                <h2>📤 메시지 발송</h2>
                
                <div class="selected-customers-info" id="selectedCustomersInfo" style="display: none;">
                    <div>
                        <span class="selected-count" id="selectedCount">0명</span> 선택됨
                    </div>
                    <button class="btn btn-secondary" onclick="clearSelection()">선택 해제</button>
                </div>
                
                <form id="sendForm" onsubmit="sendMessage(event)">
                    <div class="form-group">
                        <label>수신자 선택 <span class="required">*</span></label>
                        <div class="customer-search">
                            <input type="text" id="customerSearchSend" placeholder="이름, 회사, 직함으로 검색..." oninput="renderCustomersForSend()">
                            <button type="button" class="btn btn-secondary" onclick="toggleSelectAll()">전체 선택</button>
                        </div>
                        <div class="customer-grid" id="customerGridSend"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="messageTitle">제목 <span class="required">*</span></label>
                        <input type="text" id="messageTitle" required maxlength="100" placeholder="예: {honorific}, 신제품 안내드립니다">
                        <small>최대 100자 | 제목에도 {honorific}, {name} 등 변수 사용 가능!</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="messageBody">내용 <span class="required">*</span></label>
                        <textarea id="messageBody" required maxlength="500" placeholder="메시지 내용을 입력하세요...

사용 가능한 변수:
{honorific} - 스마트 호칭 (홍길동님, 과장님, 길동아 등) ⭐ NEW!
{name} - 고객 이름
{position} - 직함
{company} - 회사명"></textarea>
                        <small style="color: #FFD700;">💡 {honorific} 변수로 고객별 맞춤 호칭 자동 적용!</small>
                        <small>최대 500자 | 변수: {honorific}, {name}, {position}, {company}</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="sendType">발송 방식 <span class="required">*</span></label>
                        <select id="sendType" onchange="toggleSchedule()">
                            <option value="immediate">즉시 발송</option>
                            <option value="scheduled">예약 발송</option>
                        </select>
                    </div>
                    
                    <div class="form-group hidden" id="scheduleGroup">
                        <label for="scheduleTime">예약 시각 (KST) <span class="required">*</span></label>
                        <input type="datetime-local" id="scheduleTime">
                        <small>최소 현재 시각으로부터 1분 이후로 설정해주세요</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="resetSendForm()">초기화</button>
                        <button type="submit" class="btn btn-primary">발송하기</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- 예약 관리 탭 (NEW) -->
        <!-- ========================================== -->
        <div id="scheduledTab" class="tab-content hidden">
            <div class="card">
                <h2>⏰ 예약 메시지 관리</h2>
                <p style="opacity: 0.8; margin-bottom: 20px;">
                    📌 예약된 메시지는 발송 <strong>전일 오전 10시</strong>에 자동으로 확인 알림이 발송됩니다.<br>
                    사전 확인 후 승인하시면 예정된 시간에 자동 발송됩니다.
                </p>
                
                <!-- 필터 -->
                <div class="log-filters" style="margin-bottom: 20px;">
                    <select id="scheduledFilter" onchange="renderScheduledMessages()">
                        <option value="all">전체 보기</option>
                        <option value="pending-approval">승인 대기</option>
                        <option value="approved">승인 완료</option>
                        <option value="draft">임시 저장</option>
                    </select>
                    <button class="btn btn-secondary" onclick="checkPendingApprovals()">🔔 사전 확인 시뮬레이션</button>
                </div>
                
                <!-- 예약 메시지 리스트 -->
                <div id="scheduledMessagesList"></div>
            </div>
        </div>

        <!-- 고객 관리 탭 -->
        <div id="customersTab" class="tab-content hidden">
            <div class="card">
                <h2>👥 고객 관리</h2>
                
                <div class="form-actions" style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="openCustomerModal()" style="display: inline-flex !important; align-items: center; justify-content: center; gap: 4px;">+ 고객 추가</button>
                    <button class="btn btn-secondary" onclick="importCustomers()" style="display: inline-flex !important; align-items: center; justify-content: center; gap: 4px; min-width: 110px;">
                        <span>📥</span><span>가져오기</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportInviteCustomers()" style="display: inline-flex !important; align-items: center; justify-content: center; gap: 4px; min-width: 140px;">
                        <span>📤</span><span>CSV 내보내기</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportToVCard()" style="display: inline-flex !important; align-items: center; justify-content: center; gap: 4px; min-width: 160px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <span>📱</span><span>연락처 내보내기</span>
                    </button>
                </div>
                
                <div class="customer-search">
                    <input type="text" id="customerSearch" placeholder="이름, 회사, 직함으로 검색..." oninput="renderCustomers()">
                </div>
                
                <div class="customer-grid" id="customerGrid"></div>
            </div>
        </div>

        <!-- 기념일 자동발송 탭 -->
        <div id="anniversaryTab" class="tab-content hidden">
            <!-- 안내 카드 -->
            <div class="card">
                <h2>🎂 기념일 자동발송 시스템</h2>
                <p style="color: #666; margin-bottom: 15px; line-height: 1.6;">
                    고객의 생일, 기념일, 명절, 24절기 등에 자동으로 메시지를 발송합니다.<br>
                    📌 <strong style="color: #333;">발송 전날</strong> 자동 알림을 받고, 확인 후 발송됩니다.
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="background: #fff3e0; padding: 15px; border-radius: 10px; border-left: 4px solid #FFC107;">
                        <div style="font-size: 24px; font-weight: bold; color: #e65100;" id="anniversaryTotalCount">0</div>
                        <div style="font-size: 13px; color: #e65100;">총 등록 기념일</div>
                    </div>
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; border-left: 4px solid #4CAF50;">
                        <div style="font-size: 24px; font-weight: bold; color: #2e7d32;" id="anniversaryActiveCount">0</div>
                        <div style="font-size: 13px; color: #2e7d32;">활성 자동발송</div>
                    </div>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; border-left: 4px solid #2196F3;">
                        <div style="font-size: 24px; font-weight: bold; color: #1565c0;" id="anniversaryUpcomingCount">0</div>
                        <div style="font-size: 13px; color: #1565c0;">이번 달 예정</div>
                    </div>
                </div>
            </div>
            
            <!-- 기념일 등록 카드 -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2 style="margin: 0;">📅 기념일 관리</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showAnniversaryTemplates()" style="background: rgba(33, 150, 243, 0.8);">📋 템플릿 미리보기</button>
                        <button class="btn btn-success" onclick="openAnniversaryModal()">+ 기념일 추가</button>
                    </div>
                </div>
                
                <!-- 필터 -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <select id="anniversaryFilter" onchange="renderAnniversaries()" style="padding: 8px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <option value="all">전체 보기</option>
                        <option value="active">활성 상태</option>
                        <option value="inactive">비활성 상태</option>
                        <option value="personal">개인 기념일</option>
                        <option value="holiday">명절/24절기</option>
                        <option value="upcoming">다가오는 기념일</option>
                    </select>
                    
                    <input type="text" id="anniversarySearch" placeholder="🔍 검색..." onkeyup="renderAnniversaries()" style="flex: 1; min-width: 200px; padding: 8px 15px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                </div>
                
                <!-- 기념일 목록 -->
                <div id="anniversaryList" style="overflow-x: auto;"></div>
            </div>
        </div>

        <!-- 발송 로그 탭 -->
        <div id="logTab" class="tab-content hidden">
            <div class="card">
                <h2>📋 발송 로그</h2>
                
                <div class="log-filters">
                    <select id="logFilter" onchange="renderMessages()">
                        <option value="all">전체 보기</option>
                        <option value="success">발송 완료</option>
                        <option value="scheduled">예약 대기</option>
                        <option value="failed">발송 실패</option>
                    </select>
                    <select id="logSort" onchange="renderMessages()">
                        <option value="newest">최신순</option>
                        <option value="oldest">오래된순</option>
                    </select>
                </div>
                
                <div class="log-table-container" id="logContainer"></div>
            </div>
        </div>

        <!-- 템플릿 탭 -->
        <div id="templateTab" class="tab-content hidden">
            <div class="card">
                <h2>📝 템플릿 관리</h2>
                
                <div class="form-actions" style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="openTemplateModal()">+ 템플릿 추가</button>
                </div>
                
                <div class="template-grid" id="templateList"></div>
            </div>
        </div>

        <!-- 설정 탭 -->
        <!-- 고객 가져오기 탭 -->
        <div id="importTab" class="tab-content hidden">
            <div class="card">
                <h2>📥 고객 정보 가져오기</h2>
                
                <!-- 사용 안내 -->
                <div class="info-box" style="border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <div style="font-size: 14px; line-height: 1.7; color: #1565c0 !important;">
                        <strong>📱 가장 쉬운 방법 (권장)</strong><br>
                        <div style="margin-top: 8px; padding-left: 10px; background: rgba(255,255,255,0.8); padding: 10px; border-radius: 8px; color: #333 !important;">
                            <strong style="color: #1565c0;">1️⃣ 폰 연락처 앱에서 내보내기</strong><br>
                            <span style="font-size: 13px;">• 연락처 앱 열기 → 메뉴(⋮) → "연락처 내보내기"<br>
                            • 또는 "공유" → vCard 파일로 저장<br>
                            • 전체 선택 또는 원하는 연락처만 선택 가능</span><br><br>
                            
                            <strong style="color: #1565c0;">2️⃣ 저장한 파일 불러오기</strong><br>
                            <span style="font-size: 13px;">• 아래 "📇 폰연락처" 버튼 클릭<br>
                            • 저장한 .vcf 파일 선택<br>
                            • <strong>여러 파일 한 번에 선택 가능! ✨</strong></span><br><br>
                            
                            <div style="background: #FFF3CD; padding: 8px; border-radius: 5px; border-left: 3px solid #FFB300; margin-top: 8px;">
                                <strong>💡 팁:</strong> Android Chrome에서는 "📱 연락처 직접선택" 버튼을 사용하면 더 편리합니다!
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="import-section" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <!-- 휴대폰 연락처 직접 선택 (모바일 전용) -->
                    <div class="import-btn" id="contactPickerBtn" onclick="pickContacts()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 2px solid #764ba2; border-radius: 10px; padding: 20px; cursor: pointer; text-align: center; color: white;">
                        <div class="icon" style="font-size: 32px; margin-bottom: 10px;">📱</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">연락처 직접선택</div>
                        <div style="font-size: 12px; opacity: 0.9;">Android Chrome 전용</div>
                    </div>
                    <div class="import-btn" onclick="document.getElementById('csvFile').click()" style="background: #f5f5f5; border: 2px solid #ddd; border-radius: 10px; padding: 20px; cursor: pointer; text-align: center;">
                        <div class="icon" style="font-size: 32px; margin-bottom: 10px;">📊</div>
                        <div style="font-weight: bold; margin-bottom: 5px; color: #333;">CSV/Excel</div>
                        <div style="font-size: 12px; color: #666;">파일 업로드</div>
                    </div>
                    
                    <div class="import-btn" onclick="document.getElementById('vcfFile').click()" style="background: #f5f5f5; border: 2px solid #ddd; border-radius: 10px; padding: 20px; cursor: pointer; text-align: center;">
                        <div class="icon" style="font-size: 32px; margin-bottom: 10px;">📇</div>
                        <div style="font-weight: bold; margin-bottom: 5px; color: #333;">폰연락처</div>
                        <div style="font-size: 12px; color: #666;">vCard (다중선택 가능)</div>
                    </div>
                    
                    <div class="import-btn" onclick="openTextImport()" style="background: #f5f5f5; border: 2px solid #ddd; border-radius: 10px; padding: 20px; cursor: pointer; text-align: center;">
                        <div class="icon" style="font-size: 32px; margin-bottom: 10px;">📝</div>
                        <div style="font-weight: bold; margin-bottom: 5px; color: #333;">텍스트 입력</div>
                        <div style="font-size: 12px; color: #666;">복사 & 붙여넣기</div>
                    </div>
                    
                    <div class="import-btn" onclick="openManualAdd()" style="background: #f5f5f5; border: 2px solid #ddd; border-radius: 10px; padding: 20px; cursor: pointer; text-align: center;">
                        <div class="icon" style="font-size: 32px; margin-bottom: 10px;">➕</div>
                        <div style="font-weight: bold; margin-bottom: 5px; color: #333;">직접 추가</div>
                        <div style="font-size: 12px; color: #666;">한 명씩 입력</div>
                    </div>
                </div>
                
                <input type="file" id="csvFile" accept=".csv,.xlsx,.xls" style="display: none;" onchange="handleCSVUpload(event)">
                <input type="file" id="vcfFile" accept=".vcf" multiple style="display: none;" onchange="handleVCFUpload(event)">
            </div>
            
            <div class="card">
                <h2>💬 초대 메시지 설정</h2>
                <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                    공통 URL은 SNS/강의/단체문자에 활용하세요. 개별 URL은 각 고객에게 맞춤 발송할 때 사용합니다.
                </p>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">컨설턴트 이름</label>
                    <input type="text" id="consultantName" placeholder="홍길동" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: #f5f5f5; color: #333; font-size: 14px;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">초대 메시지 템플릿</label>
                    <textarea id="messageTemplate" rows="8" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: #f5f5f5; color: #333; font-size: 14px; font-family: inherit;" placeholder="초대 메시지를 입력하세요">안녕하세요, {이름}님! 👋

KFPC {컨설턴트}입니다.

실시간 재무 정보와 세무 뉴스를 받아보세요!

👉 아래 링크를 클릭하여 구독하세요:
{초대링크}

언제든지 문의 주세요! 😊</textarea>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">사용 가능한 변수: {이름}, {컨설턴트}, {초대링크}</div>
                </div>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="saveMessageTemplate()" style="flex: 1; min-width: 150px; padding: 12px 24px; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); border: none; border-radius: 8px; color: white; font-size: 14px; font-weight: bold; cursor: pointer;">💾 설정 저장</button>
                    <button onclick="copyCommonUrl()" style="flex: 1; min-width: 150px; padding: 12px 24px; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); border: none; border-radius: 8px; color: white; font-size: 14px; font-weight: bold; cursor: pointer;">📋 공통 URL 복사 (SNS/강의용)</button>
                    <button onclick="copyCommonMessage()" style="flex: 1; min-width: 150px; padding: 12px 24px; background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); border: none; border-radius: 8px; color: white; font-size: 14px; font-weight: bold; cursor: pointer;">💬 공통 메시지 복사</button>
                </div>
            </div>
        </div>


        
        <div id="settingsTab" class="tab-content hidden">
            <!-- 컨설턴트 정보 설정 -->
            <div class="card">
                <h2>👤 컨설턴트 정보 설정</h2>
                <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
                    메시지 템플릿의 <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px; color: #d63384;">{consultant}</code> 변수에 사용될 정보를 설정합니다.
                </p>
                
                <div class="form-group">
                    <label for="consultantCompany">회사명 (선택)</label>
                    <input type="text" id="consultantCompany" placeholder="예: KFPC 재무컨설팅" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 14px;">
                    <small style="opacity: 0.7;">비워두면 표시되지 않습니다</small>
                </div>
                
                <div class="form-group">
                    <label for="consultantNameSet">성명 <span class="required">*</span></label>
                    <input type="text" id="consultantNameSet" placeholder="예: 김재무" required style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 14px;">
                </div>
                
                <div class="form-group">
                    <label for="consultantPosition">직함 (선택)</label>
                    <input type="text" id="consultantPosition" placeholder="예: 대표 컨설턴트" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 14px;">
                    <small style="opacity: 0.7;">비워두면 표시되지 않습니다</small>
                </div>
                
                <div class="form-group">
                    <label>미리보기</label>
                    <div id="consultantPreview" style="padding: 15px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; line-height: 1.6;">
                        <strong style="color: #333;">메시지 서명:</strong><br>
                        <span id="previewText" style="color: #666;">- KFPC 컨설턴트 드림</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="saveConsultantInfo()">💾 저장</button>
            </div>

            <div class="card">
                <h2>⚙️ 시스템 설정</h2>
                
                <div class="form-group">
                    <label>푸시 알림 상태</label>
                    <div id="pushStatus" style="padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        확인 중...
                    </div>
                </div>
                
                <div class="form-group">
                    <label>데이터 동기화</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="syncAllData()">전체 동기화</button>
                        <button class="btn btn-secondary" onclick="backupData()">백업 생성</button>
                    </div>
                    <small>마지막 동기화: <span id="lastSync">-</span></small>
                </div>
                
                <div class="form-group">
                    <label>조용한 시간 설정</label>
                    <small>설정한 시간대에는 예약 발송이 자동으로 지연됩니다</small>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <div>
                            <label style="font-size: 12px;">시작 시각</label>
                            <input type="time" id="quietHoursStart" value="21:00">
                        </div>
                        <div>
                            <label style="font-size: 12px;">종료 시각</label>
                            <input type="time" id="quietHoursEnd" value="08:00">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>데이터 관리</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="clearCache()">캐시 삭제</button>
                        <button class="btn btn-danger" onclick="resetAllData()">전체 초기화</button>
                    </div>
                </div>
            </div>

            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2 style="margin: 0;">👥 초대 고객 목록</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <input type="text" id="inviteSearchInput" placeholder="🔍 검색..." onkeyup="renderInviteCustomers()" style="padding: 8px 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 13px;">
                        <span id="inviteSelectionInfo" style="color: #FFD700; font-weight: bold; font-size: 13px;">0명 선택됨</span>
                        <button onclick="copySelectedURLs()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); border: none; border-radius: 8px; color: white; font-size: 13px; cursor: pointer; font-weight: bold;">
                            <span>📋</span><span>선택 URL 복사</span>
                        </button>
                        <button onclick="copySelectedMessages()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); border: none; border-radius: 8px; color: white; font-size: 13px; cursor: pointer; font-weight: bold;">
                            <span>💬</span><span>선택 메시지 복사</span>
                        </button>
                        <button onclick="sendSelectedToPhone()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #FEE500 0%, #FFD700 100%); border: none; border-radius: 8px; color: #3C1E1E; font-size: 13px; cursor: pointer; font-weight: bold;">
                            <span>📱</span><span>선택 전송</span>
                        </button>
                        <button onclick="sendAllToPhone()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; font-size: 13px; cursor: pointer; font-weight: bold;">
                            <span>📲</span><span>전체 전송</span>
                        </button>
                        <button onclick="exportInviteCustomers()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: rgba(100, 181, 246, 0.8); border: none; border-radius: 8px; color: white; font-size: 13px; cursor: pointer; font-weight: bold;">
                            <span>📥</span><span>CSV 백업</span>
                        </button>
                        <button onclick="exportToVCard()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); border: none; border-radius: 8px; color: white; font-size: 13px; cursor: pointer; font-weight: bold;">
                            <span>📱</span><span>연락처 내보내기</span>
                        </button>
                        <button onclick="deleteSelectedInviteCustomers()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #FF6B6B 0%, #EE5A52 100%); border: none; border-radius: 8px; color: white; font-size: 14px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);">
                            <span>✅</span><span>선택 삭제</span>
                        </button>
                        <button onclick="clearAllInviteCustomers()" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 8px 16px; background: linear-gradient(135deg, #D32F2F 0%, #C62828 100%); border: none; border-radius: 8px; color: white; font-size: 14px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 8px rgba(211, 47, 47, 0.4);">
                            <span>🗑️</span><span>일괄 삭제</span>
                        </button>
                    </div>
                </div>
                
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(255, 255, 255, 0.1); border-bottom: 2px solid rgba(255, 255, 255, 0.2);">
                                <th style="padding: 12px; text-align: center; font-size: 13px; width: 40px;">
                                    <input type="checkbox" id="inviteSelectAll" onclick="toggleInviteSelectAll()" style="cursor: pointer;">
                                </th>
                                <th style="padding: 12px; text-align: left; font-size: 13px;">이름</th>
                                <th style="padding: 12px; text-align: left; font-size: 13px;">전화번호</th>
                                <th style="padding: 12px; text-align: left; font-size: 13px;">회사</th>
                                <th style="padding: 12px; text-align: left; font-size: 13px;">직함</th>
                                <th style="padding: 12px; text-align: center; font-size: 13px;">상태</th>
                                <th style="padding: 12px; text-align: center; font-size: 13px;">초대</th>
                                <th style="padding: 12px; text-align: center; font-size: 13px;">관리</th>
                            </tr>
                        </thead>
                        <tbody id="inviteCustomerTableBody" style="font-size: 14px;">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; opacity: 0.7;">
                                    아직 등록된 고객이 없습니다.<br>위에서 고객을 불러오세요.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div style="font-size: 14px; opacity: 0.9;">
                        <span style="display: inline-block; margin-right: 15px;">
                            <span style="font-weight: bold; color: #FFD700;">전체:</span> 
                            <span id="inviteTotalCustomers" style="font-size: 18px; font-weight: bold;">0</span>명
                        </span>
                        <span style="display: inline-block; margin-right: 15px;">
                            <span style="font-weight: bold; color: #64B5F6;">발송:</span> 
                            <span id="inviteSentCount" style="font-size: 18px; font-weight: bold;">0</span>명
                        </span>
                        <span style="display: inline-block;">
                            <span style="font-weight: bold; color: #81C784;">구독:</span> 
                            <span id="inviteSubscribedCount" style="font-size: 18px; font-weight: bold;">0</span>명
                        </span>
                    </div>
                </div>
            </div>

        </div>

        <!-- 템플릿 모달 -->
        <div id="templateModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>📝 템플릿 추가</h2>
                    <button class="modal-close" onclick="closeTemplateModal()">×</button>
                </div>
                
                <form id="templateForm" onsubmit="saveTemplate(event)">
                    <div class="form-group">
                        <label for="templateName">템플릿 이름 <span class="required">*</span></label>
                        <input type="text" id="templateName" required maxlength="50" placeholder="예: 신제품 안내">
                    </div>
                    
                    <div class="form-group">
                        <label for="templateTitle">제목 <span class="required">*</span></label>
                        <input type="text" id="templateTitle" required maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="templateBody">내용 <span class="required">*</span></label>
                        <textarea id="templateBody" required maxlength="500"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeTemplateModal()">취소</button>
                        <button type="submit" class="btn btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 고객 추가/수정 모달 -->
        <div id="customerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="customerModalTitle">👤 고객 추가</h2>
                    <button class="modal-close" onclick="closeCustomerModal()">×</button>
                </div>
                
                <form id="customerForm" onsubmit="saveCustomer(event)">
                    <input type="hidden" id="customerId">
                    
                    <div class="form-group">
                        <label for="customerName">이름 <span class="required">*</span></label>
                        <input type="text" id="customerName" required maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerCompany">회사</label>
                        <input type="text" id="customerCompany" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerPosition">직함</label>
                        <input type="text" id="customerPosition" maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerPhone">연락처</label>
                        <input type="tel" id="customerPhone" maxlength="20">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerEmail">이메일</label>
                        <input type="email" id="customerEmail" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerBirth">생일</label>
                        <input type="date" id="customerBirth">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerAnniversary">기념일</label>
                        <input type="date" id="customerAnniversary">
                    </div>
                    
                    <div class="form-group">
                        <label for="customerHonorific">호칭 유형 ⭐<span style="color: #FFD700;"> NEW!</span></label>
                        <select id="customerHonorific" style="padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 14px; width: 100%;">
                            <option value="님">이름 + 님 (홍길동님) - 일반</option>
                            <option value="직함님">직함 + 님 (과장님, 대표님) - 공식</option>
                            <option value="고객님">이름 + 고객님 (홍길동 고객님) - 정중</option>
                            <option value="씨">이름 + 씨 (홍길동씨) - 평어</option>
                            <option value="아야">이름 + 아/야 (길동아, 영희야) - 친구</option>
                            <option value="이름만">이름만 (홍길동) - 특수</option>
                        </select>
                        <small style="color: #FFD700;">💡 메시지에서 {honorific} 변수로 자동 호칭 적용!</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="customerTags">태그</label>
                        <input type="text" id="customerTags" placeholder="VIP, 법인, 재방문 (쉼표로 구분)">
                        <small>쉼표(,)로 구분하여 여러 태그를 입력하세요</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="customerMemo">메모</label>
                        <textarea id="customerMemo" maxlength="500" style="min-height: 80px;"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCustomerModal()">취소</button>
                        <button type="submit" class="btn btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 로딩 인디케이터 -->
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <div>처리 중...</div>
        </div>
    

    <!-- 기념일 추가/수정 모달 -->
    <div id="anniversaryModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="anniversaryModalTitle">📅 기념일 추가</h2>
                <button class="modal-close" onclick="closeAnniversaryModal()">×</button>
            </div>
            
            <form id="anniversaryForm" onsubmit="saveAnniversary(event)">
                <input type="hidden" id="anniversaryId">
                
                <!-- 고객 선택 -->
                <div class="form-group">
                    <label for="anniversaryCustomer">고객 선택 <span class="required">*</span></label>
                    <select id="anniversaryCustomer" required style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <option value="">선택하세요</option>
                    </select>
                </div>
                
                <!-- 기념일 유형 -->
                <div class="form-group">
                    <label for="anniversaryType">기념일 유형 <span class="required">*</span></label>
                    <select id="anniversaryType" required onchange="updateAnniversaryForm()" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <optgroup label="개인 기념일">
                            <option value="birthday">🎂 생일</option>
                            <option value="wedding">💒 결혼기념일</option>
                            <option value="company">🏢 회사 창립일</option>
                            <option value="custom">📅 기타 기념일</option>
                        </optgroup>
                        <optgroup label="일회성 이벤트">
                            <option value="promotion">🎉 승진</option>
                            <option value="admission">🎓 입학</option>
                            <option value="pass">✅ 합격</option>
                            <option value="moving">🏠 이사</option>
                            <option value="opening">🎊 개업</option>
                        </optgroup>
                        <optgroup label="명절 (음력 자동변환)">
                            <option value="lunar-new-year">🧧 설날 (구정)</option>
                            <option value="chuseok">🌕 추석</option>
                        </optgroup>
                        <optgroup label="기타 명절">
                            <option value="christmas">🎄 크리스마스</option>
                            <option value="new-year">🎆 신정 (양력설)</option>
                        </optgroup>
                        <optgroup label="24절기 (자동계산)">
                            <option value="solar-ipchun">🌱 입춘</option>
                            <option value="solar-chunbun">🌸 춘분</option>
                            <option value="solar-ipha">☀️ 입하</option>
                            <option value="solar-haaji">🌞 하지</option>
                            <option value="solar-ipchu">🍂 입추</option>
                            <option value="solar-chubun">🍁 추분</option>
                            <option value="solar-ipdong">❄️ 입동</option>
                            <option value="solar-dongji">⛄ 동지</option>
                        </optgroup>
                    </select>
                </div>
                
                <!-- 날짜 입력 (개인 기념일용) -->
                <div class="form-group" id="anniversaryDateGroup">
                    <label for="anniversaryDate">날짜 <span class="required">*</span></label>
                    <input type="date" id="anniversaryDate" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                    <small id="anniversaryDateHint">개인 기념일의 경우 날짜를 선택하세요</small>
                </div>
                
                <!-- 발송 설정 -->
                <div class="form-group">
                    <label>발송 타이밍 <span class="required">*</span></label>
                    <div style="display: flex; gap: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="anniversaryTiming" value="before" checked>
                            <span>전날 발송 (D-1)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="anniversaryTiming" value="same">
                            <span>당일 발송 (D-day)</span>
                        </label>
                    </div>
                </div>
                
                <!-- 발송 시간 -->
                <div class="form-group">
                    <label for="anniversarySendTime">발송 시간 <span class="required">*</span></label>
                    <input type="time" id="anniversarySendTime" value="09:00" required style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                    <small>기념일 메시지를 발송할 시간을 설정하세요</small>
                </div>
                
                <!-- 반복 설정 -->
                <div class="form-group" id="anniversaryRepeatGroup">
                    <label>반복 설정 <span class="required">*</span></label>
                    <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="anniversaryRepeat" value="once" checked onchange="toggleRepeatEnd()">
                            <span>1회만 발송</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="anniversaryRepeat" value="yearly" onchange="toggleRepeatEnd()">
                            <span>매년 반복</span>
                        </label>
                    </div>
                    
                    <!-- 반복 종료일 -->
                    <div id="repeatEndGroup" style="display: none; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <input type="checkbox" id="repeatUnlimited" onchange="toggleRepeatEndDate()">
                            <span>무제한 반복</span>
                        </label>
                        <div id="repeatEndDateGroup">
                            <label style="font-size: 13px; margin-bottom: 5px; display: block;">반복 종료일</label>
                            <input type="date" id="repeatEndDate" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                            <small>이 날짜 이후에는 자동 발송되지 않습니다</small>
                        </div>
                    </div>
                </div>
                
                <!-- 메시지 템플릿 선택 -->
                <div class="form-group">
                    <label for="anniversaryTemplate">메시지 템플릿 <span class="required">*</span></label>
                    <select id="anniversaryTemplate" required onchange="loadAnniversaryTemplate()" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                        <option value="">템플릿을 선택하세요</option>
                    </select>
                </div>
                
                <!-- 제목 -->
                <div class="form-group">
                    <label for="anniversaryTitle">제목 <span class="required">*</span></label>
                    <input type="text" id="anniversaryTitle" required maxlength="100" placeholder="{honorific}, 생일을 축하드립니다!" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                </div>
                
                <!-- 내용 -->
                <div class="form-group">
                    <label for="anniversaryContent">내용 <span class="required">*</span></label>
                    <textarea id="anniversaryContent" required maxlength="500" rows="6" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); font-family: inherit;"></textarea>
                    <small>변수: {honorific}, {name}, {company}, {position}</small>
                </div>
                
                <!-- 활성화 상태 -->
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="anniversaryActive" checked>
                        <span>자동 발송 활성화</span>
                    </label>
                    <small>비활성화하면 발송되지 않습니다</small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAnniversaryModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 고객 수정 모달 -->
    <div id="editCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✏️ 고객 정보 수정</h2>
                <button class="modal-close" onclick="closeModal('editCustomerModal')">×</button>
            </div>
            
            <input type="hidden" id="editCustomerId">
            
            <div class="form-group">
                <label>이름 *</label>
                <input type="text" id="editName" required>
            </div>
            
            <div class="form-group">
                <label>전화번호 *</label>
                <input type="text" id="editPhone" required>
            </div>
            
            <div class="form-group">
                <label>회사</label>
                <input type="text" id="editCompany">
            </div>
            
            <div class="form-group">
                <label>직함</label>
                <input type="text" id="editPosition">
            </div>
            
            <div class="form-group">
                <label>이메일</label>
                <input type="email" id="editEmail">
            </div>
            
            <div class="form-group">
                <label>호칭 유형 ⭐</label>
                <select id="editHonorific" style="padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 14px; width: 100%;">
                    <option value="님">이름 + 님 (홍길동님)</option>
                    <option value="직함님">직함 + 님 (과장님)</option>
                    <option value="고객님">이름 + 고객님 (홍길동 고객님)</option>
                    <option value="씨">이름 + 씨 (홍길동씨)</option>
                    <option value="아야">이름 + 아/야 (길동아)</option>
                    <option value="이름만">이름만 (홍길동)</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="saveEditedCustomer()">✅ 저장</button>
        </div>
    </div>
</div>

    <!-- 기념일 템플릿 미리보기 모달 -->
    <div id="anniversaryTemplatesModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 style="font-size: clamp(1rem, 4vw, 1.5rem); white-space: nowrap;">📋 기념일 메시지 템플릿</h2>
                <button class="modal-close" onclick="closeAnniversaryTemplatesModal()">×</button>
            </div>
            
            <div class="warning-box" style="border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                <div style="font-size: 14px; line-height: 1.6; color: #e65100 !important;">
                    💡 <strong>사용 가능한 변수:</strong><br>
                    • <code>{honorific}</code> - 호칭 (홍길동님, 과장님 등)<br>
                    • <code>{name}</code> - 이름<br>
                    • <code>{position}</code> - 직함<br>
                    • <code>{company}</code> - 회사명<br>
                    • <code>{consultant}</code> - 컨설턴트 서명
                </div>
            </div>
            
            <div id="templatePreviewList" style="display: grid; gap: 15px;">
                <!-- 템플릿 목록이 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 사용 가이드 모달 -->
    <div id="guideModal" class="modal">
        <div class="modal-content" style="max-width: min(95vw, 900px); max-height: 85vh; overflow-y: auto; width: 95%; scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.3) rgba(0,0,0,0.2);">
            <div class="modal-header" style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); margin: -20px -20px 20px -20px; padding: 20px; border-radius: 15px 15px 0 0;">
                <h2 style="font-size: clamp(1.1rem, 5vw, 1.8rem); line-height: 1.3; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">📖 웹푸시 발송시스템 사용 가이드</h2>
                <button class="modal-close" onclick="closeGuideModal()" style="position: absolute; right: 15px; top: 15px; width: 36px; height: 36px; font-size: 28px; background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.5); box-shadow: 0 2px 8px rgba(0,0,0,0.3);">×</button>
            </div>
            
            <div class="guide-content" style="padding: 5px 10px;">
                <!-- 최상단 버튼 안내 -->
                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); border-radius: 12px; padding: 12px 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.3);">
                    <h3 style="color: #FFF59D; margin-bottom: 12px; font-size: clamp(1rem, 4vw, 1.3rem);">🔝 최상단 버튼 안내</h3>
                    
                    <div style="display: grid; gap: 10px;">
                        <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                            <div style="font-weight: bold; color: #FFF59D; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.1rem);">🏠 Main 버튼</div>
                            <div style="line-height: 1.5; font-size: clamp(0.85rem, 3vw, 1rem);">메인 페이지(index.html)로 돌아갑니다.</div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; border-left: 4px solid #667eea;">
                            <div style="font-weight: bold; color: #FFF59D; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.1rem);">🔔 알림 버튼</div>
                            <div style="line-height: 1.5; font-size: clamp(0.85rem, 3vw, 1rem);">
                                브라우저의 <strong>웹푸시 알림 권한</strong>을 요청합니다.<br>
                                • 클릭하면 브라우저에서 알림 허용 팝업이 나타납니다<br>
                                • 반드시 "허용"을 선택해야 웹푸시를 받을 수 있습니다<br>
                                • 허용 후 버튼이 "✅ 알림 활성화됨"으로 변경됩니다
                            </div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                            <div style="font-weight: bold; color: #FFF59D; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.1rem);">📁 Drive 버튼</div>
                            <div style="line-height: 1.5; font-size: clamp(0.85rem, 3vw, 1rem);">
                                Google Drive에 연결하여 데이터를 클라우드에 저장합니다.<br>
                                • 초기 1회 Google 로그인이 필요합니다<br>
                                • 연결 후 자동으로 데이터가 동기화됩니다
                            </div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; border-left: 4px solid #FFA500;">
                            <div style="font-weight: bold; color: #FFF59D; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.1rem);">📥 불러오기 버튼</div>
                            <div style="line-height: 1.5; font-size: clamp(0.85rem, 3vw, 1rem);">Drive에 저장된 모든 데이터를 불러옵니다.</div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; border-left: 4px solid #FFA500;">
                            <div style="font-weight: bold; color: #FFF59D; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.1rem);">💾 저장하기 버튼</div>
                            <div style="line-height: 1.5; font-size: clamp(0.85rem, 3vw, 1rem);">현재 작업 중인 모든 데이터를 Drive에 저장합니다.</div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; border-left: 4px solid #f093fb;">
                            <div style="font-weight: bold; color: #FFF59D; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.1rem);">📖 가이드 버튼</div>
                            <div style="line-height: 1.5; font-size: clamp(0.85rem, 3vw, 1rem);">현재 보고 계신 이 사용 가이드를 표시합니다.</div>
                        </div>
                    </div>
                </div>

                <!-- 기본 사용 흐름 -->
                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.2) 0%, rgba(69, 160, 73, 0.2) 100%); border-radius: 12px; padding: 12px 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.3);">
                    <h3 style="color: #FFF59D; margin-bottom: 12px; font-size: clamp(1rem, 4vw, 1.3rem);">🚀 기본 사용 흐름</h3>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 12px 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: flex-start; margin-bottom: 12px; gap: 8px;">
                            <div style="background: #4CAF50; min-width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem;">1</div>
                            <div style="flex: 1; font-size: clamp(0.85rem, 3vw, 1rem); line-height: 1.5;">
                                <strong style="color: #FFF59D;">초기 설정</strong><br>
                                • 🔔 알림 버튼 클릭 → 알림 권한 허용<br>
                                • 📁 Drive 버튼 클릭 → Google 계정 연결
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: flex-start; margin-bottom: 12px; gap: 8px;">
                            <div style="background: #4CAF50; min-width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem;">2</div>
                            <div style="flex: 1; font-size: clamp(0.85rem, 3vw, 1rem); line-height: 1.5;">
                                <strong style="color: #FFF59D;">고객 관리</strong><br>
                                • 📇 고객 관리 탭에서 고객 추가<br>
                                • 고객 정보 입력 (이름, 연락처, 회사, 직함 등)
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: flex-start; margin-bottom: 12px; gap: 8px;">
                            <div style="background: #4CAF50; min-width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem;">3</div>
                            <div style="flex: 1; font-size: clamp(0.85rem, 3vw, 1rem); line-height: 1.5;">
                                <strong style="color: #FFF59D;">메시지 발송</strong><br>
                                • 💌 메시지 발송 탭 선택<br>
                                • 수신자 선택 → 제목/내용 작성 → 발송
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: flex-start; margin-bottom: 12px; gap: 8px;">
                            <div style="background: #4CAF50; min-width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem;">4</div>
                            <div style="flex: 1; font-size: clamp(0.85rem, 3vw, 1rem); line-height: 1.5;">
                                <strong style="color: #FFF59D;">기념일 설정</strong><br>
                                • 🎂 기념일 관리 탭에서 고객별 기념일 등록<br>
                                • 생일, 결혼기념일, 명절 등 자동 발송 설정
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: flex-start; gap: 8px;">
                            <div style="background: #4CAF50; min-width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; font-size: 0.9rem;">5</div>
                            <div style="flex: 1; font-size: clamp(0.85rem, 3vw, 1rem); line-height: 1.5;">
                                <strong style="color: #FFF59D;">예약 관리</strong><br>
                                • 📅 예약 관리 탭에서 예약 메시지 확인<br>
                                • 사전 승인 후 자동 발송
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 주요 기능 설명 -->
                <div style="background: linear-gradient(135deg, rgba(255, 165, 0, 0.2) 0%, rgba(255, 140, 0, 0.2) 100%); border-radius: 12px; padding: 12px 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.3);">
                    <h3 style="color: #FFF59D; margin-bottom: 12px; font-size: clamp(1rem, 4vw, 1.3rem);">⭐ 주요 기능 설명</h3>
                    
                    <div style="display: grid; gap: 10px;">
                        <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer;">
                            <summary style="font-weight: bold; color: #FFF59D; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">📇 고객 관리</summary>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                                • <strong>고객 추가:</strong> 직접 입력, 텍스트 가져오기, 연락처 파일(VCF) 가져오기<br>
                                • <strong>고객 정보:</strong> 이름, 전화번호, 회사, 직함, 이메일, 태그, 메모<br>
                                • <strong>호칭 설정:</strong> 님, 직함님, 고객님, 씨, 아/야, 이름만 중 선택<br>
                                • <strong>검색 기능:</strong> 이름, 회사, 직함, 태그로 빠른 검색<br>
                                • <strong>고객 수정/삭제:</strong> 카드 클릭 후 편집 가능
                            </div>
                        </details>
                        
                        <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer;">
                            <summary style="font-weight: bold; color: #FFF59D; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">💌 메시지 발송</summary>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                                • <strong>즉시 발송:</strong> 선택한 고객에게 바로 메시지 발송<br>
                                • <strong>예약 발송:</strong> 날짜와 시간을 지정하여 예약<br>
                                • <strong>수신자 선택:</strong> 체크박스로 다중 선택 가능<br>
                                • <strong>개인화:</strong> {honorific}, {name}, {company} 등 변수 사용<br>
                                • <strong>템플릿:</strong> 자주 쓰는 메시지를 템플릿으로 저장
                            </div>
                        </details>
                        
                        <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer;">
                            <summary style="font-weight: bold; color: #FFF59D; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">🎂 기념일 관리</summary>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                                • <strong>자동 발송:</strong> 기념일에 자동으로 축하 메시지 발송<br>
                                • <strong>기념일 종류:</strong> 생일, 결혼기념일, 입사기념일, 명절, 24절기 등<br>
                                • <strong>전일 알림:</strong> 기념일 하루 전에 미리 알림<br>
                                • <strong>템플릿:</strong> 각 기념일별 기본 메시지 템플릿 제공<br>
                                • <strong>개인화:</strong> 고객 정보로 자동 치환
                            </div>
                        </details>
                        
                        <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer;">
                            <summary style="font-weight: bold; color: #FFF59D; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">📅 예약 관리</summary>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                                • <strong>사전 확인:</strong> 발송 전 메시지 내용 확인<br>
                                • <strong>승인 시스템:</strong> 관리자 승인 후 자동 발송<br>
                                • <strong>상태 관리:</strong> 대기/승인/발송/취소 상태 표시<br>
                                • <strong>수정 가능:</strong> 발송 전까지 내용 수정 가능<br>
                                • <strong>취소 기능:</strong> 필요시 예약 취소
                            </div>
                        </details>
                        
                        <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer;">
                            <summary style="font-weight: bold; color: #FFF59D; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">📊 발송 기록</summary>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                                • <strong>전체 기록:</strong> 발송한 모든 메시지 이력 확인<br>
                                • <strong>상세 정보:</strong> 수신자, 제목, 내용, 발송 시간<br>
                                • <strong>검색 기능:</strong> 고객명으로 기록 검색<br>
                                • <strong>통계:</strong> 총 발송 건수 실시간 확인
                            </div>
                        </details>
                        
                        <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer;">
                            <summary style="font-weight: bold; color: #FFF59D; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">👥 고객 초대</summary>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                                • <strong>공통 초대 URL:</strong> SNS/강의/단체문자용 공통 구독 링크<br>
                                • <strong>개별 초대 링크:</strong> 각 고객별 맞춤 구독 링크<br>
                                • <strong>초대 메시지:</strong> URL 포함된 완성 메시지 복사<br>
                                • <strong>구독 관리:</strong> 구독 상태 실시간 확인
                            </div>
                        </details>
                    </div>
                </div>

                <!-- 팁 & 주의사항 -->
                <div style="background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(238, 90, 82, 0.2) 100%); border-radius: 12px; padding: 12px 15px; border: 1px solid rgba(255,255,255,0.3);">
                    <h3 style="color: #FFF59D; margin-bottom: 12px; font-size: clamp(1rem, 4vw, 1.3rem);">💡 실전 활용 꿀팁 모음</h3>
                    
                    <!-- 고객 초대 완전 가이드 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;" open>
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">👥 고객 초대 시스템 200% 활용하기</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">📢 공통 URL (SNS/강의/단체문자용)</strong><br>
                            • 사용 시기: 세미나, SNS 게시물, 단체문자 발송 시<br>
                            • 특징: 간단한 URL, 컨설턴트명만 포함<br>
                            • 복사 방법: "💬 초대 메시지 설정" → "📋 공통 URL 복사"<br>
                            • 예시: https://도메인/subscribe.html?c=홍길동<br>
                            <br>
                            <strong style="color: #FFF59D;">👤 개별 URL (1:1 맞춤 발송용)</strong><br>
                            • 사용 시기: 고객별 개인화 발송 (카톡, 문자, 이메일)<br>
                            • 특징: 고객 이름과 ID 포함, 구독 후 자동 체크<br>
                            • 복사 방법: 고객 테이블 → "📋 URL" 또는 "💬 메시지" 버튼<br>
                            • 장점: 누가 구독했는지 자동 추적 가능<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 고객 관리 탭에서 엑셀/연락처 일괄 불러오기 후<br>
                            • 체크박스로 여러 명 선택 → "선택 복사" 버튼으로<br>
                            • 모든 고객의 메시지를 한 번에 복사하세요!<br>
                            • 그 후 카톡/문자로 한 명씩 발송하면 효율적입니다
                        </div>
                    </details>
                    
                    <!-- 메시지 변수 마스터 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;">
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">✏️ 메시지 변수로 전문가처럼 개인화하기</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">필수 변수 활용법</strong><br>
                            • <strong>{honorific}</strong> - 자동 호칭 (김대표님, 이부장님, 박사장님)<br>
                            • <strong>{name}</strong> - 고객 이름만 (홍길동)<br>
                            • <strong>{position}</strong> - 직함 (대표이사, 부장, 과장)<br>
                            • <strong>{company}</strong> - 회사명 (ABC기업)<br>
                            • <strong>{consultant}</strong> - 컨설턴트 이름<br>
                            <br>
                            <strong style="color: #FFF59D;">호칭 설정 6가지 옵션</strong><br>
                            • <strong>님</strong> - 홍길동님 (가장 무난)<br>
                            • <strong>직함님</strong> - 대표님, 부장님 (비즈니스 격식)<br>
                            • <strong>고객님</strong> - 홍길동 고객님 (서비스업)<br>
                            • <strong>씨</strong> - 홍길동씨 (동년배 친근함)<br>
                            • <strong>아/야</strong> - 길동아 (친구같은 관계)<br>
                            • <strong>이름만</strong> - 홍길동 (매우 친밀)<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 고객별로 호칭을 다르게 설정하세요!<br>
                            • CEO는 "직함님", 지인은 "씨" 이런 식으로<br>
                            • {honorific} 하나로 모든 상황 대응 가능합니다
                        </div>
                    </details>
                    
                    <!-- 기념일 자동화 전략 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;">
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">🎂 기념일 자동화로 고객 감동시키기</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">추천 기념일 세팅 루틴</strong><br>
                            <strong>1단계:</strong> 고객 추가할 때 생일은 꼭 입력<br>
                            <strong>2단계:</strong> 🎂 기념일 관리에서 자동 발송 ON<br>
                            <strong>3단계:</strong> 발송 시각을 오전 9시로 설정 (출근 시간)<br>
                            <strong>4단계:</strong> 전일 알림 ON으로 하루 전 확인<br>
                            <br>
                            <strong style="color: #FFF59D;">기념일별 추천 메시지 전략</strong><br>
                            • <strong>생일</strong>: 따뜻한 축하 + 감사 인사<br>
                            • <strong>회사 창립일</strong>: 축하 + 성장 기원<br>
                            • <strong>결혼기념일</strong>: 부부 축복 메시지<br>
                            • <strong>명절</strong>: 가족 안부 + 건강 기원<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 기념일 템플릿 미리 만들어두기<br>
                            • 전일 알림으로 메시지 최종 검토 후 승인<br>
                            • 특별한 고객은 추가 선물/통화 메모 남기기
                        </div>
                    </details>
                    
                    <!-- 효과적인 메시지 작성법 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;">
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">📝 읽히는 메시지 작성 공식</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">메시지 작성 3단계 공식</strong><br>
                            <strong>1. 친근한 인사</strong> - "안녕하세요, {honorific}!" 👋<br>
                            <strong>2. 핵심 내용</strong> - 한 문단으로 간결하게<br>
                            <strong>3. 행동 유도</strong> - "아래 링크를 클릭해주세요"<br>
                            <br>
                            <strong style="color: #FFF59D;">시간대별 발송 전략</strong><br>
                            • <strong>오전 9시</strong>: 출근 시간, 생일/기념일 메시지<br>
                            • <strong>점심 12시</strong>: 점심 시간, 가벼운 정보성 메시지<br>
                            • <strong>오후 3시</strong>: 업무 중간, 세미나/행사 안내<br>
                            • <strong>저녁 7시</strong>: 퇴근 시간, 긴급하지 않은 안내<br>
                            ❌ 피해야 할 시간: 너무 이른 아침, 늦은 밤<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 제목은 짧고 명확하게 (15자 이내)<br>
                            • 이모지 1-2개로 눈길 끌기 (과하면 역효과)<br>
                            • 본문은 3-5줄 이내로 간결하게<br>
                            • 중요한 내용은 굵게 표시
                        </div>
                    </details>
                    
                    <!-- 데이터 관리 꿀팁 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;">
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">💾 데이터 안전하게 관리하기</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">자동 저장 시스템 이해하기</strong><br>
                            • 메시지 발송/고객 추가/기념일 등록 시 자동 저장<br>
                            • Drive 연결 상태 확인: 상단 초록불 확인<br>
                            • 수동 저장: 중요한 작업 후 "💾 저장하기" 클릭<br>
                            <br>
                            <strong style="color: #FFF59D;">백업 루틴 추천</strong><br>
                            • <strong>매일 아침</strong>: "📥 불러오기"로 최신 데이터 확인<br>
                            • <strong>작업 후</strong>: "💾 저장하기"로 즉시 백업<br>
                            • <strong>중요 작업 전</strong>: 불러오기로 싱크 맞추기<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 여러 기기 사용 시: 작업 전 반드시 불러오기<br>
                            • Drive 용량 부족 시: Google Drive 확인<br>
                            • 중요 데이터는 엑셀로도 백업 추천
                        </div>
                    </details>
                    
                    <!-- 모바일 최적화 사용법 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;">
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">📱 모바일에서 효율적으로 사용하기</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">모바일 필수 기능</strong><br>
                            • <strong>연락처 직접 선택</strong>: "📱 휴대폰 연락처" 버튼<br>
                            • <strong>빠른 복사</strong>: URL/메시지 복사 → 카톡/문자 발송<br>
                            • <strong>간편 메시지 발송</strong>: 고객 선택 → 즉시 발송<br>
                            • <strong>실시간 확인</strong>: 발송 내역 즉시 확인<br>
                            <br>
                            <strong style="color: #FFF59D;">외부 활동 시 활용법</strong><br>
                            • 세미나 현장: 명함 받고 즉시 고객 등록<br>
                            • 상담 후: 바로 기념일 등록 및 초대 발송<br>
                            • 이동 중: 예약 메시지 승인/수정<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 홈화면에 추가하면 앱처럼 사용 가능<br>
                            • 테이블은 가로 스크롤로 전체 내용 확인<br>
                            • 세로/가로 모드 모두 최적화되어 있음
                        </div>
                    </details>
                    
                    <!-- 통계 활용 전략 -->
                    <details style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 10px;">
                        <summary style="font-weight: bold; color: #4CAF50; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1.05rem); cursor: pointer;">📊 통계로 성과 측정하기</summary>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2); line-height: 1.7; font-size: clamp(0.85rem, 3vw, 1rem);">
                            <strong style="color: #FFF59D;">대시보드 활용법</strong><br>
                            • <strong>총 고객 수</strong>: 고객 증가 추이 파악<br>
                            • <strong>총 발송 수</strong>: 메시지 활동 지표<br>
                            • <strong>이번 달 발송</strong>: 월별 활동량 체크<br>
                            • <strong>예약 메시지</strong>: 향후 일정 확인<br>
                            <br>
                            <strong style="color: #FFF59D;">성과 개선 방법</strong><br>
                            • 월별 발송 수 목표 설정 (예: 월 50건)<br>
                            • 구독 완료 비율 체크 (초대 vs 구독)<br>
                            • 기념일 발송 비율 높이기<br>
                            <br>
                            <strong style="color: #FF6B6B;">💡 Pro 팁</strong><br>
                            • 매월 초 지난달 통계 정리<br>
                            • 반응 좋은 메시지 유형 분석<br>
                            • 미구독 고객 재초대 전략 수립
                        </div>
                    </details>
                    
                    <!-- 주의사항 -->
                    <div style="background: rgba(0,0,0,0.3); padding: 10px 12px; border-radius: 8px; margin-top: 10px;">
                        <div style="font-weight: bold; color: #ff6b6b; margin-bottom: 6px; font-size: clamp(0.9rem, 3.5vw, 1rem);">⚠️ 반드시 지켜야 할 주의사항</div>
                        <div style="line-height: 1.6; font-size: clamp(0.85rem, 3vw, 1rem);">
                            • <strong>알림 권한</strong>: 반드시 "허용"으로 설정 (안 하면 푸시 수신 불가)<br>
                            • <strong>Drive 연결</strong>: 초록불 확인, 빨간불이면 재연결 필요<br>
                            • <strong>예약 메시지</strong>: 전일 알림으로 승인해야 발송됨 (자동 발송 아님)<br>
                            • <strong>개인정보</strong>: 고객 정보 절대 외부 유출 금지<br>
                            • <strong>발송 전 확인</strong>: 특히 일괄 발송 시 내용 재확인<br>
                            • <strong>스팸 주의</strong>: 너무 자주 보내면 역효과 (주 1-2회 권장)
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <div style="font-size: clamp(1rem, 4vw, 1.2rem); margin-bottom: 8px;">🎉 이제 웹푸시 발송시스템을 사용할 준비가 되었습니다!</div>
                    <div style="opacity: 0.8; font-size: clamp(0.85rem, 3vw, 1rem);">궁금한 점이 있으면 언제든지 이 가이드를 다시 확인하세요.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 전일 알림 모달 -->
    <div id="dayBeforeModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>🔔 내일 발송 예정 알림</h2>
                <button class="modal-close" onclick="closeDayBeforeModal()">×</button>
            </div>
            
            <div class="warning-box" style="border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px; color: #e65100 !important;">
                    📅 발송 예정일: <span id="dbSendDate" style="color: #f57c00 !important;"></span>
                </div>
                <div style="font-size: 14px; color: #e65100 !important;">
                    📱 수신자: <span id="dbCustomerName" style="font-weight: bold; color: #e65100 !important;"></span>
                </div>
                <div style="font-size: 14px; color: #e65100 !important;">
                    🎂 유형: <span id="dbAnniversaryType" style="color: #e65100 !important;"></span>
                </div>
                <div style="font-size: 14px; color: #e65100 !important;">
                    ⏰ 발송 시각: <span id="dbSendTime" style="color: #e65100 !important;"></span>
                </div>
            </div>
            
            <div class="form-group">
                <label style="font-weight: bold; font-size: 15px; color: #333333 !important;">메시지 미리보기</label>
                
                <div style="background: #f5f5f5; border: 1px solid #ddd; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                    <div style="font-weight: bold; font-size: 16px; margin-bottom: 15px; color: #1a237e !important;">
                        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">제목:</div>
                        <div id="dbPreviewTitle" style="color: #333 !important;"></div>
                    </div>
                    <div style="font-size: 14px; line-height: 1.7; white-space: pre-wrap; color: #333 !important;" id="dbPreviewContent"></div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                <button class="btn btn-secondary" onclick="cancelDayBeforeNotification()" style="background: rgba(244, 67, 54, 0.8);">
                    ❌ 발송 취소
                </button>
                <button class="btn btn-primary" onclick="editDayBeforeMessage()" style="background: rgba(33, 150, 243, 0.8);">
                    ✏️ 수정하기
                </button>
                <button class="btn btn-primary" onclick="approveDayBeforeNotification()" style="background: rgba(76, 175, 80, 0.8);">
                    ✅ 발송 승인
                </button>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 13px; opacity: 0.8; text-align: center;">
                💡 <strong>발송 승인</strong>을 하시면 내일 설정된 시각에 자동으로 발송됩니다.<br>
                <strong>수정하기</strong>를 클릭하면 메시지를 수정할 수 있습니다.
            </div>
            
            <input type="hidden" id="dbAnniversaryId">
            <input type="hidden" id="dbCustomerId">
        </div>
    </div>

    <script>

        
        // ===== iOS Safari 최적화 =====
        
        // iOS 뷰포트 높이 이슈 해결
        function setVH() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        // 초기 설정 및 리사이즈 시 재계산
        setVH();
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);
        
        // iOS 모달 스크롤 잠금
        let scrollPosition = 0;
        
        function lockBodyScroll() {
            scrollPosition = window.pageYOffset;
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.top = `-${scrollPosition}px`;
            document.body.style.width = '100%';
        }
        
        function unlockBodyScroll() {
            document.body.style.removeProperty('overflow');
            document.body.style.removeProperty('position');
            document.body.style.removeProperty('top');
            document.body.style.removeProperty('width');
            window.scrollTo(0, scrollPosition);
        }
        
        // 기존 openModal, closeModal 함수 개선
        const originalOpenModal = window.openModal || function(id) {
            document.getElementById(id)?.classList.add('active');
        };
        
        const originalCloseModal = window.closeModal || function(id) {
            document.getElementById(id)?.classList.remove('active');
        };
        
        window.openModal = function(id) {
            lockBodyScroll();
            originalOpenModal(id);
        };
        
        window.closeModal = function(id) {
            unlockBodyScroll();
            originalCloseModal(id);
        };
        
        // iOS input 포커스 시 뷰포트 조정
        if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    setTimeout(() => {
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });
        }
        
        // 더블 탭 줌 방지
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });
        
        // iOS Standalone 모드 감지
        if (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches) {
            console.log('📱 iOS Standalone 모드에서 실행 중');
            document.body.classList.add('ios-standalone');
        }
        // ===== 전역 변수 =====
        let accessToken = null;
        let isDriveConnected = false;
        let isPushEnabled = false;
        let customers = [];
        let messages = [];
        let templates = [];
        let anniversarySchedules = [];
        let pushSubscriptions = [];
        let selectedCustomersData = {};
        
        // ===== 예약 메시지 관련 변수 (NEW) =====
        let scheduledMessages = []; // 예약된 메시지 목록
        
        let appSettings = {
            quietHoursStart: '21:00',
            quietHoursEnd: '08:00',
            lastSync: null
        };

        const CLIENT_ID = '288996084140-0eo93heqd66hqhg0fh1rbum6scnt3757.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDbufefZCVqCY8QQppcdQFoqVFpMriv1m0",
            authDomain: "kfpc-company-support-project.firebaseapp.com",
            databaseURL: "https://kfpc-company-support-project-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kfpc-company-support-project",
            storageBucket: "kfpc-company-support-project.firebasestorage.app",
            messagingSenderId: "1012609333373",
            appId: "1:1012609333373:web:ffba9039a7f9568356d914",
            measurementId: "G-Y757PLYBEE"
        };
        
        // Firebase 초기화
        let firebaseAuth = null;
        let currentUser = null;
        try {
            if (typeof firebase !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                firebaseAuth = firebase.auth();
            }
        } catch (error) {
            console.warn('Firebase 초기화 실패:', error);
        }
        
        // 실시간 동기화를 위한 변수들
        let lastModifiedTime = {};  // 각 파일별 마지막 수정 시간
        let syncCheckInterval = null;  // 동기화 체크 인터벌
        let isEditing = false;  // 현재 편집 중인지 여부
        
        // 구글 드라이브 파일명
        const FILES = {
            customers: 'pushcustomer_customers.fmd',
            messages: 'pushcustomer_messages.fmd',
            templates: 'pushcustomer_templates.fmd',
            inviteCustomers: 'pushcustomer_invite.fmd',
            subscriptions: 'pushcustomer_subscriptions.fmd',
            settings: 'pushcustomer_settings.fmd'
        };

        // AES-GCM 암호화 키 (실제로는 더 안전한 방식으로 관리)
        const ENC_SALT = 'kfpc-push-manager-2025-secure-key';

        // ===== 암호화/복호화 (Web Crypto API - AES-GCM) =====
        async function makeKey() {
            const raw = new TextEncoder().encode(ENC_SALT);
            const hash = await crypto.subtle.digest('SHA-256', raw);
            return crypto.subtle.importKey('raw', hash, 'AES-GCM', false, ['encrypt', 'decrypt']);
        }

        async function encryptData(obj) {
            try {
                const key = await makeKey();
                const iv = crypto.getRandomValues(new Uint8Array(12));
                const data = new TextEncoder().encode(JSON.stringify(obj));
                const ct = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, data);
                return btoa(JSON.stringify({ 
                    iv: Array.from(iv), 
                    ct: Array.from(new Uint8Array(ct)) 
                }));
            } catch (e) {
                console.error('암호화 실패:', e);
                return null;
            }
        }

        async function decryptData(b64) {
            try {
                const { iv, ct } = JSON.parse(atob(b64));
                const key = await makeKey();
                const buf = new Uint8Array(ct);
                const pt = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: new Uint8Array(iv) }, 
                    key, 
                    buf
                );
                return JSON.parse(new TextDecoder().decode(pt));
            } catch (e) {
                console.error('복호화 실패:', e);
                return null;
            }
        }

        // ===== Google Drive 연동 =====
        async function connectDrive() {
            try {
                const tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: async (response) => {
                        if (response.access_token) {
                            accessToken = response.access_token;
                            localStorage.setItem('googleAccessToken', accessToken);
                            isDriveConnected = true;
                            updateDriveStatus(true);
                            
                            // Firebase 로그인 체크
                            await checkFirebaseLogin();
                            
                            await loadAllData();
                            
                            // 실시간 동기화 시작 (3초마다)
                            if (syncCheckInterval) clearInterval(syncCheckInterval);
                            syncCheckInterval = setInterval(checkForUpdates, 3000);
                            console.log('✅ 실시간 동기화 시작 (3초마다 체크)');
                            
                            showAlert('Drive 연동이 완료되었습니다!', 'success');
                        }
                    },
                });
                tokenClient.requestAccessToken();
            } catch (error) {
                console.error('Drive 연동 오류:', error);
                showAlert('Drive 연동에 실패했습니다. 다시 시도해주세요.', 'error');
            }
        }

        function updateDriveStatus(connected) {
            const btn = document.getElementById('driveBtn');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                btn.textContent = '✅ Drive 연동됨';
                btn.style.opacity = '0.7';
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'Drive 연결됨';
            } else {
                btn.textContent = '📁 Drive 연동';
                statusDot.className = 'status-dot disconnected';
                statusText.textContent = 'Drive 미연결';
            }
        }

        // ===== Firebase 로그인 체크 =====
        async function checkFirebaseLogin() {
            if (!firebaseAuth) return;
            
            return new Promise((resolve) => {
                firebaseAuth.onAuthStateChanged(async (user) => {
                    if (user) {
                        currentUser = user;
                        console.log('✅ Firebase 로그인 완료:', user.email);
                        resolve(true);
                    } else {
                        console.log('ℹ️ Firebase 로그인 필요');
                        
                        try {
                            const provider = new firebase.auth.GoogleAuthProvider();
                            await firebaseAuth.signInWithPopup(provider);
                            console.log('✅ Firebase 자동 로그인 완료');
                            resolve(true);
                        } catch (error) {
                            console.warn('Firebase 로그인 실패:', error);
                            resolve(false);
                        }
                    }
                });
            });
        }

        // ===== 실시간 동기화 체크 (3초마다) =====
        async function checkForUpdates() {
            if (!accessToken || isEditing) return;
            
            try {
                // 각 파일의 modifiedTime을 체크
                for (const [key, fileName] of Object.entries(FILES)) {
                    const file = await findFileInDrive(fileName);
                    if (!file) continue;
                    
                    const cloudModifiedTime = new Date(file.modifiedTime).getTime();
                    
                    // 이전에 저장된 modifiedTime과 비교
                    if (lastModifiedTime[key] && cloudModifiedTime > lastModifiedTime[key]) {
                        console.log(`🔄 ${fileName} 파일 업데이트 감지, 자동 로드 중...`);
                        
                        // 특정 파일만 다시 로드
                        const data = await loadFromDrive(fileName);
                        if (data) {
                            switch(key) {
                                case 'customers':
                                    customers = data;
                                    renderCustomers();
                                    break;
                                case 'messages':
                                    messages = data;
                                    renderMessages();
                                    break;
                                case 'templates':
                                    templates = data;
                                    renderTemplates();
                                    break;
                                case 'inviteCustomers':
                                    inviteCustomers = data;
                                    if (typeof renderInviteCustomers === 'function') {
                                        renderInviteCustomers();
                                    }
                                    break;
                                case 'settings':
                                    Object.assign(systemSettings, data);
                                    break;
                            }
                            
                            lastModifiedTime[key] = cloudModifiedTime;
                            console.log(`✅ ${fileName} 업데이트 완료`);
                        }
                    } else if (!lastModifiedTime[key]) {
                        // 초기 로드 시 modifiedTime 저장
                        lastModifiedTime[key] = cloudModifiedTime;
                    }
                }
            } catch (error) {
                console.error('동기화 체크 오류:', error);
            }
        }

        // ===== Drive에서 파일 찾기 (modifiedTime 포함) =====
        async function findFileInDrive(fileName) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=name='${fileName}'&fields=files(id,name,modifiedTime)`,
                    {
                        headers: { Authorization: `Bearer ${accessToken}` }
                    }
                );
                
                if (!response.ok) return null;
                
                const data = await response.json();
                return data.files && data.files.length > 0 ? data.files[0] : null;
            } catch (error) {
                console.error('파일 찾기 오류:', error);
                return null;
            }
        }


        // ===== 데이터 로드/저장 =====
        async function loadAllData() {
            showLoading(true);
            try {
                // 모든 파일을 병렬로 로드 (순차 로드보다 훨씬 빠름)
                const [
                    customersData,
                    messagesData,
                    templatesData,
                    inviteCustomersData,
                    subsData,
                    settingsData
                ] = await Promise.all([
                    loadFromDrive(FILES.customers),
                    loadFromDrive(FILES.messages),
                    loadFromDrive(FILES.templates),
                    loadFromDrive(FILES.inviteCustomers),
                    loadFromDrive(FILES.subscriptions),
                    loadFromDrive(FILES.settings)
                ]);
                
                // 데이터 할당
                if (customersData) customers = customersData;
                if (messagesData) messages = messagesData;
                if (templatesData) templates = templatesData;
                if (inviteCustomersData) {
                    inviteCustomers = inviteCustomersData;
                    updateInviteStats();
                    renderInviteCustomers();
                }
                if (subsData) pushSubscriptions = subsData;
                if (settingsData) appSettings = { ...appSettings, ...settingsData };
                
                // UI 업데이트
                renderCustomers();
                renderCustomersForSend();
                renderMessages();
                renderTemplates();
                updateStats();
                updateSettingsUI();
                
                appSettings.lastSync = new Date().toISOString();
                await saveToDrive(FILES.settings, appSettings);
                
                showAlert('✅ 데이터를 성공적으로 불러왔습니다!', 'success');
            } catch (error) {
                console.error('❌ 데이터 로드 오류:', error);
                showAlert('⚠️ 데이터를 불러오는데 실패했습니다.', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function loadFromDrive(fileName) {
            if (!accessToken) return null;
            
            try {
                // 파일 검색 (modifiedTime 포함)
                const searchResponse = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=name='${fileName}' and trashed=false&fields=files(id,name,modifiedTime)`,
                    {
                        headers: { 'Authorization': `Bearer ${accessToken}` }
                    }
                );
                
                if (!searchResponse.ok) {
                    if (searchResponse.status === 401) {
                        // 토큰 만료
                        showAlert('인증이 만료되었습니다. 다시 연동해주세요.', 'error');
                        localStorage.removeItem('googleAccessToken');
                        accessToken = null;
                        isDriveConnected = false;
                        updateDriveStatus(false);
                        return null;
                    }
                    throw new Error('파일 검색 실패');
                }
                
                const searchData = await searchResponse.json();
                
                if (!searchData.files || searchData.files.length === 0) {
                    return null; // 파일이 없으면 null 반환
                }
                
                const file = searchData.files[0];
                const fileId = file.id;
                
                // modifiedTime 저장
                const fileKey = Object.keys(FILES).find(key => FILES[key] === fileName);
                if (fileKey && file.modifiedTime) {
                    lastModifiedTime[fileKey] = new Date(file.modifiedTime).getTime();
                }
                
                // 파일 내용 다운로드
                const downloadResponse = await fetch(
                    `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
                    {
                        headers: { 'Authorization': `Bearer ${accessToken}` }
                    }
                );
                
                if (!downloadResponse.ok) throw new Error('파일 다운로드 실패');
                
                const encryptedData = await downloadResponse.text();
                return await decryptData(encryptedData);
                
            } catch (error) {
                console.error(`${fileName} 로드 오류:`, error);
                return null;
            }
        }

        async function saveToDrive(fileName, data) {
            if (!accessToken) {
                showAlert('Drive가 연동되지 않았습니다.', 'error');
                return false;
            }
            
            try {
                const encryptedData = await encryptData(data);
                if (!encryptedData) throw new Error('암호화 실패');
                
                // 기존 파일 검색
                const searchResponse = await fetch(
                    `https://www.googleapis.com/drive/v3/files?q=name='${fileName}' and trashed=false`,
                    {
                        headers: { 'Authorization': `Bearer ${accessToken}` }
                    }
                );
                
                const searchData = await searchResponse.json();
                let fileId = searchData.files && searchData.files.length > 0 ? searchData.files[0].id : null;
                
                const blob = new Blob([encryptedData], { type: 'text/plain' });
                const metadata = {
                    name: fileName,
                    mimeType: 'text/plain'
                };
                
                if (fileId) {
                    // 파일 업데이트
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', blob);
                    
                    const response = await fetch(
                        `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart&fields=id,modifiedTime`,
                        {
                            method: 'PATCH',
                            headers: { 'Authorization': `Bearer ${accessToken}` },
                            body: form
                        }
                    );
                    
                    if (!response.ok) throw new Error('파일 업데이트 실패');
                    
                    // modifiedTime 업데이트
                    const result = await response.json();
                    const fileKey = Object.keys(FILES).find(key => FILES[key] === fileName);
                    if (fileKey && result.modifiedTime) {
                        lastModifiedTime[fileKey] = new Date(result.modifiedTime).getTime();
                    }
                } else {
                    // 새 파일 생성
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', blob);
                    
                    const response = await fetch(
                        'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,modifiedTime',
                        {
                            method: 'POST',
                            headers: { 'Authorization': `Bearer ${accessToken}` },
                            body: form
                        }
                    );
                    
                    if (!response.ok) throw new Error('파일 생성 실패');
                    
                    // modifiedTime 업데이트
                    const result = await response.json();
                    const fileKey = Object.keys(FILES).find(key => FILES[key] === fileName);
                    if (fileKey && result.modifiedTime) {
                        lastModifiedTime[fileKey] = new Date(result.modifiedTime).getTime();
                    }
                }
                
                return true;
                
            } catch (error) {
                console.error(`${fileName} 저장 오류:`, error);
                showAlert('데이터 저장에 실패했습니다.', 'error');
                return false;
            }
        }

        // ===== 웹푸시 알림 =====
        async function requestPushPermission() {
            if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
                showAlert('이 브라우저는 푸시 알림을 지원하지 않습니다.', 'error');
                return;
            }
            
            try {
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    isPushEnabled = true;
                    updatePushStatus(true);
                    showAlert('푸시 알림이 허용되었습니다!', 'success');
                    
                    // Service Worker 등록
                    // await registerServiceWorker();
                } else {
                    showAlert('푸시 알림이 거부되었습니다.', 'error');
                }
            } catch (error) {
                console.error('푸시 권한 요청 오류:', error);
                showAlert('푸시 알림 설정에 실패했습니다.', 'error');
            }
        }

        function updatePushStatus(enabled) {
            const btn = document.getElementById('pushPermissionBtn');
            if (enabled) {
                btn.textContent = '✅ 알림 활성화됨';
                btn.style.opacity = '0.7';
            } else {
                btn.textContent = '🔔 알림 허용';
            }
        }

        // ===== 고객 관리 =====
        function renderCustomers() {
            const grid = document.getElementById('customerGrid');
            const searchTerm = document.getElementById('customerSearch')?.value.toLowerCase() || '';
            
            let filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) ||
                (c.company && c.company.toLowerCase().includes(searchTerm)) ||
                (c.position && c.position.toLowerCase().includes(searchTerm)) ||
                (c.tags && c.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );
            
            if (filtered.length === 0) {
                grid.innerHTML = '<p style="text-align: center; opacity: 0.7; padding: 40px; grid-column: 1/-1;">등록된 고객이 없습니다</p>';
                return;
            }
            
            grid.innerHTML = filtered.map(customer => `
                <div class="customer-card" onclick="editCustomer('${customer.id}')">
                    <div class="customer-name">${customer.name}</div>
                    ${customer.company ? `<div class="customer-info">🏢 ${customer.company}</div>` : ''}
                    ${customer.position ? `<div class="customer-info">💼 ${customer.position}</div>` : ''}
                    ${customer.phone ? `<div class="customer-info">📞 ${customer.phone}</div>` : ''}
                    ${customer.tags && customer.tags.length > 0 ? 
                        `<div class="customer-info" style="margin-top: 8px;">
                            ${customer.tags.map(tag => 
                                `<span style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-right: 5px;">${tag}</span>`
                            ).join('')}
                        </div>` : ''}
                </div>
            `).join('');
        }

        function renderCustomersForSend() {
            const grid = document.getElementById('customerGridSend');
            const searchTerm = document.getElementById('customerSearchSend')?.value.toLowerCase() || '';
            
            let filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) ||
                (c.company && c.company.toLowerCase().includes(searchTerm)) ||
                (c.position && c.position.toLowerCase().includes(searchTerm))
            );
            
            if (filtered.length === 0) {
                grid.innerHTML = '<p style="text-align: center; opacity: 0.7; padding: 20px; grid-column: 1/-1;">등록된 고객이 없습니다</p>';
                return;
            }
            
            grid.innerHTML = filtered.map(customer => {
                const isSelected = selectedCustomersData[customer.id] !== undefined;
                return `
                    <div class="customer-card ${isSelected ? 'selected' : ''}" 
                         onclick="toggleCustomerSelection('${customer.id}')">
                        <div class="customer-name">${customer.name}</div>
                        ${customer.company ? `<div class="customer-info">🏢 ${customer.company}</div>` : ''}
                        ${customer.position ? `<div class="customer-info">💼 ${customer.position}</div>` : ''}
                    </div>
                `;
            }).join('');
            
            updateSelectedInfo();
        }

        function toggleCustomerSelection(customerId) {
            const customer = inviteCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            if (selectedCustomersData[customerId]) {
                delete selectedCustomersData[customerId];
            } else {
                selectedCustomersData[customerId] = customer;
            }
            
            renderCustomersForSend();
        }

        function toggleSelectAll() {
            const searchTerm = document.getElementById('customerSearchSend')?.value.toLowerCase() || '';
            const filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) ||
                (c.company && c.company.toLowerCase().includes(searchTerm)) ||
                (c.position && c.position.toLowerCase().includes(searchTerm))
            );
            
            const allSelected = filtered.every(c => selectedCustomersData[c.id]);
            
            if (allSelected) {
                // 모두 선택 해제
                filtered.forEach(c => delete selectedCustomersData[c.id]);
            } else {
                // 모두 선택
                filtered.forEach(c => selectedCustomersData[c.id] = c);
            }
            
            renderCustomersForSend();
        }

        function clearSelection() {
            selectedCustomersData = {};
            renderCustomersForSend();
        }

        function updateSelectedInfo() {
            const count = Object.keys(selectedCustomersData).length;
            const info = document.getElementById('selectedCustomersInfo');
            const countEl = document.getElementById('selectedCount');
            
            if (count > 0) {
                info.style.display = 'flex';
                countEl.textContent = `${count}명`;
            } else {
                info.style.display = 'none';
            }
        }

        function openCustomerModal(customerId = null) {
            const modal = document.getElementById('customerModal');
            const title = document.getElementById('customerModalTitle');
            const form = document.getElementById('customerForm');
            
            form.reset();
            
            if (customerId) {
                const customer = inviteCustomers.find(c => c.id === customerId);
                if (!customer) return;
                
                title.textContent = '👤 고객 수정';
                document.getElementById('customerId').value = customer.id;
                document.getElementById('customerName').value = customer.name || '';
                document.getElementById('customerCompany').value = customer.company || '';
                document.getElementById('customerPosition').value = customer.position || '';
                document.getElementById('customerPhone').value = customer.phone || '';
                document.getElementById('customerEmail').value = customer.email || '';
                document.getElementById('customerBirth').value = customer.birth || '';
                document.getElementById('customerAnniversary').value = customer.anniversary || '';
                document.getElementById('customerHonorific').value = customer.honorific || '님'; // ⭐ 호칭 불러오기
                document.getElementById('customerTags').value = customer.tags ? customer.tags.join(', ') : '';
                document.getElementById('customerMemo').value = customer.memo || '';
            } else {
                title.textContent = '👤 고객 추가';
                document.getElementById('customerHonorific').value = '님'; // ⭐ 기본값 설정
            }
            
            modal.classList.add('active');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('active');
        }

        function editCustomer(customerId) {
            openCustomerModal(customerId);
        }

        async function saveCustomer(e) {
            e.preventDefault();
            
            const id = document.getElementById('customerId').value || Date.now().toString();
            const name = document.getElementById('customerName').value.trim();
            const company = document.getElementById('customerCompany').value.trim();
            const position = document.getElementById('customerPosition').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const birth = document.getElementById('customerBirth').value;
            const anniversary = document.getElementById('customerAnniversary').value;
            const honorific = document.getElementById('customerHonorific').value; // ⭐ 호칭 추가
            const tagsInput = document.getElementById('customerTags').value;
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
            const memo = document.getElementById('customerMemo').value.trim();
            
            const customer = {
                id,
                name,
                company,
                position,
                phone,
                email,
                birth,
                anniversary,
                honorific, // ⭐ 호칭 저장
                tags,
                memo,
                updatedAt: new Date().toISOString()
            };
            
            const existingIndex = customers.findIndex(c => c.id === id);
            if (existingIndex >= 0) {
                customers[existingIndex] = customer;
            } else {
                customer.createdAt = new Date().toISOString();
                customers.push(customer);
            }
            
            await saveToDrive(FILES.customers, customers);
            closeCustomerModal();
            renderCustomers();
            renderCustomersForSend();
            updateStats();
            
            showAlert('고객 정보가 저장되었습니다!', 'success');
        }

        // ================================================================
        // 기념일 자동발송 시스템
        // ================================================================
        
        let anniversaries = [];
        
        // 기념일 메시지 템플릿
        const anniversaryTemplates = {
            // 개인 기념일
            'birthday': {
                title: '{honorific}, 생일을 진심으로 축하드립니다! 🎂',
                content: `{honorific}, 생일을 진심으로 축하드립니다! 🎂

항상 건강하시고 하시는 일 모두 잘 되시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'wedding': {
                title: '{honorific}, 결혼기념일을 축하드립니다! 💒',
                content: `{honorific}, 결혼기념일을 축하드립니다! 💒

부부 금슬 좋으시고 항상 행복하시길 기원합니다.

- KFPC {consultant} 드림`
            },
            'company': {
                title: '{honorific}, 창립기념일을 축하드립니다! 🏢',
                content: `{honorific}, {company} 창립기념일을 축하드립니다! 🏢

앞으로도 번창하시고 더욱 발전하시길 기원합니다.

- KFPC {consultant} 드림`
            },
            'custom': {
                title: '{honorific}, 특별한 날을 축하드립니다! 🎉',
                content: `{honorific}, 특별한 날을 축하드립니다! 🎉

뜻깊은 하루 보내시길 바랍니다.

- KFPC {consultant} 드림`
            },
            
            // 일회성 이벤트
            'promotion': {
                title: '{honorific}, 승진을 축하드립니다! 🎉',
                content: `{honorific}, 승진을 축하드립니다! 🎉

그동안의 노력이 결실을 맺었네요.
앞으로도 더욱 빛나는 활약 기대하겠습니다.

- KFPC {consultant} 드림`
            },
            'admission': {
                title: '{honorific}, 입학을 축하드립니다! 🎓',
                content: `{honorific}, 입학을 축하드립니다! 🎓

새로운 시작을 응원합니다.
배움의 즐거움이 가득하시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'pass': {
                title: '{honorific}, 합격을 축하드립니다! ✅',
                content: `{honorific}, 합격을 축하드립니다! ✅

노력한 만큼의 좋은 결과를 얻으셨네요.
진심으로 축하드립니다!

- KFPC {consultant} 드림`
            },
            'moving': {
                title: '{honorific}, 이사를 축하드립니다! 🏠',
                content: `{honorific}, 이사를 축하드립니다! 🏠

새 보금자리에서 행복한 날들 가득하시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'opening': {
                title: '{honorific}, 개업을 축하드립니다! 🎊',
                content: `{honorific}, 개업을 축하드립니다! 🎊

번창하시고 큰 성공 거두시길 기원합니다.

- KFPC {consultant} 드림`
            },
            
            // 음력 명절
            'lunar-new-year': {
                title: '{honorific}, 새해 복 많이 받으세요! 🧧',
                content: `{honorific}, 새해 복 많이 받으세요! 🧧

가족 모두 건강하시고 소망하시는 일 모두 이루어지시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'chuseok': {
                title: '{honorific}, 추석 명절 잘 보내세요! 🌕',
                content: `{honorific}, 추석 명절 잘 보내세요! 🌕

가족 모두 건강하시고 행복한 한가위 되시길 바랍니다.

- KFPC {consultant} 드림`
            },
            
            // 기타 명절
            'christmas': {
                title: '{honorific}, 메리 크리스마스! 🎄',
                content: `{honorific}, 메리 크리스마스! 🎄

따뜻하고 행복한 성탄절 보내시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'new-year': {
                title: '{honorific}, 새해 복 많이 받으세요! 🎆',
                content: `{honorific}, 새해 복 많이 받으세요! 🎆

건강하시고 뜻하시는 일 모두 이루어지는 한 해 되시길 기원합니다.

- KFPC {consultant} 드림`
            },
            
            // 24절기
            'solar-ipchun': {
                title: '{honorific}, 입춘을 맞이하여 인사드립니다 🌱',
                content: `{honorific}, 입춘을 맞이하여 인사드립니다 🌱

봄의 시작과 함께 새로운 활력이 가득하시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'solar-chunbun': {
                title: '{honorific}, 춘분 절기 인사드립니다 🌸',
                content: `{honorific}, 춘분 절기 인사드립니다 🌸

화창한 봄날처럼 기쁜 일 가득하시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'solar-ipha': {
                title: '{honorific}, 입하 절기 인사드립니다 ☀️',
                content: `{honorific}, 입하 절기 인사드립니다 ☀️

여름의 시작과 함께 건강 유의하시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'solar-haaji': {
                title: '{honorific}, 하지 절기 인사드립니다 🌞',
                content: `{honorific}, 하지 절기 인사드립니다 🌞

무더위 건강 조심하시고 활기찬 여름 보내세요.

- KFPC {consultant} 드림`
            },
            'solar-ipchu': {
                title: '{honorific}, 입추 절기 인사드립니다 🍂',
                content: `{honorific}, 입추 절기 인사드립니다 🍂

가을의 시작, 풍성한 계절 되시길 바랍니다.

- KFPC {consultant} 드림`
            },
            'solar-chubun': {
                title: '{honorific}, 추분 절기 인사드립니다 🍁',
                content: `{honorific}, 추분 절기 인사드립니다 🍁

황금빛 가을처럼 풍요로운 날들 되시길 기원합니다.

- KFPC {consultant} 드림`
            },
            'solar-ipdong': {
                title: '{honorific}, 입동 절기 인사드립니다 ❄️',
                content: `{honorific}, 입동 절기 인사드립니다 ❄️

겨울 건강 잘 챙기시고 따뜻한 연말 보내세요.

- KFPC {consultant} 드림`
            },
            'solar-dongji': {
                title: '{honorific}, 동지 절기 인사드립니다 ⛄',
                content: `{honorific}, 동지 절기 인사드립니다 ⛄

팥죽 드시고 무병장수 하시길 바랍니다.

- KFPC {consultant} 드림`
            }
        };
        
        // 기념일 유형 정보
        const anniversaryTypeInfo = {
            'birthday': { name: '생일', icon: '🎂', category: 'personal', defaultRepeat: 'yearly' },
            'wedding': { name: '결혼기념일', icon: '💒', category: 'personal', defaultRepeat: 'yearly' },
            'company': { name: '회사 창립일', icon: '🏢', category: 'personal', defaultRepeat: 'yearly' },
            'custom': { name: '기타 기념일', icon: '📅', category: 'personal', defaultRepeat: 'yearly' },
            'promotion': { name: '승진', icon: '🎉', category: 'onetime', defaultRepeat: 'once' },
            'admission': { name: '입학', icon: '🎓', category: 'onetime', defaultRepeat: 'once' },
            'pass': { name: '합격', icon: '✅', category: 'onetime', defaultRepeat: 'once' },
            'moving': { name: '이사', icon: '🏠', category: 'onetime', defaultRepeat: 'once' },
            'opening': { name: '개업', icon: '🎊', category: 'onetime', defaultRepeat: 'once' },
            'lunar-new-year': { name: '설날 (구정)', icon: '🧧', category: 'holiday', defaultRepeat: 'yearly', lunar: true },
            'chuseok': { name: '추석', icon: '🌕', category: 'holiday', defaultRepeat: 'yearly', lunar: true },
            'christmas': { name: '크리스마스', icon: '🎄', category: 'holiday', defaultRepeat: 'yearly', fixedDate: '12-25' },
            'new-year': { name: '신정', icon: '🎆', category: 'holiday', defaultRepeat: 'yearly', fixedDate: '01-01' },
            'solar-ipchun': { name: '입춘', icon: '🌱', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-chunbun': { name: '춘분', icon: '🌸', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-ipha': { name: '입하', icon: '☀️', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-haaji': { name: '하지', icon: '🌞', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-ipchu': { name: '입추', icon: '🍂', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-chubun': { name: '추분', icon: '🍁', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-ipdong': { name: '입동', icon: '❄️', category: 'solar', defaultRepeat: 'yearly', solar: true },
            'solar-dongji': { name: '동지', icon: '⛄', category: 'solar', defaultRepeat: 'yearly', solar: true }
        };
        
        // ===== 음력-양력 변환 함수 =====
        function lunarToSolar(year, month, day) {
            // 간단한 음력-양력 변환 (2024-2035년 설날/추석 데이터)
            const lunarDates = {
                'lunar-new-year': {
                    2024: '02-10', 2025: '01-29', 2026: '02-17', 2027: '02-06',
                    2028: '01-26', 2029: '02-13', 2030: '02-03', 2031: '01-23',
                    2032: '02-11', 2033: '01-31', 2034: '02-19', 2035: '02-08'
                },
                'chuseok': {
                    2024: '09-17', 2025: '10-06', 2026: '09-25', 2027: '09-15',
                    2028: '10-03', 2029: '09-22', 2030: '09-12', 2031: '10-01',
                    2032: '09-19', 2033: '09-08', 2034: '09-28', 2035: '09-17'
                }
            };
            return lunarDates;
        }
        
        // ===== 24절기 계산 함수 =====
        function calculateSolarTerm(year, termType) {
            // 24절기 양력 날짜 (대략적인 값)
            const solarTerms = {
                'solar-ipchun': { month: 2, day: 4 },      // 입춘: 2월 4일경
                'solar-chunbun': { month: 3, day: 21 },    // 춘분: 3월 21일경
                'solar-ipha': { month: 5, day: 6 },        // 입하: 5월 6일경
                'solar-haaji': { month: 6, day: 21 },      // 하지: 6월 21일경
                'solar-ipchu': { month: 8, day: 8 },       // 입추: 8월 8일경
                'solar-chubun': { month: 9, day: 23 },     // 추분: 9월 23일경
                'solar-ipdong': { month: 11, day: 7 },     // 입동: 11월 7일경
                'solar-dongji': { month: 12, day: 22 }     // 동지: 12월 22일경
            };
            
            const term = solarTerms[termType];
            if (!term) return null;
            
            return `${year}-${String(term.month).padStart(2, '0')}-${String(term.day).padStart(2, '0')}`;
        }
        
        // ===== 기념일 날짜 계산 =====
        function calculateAnniversaryDate(anniversary, year) {
            const info = anniversaryTypeInfo[anniversary.type];
            
            // 음력 명절
            if (info.lunar) {
                const lunarDates = lunarToSolar();
                return lunarDates[anniversary.type][year] || null;
            }
            
            // 24절기
            if (info.solar) {
                return calculateSolarTerm(year, anniversary.type);
            }
            
            // 고정 날짜 (크리스마스, 신정)
            if (info.fixedDate) {
                return `${year}-${info.fixedDate}`;
            }
            
            // 개인 기념일 (년도만 변경)
            if (anniversary.date) {
                const [_, month, day] = anniversary.date.split('-');
                return `${year}-${month}-${day}`;
            }
            
            return null;
        }
        
        // ===== 기념일 저장/로드 =====
        async function saveAnniversaries() {
            try {
                localStorage.setItem('kfpc_anniversaries', JSON.stringify(anniversaries));
                await saveToDrive('anniversaries.fmd', anniversaries);
            } catch (error) {
                console.error('기념일 저장 실패:', error);
            }
        }
        
        async function loadAnniversaries() {
            try {
                const data = await loadFromDrive('anniversaries.fmd');
                if (data) {
                    anniversaries = data;
                } else {
                    const local = localStorage.getItem('kfpc_anniversaries');
                    if (local) anniversaries = JSON.parse(local);
                }
            } catch (error) {
                console.error('기념일 로드 실패:', error);
            }
            renderAnniversaries();
            updateAnniversaryStats();
        }
        
        // ===== 기념일 모달 열기 =====
        function openAnniversaryModal(anniversaryId = null) {
            const modal = document.getElementById('anniversaryModal');
            const title = document.getElementById('anniversaryModalTitle');
            const form = document.getElementById('anniversaryForm');
            
            form.reset();
            
            // 고객 목록 업데이트
            const customerSelect = document.getElementById('anniversaryCustomer');
            customerSelect.innerHTML = '<option value="">선택하세요</option>' +
                customers.map(c => `<option value="${c.id}">${c.name}${c.company ? ' (' + c.company + ')' : ''}</option>`).join('');
            
            // 템플릿 목록 업데이트
            updateTemplateOptions();
            
            if (anniversaryId) {
                const anniversary = anniversaries.find(a => a.id === anniversaryId);
                if (!anniversary) return;
                
                title.textContent = '📅 기념일 수정';
                document.getElementById('anniversaryId').value = anniversary.id;
                document.getElementById('anniversaryCustomer').value = anniversary.customerId;
                document.getElementById('anniversaryType').value = anniversary.type;
                document.getElementById('anniversaryDate').value = anniversary.date || '';
                document.querySelector(`input[name="anniversaryTiming"][value="${anniversary.timing}"]`).checked = true;
                document.getElementById('anniversarySendTime').value = anniversary.sendTime;
                document.querySelector(`input[name="anniversaryRepeat"][value="${anniversary.repeat}"]`).checked = true;
                document.getElementById('anniversaryTitle').value = anniversary.title;
                document.getElementById('anniversaryContent').value = anniversary.content;
                document.getElementById('anniversaryActive').checked = anniversary.active !== false;
                
                if (anniversary.repeat === 'yearly') {
                    document.getElementById('repeatEndGroup').style.display = 'block';
                    if (anniversary.repeatUnlimited) {
                        document.getElementById('repeatUnlimited').checked = true;
                        document.getElementById('repeatEndDateGroup').style.display = 'none';
                    } else if (anniversary.repeatEndDate) {
                        document.getElementById('repeatEndDate').value = anniversary.repeatEndDate;
                    }
                }
            } else {
                title.textContent = '📅 기념일 추가';
                document.getElementById('anniversarySendTime').value = '09:00';
            }
            
            updateAnniversaryForm();
            modal.classList.add('active');
        }
        
        function closeAnniversaryModal() {
            document.getElementById('anniversaryModal').classList.remove('active');
        }
        
        // ===== 기념일 폼 업데이트 =====
        function updateAnniversaryForm() {
            const type = document.getElementById('anniversaryType').value;
            const info = anniversaryTypeInfo[type];
            const dateGroup = document.getElementById('anniversaryDateGroup');
            const repeatGroup = document.getElementById('anniversaryRepeatGroup');
            const dateInput = document.getElementById('anniversaryDate');
            const dateHint = document.getElementById('anniversaryDateHint');
            
            // 개인 기념일만 날짜 입력 표시
            if (info && (info.category === 'personal' || info.category === 'onetime')) {
                dateGroup.style.display = 'block';
                dateInput.required = true;
                
                if (info.category === 'onetime') {
                    dateHint.textContent = '일회성 이벤트 날짜를 선택하세요';
                } else {
                    dateHint.textContent = '매년 반복될 기념일 날짜를 선택하세요';
                }
            } else {
                dateGroup.style.display = 'none';
                dateInput.required = false;
            }
            
            // 일회성 이벤트는 반복 설정 자동 조정
            if (info && info.defaultRepeat === 'once') {
                document.querySelector('input[name="anniversaryRepeat"][value="once"]').checked = true;
                toggleRepeatEnd();
            }
        }
        
        // ===== 템플릿 옵션 업데이트 =====
        function updateTemplateOptions() {
            const select = document.getElementById('anniversaryTemplate');
            const type = document.getElementById('anniversaryType').value;
            
            select.innerHTML = '<option value="">직접 작성</option>';
            
            if (type && anniversaryTemplates[type]) {
                select.innerHTML += `<option value="${type}">기본 템플릿</option>`;
            }
        }
        
        // ===== 템플릿 로드 =====
        function loadAnniversaryTemplate() {
            const templateValue = document.getElementById('anniversaryTemplate').value;
            if (!templateValue || templateValue === '') return;
            
            const template = anniversaryTemplates[templateValue];
            if (template) {
                document.getElementById('anniversaryTitle').value = template.title;
                document.getElementById('anniversaryContent').value = template.content;
            }
        }
        
        // ===== 반복 종료일 토글 =====
        function toggleRepeatEnd() {
            const repeat = document.querySelector('input[name="anniversaryRepeat"]:checked').value;
            const endGroup = document.getElementById('repeatEndGroup');
            
            if (repeat === 'yearly') {
                endGroup.style.display = 'block';
            } else {
                endGroup.style.display = 'none';
            }
        }
        
        function toggleRepeatEndDate() {
            const unlimited = document.getElementById('repeatUnlimited').checked;
            const dateGroup = document.getElementById('repeatEndDateGroup');
            
            if (unlimited) {
                dateGroup.style.display = 'none';
                document.getElementById('repeatEndDate').value = '';
            } else {
                dateGroup.style.display = 'block';
            }
        }
        
        // ===== 기념일 저장 =====
        async function saveAnniversary(e) {
            e.preventDefault();
            
            const id = document.getElementById('anniversaryId').value || Date.now().toString();
            const customerId = document.getElementById('anniversaryCustomer').value;
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                showAlert('고객을 선택해주세요.', 'error');
                return;
            }
            
            const type = document.getElementById('anniversaryType').value;
            const timing = document.querySelector('input[name="anniversaryTiming"]:checked').value;
            const repeat = document.querySelector('input[name="anniversaryRepeat"]:checked').value;
            
            const anniversary = {
                id,
                customerId,
                customerName: customer.name,
                type,
                date: document.getElementById('anniversaryDate').value || null,
                timing,
                sendTime: document.getElementById('anniversarySendTime').value,
                repeat,
                repeatUnlimited: repeat === 'yearly' && document.getElementById('repeatUnlimited').checked,
                repeatEndDate: repeat === 'yearly' && !document.getElementById('repeatUnlimited').checked ? 
                    document.getElementById('repeatEndDate').value : null,
                title: document.getElementById('anniversaryTitle').value,
                content: document.getElementById('anniversaryContent').value,
                active: document.getElementById('anniversaryActive').checked,
                createdAt: new Date().toISOString()
            };
            
            const existingIndex = anniversaries.findIndex(a => a.id === id);
            if (existingIndex >= 0) {
                anniversaries[existingIndex] = { ...anniversaries[existingIndex], ...anniversary, updatedAt: new Date().toISOString() };
            } else {
                anniversaries.push(anniversary);
            }
            
            await saveAnniversaries();
            closeAnniversaryModal();
            renderAnniversaries();
            updateAnniversaryStats();
            
            showAlert('기념일이 저장되었습니다!', 'success');
        }
        
        // ===== 기념일 삭제 =====
        async function deleteAnniversary(id) {
            const anniversary = anniversaries.find(a => a.id === id);
            if (!anniversary) return;
            
            if (!confirm(`"${anniversary.customerName}님의 ${anniversaryTypeInfo[anniversary.type].name}" 기념일을 삭제하시겠습니까?`)) {
                return;
            }
            
            anniversaries = anniversaries.filter(a => a.id !== id);
            await saveAnniversaries();
            renderAnniversaries();
            updateAnniversaryStats();
            
            showAlert('기념일이 삭제되었습니다.', 'success');
        }
        
        // ===== 기념일 활성화/비활성화 =====
        async function toggleAnniversaryActive(id) {
            const anniversary = anniversaries.find(a => a.id === id);
            if (!anniversary) return;
            
            anniversary.active = !anniversary.active;
            await saveAnniversaries();
            renderAnniversaries();
            updateAnniversaryStats();
        }
        
        // ===== 기념일 목록 렌더링 =====
        function renderAnniversaries() {
            const container = document.getElementById('anniversaryList');
            const filter = document.getElementById('anniversaryFilter')?.value || 'all';
            const search = document.getElementById('anniversarySearch')?.value.toLowerCase() || '';
            
            let filtered = anniversaries.filter(a => {
                const matchSearch = !search || 
                    a.customerName.toLowerCase().includes(search) ||
                    anniversaryTypeInfo[a.type].name.toLowerCase().includes(search);
                
                if (!matchSearch) return false;
                
                switch(filter) {
                    case 'active': return a.active !== false;
                    case 'inactive': return a.active === false;
                    case 'personal': return ['personal', 'onetime'].includes(anniversaryTypeInfo[a.type].category);
                    case 'holiday': return ['holiday', 'solar'].includes(anniversaryTypeInfo[a.type].category);
                    case 'upcoming': return isUpcoming(a);
                    default: return true;
                }
            });
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; opacity: 0.7;">
                        <div style="font-size: 48px; margin-bottom: 15px;">📅</div>
                        <div style="font-size: 16px;">등록된 기념일이 없습니다</div>
                        <div style="font-size: 14px; margin-top: 10px;">+ 기념일 추가 버튼을 눌러 시작하세요</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(255,255,255,0.1); border-bottom: 2px solid rgba(255,255,255,0.2);">
                            <th style="padding: 12px; text-align: left;">고객</th>
                            <th style="padding: 12px; text-align: left;">기념일</th>
                            <th style="padding: 12px; text-align: center;">다음 발송일</th>
                            <th style="padding: 12px; text-align: center;">발송 설정</th>
                            <th style="padding: 12px; text-align: center;">반복</th>
                            <th style="padding: 12px; text-align: center;">상태</th>
                            <th style="padding: 12px; text-align: center;">관리</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map(a => {
                            const info = anniversaryTypeInfo[a.type];
                            const nextDate = getNextAnniversaryDate(a);
                            const daysUntil = nextDate ? Math.ceil((new Date(nextDate) - new Date()) / (1000 * 60 * 60 * 24)) : null;
                            
                            return `
                                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <td style="padding: 12px;">
                                        <strong>${a.customerName}</strong>
                                    </td>
                                    <td style="padding: 12px;">
                                        <div>${info.icon} ${info.name}</div>
                                        ${a.date ? `<div style="font-size: 11px; opacity: 0.7; margin-top: 3px;">${formatDate(a.date)}</div>` : ''}
                                    </td>
                                    <td style="padding: 12px; text-align: center;">
                                        ${nextDate ? `
                                            <div>${formatDate(nextDate)}</div>
                                            <div style="font-size: 11px; color: ${daysUntil <= 7 ? '#FFD700' : '#4CAF50'}; margin-top: 3px;">
                                                ${daysUntil === 0 ? '오늘!' : daysUntil === 1 ? '내일' : `D-${daysUntil}`}
                                            </div>
                                        ` : '-'}
                                    </td>
                                    <td style="padding: 12px; text-align: center; font-size: 12px;">
                                        <div>${a.timing === 'before' ? '전날' : '당일'} ${a.sendTime}</div>
                                    </td>
                                    <td style="padding: 12px; text-align: center;">
                                        <span style="padding: 4px 8px; background: rgba(255,255,255,0.1); border-radius: 4px; font-size: 11px;">
                                            ${a.repeat === 'yearly' ? (a.repeatUnlimited ? '매년 무제한' : `매년 (~${formatDate(a.repeatEndDate)})`) : '1회만'}
                                        </span>
                                    </td>
                                    <td style="padding: 12px; text-align: center;">
                                        <label style="cursor: pointer; display: inline-block;">
                                            <input type="checkbox" ${a.active !== false ? 'checked' : ''} onchange="toggleAnniversaryActive('${a.id}')" style="cursor: pointer;">
                                            <span style="font-size: 11px; margin-left: 5px;">${a.active !== false ? '활성' : '비활성'}</span>
                                        </label>
                                    </td>
                                    <td style="padding: 12px; text-align: center; white-space: nowrap;">
                                        <button onclick="openAnniversaryModal('${a.id}')" style="padding: 6px 10px; background: rgba(33,150,243,0.8); border: none; border-radius: 5px; color: white; cursor: pointer; margin-right: 5px;" title="수정">✏️</button>
                                        <button onclick="deleteAnniversary('${a.id}')" style="padding: 6px 10px; background: rgba(244,67,54,0.8); border: none; border-radius: 5px; color: white; cursor: pointer;" title="삭제">🗑️</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // ===== 다음 기념일 날짜 계산 =====
        function getNextAnniversaryDate(anniversary) {
            const today = new Date();
            const currentYear = today.getFullYear();
            
            // 올해 날짜 계산
            let thisYearDate = calculateAnniversaryDate(anniversary, currentYear);
            if (thisYearDate) {
                const thisYearDateTime = new Date(thisYearDate);
                
                // 발송 타이밍에 따라 조정
                if (anniversary.timing === 'before') {
                    thisYearDateTime.setDate(thisYearDateTime.getDate() - 1);
                }
                
                // 올해 날짜가 미래면 반환
                if (thisYearDateTime >= today) {
                    // 종료일 체크
                    if (anniversary.repeatEndDate && thisYearDate > anniversary.repeatEndDate) {
                        return null;
                    }
                    return thisYearDateTime.toISOString().split('T')[0];
                }
            }
            
            // 내년 날짜 계산 (반복인 경우)
            if (anniversary.repeat === 'yearly') {
                let nextYearDate = calculateAnniversaryDate(anniversary, currentYear + 1);
                if (nextYearDate) {
                    // 종료일 체크
                    if (anniversary.repeatEndDate && nextYearDate > anniversary.repeatEndDate) {
                        return null;
                    }
                    
                    const nextYearDateTime = new Date(nextYearDate);
                    if (anniversary.timing === 'before') {
                        nextYearDateTime.setDate(nextYearDateTime.getDate() - 1);
                    }
                    return nextYearDateTime.toISOString().split('T')[0];
                }
            }
            
            return null;
        }
        
        // ===== 다가오는 기념일 체크 =====
        function isUpcoming(anniversary) {
            const nextDate = getNextAnniversaryDate(anniversary);
            if (!nextDate) return false;
            
            const daysUntil = Math.ceil((new Date(nextDate) - new Date()) / (1000 * 60 * 60 * 24));
            return daysUntil >= 0 && daysUntil <= 30;
        }
        
        // ===== 통계 업데이트 =====
        function updateAnniversaryStats() {
            document.getElementById('anniversaryTotalCount').textContent = anniversaries.length;
            document.getElementById('anniversaryActiveCount').textContent = anniversaries.filter(a => a.active !== false).length;
            
            const today = new Date();
            const thisMonth = today.getMonth();
            const thisYear = today.getFullYear();
            
            const upcomingCount = anniversaries.filter(a => {
                if (a.active === false) return false;
                const nextDate = getNextAnniversaryDate(a);
                if (!nextDate) return false;
                const date = new Date(nextDate);
                return date.getMonth() === thisMonth && date.getFullYear() === thisYear;
            }).length;
            
            document.getElementById('anniversaryUpcomingCount').textContent = upcomingCount;
        }
        
        // ===== 날짜 포맷 =====
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}월 ${date.getDate()}일`;
        }

        // ===== 메시지 발송 =====
        function validateSchedule(dtStr) {
            if (!dtStr) return false;
            const when = new Date(dtStr);
            return when.getTime() > Date.now() + 60 * 1000; // 최소 1분 이후
        }

        async function sendMessage(e) {
            e.preventDefault();
            
            const selectedIds = Object.keys(selectedCustomersData);
            if (selectedIds.length === 0) {
                showAlert('발송할 고객을 선택해주세요.', 'error');
                return;
            }
            
            const title = document.getElementById('messageTitle').value.trim();
            const body = document.getElementById('messageBody').value.trim();
            const sendType = document.getElementById('sendType').value;
            const scheduleTime = document.getElementById('scheduleTime').value;
            
            if (sendType === 'scheduled' && !validateSchedule(scheduleTime)) {
                showAlert('예약 시각은 현재 시각으로부터 최소 1분 이후로 설정해주세요.', 'error');
                return;
            }
            
            let sentCount = 0;
            
            selectedIds.forEach(id => {
                const customer = selectedCustomersData[id];
                
                // ⭐ 스마트 호칭 시스템
                function getHonorific(customer) {
                    const name = customer.name || '';
                    const position = customer.position || '';
                    const honorificType = customer.honorific || '님'; // 기본값: 님
                    
                    // 받침 체크 함수 (한글 유니코드 기반)
                    function hasFinalConsonant(text) {
                        if (!text) return false;
                        const lastChar = text.charCodeAt(text.length - 1);
                        return (lastChar - 0xAC00) % 28 !== 0;
                    }
                    
                    switch(honorificType) {
                        case '님':
                            return name + '님';
                        case '직함님':
                            return position ? position + '님' : name + '님';
                        case '고객님':
                            return name + ' 고객님';
                        case '씨':
                            return name + '씨';
                        case '아야':
                            return name + (hasFinalConsonant(name) ? '아' : '야');
                        case '이름만':
                            return name;
                        default:
                            return name + '님';
                    }
                }
                
                const personalizedBody = body
                    .replace(/{honorific}/g, getHonorific(customer))
                    .replace(/{name}/g, customer.name || '')
                    .replace(/{position}/g, customer.position || '')
                    .replace(/{company}/g, customer.company || '');
                
                const personalizedTitle = title
                    .replace(/{honorific}/g, getHonorific(customer))
                    .replace(/{name}/g, customer.name || '')
                    .replace(/{position}/g, customer.position || '')
                    .replace(/{company}/g, customer.company || '');
                
                const message = {
                    id: Date.now() + sentCount,
                    customerId: customer.id,
                    customerName: customer.name,
                    company: customer.company,
                    position: customer.position,
                    title: personalizedTitle,
                    body: personalizedBody,
                    originalTitle: title,
                    originalBody: body,
                    sendType: sendType,
                    scheduleTime: sendType === 'scheduled' ? scheduleTime : null,
                    status: sendType === 'scheduled' ? 'scheduled' : 'success',
                    sentAt: sendType === 'immediate' ? new Date().toISOString() : null,
                    createdAt: new Date().toISOString()
                };
                
                messages.unshift(message);
                sentCount++;
            });
            
            await saveToDrive(FILES.messages, messages);
            resetSendForm();
            selectedCustomersData = {};
            renderCustomersForSend();
            renderMessages();
            updateStats();
            
            showAlert(`✅ ${sentCount}명의 고객에게 메시지가 ${sendType === 'scheduled' ? '예약' : '발송'}되었습니다!`, 'success');
            
            switchTab('log', document.querySelectorAll('.tab-btn')[3]);
        }

        function resetSendForm() {
            document.getElementById('sendForm').reset();
            document.getElementById('scheduleGroup').classList.add('hidden');
        }

        function toggleSchedule() {
            const sendType = document.getElementById('sendType').value;
            const scheduleGroup = document.getElementById('scheduleGroup');
            
            if (sendType === 'scheduled') {
                scheduleGroup.classList.remove('hidden');
                // 현재 시각 + 1시간을 기본값으로 설정
                const now = new Date();
                now.setHours(now.getHours() + 1);
                const formatted = now.toISOString().slice(0, 16);
                document.getElementById('scheduleTime').value = formatted;
            } else {
                scheduleGroup.classList.add('hidden');
            }
        }

        // ===== 발송 로그 =====
        function renderMessages() {
            const container = document.getElementById('logContainer');
            const filter = document.getElementById('logFilter')?.value || 'all';
            const sort = document.getElementById('logSort')?.value || 'newest';
            
            let filtered = [...messages];
            
            if (filter !== 'all') {
                filtered = filtered.filter(m => m.status === filter);
            }
            
            if (sort === 'newest') {
                filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            } else {
                filtered.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7; padding: 40px;">발송 내역이 없습니다</p>';
                return;
            }
            
            container.innerHTML = filtered.map(msg => {
                const statusClass = msg.status;
                const statusText = msg.status === 'success' ? '발송 완료' : 
                                 msg.status === 'scheduled' ? '예약 대기' : '발송 실패';
                const dateStr = msg.sentAt ? 
                    new Date(msg.sentAt).toLocaleString('ko-KR') : 
                    msg.scheduleTime ? 
                    `예약: ${new Date(msg.scheduleTime).toLocaleString('ko-KR')}` :
                    new Date(msg.createdAt).toLocaleString('ko-KR');
                
                return `
                    <div class="log-item ${statusClass}">
                        <div class="log-header">
                            <div class="log-title">${msg.title}</div>
                            <span class="log-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="log-body">${msg.body}</div>
                        <div class="log-footer">
                            <span>📤 ${msg.customerName} ${msg.position || ''}</span>
                            <span>🕐 ${dateStr}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== 템플릿 =====
        function openTemplateModal() {
            document.getElementById('templateModal').classList.add('active');
            document.getElementById('templateForm').reset();
        }

        function closeTemplateModal() {
            document.getElementById('templateModal').classList.remove('active');
        }

        async function saveTemplate(e) {
            e.preventDefault();
            
            const template = {
                id: Date.now(),
                name: document.getElementById('templateName').value.trim(),
                title: document.getElementById('templateTitle').value.trim(),
                body: document.getElementById('templateBody').value.trim(),
                createdAt: new Date().toISOString()
            };
            
            templates.push(template);
            await saveToDrive(FILES.templates, templates);
            closeTemplateModal();
            renderTemplates();
            
            showAlert('✅ 템플릿이 저장되었습니다!', 'success');
        }

        function renderTemplates() {
            const list = document.getElementById('templateList');
            
            if (templates.length === 0) {
                list.innerHTML = '<p style="text-align: center; opacity: 0.7; padding: 40px; grid-column: 1/-1;">등록된 템플릿이 없습니다</p>';
                return;
            }
            
            list.innerHTML = templates.map(template => `
                <div class="template-card">
                    <div class="template-name">${template.name}</div>
                    <div class="template-preview">${template.body}</div>
                    <div class="template-actions">
                        <button class="btn btn-secondary" onclick="useTemplate(${template.id})">사용</button>
                        <button class="btn btn-danger" onclick="deleteTemplate(${template.id})">삭제</button>
                    </div>
                </div>
            `).join('');
        }

        function useTemplate(id) {
            const template = templates.find(t => t.id === id);
            if (!template) return;
            
            switchTab('send', document.querySelectorAll('.tab-btn')[0]);
            document.getElementById('messageTitle').value = template.title;
            document.getElementById('messageBody').value = template.body;
            
            showAlert('템플릿이 적용되었습니다!', 'success');
        }

        async function deleteTemplate(id) {
            if (!confirm('이 템플릿을 삭제하시겠습니까?')) return;
            
            templates = templates.filter(t => t.id !== id);
            await saveToDrive(FILES.templates, templates);
            renderTemplates();
            
            showAlert('템플릿이 삭제되었습니다.', 'success');
        }

        // ===== 통계 =====
        function updateStats() {
            document.getElementById('statCustomers').textContent = customers.length;
            document.getElementById('statMessages').textContent = messages.length;
            document.getElementById('statScheduled').textContent = messages.filter(m => m.status === 'scheduled').length;
            document.getElementById('statSubscribers').textContent = pushSubscriptions.length;
        }

        // ===== 탭 전환 (버그 수정) =====
        function switchTab(tab, el) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            
            if (el) el.classList.add('active');
            
            const tabMap = {
                'send': 'sendTab',
                'scheduled': 'scheduledTab',
                'customers': 'customersTab',
                'anniversary': 'anniversaryTab',
                'log': 'logTab',
                'template': 'templateTab',
                'settings': 'settingsTab',
                'import': 'importTab'
            };
            
            const targetTab = document.getElementById(tabMap[tab]);
            if (targetTab) {
                targetTab.classList.remove('hidden');
                
                // 탭 전환 시 해당 탭의 렌더링 함수 호출
                if (tab === 'scheduled') {
                    renderScheduledMessages();
                } else if (tab === 'customers') {
                    renderCustomers();
                } else if (tab === 'log') {
                    renderMessages();
                } else if (tab === 'anniversary') {
                    renderAnniversaries();
                }
            }
        }

        // ===== 설정 =====
        function updateSettingsUI() {
            document.getElementById('quietHoursStart').value = appSettings.quietHoursStart || '21:00';
            document.getElementById('quietHoursEnd').value = appSettings.quietHoursEnd || '08:00';
            document.getElementById('lastSync').textContent = appSettings.lastSync ? 
                new Date(appSettings.lastSync).toLocaleString('ko-KR') : '-';
            
            const pushStatus = document.getElementById('pushStatus');
            if (isPushEnabled) {
                pushStatus.innerHTML = '<span style="color: #4CAF50;">✅ 푸시 알림 활성화됨</span>';
            } else {
                pushStatus.innerHTML = '<span style="color: #ff6b6b;">❌ 푸시 알림 비활성화됨</span><br><small>상단의 "🔔 알림 허용" 버튼을 클릭하여 활성화하세요.</small>';
            }
        }

        async function syncAllData() {
            showLoading(true);
            try {
                await saveToDrive(FILES.customers, customers);
                await saveToDrive(FILES.messages, messages);
                await saveToDrive(FILES.templates, templates);
                await saveToDrive(FILES.inviteCustomers, inviteCustomers);
                await saveToDrive(FILES.subscriptions, pushSubscriptions);
                
                appSettings.lastSync = new Date().toISOString();
                await saveToDrive(FILES.settings, appSettings);
                
                updateSettingsUI();
                showAlert('전체 데이터가 동기화되었습니다!', 'success');
            } catch (error) {
                console.error('동기화 오류:', error);
                showAlert('동기화에 실패했습니다.', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function backupData() {
            const backup = {
                customers,
                messages,
                templates,
                pushSubscriptions,
                appSettings,
                backupDate: new Date().toISOString()
            };
            
            const encrypted = await encryptData(backup);
            const blob = new Blob([encrypted], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kfpc_backup_${new Date().toISOString().slice(0,10)}.fmd`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('백업 파일이 다운로드되었습니다!', 'success');
        }

        function clearCache() {
            if (!confirm('캐시를 삭제하시겠습니까? (Drive 데이터는 유지됩니다)')) return;
            
            localStorage.removeItem('cachedCustomers');
            localStorage.removeItem('cachedMessages');
            
            showAlert('캐시가 삭제되었습니다.', 'success');
        }

        async function resetAllData() {
            if (!confirm('⚠️ 경고: 모든 데이터가 삭제됩니다. 계속하시겠습니까?')) return;
            if (!confirm('정말로 모든 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) return;
            
            customers = [];
            messages = [];
            templates = [];
            pushSubscriptions = [];
            selectedCustomersData = {};
            
            await saveToDrive(FILES.customers, customers);
            await saveToDrive(FILES.messages, messages);
            await saveToDrive(FILES.templates, templates);
            await saveToDrive(FILES.subscriptions, pushSubscriptions);
            
            renderCustomers();
            renderCustomersForSend();
            renderMessages();
            renderTemplates();
            updateStats();
            
            showAlert('모든 데이터가 초기화되었습니다.', 'success');
        }

        // ===== 유틸리티 =====
        function showAlert(message, type = 'info') {
            const banner = document.getElementById('alertBanner');
            const messageEl = document.getElementById('alertMessage');
            
            messageEl.textContent = message;
            banner.classList.add('show');
            
            // 3초 후 자동 닫기
            setTimeout(() => {
                closeAlert();
            }, 3000);
        }

        function closeAlert() {
            document.getElementById('alertBanner').classList.remove('show');
        }

        function showLoading(show) {
            const loading = document.getElementById('loadingIndicator');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function goBack() {
            if (confirm('메인으로 돌아가시겠습니까?')) {
                window.location.href = 'index.html';
            }
        }

        // ===== 초기화 =====
        async function init() {
            const savedToken = localStorage.getItem('googleAccessToken');
            if (savedToken) {
                accessToken = savedToken;
                isDriveConnected = true;
                updateDriveStatus(true);
                await loadAllData();
            } else {
                updateDriveStatus(false);
            }
            
            // 푸시 권한 확인
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    isPushEnabled = true;
                    updatePushStatus(true);
                }
            }
            
            updateStats();
            updateSettingsUI();
        }

        window.addEventListener('load', () => { init(); if (typeof initInvite === 'function') initInvite(); });
    
        
        // ===============================================================
        // 고객 초대 시스템 함수들 (customer-invite.html에서 통합)
        // ===============================================================
        
        // ===== 데이터 저장소 =====
        let inviteCustomers = [];
        let messageTemplate = '';
        let consultantName = '홍길동';
        
        // ===== 초기화 =====
        function initInvite() {
            loadData();
            updateInviteStats();
            renderInviteCustomers();
        }
        
        // ===== 데이터 관리 =====
        function saveInviteData() {
            localStorage.setItem('pushcustomer_invite_customers', JSON.stringify(inviteCustomers));
            
            // Google Drive에도 저장
            if (typeof saveToDrive === 'function') {
                saveToDrive();
            }
            localStorage.setItem('pushcustomer_consultant_name', consultantName);
            localStorage.setItem('pushcustomer_message_template', messageTemplate);
            updateInviteStats();
            renderInviteCustomers();
        }
        
        function loadData() {
            const savedCustomers = localStorage.getItem('pushcustomer_invite_customers');
            const savedName = localStorage.getItem('pushcustomer_consultant_name');
            const savedTemplate = localStorage.getItem('pushcustomer_message_template');
            
            if (savedCustomers) inviteCustomers = JSON.parse(savedCustomers);
            if (savedName) {
                consultantName = savedName;
                document.getElementById('consultantName').value = savedName;
            }
            if (savedTemplate) {
                messageTemplate = savedTemplate;
                document.getElementById('messageTemplate').value = savedTemplate;
            } else {
                messageTemplate = document.getElementById('messageTemplate').value;
            }
        }
        
        // ===== 통계 업데이트 =====
        function updateInviteStats() {
            document.getElementById('inviteTotalCustomers').textContent = inviteCustomers.length;
            document.getElementById('inviteSentCount').textContent = inviteCustomers.filter(c => c.inviteSent).length;
            document.getElementById('inviteSubscribedCount').textContent = inviteCustomers.filter(c => c.subscribed).length;
        }
        
        // ===== 고객 목록 렌더링 =====
        function renderInviteCustomers() {
            const searchTerm = document.getElementById('inviteSearchInput') ? document.getElementById('inviteSearchInput').value.toLowerCase() : '';
            const filtered = inviteCustomers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) ||
                c.phone.includes(searchTerm) ||
                (c.company && c.company.toLowerCase().includes(searchTerm))
            );
            
            const tbody = document.getElementById('inviteCustomerTableBody');
            
            if (!tbody) return;
            
            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; opacity: 0.7;">
                            ${searchTerm ? '검색 결과가 없습니다.' : '아직 등록된 고객이 없습니다.<br>위에서 고객을 불러오세요.'}
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filtered.map(customer => {
                const isSelected = selectedInviteCustomers.has(customer.id);
                
                // ⭐ 호칭 미리보기
                const honorificType = customer.honorific || '님';
                let honorificPreview = '';
                switch(honorificType) {
                    case '님': honorificPreview = `${customer.name}님`; break;
                    case '직함님': honorificPreview = customer.position ? `${customer.position}님` : `${customer.name}님`; break;
                    case '고객님': honorificPreview = `${customer.name} 고객님`; break;
                    case '씨': honorificPreview = `${customer.name}씨`; break;
                    case '아야': 
                        const hasFinal = customer.name && (customer.name.charCodeAt(customer.name.length-1) - 0xAC00) % 28 !== 0;
                        honorificPreview = `${customer.name}${hasFinal ? '아' : '야'}`;
                        break;
                    case '이름만': honorificPreview = customer.name; break;
                    default: honorificPreview = `${customer.name}님`;
                }
                
                return `
                    <tr>
                        <td style="text-align: center;">
                            <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleInviteCustomerSelect(${customer.id})" style="cursor: pointer;">
                        </td>
                        <td>
                            <strong>${customer.name}</strong>
                            <div style="font-size: 11px; color: #FFD700; margin-top: 3px;">
                                💬 ${honorificPreview}
                            </div>
                        </td>
                        <td>${customer.phone}</td>
                        <td>${customer.company || '-'}</td>
                        <td>${customer.position || '-'}</td>
                        <td style="text-align: center;">
                            <span class="status-badge ${customer.subscribed ? 'status-subscribed' : customer.inviteSent ? 'status-sent' : 'status-pending'}">
                                ${customer.subscribed ? '✅ 구독완료' : customer.inviteSent ? '📤 발송됨' : '⏳ 대기'}
                            </span>
                        </td>
                        <td style="text-align: center; white-space: nowrap;">
                            <button class="btn-copy" onclick="copyInviteLink(${customer.id})" title="URL만 복사" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin: 2px;">
                                📋 URL
                            </button>
                            <button class="btn-copy" onclick="copyInviteMessage(${customer.id})" title="메시지+URL 복사" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin: 2px;">
                                💬 메시지
                            </button>
                            <button class="btn-edit" onclick="editInviteCustomer(${customer.id})" title="수정" style="background: rgba(255, 193, 7, 0.8); padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 2px;">✏️</button>
                            <button class="btn-delete" onclick="deleteInviteCustomer(${customer.id})" title="삭제" style="background: rgba(244, 67, 54, 0.8); color: white; padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 2px;">🗑️</button>
                        </td>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // 전체 선택 체크박스 상태 업데이트
            const selectAllCheckbox = document.getElementById('inviteSelectAll');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = inviteCustomers.length > 0 && selectedInviteCustomers.size === inviteCustomers.length;
            }
        }

        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    parseCSV(text);
                } catch (error) {
                    console.error('CSV 파싱 오류:', error);
                    showAlert('❌ CSV 파일을 읽는 중 오류가 발생했습니다.', 'error');
                }
            };
            reader.onerror = function() {
                showAlert('❌ 파일을 읽을 수 없습니다.', 'error');
            };
            // UTF-8로 명시적으로 읽기
            reader.readAsText(file, 'UTF-8');
        }
        
        // ===== 공통 고객 추가 헬퍼 함수 =====
        function addCustomerToBothSystems(customerData) {
            const newCustomer = {
                id: customerData.id || Date.now(),
                name: customerData.name,
                phone: customerData.phone,
                company: customerData.company || '',
                position: customerData.position || '',
                email: customerData.email || '',
                honorific: customerData.honorific || '님',
                inviteSent: false,
                subscribed: false,
                createdAt: customerData.createdAt || new Date().toISOString()
            };
            
            // 초대 시스템에 추가
            inviteCustomers.push(newCustomer);
            
            // 고객 관리에도 추가
            customers.push({
                id: newCustomer.id,
                name: newCustomer.name,
                phone: newCustomer.phone,
                company: newCustomer.company,
                position: newCustomer.position,
                email: newCustomer.email,
                tags: [],
                birthday: '',
                memo: '',
                createdAt: newCustomer.createdAt
            });
            
            return newCustomer;
        }
        
        // ===== CSV/텍스트 파싱 =====
        // ===== CSV/텍스트 파싱 =====
        function parseCSV(text) {
            const lines = text.split('\n');
            let imported = 0;
            
            // 첫 줄이 헤더인지 확인
            const startIndex = lines[0].toLowerCase().includes('이름') || lines[0].toLowerCase().includes('name') ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const parts = line.split(',').map(p => p.trim());
                if (parts.length >= 2) {
                    addCustomerToBothSystems({
                        id: Date.now() + imported,
                        name: parts[0],
                        phone: parts[1],
                        company: parts[2] || '',
                        position: parts[3] || '',
                        email: parts[4] || '',
                        honorific: '님'
                    });
                    imported++;
                }
            }
            
            saveInviteData();
            saveToDrive(FILES.customers, customers);
            renderCustomers();
            renderCustomersForSend();
            renderInviteCustomers();
            showAlert(`✅ ${imported}명의 고객을 가져왔습니다!`);
        }
        // ===== vCard 처리 =====
        function handleVCFUpload(event) {
            const files = event.target.files;
            let totalImported = 0;
            let processed = 0;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const vcf = e.target.result;
                        const imported = parseVCard(vcf);
                        totalImported += imported;
                        processed++;
                        
                        if (processed === files.length) {
                            saveInviteData();
                            saveToDrive(FILES.customers, customers);
                            renderCustomers();
                            renderCustomersForSend();
                            renderInviteCustomers();
                            
                            if (totalImported > 0) {
                                showAlert(`✅ ${totalImported}명의 연락처를 가져왔습니다!`);
                            } else {
                                showAlert('⚠️ 가져온 연락처가 없습니다. 파일 형식을 확인해주세요.', 'warning');
                            }
                        }
                    } catch (error) {
                        console.error('VCF 파싱 오류:', error);
                        showAlert('❌ 연락처 파일을 읽는 중 오류가 발생했습니다.', 'error');
                    }
                };
                reader.onerror = function() {
                    showAlert('❌ 파일을 읽을 수 없습니다.', 'error');
                };
                // UTF-8로 명시적으로 읽기
                reader.readAsText(file, 'UTF-8');
            });
        }
        
        // ===== QUOTED-PRINTABLE 디코딩 함수 =====
        function decodeQuotedPrintable(str) {
            if (!str) return '';
            
            // =XX 형태의 16진수를 바이트로 변환
            const bytes = [];
            let i = 0;
            
            while (i < str.length) {
                if (str[i] === '=' && i + 2 < str.length) {
                    const hex = str.substring(i + 1, i + 3);
                    bytes.push(parseInt(hex, 16));
                    i += 3;
                } else {
                    bytes.push(str.charCodeAt(i));
                    i++;
                }
            }
            
            // UTF-8 디코딩
            try {
                return new TextDecoder('utf-8').decode(new Uint8Array(bytes));
            } catch (e) {
                console.error('디코딩 오류:', e);
                return str;
            }
        }
        
        // ===== vCard 파싱 개선 =====
        function parseVCard(vcfText) {
            const vcards = vcfText.split('BEGIN:VCARD');
            let imported = 0;
            
            vcards.slice(1).forEach(vcard => {
                const contact = {};
                
                // 줄 접기(line folding) 처리: 다음 줄이 공백으로 시작하면 이전 줄과 합침
                const lines = vcard.split(/\r?\n/).reduce((acc, line) => {
                    if (line.startsWith(' ') || line.startsWith('\t')) {
                        if (acc.length > 0) {
                            acc[acc.length - 1] += line.trim();
                        }
                    } else {
                        acc.push(line);
                    }
                    return acc;
                }, []);
                
                lines.forEach(line => {
                    line = line.trim();
                    
                    // FN (Full Name) - 이름
                    if (line.startsWith('FN')) {
                        const value = line.split(':')[1];
                        if (value) {
                            // ENCODING=QUOTED-PRINTABLE 체크
                            if (line.includes('ENCODING=QUOTED-PRINTABLE') || line.includes('ENCODING=quoted-printable')) {
                                contact.name = decodeQuotedPrintable(value.trim());
                            } else {
                                contact.name = value.trim();
                            }
                        }
                    }
                    
                    // N (Name) - FN이 없을 경우 대체
                    else if (line.startsWith('N:') && !contact.name) {
                        const parts = line.substring(2).split(';');
                        const lastName = parts[0] || '';
                        const firstName = parts[1] || '';
                        contact.name = (lastName + firstName).trim();
                    }
                    
                    // TEL (Telephone) - 전화번호
                    else if (line.startsWith('TEL')) {
                        const value = line.split(':')[1];
                        if (value) {
                            let phone = value.trim();
                            // ENCODING=QUOTED-PRINTABLE 체크
                            if (line.includes('ENCODING=QUOTED-PRINTABLE') || line.includes('ENCODING=quoted-printable')) {
                                phone = decodeQuotedPrintable(phone);
                            }
                            // 숫자와 하이픈만 남기기
                            phone = phone.replace(/[^0-9-]/g, '');
                            if (phone && !contact.phone) {
                                contact.phone = phone;
                            }
                        }
                    }
                    
                    // EMAIL - 이메일
                    else if (line.startsWith('EMAIL')) {
                        const value = line.split(':')[1];
                        if (value) {
                            let email = value.trim();
                            // ENCODING=QUOTED-PRINTABLE 체크
                            if (line.includes('ENCODING=QUOTED-PRINTABLE') || line.includes('ENCODING=quoted-printable')) {
                                email = decodeQuotedPrintable(email);
                            }
                            if (email && !contact.email) {
                                contact.email = email;
                            }
                        }
                    }
                    
                    // ORG (Organization) - 회사명
                    else if (line.startsWith('ORG')) {
                        const value = line.split(':')[1];
                        if (value) {
                            let org = value.trim();
                            // ENCODING=QUOTED-PRINTABLE 체크
                            if (line.includes('ENCODING=QUOTED-PRINTABLE') || line.includes('ENCODING=quoted-printable')) {
                                org = decodeQuotedPrintable(org);
                            }
                            const parts = org.split(';');
                            contact.company = parts[0]?.trim();
                        }
                    }
                    
                    // TITLE - 직함
                    else if (line.startsWith('TITLE')) {
                        const value = line.split(':')[1];
                        if (value) {
                            let title = value.trim();
                            // ENCODING=QUOTED-PRINTABLE 체크
                            if (line.includes('ENCODING=QUOTED-PRINTABLE') || line.includes('ENCODING=quoted-printable')) {
                                title = decodeQuotedPrintable(title);
                            }
                            contact.position = title;
                        }
                    }
                });
                
                // 이름과 전화번호가 있을 때만 추가
                if (contact.name && contact.phone) {
                    addCustomerToBothSystems({
                        id: Date.now() + imported,
                        name: contact.name,
                        phone: contact.phone,
                        company: contact.company || '',
                        position: contact.position || '',
                        email: contact.email || '',
                        honorific: '님'
                    });
                    imported++;
                }
            });
            
            return imported;
        }
        
        // ===== 휴대폰 연락처 직접 선택 (Contact Picker API) =====
        async function pickContacts() {
            // Contact Picker API 지원 여부 확인
            if (!('contacts' in navigator && 'ContactsManager' in window)) {
                showAlert(`❌ Contact Picker API를 지원하지 않는 브라우저입니다.

📱 Android Chrome 사용 권장!

💡 대신 이렇게 하세요:
1️⃣ 폰 연락처 앱 열기
2️⃣ 메뉴 → "연락처 내보내기" 또는 "공유"
3️⃣ vCard 파일(.vcf)로 저장
4️⃣ 여기서 "📇 폰연락처" 버튼 클릭
5️⃣ 저장한 .vcf 파일 선택 (다중 선택 가능)`, 'error');
                return;
            }
            
            try {
                // 가져올 정보 속성 지정
                const props = ['name', 'tel', 'email'];
                const opts = { multiple: true }; // 여러 명 선택 가능
                
                // 사용자에게 연락처 선택 UI 표시
                const contacts = await navigator.contacts.select(props, opts);
                
                if (!contacts || contacts.length === 0) {
                    showAlert('ℹ️ 선택된 연락처가 없습니다.', 'info');
                    return;
                }
                
                let imported = 0;
                
                // 선택된 연락처들을 양쪽 시스템에 추가
                contacts.forEach(contact => {
                    const name = contact.name && contact.name.length > 0 ? contact.name[0] : '';
                    const tel = contact.tel && contact.tel.length > 0 ? contact.tel[0] : '';
                    const email = contact.email && contact.email.length > 0 ? contact.email[0] : '';
                    
                    if (name && tel) {
                        // 중복 체크 (전화번호 기준)
                        const exists = inviteCustomers.some(c => c.phone === tel);
                        if (!exists) {
                            addCustomerToBothSystems({
                                id: Date.now() + imported,
                                name: name,
                                phone: tel,
                                company: '',
                                position: '',
                                email: email,
                                honorific: '님'
                            });
                            imported++;
                        }
                    }
                });
                
                if (imported > 0) {
                    saveInviteData();
                    saveToDrive(FILES.customers, customers);
                    renderCustomers();
                    renderCustomersForSend();
                    renderInviteCustomers();
                    updateInviteStats();
                    showAlert(`✅ ${imported}명의 연락처를 가져왔습니다!`, 'success');
                } else {
                    showAlert('ℹ️ 새로 추가된 연락처가 없습니다. (중복 제외)', 'info');
                }
                
            } catch (error) {
                console.error('연락처 선택 오류:', error);
                if (error.name === 'NotSupportedError') {
                    showAlert('❌ 이 브라우저는 연락처 직접 선택을 지원하지 않습니다.\n\n💡 파일 업로드 방식을 이용해주세요.', 'error');
                } else if (error.name === 'SecurityError') {
                    showAlert('❌ 보안 정책으로 인해 연락처 접근이 거부되었습니다.\n\n💡 HTTPS 환경에서만 사용 가능합니다.', 'error');
                } else {
                    showAlert('❌ 연락처를 가져오는 중 오류가 발생했습니다.', 'error');
                }
            }
        }
        
        // ===== 텍스트 입력 =====
        function openTextImport() {
            openModal('textModal');
        }
        
        function importFromText() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                showAlert('❌ 텍스트를 입력해주세요.', true);
                return;
            }
            
            parseCSV(text);
            document.getElementById('textInput').value = '';
            closeModal('textModal');
        }
        
        // ===== 직접 추가 =====
        function openManualAdd() {
            openModal('manualModal');
        }
        
        function addManualCustomer() {
            const name = document.getElementById('manualName').value.trim();
            const phone = document.getElementById('manualPhone').value.trim();
            
            if (!name || !phone) {
                showAlert('❌ 이름과 전화번호는 필수입니다.', true);
                return;
            }
            
            const newCustomer = {
                id: Date.now(),
                name: name,
                phone: phone,
                company: document.getElementById('manualCompany').value.trim(),
                position: document.getElementById('manualPosition').value.trim(),
                email: document.getElementById('manualEmail').value.trim(),
                honorific: '님', // ⭐ 기본 호칭
                inviteSent: false,
                subscribed: false,
                createdAt: new Date().toISOString()
            };
            
            // 초대 시스템에 추가
            inviteCustomers.push(newCustomer);
            
            // 고객 관리에도 추가 (중요!)
            customers.push({
                id: newCustomer.id,
                name: newCustomer.name,
                phone: newCustomer.phone,
                company: newCustomer.company,
                position: newCustomer.position,
                email: newCustomer.email,
                tags: [],
                birthday: '',
                memo: '',
                createdAt: newCustomer.createdAt
            });
            
            // 저장 및 렌더링
            saveInviteData();
            saveToDrive(FILES.customers, customers);
            closeModal('manualModal');
            showAlert(`✅ ${name}님이 추가되었습니다!`);
            
            // 렌더링 업데이트
            renderCustomers();
            renderCustomersForSend();
            renderInviteCustomers();
            
            // 입력 필드 초기화
            document.getElementById('manualName').value = '';
            document.getElementById('manualPhone').value = '';
            document.getElementById('manualCompany').value = '';
            document.getElementById('manualPosition').value = '';
            document.getElementById('manualEmail').value = '';
        }
        
        // ===== 초대 링크 생성 =====
        function generateInviteLink(customerId) {
            // 자동 도메인 감지 (Netlify 배포된 주소 자동 사용)
            const baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
            
            // 고객 정보 찾기
            const customer = inviteCustomers.find(c => c.id === customerId) || customers.find(c => c.id === customerId);
            
            if (!customer) return baseUrl + 'subscribe.html';
            
            // 간단한 파라미터로 URL 생성 (짧고 깔끔하게)
            const params = new URLSearchParams({
                r: customer.name,      // r = reference (고객명)
                id: customerId         // 고객 ID
            });
            
            // 최종 URL: https://ceofocus123.netlify.app/subscribe.html?r=홍길동&id=123
            return `${baseUrl}subscribe.html?${params.toString()}`;
        }
        
        // ===== 초대 메시지 생성 =====
        function generateInviteMessage(customer) {
            const inviteLink = generateInviteLink(customer.id);
            
            return messageTemplate
                .replace(/{이름}/g, customer.name)
                .replace(/{컨설턴트}/g, consultantName)
                .replace(/{초대링크}/g, inviteLink);
        }
        
        // ===== 공통 구독 URL 생성 (SNS/강의용) =====
        function generateCommonUrl() {
            const baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
            const consultantName = localStorage.getItem('kfpc_consultant_name') || '';
            
            if (consultantName) {
                // 컨설턴트 이름이 있으면 포함
                return `${baseUrl}subscribe.html?c=${encodeURIComponent(consultantName)}`;
            } else {
                // 컨설턴트 이름이 없으면 기본 URL
                return `${baseUrl}subscribe.html`;
            }
        }
        
        // ===== 공통 URL 복사 =====
        function copyCommonUrl() {
            const url = generateCommonUrl();
            
            navigator.clipboard.writeText(url).then(() => {
                showAlert(`✅ 공통 구독 URL이 복사되었습니다!\n\nSNS/강의/단체문자 등에 활용하세요.`);
            }).catch(() => {
                showAlert('❌ 복사에 실패했습니다.', 'error');
            });
        }
        
        // ===== 공통 URL 메시지 복사 =====
        function copyCommonMessage() {
            const url = generateCommonUrl();
            const consultantName = localStorage.getItem('kfpc_consultant_name') || '담당자';
            
            const message = `안녕하세요! 👋

KFPC ${consultantName}입니다.

실시간 재무 정보와 세무 뉴스를 받아보세요!

👉 구독하기: ${url}

언제든지 문의 주세요! 😊`;
            
            navigator.clipboard.writeText(message).then(() => {
                showAlert(`✅ 공통 구독 메시지가 복사되었습니다!\n\nSNS/강의/단체문자 등에 활용하세요.`);
            }).catch(() => {
                showAlert('❌ 복사에 실패했습니다.', 'error');
            });
        }
        
        // ===== 초대 링크 복사 =====
        function copyInviteLink(customerId) {
            const customer = inviteCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            const inviteLink = generateInviteLink(customerId);
            
            navigator.clipboard.writeText(inviteLink).then(() => {
                showAlert(`✅ ${customer.name}님의 초대 링크가 복사되었습니다!`);
            }).catch(() => {
                showAlert('❌ 복사에 실패했습니다.', 'error');
            });
        }
        
        // ===== 메시지+URL 복사 =====
        function copyInviteMessage(customerId) {
            const customer = inviteCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            const inviteLink = generateInviteLink(customerId);
            const consultantName = localStorage.getItem('kfpc_consultant_name') || '담당자';
            
            // 메시지 템플릿 (사용자가 수정 가능)
            const message = `안녕하세요, ${customer.name}님! 👋

KFPC ${consultantName}입니다.

실시간 재무 정보와 세무 뉴스를 받아보세요!

👉 구독하기: ${inviteLink}

언제든지 문의 주세요! 😊`;
            
            navigator.clipboard.writeText(message).then(() => {
                showAlert(`✅ ${customer.name}님에게 보낼 메시지가 복사되었습니다!\n\n문자/메신저로 발송하세요.`);
            }).catch(() => {
                showAlert('❌ 복사에 실패했습니다.', 'error');
            });
        }
        
        // ===== 고객 삭제 =====
        function deleteInviteCustomer(customerId) {
            const customer = inviteCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            if (confirm(`${customer.name}님을 삭제하시겠습니까?`)) {
                inviteCustomers = inviteCustomers.filter(c => c.id !== customerId);
                saveInviteData();
                showAlert(`✅ ${customer.name}님이 삭제되었습니다.`);
            }
        }
        
        // ===== 메시지 템플릿 저장 =====
        function saveMessageTemplate() {
            consultantName = document.getElementById('consultantName').value.trim();
            messageTemplate = document.getElementById('messageTemplate').value.trim();
            
            if (!consultantName || !messageTemplate) {
                showAlert('❌ 이름과 메시지를 입력해주세요.', true);
                return;
            }
            
            saveInviteData();
            showAlert('✅ 템플릿이 저장되었습니다!');
        }
        
        // ===== 컨설턴트 정보 관리 =====
        function saveConsultantInfo() {
            const company = document.getElementById('consultantCompany').value.trim();
            const name = document.getElementById('consultantNameSet').value.trim();
            const position = document.getElementById('consultantPosition').value.trim();
            
            if (!name) {
                showAlert('❌ 컨설턴트 성명은 필수입니다.', true);
                return;
            }
            
            // 저장
            localStorage.setItem('kfpc_consultant_company', company);
            localStorage.setItem('kfpc_consultant_name', name);
            localStorage.setItem('kfpc_consultant_position', position);
            
            showAlert('✅ 컨설턴트 정보가 저장되었습니다!');
            updateConsultantPreview();
        }
        
        function loadConsultantInfo() {
            const company = localStorage.getItem('kfpc_consultant_company') || '';
            const name = localStorage.getItem('kfpc_consultant_name') || '';
            const position = localStorage.getItem('kfpc_consultant_position') || '';
            
            document.getElementById('consultantCompany').value = company;
            document.getElementById('consultantNameSet').value = name;
            document.getElementById('consultantPosition').value = position;
            
            updateConsultantPreview();
            
            // 입력 필드에 이벤트 리스너 추가
            ['consultantCompany', 'consultantNameSet', 'consultantPosition'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateConsultantPreview);
            });
        }
        
        function updateConsultantPreview() {
            const company = document.getElementById('consultantCompany').value.trim();
            const name = document.getElementById('consultantNameSet').value.trim() || '컨설턴트';
            const position = document.getElementById('consultantPosition').value.trim();
            
            let preview = '- ';
            if (company) preview += company + ' ';
            if (position) preview += position + ' ';
            preview += name + ' 드림';
            
            document.getElementById('previewText').textContent = preview;
        }
        
        function getConsultantSignature() {
            const company = localStorage.getItem('kfpc_consultant_company') || '';
            const name = localStorage.getItem('kfpc_consultant_name') || '컨설턴트';
            const position = localStorage.getItem('kfpc_consultant_position') || '';
            
            let signature = '';
            if (company) signature += company + ' ';
            if (position) signature += position + ' ';
            signature += name;
            
            return signature;
        }
        
        
        // ===== 고객 목록 백업 =====
        function exportInviteCustomers() {
            if (inviteCustomers.length === 0) {
                showAlert('❌ 백업할 고객이 없습니다.', true);
                return;
            }
            
            const csv = [
                ['이름', '전화번호', '회사', '직함', '이메일', '초대발송', '구독상태', '등록일'].join(','),
                ...inviteCustomers.map(c => [
                    c.name,
                    c.phone,
                    c.company,
                    c.position,
                    c.email,
                    c.inviteSent ? '발송됨' : '미발송',
                    c.subscribed ? '구독완료' : '미구독',
                    new Date(c.createdAt).toLocaleString('ko-KR')
                ].join(','))
            ].join('\n');
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kfpc_customers_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('✅ 고객 목록이 다운로드되었습니다!');
        }
        
        // ===== vCard 내보내기 (휴대폰 연락처 저장용) =====
        function exportToVCard() {
            if (customers.length === 0 && inviteCustomers.length === 0) {
                showAlert('❌ 내보낼 고객이 없습니다.', 'error');
                return;
            }
            
            // 모든 고객 합치기
            const allCustomers = [...customers, ...inviteCustomers];
            
            if (allCustomers.length === 0) {
                showAlert('❌ 내보낼 고객이 없습니다.', 'error');
                return;
            }
            
            // vCard 형식으로 변환
            let vcfContent = '';
            
            allCustomers.forEach(customer => {
                if (!customer.name || !customer.phone) return;
                
                vcfContent += 'BEGIN:VCARD\r\n';
                vcfContent += 'VERSION:3.0\r\n';
                vcfContent += `FN:${customer.name}\r\n`;
                vcfContent += `N:${customer.name};;;;\r\n`;
                
                // 전화번호
                const phone = customer.phone.replace(/[^0-9]/g, '');
                vcfContent += `TEL;TYPE=CELL:${phone}\r\n`;
                
                // 이메일
                if (customer.email) {
                    vcfContent += `EMAIL;TYPE=INTERNET:${customer.email}\r\n`;
                }
                
                // 회사
                if (customer.company) {
                    vcfContent += `ORG:${customer.company}\r\n`;
                }
                
                // 직함
                if (customer.position) {
                    vcfContent += `TITLE:${customer.position}\r\n`;
                }
                
                // 메모 (KFPC 고객임을 표시)
                vcfContent += 'NOTE:KFPC 고객\r\n';
                
                vcfContent += 'END:VCARD\r\n';
            });
            
            // 파일 다운로드
            const blob = new Blob([vcfContent], { type: 'text/vcard;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `KFPC_고객연락처_${new Date().toISOString().slice(0,10)}.vcf`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert(`✅ ${allCustomers.length}명의 연락처가 vCard 형식으로 다운로드되었습니다!\n\n📱 휴대폰에서 파일을 열면 연락처 앱에 자동으로 추가됩니다.`, 'success');
        }
        
        // ===== 선택 삭제 =====
        function deleteSelectedInviteCustomers() {
            const selectedIds = selectedInviteCustomers;
            
            if (selectedIds.length === 0) {
                showAlert('ℹ️ 삭제할 고객을 선택해주세요.', 'info');
                return;
            }
            
            const selectedNames = inviteCustomers
                .filter(c => selectedIds.includes(c.id))
                .map(c => c.name)
                .join(', ');
            
            if (!confirm(`⚠️ 선택한 ${selectedIds.length}명의 고객을 삭제하시겠습니까?\n\n${selectedNames}\n\n이 작업은 되돌릴 수 없습니다.`)) {
                return;
            }
            
            // 선택된 고객들 삭제
            inviteCustomers = inviteCustomers.filter(c => !selectedIds.includes(c.id));
            
            // 선택 목록 초기화
            selectedInviteCustomers = [];
            
            // 저장 및 화면 갱신
            saveInviteData();
            
            showAlert(`✅ ${selectedIds.length}명의 고객이 삭제되었습니다.`, 'success');
        }
        
        // ===== 전체 삭제 (일괄 삭제) =====
        function clearAllInviteCustomers() {
            if (!confirm('⚠️ 모든 고객 정보를 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.')) {
                return;
            }
            
            if (!confirm('정말로 삭제하시겠습니까?')) {
                return;
            }
            
            inviteCustomers = [];
            saveInviteData();
            showAlert('✅ 모든 고객 정보가 삭제되었습니다.');
        }
        
        // ===== 모달 =====
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }
        
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }
        
        // ===== 알림 =====
        function showAlert(message, isError = false) {
            const alert = document.createElement('div');
            alert.className = `alert ${isError ? 'error' : ''}`;
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
        
        // ===== 초기화 =====
        window.addEventListener('load', () => { init(); if (typeof initInvite === 'function') initInvite(); });
        
        // ===============================================================
        
        
        // ===== 고객 정보 수정 =====
        function editInviteCustomer(customerId) {
            const customer = inviteCustomers.find(c => c.id === customerId);
            if (!customer) return;
            
            // 수정 모달에 기존 데이터 채우기
            document.getElementById('editCustomerId').value = customer.id;
            document.getElementById('editName').value = customer.name;
            document.getElementById('editPhone').value = customer.phone;
            document.getElementById('editCompany').value = customer.company || '';
            document.getElementById('editPosition').value = customer.position || '';
            document.getElementById('editEmail').value = customer.email || '';
            document.getElementById('editHonorific').value = customer.honorific || '님'; // ⭐ 호칭 불러오기
            
            openModal('editCustomerModal');
        }
        
        function saveEditedCustomer() {
            const customerId = parseInt(document.getElementById('editCustomerId').value);
            const customer = inviteCustomers.find(c => c.id === customerId);
            
            if (!customer) return;
            
            const name = document.getElementById('editName').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            
            if (!name || !phone) {
                showInviteAlert('이름과 전화번호는 필수입니다.', true);
                return;
            }
            
            // 고객 정보 업데이트
            customer.name = name;
            customer.phone = phone;
            customer.company = document.getElementById('editCompany').value.trim();
            customer.position = document.getElementById('editPosition').value.trim();
            customer.email = document.getElementById('editEmail').value.trim();
            customer.honorific = document.getElementById('editHonorific').value; // ⭐ 호칭 추가
            customer.updatedAt = new Date().toISOString();
            
            saveInviteData();
            closeModal('editCustomerModal');
            showInviteAlert(`✅ ${name}님의 정보가 수정되었습니다!`);
        }
        
        // ===== 고객 선택 관리 =====
        let selectedInviteCustomers = new Set();
        
        function toggleInviteCustomerSelect(customerId) {
            if (selectedInviteCustomers.has(customerId)) {
                selectedInviteCustomers.delete(customerId);
            } else {
                selectedInviteCustomers.add(customerId);
            }
            updateInviteSelectionInfo();
        }
        
        function toggleInviteSelectAll() {
            const checkbox = document.getElementById('inviteSelectAll');
            
            if (checkbox.checked) {
                inviteCustomers.forEach(c => selectedInviteCustomers.add(c.id));
            } else {
                selectedInviteCustomers.clear();
            }
            
            renderInviteCustomers();
            updateInviteSelectionInfo();
        }
        
        function updateInviteSelectionInfo() {
            const info = document.getElementById('inviteSelectionInfo');
            if (info) {
                info.textContent = `${selectedInviteCustomers.size}명 선택됨`;
            }
        }
        
        // ===== 휴대폰으로 전송 =====
        // ===== 선택한 고객들의 URL 복사 =====
        function copySelectedURLs() {
            if (selectedInviteCustomers.size === 0) {
                showAlert('❌ 복사할 고객을 선택해주세요.', 'error');
                return;
            }
            
            const selected = inviteCustomers.filter(c => selectedInviteCustomers.has(c.id));
            
            // URL 목록 생성
            let urlList = '📋 구독 URL 목록\n';
            urlList += '━━━━━━━━━━━━━━━\n\n';
            
            selected.forEach((customer, index) => {
                const url = generateInviteLink(customer.id);
                urlList += `${index + 1}. ${customer.name}\n`;
                urlList += `${url}\n\n`;
            });
            
            urlList += `━━━━━━━━━━━━━━━\n`;
            urlList += `총 ${selected.length}명`;
            
            navigator.clipboard.writeText(urlList).then(() => {
                showAlert(`✅ ${selected.length}명의 URL이 복사되었습니다!\n\n문자/메신저로 각 고객에게 발송하세요.`);
            }).catch(() => {
                showAlert('❌ 복사에 실패했습니다.', 'error');
            });
        }
        
        // ===== 선택한 고객들의 메시지 복사 =====
        function copySelectedMessages() {
            if (selectedInviteCustomers.size === 0) {
                showAlert('❌ 복사할 고객을 선택해주세요.', 'error');
                return;
            }
            
            const selected = inviteCustomers.filter(c => selectedInviteCustomers.has(c.id));
            const consultantName = localStorage.getItem('kfpc_consultant_name') || '담당자';
            
            // 각 고객별 메시지 생성
            let messages = '';
            
            selected.forEach((customer, index) => {
                const url = generateInviteLink(customer.id);
                
                messages += `━━━━━━━━━━━━━━━\n`;
                messages += `${index + 1}. ${customer.name}님에게 보낼 메시지:\n`;
                messages += `━━━━━━━━━━━━━━━\n\n`;
                messages += `안녕하세요, ${customer.name}님! 👋\n\n`;
                messages += `KFPC ${consultantName}입니다.\n\n`;
                messages += `실시간 재무 정보와 세무 뉴스를 받아보세요!\n\n`;
                messages += `👉 구독하기: ${url}\n\n`;
                messages += `언제든지 문의 주세요! 😊\n\n\n`;
            });
            
            messages += `━━━━━━━━━━━━━━━\n`;
            messages += `총 ${selected.length}명\n`;
            messages += `━━━━━━━━━━━━━━━`;
            
            navigator.clipboard.writeText(messages).then(() => {
                showAlert(`✅ ${selected.length}명에게 보낼 메시지가 복사되었습니다!\n\n각 고객에게 맞는 메시지를 복사해서 발송하세요.`);
            }).catch(() => {
                showAlert('❌ 복사에 실패했습니다.', 'error');
            });
        }
        
        function sendSelectedToPhone() {
            if (selectedInviteCustomers.size === 0) {
                showInviteAlert('❌ 전송할 고객을 선택해주세요.', true);
                return;
            }
            
            const selected = inviteCustomers.filter(c => selectedInviteCustomers.has(c.id));
            
            // vCard 형식으로 변환
            let vCardData = '';
            
            selected.forEach(customer => {
                vCardData += `BEGIN:VCARD\nVERSION:3.0\n`;
                vCardData += `FN:${customer.name}\n`;
                vCardData += `TEL:${customer.phone}\n`;
                if (customer.email) vCardData += `EMAIL:${customer.email}\n`;
                if (customer.company) vCardData += `ORG:${customer.company}\n`;
                if (customer.position) vCardData += `TITLE:${customer.position}\n`;
                vCardData += `END:VCARD\n\n`;
            });
            
            // Blob 생성 및 다운로드
            const blob = new Blob([vCardData], { type: 'text/vcard;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `selected_customers_${new Date().toISOString().slice(0,10)}.vcf`;
            a.click();
            URL.revokeObjectURL(url);
            
            showInviteAlert(`✅ ${selected.length}명의 연락처가 다운로드되었습니다!`);
        }
        
        function sendAllToPhone() {
            if (inviteCustomers.length === 0) {
                showInviteAlert('❌ 전송할 고객이 없습니다.', true);
                return;
            }
            
            // vCard 형식으로 변환
            let vCardData = '';
            
            inviteCustomers.forEach(customer => {
                vCardData += `BEGIN:VCARD\nVERSION:3.0\n`;
                vCardData += `FN:${customer.name}\n`;
                vCardData += `TEL:${customer.phone}\n`;
                if (customer.email) vCardData += `EMAIL:${customer.email}\n`;
                if (customer.company) vCardData += `ORG:${customer.company}\n`;
                if (customer.position) vCardData += `TITLE:${customer.position}\n`;
                vCardData += `END:VCARD\n\n`;
            });
            
            // Blob 생성 및 다운로드
            const blob = new Blob([vCardData], { type: 'text/vcard;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `all_customers_${new Date().toISOString().slice(0,10)}.vcf`;
            a.click();
            URL.revokeObjectURL(url);
            
            showInviteAlert(`✅ 전체 ${inviteCustomers.length}명의 연락처가 다운로드되었습니다!`);
        }
        
        // showAlert를 showInviteAlert로 래핑 (중복 방지)
        function showInviteAlert(message, isError = false) {
            if (typeof showAlert === 'function') {
                showAlert(message, isError ? 'error' : 'success');
            } else {
                alert(message);
            }
        }
// 고객 초대 시스템 함수들 끝
        // ===============================================================
        
        // ================================================================
        // 예약 메시지 사전 확인 시스템 (NEW)
        // ================================================================
        
        // 예약 메시지 데이터 로드
        function loadScheduledMessages() {
            const saved = localStorage.getItem('scheduledMessages');
            if (saved) {
                scheduledMessages = JSON.parse(saved);
            }
            updatePendingBadge();
        }
        
        // 예약 메시지 데이터 저장
        function saveScheduledMessages() {
            localStorage.setItem('scheduledMessages', JSON.stringify(scheduledMessages));
            updatePendingBadge();
        }
        
        // 승인 대기 배지 업데이트
        function updatePendingBadge() {
            const pendingCount = scheduledMessages.filter(m => m.status === 'pending-approval').length;
            const badge = document.getElementById('pendingBadge');
            if (badge) {
                if (pendingCount > 0) {
                    badge.textContent = pendingCount;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // 예약 메시지 생성 (메시지 발송 폼에서 예약 발송 선택 시)
        function createScheduledMessage(title, body, customerIds, scheduledTime) {
            const message = {
                id: Date.now(),
                title: title,
                body: body,
                customerIds: customerIds,
                customerCount: customerIds.length,
                scheduledTime: scheduledTime,
                status: 'draft', // draft, pending-approval, approved, sent, cancelled
                createdAt: new Date().toISOString(),
                approvedAt: null,
                sentAt: null,
                approvedBy: null,
                modifiedAt: null
            };
            
            scheduledMessages.push(message);
            saveScheduledMessages();
            
            // 발송 전일 오전 10시에 알림을 보내야 하는지 확인
            checkAndSetApprovalAlert(message);
            
            return message;
        }
        
        // 발송 전일 오전 10시 확인 (시뮬레이션)
        function checkAndSetApprovalAlert(message) {
            const scheduledDate = new Date(message.scheduledTime);
            const dayBefore = new Date(scheduledDate);
            dayBefore.setDate(dayBefore.getDate() - 1);
            dayBefore.setHours(10, 0, 0, 0);
            
            const now = new Date();
            
            // 발송 시간이 24시간 이상 남았으면 사전 확인 대기 상태로
            if (scheduledDate - now > 24 * 60 * 60 * 1000) {
                message.status = 'pending-approval';
                message.approvalAlertTime = dayBefore.toISOString();
            } else {
                // 24시간 미만이면 즉시 확인 필요
                message.status = 'pending-approval';
                message.approvalAlertTime = new Date().toISOString();
            }
        }
        
        // 예약 메시지 목록 렌더링
        function renderScheduledMessages() {
            const container = document.getElementById('scheduledMessagesList');
            const filter = document.getElementById('scheduledFilter')?.value || 'all';
            
            if (!container) return;
            
            let filtered = scheduledMessages;
            if (filter !== 'all') {
                filtered = scheduledMessages.filter(m => m.status === filter);
            }
            
            // 최신순 정렬
            filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">📭</div>
                        <div class="text">예약된 메시지가 없습니다</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(msg => {
                const scheduledDate = new Date(msg.scheduledTime);
                const isPending = msg.status === 'pending-approval';
                const isApproved = msg.status === 'approved';
                
                let statusText = '임시 저장';
                let statusClass = 'draft';
                if (isPending) {
                    statusText = '🔔 승인 대기';
                    statusClass = 'pending-approval';
                } else if (isApproved) {
                    statusText = '✅ 승인 완료';
                    statusClass = 'approved';
                } else if (msg.status === 'sent') {
                    statusText = '📤 발송 완료';
                    statusClass = 'approved';
                } else if (msg.status === 'cancelled') {
                    statusText = '❌ 취소됨';
                    statusClass = 'draft';
                }
                
                return `
                    <div class="scheduled-message-card ${statusClass}">
                        <div class="message-header">
                            <div class="message-title">${msg.title}</div>
                            <div class="message-status ${statusClass}">${statusText}</div>
                        </div>
                        
                        <div class="message-body">${msg.body}</div>
                        
                        <div class="message-info">
                            <div class="info-item">
                                <span class="icon">👥</span>
                                <span>수신자: ${msg.customerCount}명</span>
                            </div>
                            <div class="info-item">
                                <span class="icon">⏰</span>
                                <span>발송 예정: ${formatDateTime(scheduledDate)}</span>
                            </div>
                            <div class="info-item">
                                <span class="icon">📅</span>
                                <span>생성일: ${formatDateTime(new Date(msg.createdAt))}</span>
                            </div>
                            ${msg.approvedAt ? `
                            <div class="info-item">
                                <span class="icon">✅</span>
                                <span>승인일: ${formatDateTime(new Date(msg.approvedAt))}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="message-actions">
                            ${isPending ? `
                                <button class="btn-approve" onclick="approveMessage(${msg.id})">
                                    ✅ 승인 (예정대로 발송)
                                </button>
                                <button class="btn-modify" onclick="modifyMessage(${msg.id})">
                                    ✏️ 수정
                                </button>
                            ` : ''}
                            ${(isPending || isApproved) ? `
                                <button class="btn-cancel" onclick="cancelMessage(${msg.id})">
                                    ❌ 취소
                                </button>
                            ` : ''}
                            ${msg.status === 'sent' ? `
                                <button class="btn btn-secondary" onclick="viewMessageDetail(${msg.id})">
                                    📊 발송 결과 보기
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 메시지 승인
        function approveMessage(messageId) {
            const message = scheduledMessages.find(m => m.id === messageId);
            if (!message) return;
            
            if (confirm(`"${message.title}" 메시지를 승인하시겠습니까?\n\n예정된 시간에 자동으로 발송됩니다.\n발송 예정: ${formatDateTime(new Date(message.scheduledTime))}`)) {
                message.status = 'approved';
                message.approvedAt = new Date().toISOString();
                message.approvedBy = 'current_user'; // 실제로는 로그인한 사용자 ID
                
                saveScheduledMessages();
                renderScheduledMessages();
                
                showAlert(`✅ 메시지가 승인되었습니다!\n${formatDateTime(new Date(message.scheduledTime))}에 자동 발송됩니다.`);
                
                // 실제 발송 예약 (시뮬레이션)
                scheduleAutoSend(message);
            }
        }
        
        // 메시지 수정
        function modifyMessage(messageId) {
            const message = scheduledMessages.find(m => m.id === messageId);
            if (!message) return;
            
            // 모달로 수정 폼 표시
            showModifyModal(message);
        }
        
        // 수정 모달 표시
        function showModifyModal(message) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>✏️ 예약 메시지 수정</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">×</button>
                    </div>
                    
                    <div class="form-group">
                        <label>제목</label>
                        <input type="text" id="modifyTitle" value="${message.title}" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.1);color:white;font-size:16px;">
                    </div>
                    
                    <div class="form-group">
                        <label>내용</label>
                        <textarea id="modifyBody" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.1);color:white;font-size:16px;min-height:150px;">${message.body}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>발송 예정 시각</label>
                        <input type="datetime-local" id="modifyScheduledTime" value="${new Date(message.scheduledTime).toISOString().slice(0, 16)}" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.1);color:white;font-size:16px;">
                    </div>
                    
                    <div style="display:flex;gap:10px;margin-top:20px;">
                        <button class="btn-secondary" style="flex:1;padding:12px;min-height:44px;" onclick="this.closest('.modal').remove()">취소</button>
                        <button class="btn-primary" style="flex:1;padding:12px;min-height:44px;" onclick="saveModifiedMessage(${message.id}, this.closest('.modal'))">저장</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // 수정된 메시지 저장
        function saveModifiedMessage(messageId, modal) {
            const message = scheduledMessages.find(m => m.id === messageId);
            if (!message) return;
            
            const title = document.getElementById('modifyTitle').value.trim();
            const body = document.getElementById('modifyBody').value.trim();
            const scheduledTime = document.getElementById('modifyScheduledTime').value;
            
            if (!title || !body || !scheduledTime) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            
            const newScheduledTime = new Date(scheduledTime);
            if (newScheduledTime <= new Date()) {
                alert('발송 시간은 현재 시간 이후여야 합니다.');
                return;
            }
            
            message.title = title;
            message.body = body;
            message.scheduledTime = newScheduledTime.toISOString();
            message.modifiedAt = new Date().toISOString();
            message.status = 'pending-approval'; // 수정 후 다시 승인 대기
            message.approvedAt = null;
            
            checkAndSetApprovalAlert(message);
            
            saveScheduledMessages();
            renderScheduledMessages();
            
            modal.remove();
            showAlert(`✅ 메시지가 수정되었습니다!\n다시 승인해주세요.`);
        }
        
        // 메시지 취소
        function cancelMessage(messageId) {
            const message = scheduledMessages.find(m => m.id === messageId);
            if (!message) return;
            
            if (confirm(`"${message.title}" 메시지를 취소하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.`)) {
                message.status = 'cancelled';
                
                saveScheduledMessages();
                renderScheduledMessages();
                
                showAlert(`❌ 메시지가 취소되었습니다.`);
            }
        }
        
        // 자동 발송 예약 (실제로는 백엔드/cron job 필요)
        function scheduleAutoSend(message) {
            const scheduledTime = new Date(message.scheduledTime);
            const now = new Date();
            const delay = scheduledTime - now;
            
            if (delay > 0 && delay < 24 * 60 * 60 * 1000) { // 24시간 이내면 setTimeout 사용
                setTimeout(() => {
                    executeSendMessage(message);
                }, delay);
                
                console.log(`📅 메시지 자동 발송 예약됨: ${message.title} at ${formatDateTime(scheduledTime)}`);
            }
        }
        
        // 실제 메시지 발송 실행
        function executeSendMessage(message) {
            console.log('📤 메시지 발송 실행:', message.title);
            
            // 여기서 실제 발송 로직 실행
            // 예: sendPushNotification(message);
            
            message.status = 'sent';
            message.sentAt = new Date().toISOString();
            
            saveScheduledMessages();
            renderScheduledMessages();
            
            showAlert(`✅ "${message.title}" 메시지가 발송되었습니다!`);
        }
        
        // 사전 확인 시뮬레이션 (테스트용)
        function checkPendingApprovals() {
            const pending = scheduledMessages.filter(m => m.status === 'pending-approval');
            
            if (pending.length === 0) {
                showAlert('⚠️ 승인 대기 중인 메시지가 없습니다.');
                return;
            }
            
            const message = `🔔 사전 확인 알림\n\n아래 메시지들이 발송 예정입니다.\n승인 후 자동 발송됩니다.\n\n${pending.map(m => `• ${m.title} (${formatDateTime(new Date(m.scheduledTime))})`).join('\n')}`;
            
            alert(message);
            
            // 예약 관리 탭으로 이동
            switchTab('scheduled', document.querySelector('.tab-btn[onclick*="scheduled"]'));
        }
        
        // 날짜/시간 포맷팅
        function formatDateTime(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hour = String(date.getHours()).padStart(2, '0');
            const minute = String(date.getMinutes()).padStart(2, '0');
            
            return `${year}-${month}-${day} ${hour}:${minute}`;
        }
        
        // 메시지 발송 폼 수정 - 예약 발송 시 예약 메시지로 저장
        const originalSendMessage = window.sendMessage;
        window.sendMessage = function(event) {
            event.preventDefault();
            
            const sendType = document.getElementById('sendType').value;
            const title = document.getElementById('messageTitle').value;
            const body = document.getElementById('messageBody').value;
            const scheduleTime = document.getElementById('scheduleTime').value;
            
            // 선택된 고객 ID 수집
            const selectedCustomerIds = Array.from(selectedCustomersData || {})
                .filter(([id, selected]) => selected)
                .map(([id]) => parseInt(id));
            
            if (selectedCustomerIds.length === 0) {
                showAlert('수신자를 선택해주세요.', true);
                return;
            }
            
            if (sendType === 'scheduled') {
                if (!scheduleTime) {
                    showAlert('예약 시각을 입력해주세요.', true);
                    return;
                }
                
                const scheduledTime = new Date(scheduleTime);
                if (scheduledTime <= new Date()) {
                    showAlert('예약 시각은 현재 시간 이후여야 합니다.', true);
                    return;
                }
                
                // 예약 메시지 생성
                const message = createScheduledMessage(title, body, selectedCustomerIds, scheduledTime.toISOString());
                
                showAlert(`✅ 예약 메시지가 등록되었습니다!\n\n발송 전일 오전 10시에 사전 확인 알림을 받게 됩니다.`);
                
                // 폼 초기화
                document.getElementById('sendForm').reset();
                selectedCustomersData = {};
                
                // 예약 관리 탭으로 이동
                setTimeout(() => {
                    switchTab('scheduled', document.querySelector('.tab-btn[onclick*="scheduled"]'));
                }, 2000);
                
                return;
            }
            
            // 즉시 발송인 경우 기존 로직 실행
            if (typeof originalSendMessage === 'function') {
                originalSendMessage(event);
            }
        };
        
        // 초기화 시 예약 메시지 로드
        document.addEventListener('DOMContentLoaded', function() {
            loadScheduledMessages();
            
            // 예약 관리 탭 렌더링
            if (document.getElementById('scheduledTab')) {
                renderScheduledMessages();
            }
            
            // 기념일 로드
            loadAnniversaries();
            
            // 컨설턴트 정보 로드
            loadConsultantInfo();
            
            // 기념일 자동 발송 체크 (매일 아침 9시)
            checkUpcomingAnniversaries();
            setInterval(checkUpcomingAnniversaries, 10 * 60 * 1000); // 10분마다 체크
        });
        
        // ===== 기념일 자동 발송 체크 =====
        function checkUpcomingAnniversaries() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const todayDate = new Date(today);
            
            // 내일 날짜 계산
            const tomorrow = new Date(todayDate);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            // 전일 알림 저장소 가져오기
            let pendingNotifications = JSON.parse(localStorage.getItem('kfpc_pending_anniversary_notifications') || '{}');
            
            anniversaries.forEach(anniversary => {
                if (anniversary.active === false) return;
                
                const nextDate = getNextAnniversaryDate(anniversary);
                if (!nextDate) return;
                
                // === 전일 알림 체크 (오전 10시~10시30분) ===
                if (nextDate === tomorrowStr && now.getHours() === 10 && now.getMinutes() < 30) {
                    const notificationKey = `${anniversary.id}_${tomorrowStr}`;
                    
                    // 이미 알림을 보낸 경우 스킵
                    if (pendingNotifications[notificationKey]) return;
                    
                    // 전일 알림 표시
                    showDayBeforeNotification(anniversary, nextDate);
                    
                    // 알림 표시 기록
                    pendingNotifications[notificationKey] = {
                        anniversaryId: anniversary.id,
                        notifiedAt: now.toISOString(),
                        sendDate: nextDate,
                        status: 'pending' // pending, approved, cancelled
                    };
                    localStorage.setItem('kfpc_pending_anniversary_notifications', JSON.stringify(pendingNotifications));
                }
                
                // === 당일 발송 체크 ===
                if (nextDate === today) {
                    const notificationKey = `${anniversary.id}_${today}`;
                    const notification = pendingNotifications[notificationKey];
                    
                    // 전일 승인을 받지 않은 경우 발송하지 않음
                    if (!notification || notification.status !== 'approved') {
                        console.log(`⏸️ 기념일 ${anniversary.id}: 전일 승인이 없어 발송 건너뜀`);
                        return;
                    }
                    
                    const [hours, minutes] = anniversary.sendTime.split(':');
                    const sendTime = new Date();
                    sendTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    
                    // 발송 시간이 되었는지 체크
                    if (now >= sendTime && !anniversary.sentToday) {
                        sendAnniversaryMessage(anniversary);
                        anniversary.sentToday = true;
                        saveAnniversaries();
                        
                        // 발송 완료 후 알림 기록 삭제
                        delete pendingNotifications[notificationKey];
                        localStorage.setItem('kfpc_pending_anniversary_notifications', JSON.stringify(pendingNotifications));
                    }
                }
                
                // 매일 자정에 sentToday 플래그 초기화
                if (anniversary.sentToday && nextDate !== today) {
                    anniversary.sentToday = false;
                    saveAnniversaries();
                }
            });
            
            // 오래된 알림 기록 정리 (7일 이상 지난 것)
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            Object.keys(pendingNotifications).forEach(key => {
                const notification = pendingNotifications[key];
                if (new Date(notification.sendDate) < sevenDaysAgo) {
                    delete pendingNotifications[key];
                }
            });
            localStorage.setItem('kfpc_pending_anniversary_notifications', JSON.stringify(pendingNotifications));
        }
        
        // ===== 전일 알림 표시 =====
        function showDayBeforeNotification(anniversary, sendDate) {
            const customer = customers.find(c => c.id === anniversary.customerId);
            if (!customer) return;
            
            // 호칭 처리 함수
            function getHonorific(customer) {
                const name = customer.name || '';
                const position = customer.position || '';
                const honorificType = customer.honorific || '님';
                
                function hasFinalConsonant(text) {
                    if (!text) return false;
                    const lastChar = text.charCodeAt(text.length - 1);
                    return (lastChar - 0xAC00) % 28 !== 0;
                }
                
                switch(honorificType) {
                    case '님': return name + '님';
                    case '직함님': return position ? position + '님' : name + '님';
                    case '고객님': return name + ' 고객님';
                    case '씨': return name + '씨';
                    case '아야': return name + (hasFinalConsonant(name) ? '아' : '야');
                    case '이름만': return name;
                    default: return name + '님';
                }
            }
            
            // 메시지 미리보기 생성
            const consultant = getConsultantSignature();
            const previewTitle = anniversary.title
                .replace(/{honorific}/g, getHonorific(customer))
                .replace(/{name}/g, customer.name || '')
                .replace(/{position}/g, customer.position || '')
                .replace(/{company}/g, customer.company || '')
                .replace(/{consultant}/g, consultant);
            
            const previewContent = anniversary.content
                .replace(/{honorific}/g, getHonorific(customer))
                .replace(/{name}/g, customer.name || '')
                .replace(/{position}/g, customer.position || '')
                .replace(/{company}/g, customer.company || '')
                .replace(/{consultant}/g, consultant);
            
            // 전일 알림 모달 열기
            openDayBeforeModal(anniversary, customer, sendDate, previewTitle, previewContent);
        }
        
        // ===== 전일 알림 모달 관리 =====
        function openDayBeforeModal(anniversary, customer, sendDate, previewTitle, previewContent) {
            const info = anniversaryTypeInfo[anniversary.type];
            
            document.getElementById('dbAnniversaryId').value = anniversary.id;
            document.getElementById('dbCustomerId').value = customer.id;
            document.getElementById('dbSendDate').textContent = sendDate + ' (' + anniversary.sendTime + ')';
            document.getElementById('dbCustomerName').textContent = customer.name + (customer.company ? ` (${customer.company})` : '');
            document.getElementById('dbAnniversaryType').textContent = info.emoji + ' ' + info.name;
            document.getElementById('dbSendTime').textContent = anniversary.sendTime;
            document.getElementById('dbPreviewTitle').textContent = previewTitle;
            document.getElementById('dbPreviewContent').textContent = previewContent;
            
            document.getElementById('dayBeforeModal').classList.add('show');
        }
        
        function closeDayBeforeModal() {
            document.getElementById('dayBeforeModal').classList.remove('show');
        }
        
        function approveDayBeforeNotification() {
            const anniversaryId = parseInt(document.getElementById('dbAnniversaryId').value);
            const sendDate = document.getElementById('dbSendDate').textContent.split(' ')[0];
            
            // 승인 처리
            let pendingNotifications = JSON.parse(localStorage.getItem('kfpc_pending_anniversary_notifications') || '{}');
            const notificationKey = `${anniversaryId}_${sendDate}`;
            
            if (pendingNotifications[notificationKey]) {
                pendingNotifications[notificationKey].status = 'approved';
                pendingNotifications[notificationKey].approvedAt = new Date().toISOString();
                localStorage.setItem('kfpc_pending_anniversary_notifications', JSON.stringify(pendingNotifications));
                
                showAlert('✅ 발송이 승인되었습니다!\n\n내일 설정된 시각에 자동으로 발송됩니다.', 'success');
                closeDayBeforeModal();
            } else {
                showAlert('❌ 알림 정보를 찾을 수 없습니다.', 'error');
            }
        }
        
        function cancelDayBeforeNotification() {
            if (!confirm('정말 발송을 취소하시겠습니까?\n\n취소 후에는 자동 발송되지 않습니다.')) {
                return;
            }
            
            const anniversaryId = parseInt(document.getElementById('dbAnniversaryId').value);
            const sendDate = document.getElementById('dbSendDate').textContent.split(' ')[0];
            
            // 취소 처리
            let pendingNotifications = JSON.parse(localStorage.getItem('kfpc_pending_anniversary_notifications') || '{}');
            const notificationKey = `${anniversaryId}_${sendDate}`;
            
            if (pendingNotifications[notificationKey]) {
                pendingNotifications[notificationKey].status = 'cancelled';
                pendingNotifications[notificationKey].cancelledAt = new Date().toISOString();
                localStorage.setItem('kfpc_pending_anniversary_notifications', JSON.stringify(pendingNotifications));
                
                showAlert('🚫 발송이 취소되었습니다.', 'info');
                closeDayBeforeModal();
            }
        }
        
        function editDayBeforeMessage() {
            const anniversaryId = parseInt(document.getElementById('dbAnniversaryId').value);
            
            // 기념일 탭으로 이동
            switchTab('anniversary', document.querySelector('.tab-btn[onclick*="anniversary"]'));
            
            // 모달 닫기
            closeDayBeforeModal();
            
            // 해당 기념일 수정 모달 열기
            setTimeout(() => {
                editAnniversary(anniversaryId);
                showAlert('💡 수정 후 저장하시면 다시 전일 알림을 받게 됩니다.', 'info');
            }, 300);
        }
        
        // ===== 기념일 템플릿 미리보기 =====
        function showAnniversaryTemplates() {
            const modal = document.getElementById('anniversaryTemplatesModal');
            const listContainer = document.getElementById('templatePreviewList');
            
            // 카테고리 버튼 HTML 생성
            let categoryButtonsHtml = `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; scrollbar-width: thin; -webkit-overflow-scrolling: touch;">
            `;
            
            // 카테고리별로 분류
            const categories = {
                'personal': { name: '📅 개인 기념일', types: ['birthday', 'wedding', 'company', 'custom'] },
                'onetime': { name: '🎉 일회성 이벤트', types: ['promotion', 'admission', 'pass', 'moving', 'opening'] },
                'holiday': { name: '🎆 명절', types: ['lunar-new-year', 'chuseok', 'christmas', 'new-year'] },
                'solar': { name: '🌱 24절기', types: ['solar-ipchun', 'solar-chunbun', 'solar-ipha', 'solar-haaji', 'solar-ipchu', 'solar-chubun', 'solar-ipdong', 'solar-dongji'] }
            };
            
            // 카테고리 버튼들 생성
            Object.entries(categories).forEach(([catKey, catInfo], index) => {
                categoryButtonsHtml += `
                    <button 
                        onclick="showCategoryTemplates('${catKey}')" 
                        id="cat-btn-${catKey}"
                        style="
                            flex-shrink: 0;
                            padding: 12px 20px;
                            background: ${index === 0 ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'rgba(255, 255, 255, 0.2)'};
                            border: 2px solid ${index === 0 ? '#667eea' : 'rgba(255, 255, 255, 0.3)'};
                            border-radius: 25px;
                            color: white;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                            white-space: nowrap;
                        "
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
                    >
                        ${catInfo.name}
                    </button>
                `;
            });
            
            categoryButtonsHtml += `
                    </div>
                </div>
            `;
            
            // 상세 내용 표시 영역
            let detailsHtml = `
                <div id="templateDetailsArea" style="min-height: 300px;">
                    <!-- 선택된 카테고리의 템플릿들이 여기에 표시됩니다 -->
                </div>
            `;
            
            listContainer.innerHTML = categoryButtonsHtml + detailsHtml;
            
            // 첫 번째 카테고리 자동 표시
            showCategoryTemplates('personal');
            
            modal.classList.add('show');
        }
        
        function showCategoryTemplates(categoryKey) {
            // 모든 카테고리 버튼 스타일 초기화
            document.querySelectorAll('[id^="cat-btn-"]').forEach(btn => {
                btn.style.background = 'rgba(255, 255, 255, 0.2)';
                btn.style.border = '2px solid rgba(255, 255, 255, 0.3)';
            });
            
            // 선택된 버튼 활성화
            const selectedBtn = document.getElementById(`cat-btn-${categoryKey}`);
            if (selectedBtn) {
                selectedBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                selectedBtn.style.border = '2px solid #667eea';
            }
            
            const categories = {
                'personal': { name: '📅 개인 기념일', types: ['birthday', 'wedding', 'company', 'custom'] },
                'onetime': { name: '🎉 일회성 이벤트', types: ['promotion', 'admission', 'pass', 'moving', 'opening'] },
                'holiday': { name: '🎆 명절', types: ['lunar-new-year', 'chuseok', 'christmas', 'new-year'] },
                'solar': { name: '🌱 24절기', types: ['solar-ipchun', 'solar-chunbun', 'solar-ipha', 'solar-haaji', 'solar-ipchu', 'solar-chubun', 'solar-ipdong', 'solar-dongji'] }
            };
            
            const catInfo = categories[categoryKey];
            const detailsArea = document.getElementById('templateDetailsArea');
            
            let html = '';
            catInfo.types.forEach(type => {
                const template = anniversaryTemplates[type];
                const info = anniversaryTypeInfo[type];
                
                if (template && info) {
                    const itemId = `template-${categoryKey}-${type}`;
                    html += `
                    <div id="${itemId}" style="margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden;">
                        <div style="background: rgba(102, 126, 234, 0.3); padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;" onclick="toggleTemplate('${itemId}')">
                            <span style="font-weight: bold; font-size: 13px; color: #FFD700;">
                                ${info.icon} ${info.name}
                            </span>
                            <span id="${itemId}-arrow" style="font-size: 18px; color: #FFD700;">▼</span>
                        </div>
                        <div id="${itemId}-content" style="display: none; background: rgba(255,255,255,0.15); padding: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <div style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 15px; font-size: 14px; line-height: 1.7; white-space: pre-wrap; color: #ffffff;">
                                <div style="font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px;">제목:</div>
                                ${template.title}
                                
                                <div style="font-weight: bold; margin: 15px 0 8px 0; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px;">내용:</div>
                                ${template.content}
                            </div>
                            <button onclick="scrollToTop()" style="margin-top: 15px; padding: 6px 12px; background: rgba(102, 126, 234, 0.5); border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 12px; float: right;">
                                ⬆️ 위로가기
                            </button>
                            <div style="clear: both;"></div>
                        </div>
                    </div>`;
                }
            });
            
            detailsArea.innerHTML = html;
        }
        
        function toggleTemplate(itemId) {
            const content = document.getElementById(itemId + '-content');
            const arrow = document.getElementById(itemId + '-arrow');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '▲';
            } else {
                content.style.display = 'none';
                arrow.textContent = '▼';
            }
        }
        
        function scrollToTop() {
            const modal = document.getElementById('anniversaryTemplatesModal').querySelector('.modal-content');
            modal.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function closeAnniversaryTemplatesModal() {
            document.getElementById('anniversaryTemplatesModal').classList.remove('show');
        }
        
        // ===== 가이드 모달 =====
        function openGuideModal() {
            document.getElementById('guideModal').classList.add('show');
        }
        
        function closeGuideModal() {
            document.getElementById('guideModal').classList.remove('show');
        }
        
        // ===== 기념일 메시지 발송 =====
        async function sendAnniversaryMessage(anniversary) {
            const customer = customers.find(c => c.id === anniversary.customerId);
            if (!customer) return;
            
            // 호칭 처리
            function getHonorific(customer) {
                const name = customer.name || '';
                const position = customer.position || '';
                const honorificType = customer.honorific || '님';
                
                function hasFinalConsonant(text) {
                    if (!text) return false;
                    const lastChar = text.charCodeAt(text.length - 1);
                    return (lastChar - 0xAC00) % 28 !== 0;
                }
                
                switch(honorificType) {
                    case '님': return name + '님';
                    case '직함님': return position ? position + '님' : name + '님';
                    case '고객님': return name + ' 고객님';
                    case '씨': return name + '씨';
                    case '아야': return name + (hasFinalConsonant(name) ? '아' : '야');
                    case '이름만': return name;
                    default: return name + '님';
                }
            }
            
            // 메시지 개인화
            const consultant = getConsultantSignature();
            
            const personalizedTitle = anniversary.title
                .replace(/{honorific}/g, getHonorific(customer))
                .replace(/{name}/g, customer.name || '')
                .replace(/{position}/g, customer.position || '')
                .replace(/{company}/g, customer.company || '')
                .replace(/{consultant}/g, consultant);
            
            const personalizedContent = anniversary.content
                .replace(/{honorific}/g, getHonorific(customer))
                .replace(/{name}/g, customer.name || '')
                .replace(/{position}/g, customer.position || '')
                .replace(/{company}/g, customer.company || '')
                .replace(/{consultant}/g, consultant);
            
            // 메시지 로그 저장
            const message = {
                id: Date.now(),
                customerId: customer.id,
                customerName: customer.name,
                company: customer.company,
                position: customer.position,
                title: personalizedTitle,
                body: personalizedContent,
                originalTitle: anniversary.title,
                originalBody: anniversary.content,
                sendType: 'anniversary',
                anniversaryType: anniversary.type,
                status: 'success',
                sentAt: new Date().toISOString(),
                createdAt: new Date().toISOString()
            };
            
            messages.unshift(message);
            await saveToDrive(FILES.messages, messages);
            
            // 알림 표시
            const info = anniversaryTypeInfo[anniversary.type];
            showAlert(`🎉 ${customer.name}님께 ${info.name} 메시지가 발송되었습니다!`, 'success');
            
            // 통계 업데이트
            updateStats();
            renderMessages();
        }
        
        // ================================================================
        // 예약 메시지 시스템 끝
        // ================================================================
        
        // ================================================================
        // 페이지 로드 시 자동 초기화
        // ================================================================
        window.addEventListener('load', () => {
            console.log('✅ 페이지 로드 완료');
            
            // Contact Picker API 지원 여부 확인 (휴대폰 연락처 직접 선택 기능)
            const contactPickerBtn = document.getElementById('contactPickerBtn');
            if (contactPickerBtn) {
                if (!('contacts' in navigator && 'ContactsManager' in window)) {
                    // 지원하지 않는 경우 버튼 비활성화 및 스타일 변경
                    contactPickerBtn.style.opacity = '0.5';
                    contactPickerBtn.style.cursor = 'not-allowed';
                    const lastDiv = contactPickerBtn.querySelector('div:last-child');
                    if (lastDiv) lastDiv.textContent = 'PC에서는 사용 불가';
                    console.log('ℹ️ Contact Picker API 미지원 (PC 환경)');
                } else {
                    console.log('✅ Contact Picker API 지원 (모바일 환경)');
                }
            }
            
            // localStorage에서 토큰 복원 시도
            const savedToken = localStorage.getItem('googleAccessToken');
            if (savedToken) {
                accessToken = savedToken;
                isDriveConnected = true;
                updateDriveStatus(true);
                
                console.log('✅ 저장된 토큰 복원 성공');
                
                // 백그라운드에서 비동기 로딩 (페이지 표시를 차단하지 않음)
                (async () => {
                    try {
                        // Firebase 로그인 체크
                        await checkFirebaseLogin();
                        
                        // 데이터 로드
                        await loadAllData();
                        
                        // 실시간 동기화 시작 (3초마다)
                        if (syncCheckInterval) clearInterval(syncCheckInterval);
                        syncCheckInterval = setInterval(checkForUpdates, 3000);
                        console.log('✅ 실시간 동기화 시작 (3초마다 체크)');
                    } catch (error) {
                        console.error('❌ 초기화 오류:', error);
                    }
                })();
            } else {
                console.log('ℹ️ 저장된 토큰 없음 - Drive 연동 필요');
            }
        });
        
    </script>

    
    <!-- ========================================== -->
    <!-- 고객 초대 시스템 모달 -->
    <!-- ========================================== -->
    
        <div id="textModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📝 텍스트로 고객 추가</h2>
                <button class="modal-close" onclick="closeModal('textModal')">×</button>
            </div>
            
            <div class="form-group">
                <label>CSV 형식으로 입력 (이름, 전화번호, 회사, 직함, 이메일)</label>
                <textarea id="textInput" placeholder="홍길동, 010-1234-5678, ABC기업, 대표이사, hong@abc.com
김영희, 010-9876-5432, XYZ회사, 부장, kim@xyz.com"></textarea>
            </div>
            
            <button class="btn-primary" onclick="importFromText()">✅ 추가하기</button>
        </div>
    </div>
    
    <!-- 직접 추가 모달 -->
    <div id="manualModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ 고객 직접 추가</h2>
                <button class="modal-close" onclick="closeModal('manualModal')">×</button>
            </div>
            
            <div class="form-group">
                <label>이름 *</label>
                <input type="text" id="manualName" placeholder="홍길동" required>
            </div>
            
            <div class="form-group">
                <label>전화번호 *</label>
                <input type="text" id="manualPhone" placeholder="010-1234-5678" required>
            </div>
            
            <div class="form-group">
                <label>회사</label>
                <input type="text" id="manualCompany" placeholder="ABC기업">
            </div>
            
            <div class="form-group">
                <label>직함</label>
                <input type="text" id="manualPosition" placeholder="대표이사">
            </div>
            
            <div class="form-group">
                <label>이메일</label>
                <input type="email" id="manualEmail" placeholder="hong@abc.com">
            </div>
            
            <button class="btn-primary" onclick="addManualCustomer()">✅ 추가하기</button>
        </div>
    </div>
    
</body>
</html>