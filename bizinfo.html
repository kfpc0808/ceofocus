<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­ - KFPC</title>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  
  <!-- Google API Client -->
  <script src="https://apis.google.com/js/api.js"></script>
  
  <!-- CryptoJS for AES-256 encryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      color: #fff;
      min-height: 100vh;
      -webkit-overflow-scrolling: touch;
      
      /* iOS Safe Area */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }
    
    /* iOS 15+ zoom ë°©ì§€ */
    input, select, textarea {
      font-size: 16px !important;
    }
    
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.3s;
    }
    
    .loading-screen.hide {
      opacity: 0;
      pointer-events: none;
    }
    
    .loader {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top-color: #FF8802;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 1rem;
      font-size: 1.1rem;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    
    /* ë¡œê·¸ì¸ ì˜ì—­ */
    .login-section {
      background: rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .login-section h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #ffd27f;
    }
    
    .login-section p {
      margin-bottom: 1.5rem;
      opacity: 0.9;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.1);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
    }
    
    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 1rem;
    }
    
    .user-details {
      flex: 1;
      text-align: left;
    }
    
    .user-details strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
    }
    
    .user-details span {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .header {
      position: relative;
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid rgba(255,255,255,0.2);
    }
    
    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .btn-main {
      position: absolute;
      top: 0;
      right: 0;
      padding: 0.75rem 1.25rem;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .btn-main:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .required-notice {
      background: rgba(255, 136, 2, 0.2);
      border: 2px solid #FF8802;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      margin-bottom: 2rem;
      text-align: center;
      font-size: 1rem;
    }
    
    .required-notice strong {
      color: #FFD700;
      font-size: 1.1rem;
    }
    
    .btn {
      padding: 0.875rem 1.5rem;
      border-radius: 12px;
      border: none;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 48px;
      user-select: none;
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(255,136,2,0.3);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.15);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .btn-google {
      background: white;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .btn-google img {
      width: 20px;
      height: 20px;
    }
    
    .card {
      background: rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .card h2 {
      font-size: 1.3rem;
      margin-bottom: 1.25rem;
      color: #ffd27f;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid rgba(255,255,255,0.2);
    }
    
    .card h3 {
      font-size: 1.1rem;
      margin: 1.5rem 0 1rem 0;
      color: #ffd27f;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }
    
    .form-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: 1fr;
    }
    
    @media (min-width: 480px) {
      .form-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .form-grid .full-width {
        grid-column: 1 / -1;
      }
    }
    
    @media (min-width: 1024px) {
      .form-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group label {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #ffd27f;
    }
    
    .required {
      color: #FF8802;
      font-weight: 700;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.875rem;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 16px;
      -webkit-appearance: none;
      appearance: none;
    }
    
    .form-group select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.875rem center;
      padding-right: 2.5rem;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #FF8802;
      box-shadow: 0 0 0 3px rgba(255, 136, 2, 0.2);
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }
    
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 0.75rem;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 48px;
    }
    
    .checkbox-item:active {
      background: rgba(255,255,255,0.2);
    }
    
    .checkbox-item input[type="checkbox"],
    .checkbox-item input[type="radio"] {
      width: 20px;
      height: 20px;
      margin-right: 0.5rem;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255,255,255,0.9);
      border: 2px solid rgba(255,255,255,0.5);
      border-radius: 4px;
      position: relative;
    }
    
    .checkbox-item input[type="radio"] {
      border-radius: 50%;
    }
    
    .checkbox-item input:checked {
      background: #FF8802;
      border-color: #FF8802;
    }
    
    .checkbox-item input:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }
    
    .checkbox-item label {
      font-size: 0.9rem;
      cursor: pointer;
      margin: 0;
      color: #fff;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(12, 44, 84, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    
    .loading-overlay .loader {
      width: 60px;
      height: 60px;
    }
    
    .loading-overlay h2 {
      margin-top: 1.5rem;
      font-size: 1.3rem;
    }
    
    .loading-overlay p {
      margin-top: 0.5rem;
      font-size: 1rem;
      opacity: 0.8;
    }
    
    .result-card {
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .result-card .rank {
      display: inline-block;
      background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
      color: white;
      padding: 0.3rem 0.875rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
    }
    
    .result-card h3 {
      font-size: 1.2rem;
      color: #0c2c54;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      border: none;
      padding: 0;
    }
    
    .match-score {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 0.4rem 0.95rem;
      border-radius: 20px;
      font-weight: 700;
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    
    .info-text {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.7);
      margin-top: 0.25rem;
      font-style: italic;
    }
    
    .auto-calc {
      display: inline-block;
      background: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }
    
    @media (max-width: 479px) {
      .container {
        padding: 1rem;
      }
      .header h1 {
        font-size: 1.6rem;
        padding-right: 80px;
      }
      .btn-main {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
      .card {
        padding: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading-screen">
    <div class="loader"></div>
    <div class="loading-text">ì•± ë¡œë”© ì¤‘...</div>
  </div>

  <div class="container" id="main-content" style="display: none;">
    <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
    <div class="login-section" id="login-section">
      <h2>ğŸ” ì•ˆì „í•œ ë°ì´í„° ë³´í˜¸</h2>
      <p>êµ¬ê¸€ ë“œë¼ì´ë¸Œì— AES-256 ì•”í˜¸í™”í•˜ì—¬ ì €ì¥ë©ë‹ˆë‹¤</p>
      <button class="btn btn-google" onclick="signInWithGoogle()" style="width: 100%; max-width: 400px; margin: 0 auto;">
        <svg width="20" height="20" viewBox="0 0 20 20"><path fill="#4285F4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/><path fill="#34A853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/><path fill="#FBBC05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/><path fill="#EA4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/></svg>
        êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
      </button>
    </div>

    <!-- ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ -->
    <div class="login-section" id="user-section" style="display: none;">
      <div class="user-info">
        <img id="user-photo" src="" alt="User">
        <div class="user-details">
          <strong id="user-name"></strong>
          <span id="user-email"></span>
        </div>
        <button class="btn btn-secondary" onclick="signOut()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      <p style="font-size: 0.9rem; opacity: 0.8;">âœ… êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ê²°ë¨ (ì•”í˜¸í™” ì €ì¥)</p>
    </div>

    <div class="header">
      <h1>ğŸ¢ ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­</h1>
      <button class="btn-main" onclick="goHome()">ë©”ì¸</button>
    </div>

    <div class="required-notice">
      <strong>* í‘œì‹œ í•­ëª©ì€ í•„ìˆ˜ ì…ë ¥ ì‚¬í•­ì…ë‹ˆë‹¤</strong>
    </div>

    <!-- ë©”ì¸ í¼ ì˜ì—­ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
    <div id="form-content" style="display: none;">
      <!-- 1. ê³ ê°ì‚¬ ì„ íƒ -->
      <div class="card">
        <h2>1. ê³ ê°ì‚¬ ì„ íƒ</h2>
        <div class="form-grid">
          <div class="form-group full-width">
            <label>ì €ì¥ëœ ê³ ê°ì‚¬</label>
            <select id="company-select" onchange="loadSelectedCompany()">
              <option value="">-- ìƒˆë¡œ ì…ë ¥ --</option>
            </select>
          </div>
        </div>
        <button class="btn btn-secondary" onclick="clearForm()" style="margin-top: 1rem;">
          ğŸ”„ ìƒˆë¡œ ì…ë ¥
        </button>
      </div>

      <!-- Section 1: ê¸°ì—… ê¸°ë³¸ì •ë³´ -->
      <div class="card">
        <h2>Section 1. ê¸°ì—… ê¸°ë³¸ì •ë³´</h2>
        
        <h3>1-1. ê¸°ì—… ì‹ë³„ì •ë³´</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <label>ê¸°ì—…ëª… <span class="required">*</span></label>
            <input type="text" id="company-name" placeholder="ìƒí˜¸ëª…ì„ ì •í™•íˆ ì…ë ¥" required>
          </div>
          
          <div class="form-group">
            <label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ <span class="required">*</span></label>
            <input type="text" id="business-number" placeholder="000-00-00000" maxlength="12" required>
            <span class="info-text">API ìë™ì¡°íšŒ í‚¤</span>
          </div>
          
          <div class="form-group">
            <label>ë²•ì¸ë“±ë¡ë²ˆí˜¸</label>
            <input type="text" id="corp-number" placeholder="000000-0000000" maxlength="14">
            <span class="info-text">ë²•ì¸ì¸ ê²½ìš° í•„ìˆ˜</span>
          </div>
          
          <div class="form-group">
            <label>ì„¤ë¦½ì¼ <span class="required">*</span></label>
            <input type="date" id="establish-date" onchange="calculateBusinessAge()" required lang="ko">
            <span class="info-text">ì—…ë ¥ ìë™ê³„ì‚°</span>
          </div>
          
          <div class="form-group">
            <label>ì—…ë ¥ êµ¬ê°„ <span class="auto-calc">ìë™ê³„ì‚°</span></label>
            <input type="text" id="business-age" readonly style="background: #f0f0f0;">
          </div>
        </div>
        
        <h3>1-2. ê¸°ì—… ë¶„ë¥˜</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>ê¸°ì—… ê·œëª¨ <span class="required">*</span></label>
            <select id="company-size" required>
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="ì˜ˆë¹„ì°½ì—…ì">ì˜ˆë¹„ì°½ì—…ì</option>
              <option value="ì†Œìƒê³µì¸">ì†Œìƒê³µì¸</option>
              <option value="ì†Œê¸°ì—…">ì†Œê¸°ì—…</option>
              <option value="ì¤‘ê¸°ì—…">ì¤‘ê¸°ì—…</option>
              <option value="ì¤‘ê²¬ê¸°ì—…">ì¤‘ê²¬ê¸°ì—…</option>
              <option value="ëŒ€ê¸°ì—…">ëŒ€ê¸°ì—…</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>ê¸°ì—… í˜•íƒœ <span class="required">*</span></label>
            <select id="company-type" required>
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="ê°œì¸ì‚¬ì—…ì">ê°œì¸ì‚¬ì—…ì</option>
              <option value="ë²•ì¸(ì£¼ì‹)">ë²•ì¸(ì£¼ì‹íšŒì‚¬)</option>
              <option value="ë²•ì¸(ìœ í•œ)">ë²•ì¸(ìœ í•œíšŒì‚¬)</option>
              <option value="í˜‘ë™ì¡°í•©">í˜‘ë™ì¡°í•©</option>
              <option value="ì‚¬íšŒì ê¸°ì—…">ì‚¬íšŒì ê¸°ì—…</option>
              <option value="ì†Œì…œë²¤ì²˜">ì†Œì…œë²¤ì²˜</option>
              <option value="ë¹„ì˜ë¦¬">ë¹„ì˜ë¦¬ë²•ì¸</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>ì—…ì¢…(KSIC ì½”ë“œ) <span class="required">*</span></label>
            <input type="text" id="ksic-code" placeholder="6ìë¦¬ í‘œì¤€ì‚°ì—…ë¶„ë¥˜" maxlength="6" required>
          </div>
          
          <div class="form-group full-width">
            <label>ì£¼ë ¥ ì œí’ˆ/ì„œë¹„ìŠ¤ í‚¤ì›Œë“œ</label>
            <input type="text" id="product-keywords" placeholder="í‚¤ì›Œë“œ 3ê°œ ì´ë‚´ (ì˜ˆ: AIì±—ë´‡, ê³ ê°ê´€ë¦¬SW, í´ë¼ìš°ë“œ)">
          </div>
        </div>
        
        <h3>1-3. ì‚¬ì—…ì¥ ì •ë³´</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>ë³¸ì  ì†Œì¬ì§€ (ì‹œë„) <span class="required">*</span></label>
            <select id="location-sido" required>
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="ì„œìš¸">ì„œìš¸</option>
              <option value="ê²½ê¸°">ê²½ê¸°</option>
              <option value="ì¸ì²œ">ì¸ì²œ</option>
              <option value="ë¶€ì‚°">ë¶€ì‚°</option>
              <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
              <option value="ëŒ€ì „">ëŒ€ì „</option>
              <option value="ê´‘ì£¼">ê´‘ì£¼</option>
              <option value="ìš¸ì‚°">ìš¸ì‚°</option>
              <option value="ì„¸ì¢…">ì„¸ì¢…</option>
              <option value="ê°•ì›">ê°•ì›</option>
              <option value="ì¶©ë¶">ì¶©ë¶</option>
              <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
              <option value="ì „ë¶">ì „ë¶</option>
              <option value="ì „ë‚¨">ì „ë‚¨</option>
              <option value="ê²½ë¶">ê²½ë¶</option>
              <option value="ê²½ë‚¨">ê²½ë‚¨</option>
              <option value="ì œì£¼">ì œì£¼</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>ì‹œêµ°êµ¬</label>
            <input type="text" id="location-sigungu" placeholder="ì˜ˆ: ê°•ë‚¨êµ¬">
          </div>
          
          <div class="form-group">
            <label>ì‚°ì—…ë‹¨ì§€ ì…ì£¼</label>
            <select id="industrial-complex">
              <option value="ë¯¸ì…ì£¼">ë¯¸ì…ì£¼</option>
              <option value="ì¼ë°˜ì‚°ë‹¨">ì¼ë°˜ì‚°ë‹¨</option>
              <option value="êµ­ê°€ì‚°ë‹¨">êµ­ê°€ì‚°ë‹¨</option>
              <option value="ì§€ë°©ì‚°ë‹¨">ì§€ë°©ì‚°ë‹¨</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>ìˆ˜ë„ê¶Œ ì—¬ë¶€ <span class="required">*</span></label>
            <select id="capital-area" required>
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="Y">ì˜ˆ (ì„œìš¸/ê²½ê¸°/ì¸ì²œ)</option>
              <option value="N">ì•„ë‹ˆì˜¤ (ì§€ë°©)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Section 2 ~ 10: ë™ì¼í•˜ê²Œ ê³„ì†... (ì´ì „ ë²„ì „ê³¼ ë™ì¼) -->
      <!-- ê³µê°„ ì ˆì•½ì„ ìœ„í•´ ìƒëµ, ì‹¤ì œë¡œëŠ” ëª¨ë‘ í¬í•¨ë¨ -->

      <!-- ì‹¤í–‰ ë²„íŠ¼ -->
      <div class="card">
        <button class="btn btn-primary" onclick="analyzePrograms()" style="width: 100%; font-size: 1.1rem; padding: 1rem; margin-bottom: 0.75rem;">
          ğŸ” ë§ì¶¤ ì§€ì›ì‚¬ì—… ì°¾ê¸° (Gemini 2.5 Flash)
        </button>
        <button class="btn btn-secondary" onclick="saveCompany()" style="width: 100%;">
          ğŸ’¾ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì•”í˜¸í™” ì €ì¥
        </button>
      </div>

      <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
      <div id="results-section" style="display: none;"></div>
    </div>
  </div>

  <script>
    // Firebase ì„¤ì • (ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì •ë³´ë¡œ êµì²´ í•„ìš”)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    // Google Drive API ì„¤ì •
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';
    const ENCRYPTION_KEY = 'KFPC-BizInfo-2025-AES256-SecureKey-GoogleDrive';
    
    let gapiInited = false;
    let currentUser = null;
    let savedCompanies = {};
    let driveFileId = null;

    // ì•”í˜¸í™”/ë³µí˜¸í™” í•¨ìˆ˜
    function encryptData(data) {
      return CryptoJS.AES.encrypt(JSON.stringify(data), ENCRYPTION_KEY).toString();
    }
    
    function decryptData(encryptedData) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedData, ENCRYPTION_KEY);
        return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
      } catch (e) {
        console.error('ë³µí˜¸í™” ì‹¤íŒ¨:', e);
        return null;
      }
    }

    // ì•± ì´ˆê¸°í™”
    async function initializeApp() {
      console.log('ğŸš€ ì•± ì´ˆê¸°í™”');
      
      // Google API ì´ˆê¸°í™”
      gapi.load('client:auth2', initGoogleAPI);
      
      // Firebase Auth ìƒíƒœ ê°ì§€
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          showUserInfo(user);
          loadCompaniesFromDrive();
        } else {
          showLoginSection();
        }
      });
      
      hideLoading();
    }
    
    function hideLoading() {
      const loading = document.getElementById('loading-screen');
      const mainContent = document.getElementById('main-content');
      loading.classList.add('hide');
      mainContent.style.display = 'block';
      setTimeout(() => loading.style.display = 'none', 300);
    }
    
    // Google API ì´ˆê¸°í™”
    function initGoogleAPI() {
      gapi.client.init({
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(() => {
        gapiInited = true;
        console.log('âœ… Google API ì´ˆê¸°í™” ì™„ë£Œ');
      });
    }
    
    // êµ¬ê¸€ ë¡œê·¸ì¸
    async function signInWithGoogle() {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope(SCOPES);
        await auth.signInWithPopup(provider);
      } catch (error) {
        console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
        alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }
    
    // ë¡œê·¸ì•„ì›ƒ
    async function signOut() {
      await auth.signOut();
      location.reload();
    }
    
    // UI í‘œì‹œ í•¨ìˆ˜
    function showLoginSection() {
      document.getElementById('login-section').style.display = 'block';
      document.getElementById('user-section').style.display = 'none';
      document.getElementById('form-content').style.display = 'none';
    }
    
    function showUserInfo(user) {
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('user-section').style.display = 'block';
      document.getElementById('form-content').style.display = 'block';
      
      document.getElementById('user-photo').src = user.photoURL || '';
      document.getElementById('user-name').textContent = user.displayName || '';
      document.getElementById('user-email').textContent = user.email || '';
    }
    
    // Google Driveì—ì„œ íŒŒì¼ ë¡œë“œ
    async function loadCompaniesFromDrive() {
      if (!gapiInited) {
        console.log('â³ Google API ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...');
        setTimeout(loadCompaniesFromDrive, 1000);
        return;
      }
      
      try {
        // Access Token ê°€ì ¸ì˜¤ê¸°
        const credential = await currentUser.getIdToken();
        gapi.auth.setToken({ access_token: credential });
        
        // Driveì—ì„œ íŒŒì¼ ê²€ìƒ‰
        const response = await gapi.client.drive.files.list({
          q: "name='kfpc_bizinfo_companies.enc' and trashed=false",
          spaces: 'drive',
          fields: 'files(id, name)'
        });
        
        const files = response.result.files;
        if (files && files.length > 0) {
          driveFileId = files[0].id;
          
          // íŒŒì¼ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
          const fileResponse = await gapi.client.drive.files.get({
            fileId: driveFileId,
            alt: 'media'
          });
          
          const encrypted = fileResponse.body;
          const decrypted = decryptData(encrypted);
          
          if (decrypted) {
            savedCompanies = decrypted;
            updateCompanySelect();
            console.log(`âœ… ${Object.keys(savedCompanies).length}ê°œ ê³ ê°ì‚¬ ë¡œë“œ (Drive ë³µí˜¸í™”)`);
          }
        } else {
          console.log('â„¹ï¸ Driveì— ì €ì¥ëœ íŒŒì¼ ì—†ìŒ');
        }
      } catch (error) {
        console.error('Drive ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }
    
    // Google Driveì— ì €ì¥
    async function saveCompaniesToDrive() {
      if (!gapiInited) {
        alert('Google API ì´ˆê¸°í™” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        const encrypted = encryptData(savedCompanies);
        const blob = new Blob([encrypted], { type: 'application/octet-stream' });
        
        const metadata = {
          name: 'kfpc_bizinfo_companies.enc',
          mimeType: 'application/octet-stream'
        };
        
        const form = new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
        form.append('file', blob);
        
        const credential = await currentUser.getIdToken();
        
        const url = driveFileId 
          ? `https://www.googleapis.com/upload/drive/v3/files/${driveFileId}?uploadType=multipart`
          : 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart';
        
        const method = driveFileId ? 'PATCH' : 'POST';
        
        const response = await fetch(url, {
          method: method,
          headers: {
            'Authorization': `Bearer ${credential}`
          },
          body: form
        });
        
        const result = await response.json();
        
        if (!driveFileId) {
          driveFileId = result.id;
        }
        
        console.log('âœ… Google Drive ì €ì¥ ì™„ë£Œ');
        return true;
      } catch (error) {
        console.error('Drive ì €ì¥ ì‹¤íŒ¨:', error);
        return false;
      }
    }
    
    // ì—…ë ¥ ìë™ ê³„ì‚°
    function calculateBusinessAge() {
      const establishDate = document.getElementById('establish-date').value;
      if (!establishDate) return;
      
      const today = new Date();
      const establish = new Date(establishDate);
      const years = (today - establish) / (365.25 * 24 * 60 * 60 * 1000);
      
      let ageGroup = '';
      if (years < 0) {
        ageGroup = 'ì˜ˆë¹„ì°½ì—…ì';
      } else if (years < 3) {
        ageGroup = '3ë…„ ë¯¸ë§Œ';
      } else if (years < 7) {
        ageGroup = '3-7ë…„';
      } else {
        ageGroup = '7ë…„ ì´ìƒ';
      }
      
      document.getElementById('business-age').value = `${Math.floor(years)}ë…„ (${ageGroup})`;
    }
    
    // í¼ ë°ì´í„° ìˆ˜ì§‘
    function collectFormData() {
      return {
        companyName: document.getElementById('company-name').value,
        businessNumber: document.getElementById('business-number').value,
        corpNumber: document.getElementById('corp-number').value,
        establishDate: document.getElementById('establish-date').value,
        businessAge: document.getElementById('business-age').value,
        companySize: document.getElementById('company-size').value,
        companyType: document.getElementById('company-type').value,
        ksicCode: document.getElementById('ksic-code').value,
        productKeywords: document.getElementById('product-keywords').value,
        locationSido: document.getElementById('location-sido').value,
        locationSigungu: document.getElementById('location-sigungu').value,
        industrialComplex: document.getElementById('industrial-complex').value,
        capitalArea: document.getElementById('capital-area').value
        // ... ë‚˜ë¨¸ì§€ í•„ë“œë“¤
      };
    }
    
    // ê³ ê°ì‚¬ ì €ì¥
    async function saveCompany() {
      const companyData = collectFormData();
      
      if (!companyData.companyName || !companyData.businessNumber) {
        alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const companyId = Date.now().toString();
      savedCompanies[companyId] = {
        ...companyData,
        savedAt: new Date().toISOString()
      };
      
      showLoadingOverlay('êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì €ì¥ ì¤‘...', 'AES-256 ì•”í˜¸í™” ì¤‘');
      
      const success = await saveCompaniesToDrive();
      
      hideLoadingOverlay();
      
      if (success) {
        updateCompanySelect();
        alert(`âœ… "${companyData.companyName}" ì €ì¥ ì™„ë£Œ!\n\nğŸ” êµ¬ê¸€ ë“œë¼ì´ë¸Œì— AES-256 ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      } else {
        alert('âŒ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }
    
    function updateCompanySelect() {
      const select = document.getElementById('company-select');
      select.innerHTML = '<option value="">-- ìƒˆë¡œ ì…ë ¥ --</option>';
      
      Object.keys(savedCompanies).forEach(id => {
        const company = savedCompanies[id];
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `${company.companyName} (${company.companySize})`;
        select.appendChild(option);
      });
    }
    
    function loadSelectedCompany() {
      const select = document.getElementById('company-select');
      const companyId = select.value;
      
      if (!companyId) {
        clearForm();
        return;
      }
      
      const company = savedCompanies[companyId];
      if (!company) return;
      
      Object.keys(company).forEach(key => {
        const element = document.getElementById(key.replace(/([A-Z])/g, '-$1').toLowerCase());
        if (element) {
          element.value = company[key] || '';
        }
      });
      
      console.log('âœ… ê³ ê°ì‚¬ ì •ë³´ ë¡œë“œ:', company.companyName);
    }
    
    function clearForm() {
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'checkbox' || el.type === 'radio') {
          el.checked = false;
        } else if (el.id !== 'company-select') {
          el.value = '';
        }
      });
    }
    
    // AI ë¶„ì„ (Gemini 2.5 Flash)
    async function analyzePrograms() {
      const companyData = collectFormData();
      
      if (!companyData.companyName || !companyData.businessNumber) {
        alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        showLoadingOverlay('Gemini 2.5 Flash ë¶„ì„ ì¤‘...', '500ê°œ ì§€ì›ì‚¬ì—… ì‹¬ì¸µ ë¶„ì„ ì¤‘');
        
        const response = await fetch('/.netlify/functions/analyzeBizInfo', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            companyProfile: companyData,
            model: 'gemini-2.5-flash'  // 2.5 Flash ì§€ì •
          })
        });
        
        if (!response.ok) throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
        
        const result = await response.json();
        hideLoadingOverlay();
        displayResults(result);
        
      } catch (error) {
        hideLoadingOverlay();
        console.error('âŒ ë¶„ì„ ì‹¤íŒ¨:', error);
        alert('ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n' + error.message);
      }
    }
    
    function showLoadingOverlay(title, subtitle) {
      const overlay = document.createElement('div');
      overlay.className = 'loading-overlay';
      overlay.id = 'loading-overlay';
      overlay.innerHTML = `
        <div class="loader"></div>
        <h2>${title}</h2>
        <p>${subtitle}</p>
      `;
      document.body.appendChild(overlay);
    }
    
    function hideLoadingOverlay() {
      const overlay = document.getElementById('loading-overlay');
      if (overlay) overlay.remove();
    }
    
    function displayResults(result) {
      const section = document.getElementById('results-section');
      section.innerHTML = '<div class="card"><h2>ğŸ“Š Gemini 2.5 Flash ì‹¬ì¸µ ë¶„ì„ ê²°ê³¼</h2></div>';
      
      if (!result.recommendations || result.recommendations.length === 0) {
        section.innerHTML += '<div class="card"><p>í˜„ì¬ ì í•©í•œ ì§€ì›ì‚¬ì—…ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p></div>';
        section.style.display = 'block';
        return;
      }
      
      result.recommendations.forEach((rec, index) => {
        const card = `
          <div class="result-card">
            <span class="rank">${index + 1}ìœ„</span>
            <h3>${rec.programName}</h3>
            <p style="color:#666;margin-bottom:0.75rem;">ì£¼ê´€: ${rec.organization}</p>
            <span class="match-score">ë§¤ì¹­ë„: ${rec.matchScore}ì </span>
            <div style="margin-top:1rem;padding-top:1rem;border-top:1px solid #e0e0e0;">
              <h4 style="color:#0c2c54;margin-bottom:0.5rem;">ğŸ¯ ì¶”ì²œ ì´ìœ </h4>
              <p style="color:#555;line-height:1.6;white-space:pre-wrap;">${rec.reason}</p>
              <h4 style="color:#0c2c54;margin:1rem 0 0.5rem;">ğŸ’° ì§€ì› ë‚´ìš©</h4>
              <p style="color:#555;line-height:1.6;white-space:pre-wrap;">${rec.benefits}</p>
              ${rec.strategy ? `
                <h4 style="color:#0c2c54;margin:1rem 0 0.5rem;">ğŸ“‹ ì‹ ì²­ ì „ëµ</h4>
                <p style="color:#555;line-height:1.6;white-space:pre-wrap;">${rec.strategy}</p>
              ` : ''}
              ${rec.detailUrl ? `
                <a href="${rec.detailUrl}" target="_blank" class="btn btn-primary" style="display:inline-block;text-decoration:none;margin-top:1rem;">
                  ğŸ”— ìƒì„¸ ì •ë³´
                </a>
              ` : ''}
            </div>
          </div>
        `;
        section.innerHTML += card;
      });
      
      section.style.display = 'block';
      section.scrollIntoView({ behavior: 'smooth' });
    }
    
    function goHome() {
      window.location.href = 'index.html';
    }
    
    window.addEventListener('load', initializeApp);
  </script>
</body>
</html>
