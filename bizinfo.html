<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­ - KFPC</title>
  
  <!-- CryptoJS for AES-256 encryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  
  <!-- Google API for Drive -->
  <script src="https://apis.google.com/js/api.js"></script>
  
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client"></script>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      color: #fff;
      min-height: 100vh;
      -webkit-overflow-scrolling: touch;
      font-size: 14px;
    }
    
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.3s;
    }
    
    .loading-screen.hide {
      opacity: 0;
      pointer-events: none;
    }
    
    .loader {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: #FF8802;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 0.75rem;
      font-size: 0.95rem;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0.75rem;
    }
    
    .btn-main {
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .btn-main.btn-small {
      padding: 0.35rem 0.5rem;
      font-size: 0.6rem;
    }
    
    .btn-main:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .header-left {
      position: absolute;
      left: 0;
      top: 0;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .header {
      position: relative;
      text-align: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding-top: 0.3rem;
    }
    
    .header h1 {
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
      padding: 0 60px;
    }
    
    .header .btn-main {
      position: absolute;
      right: 0;
      top: 0;
    }
    
    /* ì£¼ë ¥ì œí’ˆ ê·¸ë¦¬ë“œ */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.3rem;
    }
    
    .product-grid input {
      padding: 0.4rem 0.5rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 12px;
    }
    
    @media (min-width: 600px) {
      .product-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    /* ë¯¸ë‹ˆ ë²„íŠ¼ */
    .btn-mini {
      padding: 0.4rem 0.5rem;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.15);
      color: white;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .btn-mini:hover {
      background: rgba(255,255,255,0.25);
    }
    
    /* ì†ì‹¤ ì²´í¬ë°•ìŠ¤ */
    .loss-checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.2rem;
      cursor: pointer;
      user-select: none;
    }
    
    .loss-checkbox-label input {
      display: none;
    }
    
    .loss-checkbox-box {
      width: 20px;
      height: 20px;
      border: 2px solid #ff6b6b;
      border-radius: 4px;
      background: rgba(255,255,255,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: transparent;
      transition: all 0.2s;
    }
    
    .loss-checkbox-label input:checked + .loss-checkbox-box {
      background: #ff6b6b;
      color: white;
    }
    
    .loss-checkbox-text {
      font-size: 0.7rem;
      color: #ff6b6b;
      font-weight: 600;
    }
    
    .required-notice {
      background: rgba(255, 136, 2, 0.2);
      border: 1px solid #FF8802;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.75rem;
      text-align: center;
      font-size: 0.8rem;
    }
    
    .required-notice strong {
      color: #FFD700;
      font-size: 0.85rem;
    }
    
    .btn {
      padding: 0.6rem 1rem;
      border-radius: 8px;
      border: none;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 40px;
      user-select: none;
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(255,136,2,0.3);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.15);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    /* ì»´íŒ©íŠ¸ ì¹´ë“œ */
    .card {
      background: rgba(255,255,255,0.12);
      border-radius: 10px;
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .card h2 {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
      color: #ffd27f;
      padding-bottom: 0.4rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .section-info-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: rgba(255, 210, 127, 0.2);
      border: 1px solid #ffd27f;
      border-radius: 50%;
      font-size: 0.7rem;
      font-weight: 700;
      color: #ffd27f;
      cursor: help;
      flex-shrink: 0;
    }
    
    .section-info-tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      left: 25px;
      top: -8px;
      background: rgba(20, 40, 70, 0.98);
      color: #fff;
      padding: 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 400;
      line-height: 1.4;
      white-space: nowrap;
      z-index: 1000;
      border: 1px solid rgba(255, 210, 127, 0.3);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      pointer-events: none;
    }
    
    .section-info-tooltip::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 50%;
      transform: translateY(-50%);
      border-width: 5px;
      border-style: solid;
      border-color: transparent rgba(20, 40, 70, 0.98) transparent transparent;
    }
    
    .section-info-icon:hover .section-info-tooltip {
      visibility: visible;
      opacity: 1;
    }
    
    .card h3 {
      font-size: 0.85rem;
      margin: 0.6rem 0 0.4rem 0;
      color: #ffd27f;
      padding-bottom: 0.25rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    /* ì»´íŒ©íŠ¸ í¼ ê·¸ë¦¬ë“œ - ëª¨ë°”ì¼ì—ì„œë„ 2ì—´ */
    .form-grid {
      display: grid;
      gap: 0.4rem;
      grid-template-columns: repeat(2, 1fr);
    }
    
    .form-grid .full-width {
      grid-column: 1 / -1;
    }
    
    @media (min-width: 600px) {
      .form-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 900px) {
      .form-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (min-width: 1200px) {
      .form-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    
    /* ì»´íŒ©íŠ¸ í¼ ê·¸ë£¹ */
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group label {
      font-size: 0.72rem;
      font-weight: 600;
      margin-bottom: 0.15rem;
      color: #ffd27f;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .required {
      color: #FF8802;
      font-weight: 700;
    }
    
    /* ì»´íŒ©íŠ¸ ì¸í’‹ */
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.45rem 0.5rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 13px;
      -webkit-appearance: none;
      appearance: none;
      min-height: 32px;
    }
    
    .form-group select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      padding-right: 1.8rem;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #FF8802;
      box-shadow: 0 0 0 2px rgba(255, 136, 2, 0.2);
    }
    
    .form-group textarea {
      min-height: 50px;
      resize: vertical;
      font-family: inherit;
    }
    
    /* ì»´íŒ©íŠ¸ ì²´í¬ë°•ìŠ¤ ê·¸ë¦¬ë“œ */
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.3rem;
    }
    
    @media (min-width: 480px) {
      .checkbox-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 768px) {
      .checkbox-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 0.35rem 0.5rem;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 32px;
    }
    
    .checkbox-item:active {
      background: rgba(255,255,255,0.2);
    }
    
    .checkbox-item input[type="checkbox"],
    .checkbox-item input[type="radio"] {
      width: 16px;
      height: 16px;
      margin-right: 0.35rem;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255,255,255,0.9);
      border: 1.5px solid rgba(255,255,255,0.5);
      border-radius: 3px;
      position: relative;
      flex-shrink: 0;
    }
    
    .checkbox-item input[type="radio"] {
      border-radius: 50%;
    }
    
    .checkbox-item input:checked {
      background: #FF8802;
      border-color: #FF8802;
    }
    
    .checkbox-item input:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 11px;
      font-weight: bold;
    }
    
    .checkbox-item label {
      font-size: 0.72rem;
      cursor: pointer;
      margin: 0;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(12, 44, 84, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    
    .loading-overlay .loader {
      width: 50px;
      height: 50px;
    }
    
    .loading-overlay h2 {
      margin-top: 1rem;
      font-size: 1.1rem;
    }
    
    .loading-overlay p {
      margin-top: 0.3rem;
      font-size: 0.85rem;
      opacity: 0.8;
    }
    
    .result-card {
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 10px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .result-card .rank {
      display: inline-block;
      background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
    }
    
    .result-card h3 {
      font-size: 1rem;
      color: #0c2c54;
      margin-bottom: 0.3rem;
      line-height: 1.3;
      border: none;
      padding: 0;
    }
    
    .match-score {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-weight: 700;
      margin-bottom: 0.5rem;
      font-size: 0.8rem;
    }
    
    /* ì»´íŒ©íŠ¸ info-text */
    .info-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.1rem;
      font-style: italic;
      line-height: 1.2;
    }
    
    /* ëª¨ë°”ì¼ ì¶”ê°€ ìµœì í™” */
    @media (max-width: 479px) {
      .container {
        padding: 0.5rem;
      }
      .header h1 {
        font-size: 1.1rem;
        padding-right: 70px;
      }
      .card {
        padding: 0.5rem;
        border-radius: 8px;
      }
      .card h2 {
        font-size: 0.9rem;
      }
    }
    
    /* PC ìµœì í™” */
    @media (min-width: 1024px) {
      .container {
        padding: 1rem;
      }
      .card {
        padding: 0.85rem;
      }
      .form-grid {
        gap: 0.5rem;
      }
      .form-group label {
        font-size: 0.78rem;
      }
      .form-group input,
      .form-group select {
        padding: 0.5rem 0.6rem;
        font-size: 14px;
        min-height: 36px;
      }
      .checkbox-item {
        padding: 0.45rem 0.6rem;
        min-height: 36px;
      }
      .checkbox-item label {
        font-size: 0.78rem;
      }
    }
    
    /* ë²„íŠ¼ 1í–‰ ê³ ì • */
    button, .btn-primary, .btn-secondary {
      white-space: nowrap !important;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* ê³ ê°ì‚¬ ëª©ë¡ ìŠ¤íƒ€ì¼ */
    .company-list-controls {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .search-box input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 13px;
    }
    
    .sort-buttons {
      display: flex;
      gap: 0.3rem;
    }
    
    .sort-btn {
      flex: 1;
      padding: 0.4rem 0.5rem;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
      color: #fff;
      border-radius: 6px;
      font-size: 0.72rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .sort-btn.active {
      background: #FF8802;
      border-color: #FF8802;
    }
    
    .company-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      background: rgba(0,0,0,0.1);
    }
    
    .company-list-empty {
      padding: 1rem;
      text-align: center;
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }
    
    .company-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.6rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .company-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .company-item.selected {
      background: rgba(255,136,2,0.3);
      border-left: 3px solid #FF8802;
    }
    
    .company-item:last-child {
      border-bottom: none;
    }
    
    .company-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .company-item-name {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .company-item-meta {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.1rem;
    }
    
    .company-item-date {
      font-size: 0.6rem;
      color: rgba(255,255,255,0.4);
      white-space: nowrap;
    }
    
    .company-action-buttons {
      display: flex;
      gap: 0.3rem;
    }
    
    .company-action-buttons .btn {
      flex: 1;
      font-size: 0.8rem;
      padding: 0.5rem;
    }
    
    @media (min-width: 480px) {
      .company-list-controls {
        flex-direction: row;
        align-items: center;
      }
      .search-box {
        flex: 1;
      }
      .sort-buttons {
        flex: 0 0 auto;
      }
    }
    
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading-screen">
    <div class="loader"></div>
    <div class="loading-text">ì•± ë¡œë”© ì¤‘...</div>
  </div>

  <!-- Google ë¡œê·¸ì¸ í™”ë©´ -->
  <div id="login-screen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%); z-index: 9999; display: flex; align-items: center; justify-content: center;">
    <div style="background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; max-width: 400px; width: 90%;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ¢</div>
      <h2 style="color: #0c2c54; margin-bottom: 0.5rem; font-size: 1.8rem;">ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­</h2>
      <p style="color: #666; margin-bottom: 2rem; font-size: 0.95rem;">êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤</p>
      
      <button id="google-signin-btn" onclick="signInWithGoogle()" style="
        width: 100%;
        padding: 1rem;
        background: white;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        color: #333;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        transition: all 0.2s;
      " onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.boxShadow='none'">
        <svg width="20" height="20" viewBox="0 0 24 24">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°
      </button>
      
      <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; text-align: left; font-size: 0.85rem; color: #666;">
        <div style="font-weight: 600; margin-bottom: 0.5rem; color: #0c2c54;">ğŸ”’ ì •ë³´ë³´í˜¸</div>
        <div style="line-height: 1.6;">
          â€¢ ë°ì´í„°ëŠ” ì‚¬ìš©ìì˜ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì•”í˜¸í™” ì €ì¥<br>
          â€¢ ì–¸ì œë“  ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="main-content" style="display: none;">
    <div class="header">
      <div class="header-left">
        <button class="btn-main btn-small" onclick="signOut()">ë¡œê·¸ì•„ì›ƒ</button>
        <span id="user-info" style="font-size: 0.7rem; color: #ddd;"></span>
      </div>
      <h1>ğŸ¢ ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­</h1>
      <button class="btn-main btn-small" onclick="goHome()">ë©”ì¸</button>
    </div>

    <div class="required-notice">
      <strong>* í‘œì‹œ í•­ëª©ì€ í•„ìˆ˜ ì…ë ¥ ì‚¬í•­ì…ë‹ˆë‹¤</strong>
    </div>

    <!-- 1. ê³ ê°ì‚¬ ì„ íƒ -->
    <div class="card">
      <h2>1. ê³ ê°ì‚¬ ê´€ë¦¬</h2>
      
      <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
      <div class="company-list-controls">
        <div class="search-box">
          <input type="text" id="company-search" placeholder="ğŸ” ê¸°ì—…ëª… ê²€ìƒ‰..." oninput="filterCompanyList()">
        </div>
        <div class="sort-buttons">
          <button class="sort-btn active" onclick="sortCompanyList('name')" id="sort-name">ê°€ë‚˜ë‹¤ìˆœ</button>
          <button class="sort-btn" onclick="sortCompanyList('date')" id="sort-date">ìµœì‹ ìˆœ</button>
        </div>
      </div>
      
      <!-- ê¸°ì—… ëª©ë¡ -->
      <div class="company-list" id="company-list">
        <div class="company-list-empty">ì €ì¥ëœ ê³ ê°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
      
      <!-- ìˆ¨ê¹€ ë“œë¡­ë‹¤ìš´ (í˜¸í™˜ì„±) -->
      <select id="company-select" style="display:none;" onchange="loadSelectedCompany()">
        <option value="">-- ìƒˆë¡œ ì…ë ¥ --</option>
      </select>
      
      <div class="company-action-buttons">
        <button class="btn btn-secondary" onclick="clearForm()">
          â• ìƒˆë¡œ ì…ë ¥
        </button>
      </div>
    </div>

    <!-- Section 1: ê¸°ì—… ê¸°ë³¸ì •ë³´ -->
    <div class="card">
      <h2>Section 1. ê¸°ì—… ê¸°ë³¸ì •ë³´</h2>
      
      <h3>1-1. ê¸°ì—… ì‹ë³„ì •ë³´</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ê¸°ì—…ëª… <span class="required">*</span></label>
          <input type="text" id="company-name" placeholder="ìƒí˜¸ëª…ì„ ì •í™•íˆ ì…ë ¥" required>
        </div>
        
        <div class="form-group">
          <label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ <span class="required">*</span></label>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="text" id="business-number-1" placeholder="000" maxlength="3" style="width: 80px;" inputmode="numeric" required oninput="allowOnlyNumbers(this); moveFocusOnMaxLength(this, 'business-number-2', 3)">
            <span style="color: #ddd;">-</span>
            <input type="text" id="business-number-2" placeholder="00" maxlength="2" style="width: 60px;" inputmode="numeric" required oninput="allowOnlyNumbers(this); moveFocusOnMaxLength(this, 'business-number-3', 2)">
            <span style="color: #ddd;">-</span>
            <input type="text" id="business-number-3" placeholder="00000" maxlength="5" style="width: 100px;" inputmode="numeric" required oninput="allowOnlyNumbers(this)">
          </div>
        </div>
        
        <div class="form-group">
          <label>ê°œì—…ì—°ì›”ì¼(ì‚¬ì—…ìë“±ë¡ì¦) <span class="required">*</span></label>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="date" id="establish-date" required onchange="calculateBusinessAge()" style="flex: 1;">
            <span id="business-age-display" style="font-size: 0.75rem; color: #ffd27f; white-space: nowrap;"></span>
          </div>
        </div>
      </div>
      
      <h3>1-2. ê¸°ì—… ë¶„ë¥˜</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ê¸°ì—… ê·œëª¨ <span class="required">*</span></label>
          <select id="company-size" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì˜ˆë¹„ì°½ì—…ì">ì˜ˆë¹„ì°½ì—…ì</option>
            <option value="ì†Œìƒê³µì¸">ì†Œìƒê³µì¸</option>
            <option value="ì†Œê¸°ì—…">ì†Œê¸°ì—…</option>
            <option value="ì¤‘ê¸°ì—…">ì¤‘ê¸°ì—…</option>
            <option value="ì¤‘ê²¬ê¸°ì—…">ì¤‘ê²¬ê¸°ì—…</option>
            <option value="ëŒ€ê¸°ì—…">ëŒ€ê¸°ì—…</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ê¸°ì—… í˜•íƒœ <span class="required">*</span></label>
          <select id="company-type" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ê°œì¸ì‚¬ì—…ì">ê°œì¸ì‚¬ì—…ì</option>
            <option value="ë²•ì¸(ì£¼ì‹)">ë²•ì¸(ì£¼ì‹íšŒì‚¬)</option>
            <option value="ë²•ì¸(ìœ í•œ)">ë²•ì¸(ìœ í•œíšŒì‚¬)</option>
            <option value="í˜‘ë™ì¡°í•©">í˜‘ë™ì¡°í•©</option>
            <option value="ì‚¬íšŒì ê¸°ì—…">ì‚¬íšŒì ê¸°ì—…</option>
            <option value="ì†Œì…œë²¤ì²˜">ì†Œì…œë²¤ì²˜</option>
            <option value="ë¹„ì˜ë¦¬">ë¹„ì˜ë¦¬ë²•ì¸</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‚¬ì—… ìƒíƒœ <span class="required">*</span></label>
          <select id="business-status" required>
            <option value="ìš´ì˜ì¤‘">ìš´ì˜ì¤‘</option>
            <option value="íœ´ì—…">íœ´ì—…</option>
            <option value="íì—…">íì—…</option>
          </select>
        </div>
        
        <div class="form-group full-width">
          <label>ì—…ì¢…(KSIC ì½”ë“œ) <span class="required">*</span></label>
          <div style="display: flex; gap: 0.3rem; align-items: flex-start;">
            <select id="ksic-select" onchange="updateKsicCode()" style="flex: 1;">
              <option value="">ëŒ€ë¶„ë¥˜ ì„ íƒ</option>
              <optgroup label="ì œì¡°ì—… (C)">
                <option value="10">10 - ì‹ë£Œí’ˆ</option>
                <option value="11">11 - ìŒë£Œ</option>
                <option value="13">13 - ì„¬ìœ ì œí’ˆ</option>
                <option value="14">14 - ì˜ë³µ/ëª¨í”¼</option>
                <option value="20">20 - í™”í•™ë¬¼ì§ˆ/ì œí’ˆ</option>
                <option value="21">21 - ì˜ì•½í’ˆ</option>
                <option value="22">22 - ê³ ë¬´/í”Œë¼ìŠ¤í‹±</option>
                <option value="25">25 - ê¸ˆì†ê°€ê³µ</option>
                <option value="26">26 - ì „ìë¶€í’ˆ/í†µì‹ ì¥ë¹„</option>
                <option value="27">27 - ì˜ë£Œ/ì •ë°€ê¸°ê¸°</option>
                <option value="28">28 - ì „ê¸°ì¥ë¹„</option>
                <option value="29">29 - ê¸°ê³„/ì¥ë¹„</option>
                <option value="30">30 - ìë™ì°¨</option>
              </optgroup>
              <optgroup label="ì •ë³´í†µì‹ ì—… (J)">
                <option value="58">58 - ì¶œíŒì—…</option>
                <option value="61">61 - í†µì‹ ì—…</option>
                <option value="62">62 - SWê°œë°œ/ê³µê¸‰</option>
                <option value="63">63 - ì •ë³´ì„œë¹„ìŠ¤</option>
              </optgroup>
              <optgroup label="ì „ë¬¸/ê³¼í•™/ê¸°ìˆ  (M)">
                <option value="70">70 - ì—°êµ¬ê°œë°œ</option>
                <option value="71">71 - ì „ë¬¸ì„œë¹„ìŠ¤</option>
                <option value="72">72 - ê±´ì¶•/ì—”ì§€ë‹ˆì–´ë§</option>
              </optgroup>
              <optgroup label="ë„ì†Œë§¤/ì„œë¹„ìŠ¤">
                <option value="46">46 - ë„ë§¤ì—…</option>
                <option value="47">47 - ì†Œë§¤ì—…</option>
                <option value="56">56 - ìŒì‹ì /ì£¼ì </option>
                <option value="85">85 - êµìœ¡ì„œë¹„ìŠ¤</option>
                <option value="86">86 - ë³´ê±´ì—…</option>
              </optgroup>
            </select>
            <input type="text" id="ksic-code" placeholder="5ìë¦¬" maxlength="5" style="width: 70px;" inputmode="numeric" required oninput="allowOnlyNumbers(this)">
            <button type="button" onclick="openKsicSearch()" class="btn-mini">ğŸ”</button>
          </div>
          <span class="info-text">ëŒ€ë¶„ë¥˜ ì„ íƒ í›„ ì„¸ë¶€ì½”ë“œ ì…ë ¥, ë˜ëŠ” ğŸ”ë¡œ ê²€ìƒ‰</span>
        </div>
        
        <div class="form-group full-width">
          <label>ì£¼ë ¥ ì œí’ˆ/ì„œë¹„ìŠ¤ (ìµœëŒ€ 4ê°œ)</label>
          <div class="product-grid">
            <input type="text" id="product-1" placeholder="ì£¼ë ¥ì œí’ˆ 1">
            <input type="text" id="product-2" placeholder="ì£¼ë ¥ì œí’ˆ 2">
            <input type="text" id="product-3" placeholder="ì£¼ë ¥ì œí’ˆ 3">
            <input type="text" id="product-4" placeholder="ì£¼ë ¥ì œí’ˆ 4">
          </div>
        </div>
      </div>
      
      <h3>1-3. ì‚¬ì—…ì¥ ì •ë³´</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ë³¸ì  ì†Œì¬ì§€ (ì‹œë„) <span class="required">*</span></label>
          <select id="location-sido" required onchange="updateSigunguOptions()">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì„œìš¸">ì„œìš¸</option>
            <option value="ê²½ê¸°">ê²½ê¸°</option>
            <option value="ì¸ì²œ">ì¸ì²œ</option>
            <option value="ë¶€ì‚°">ë¶€ì‚°</option>
            <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
            <option value="ëŒ€ì „">ëŒ€ì „</option>
            <option value="ê´‘ì£¼">ê´‘ì£¼</option>
            <option value="ìš¸ì‚°">ìš¸ì‚°</option>
            <option value="ì„¸ì¢…">ì„¸ì¢…</option>
            <option value="ê°•ì›">ê°•ì›</option>
            <option value="ì¶©ë¶">ì¶©ë¶</option>
            <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
            <option value="ì „ë¶">ì „ë¶</option>
            <option value="ì „ë‚¨">ì „ë‚¨</option>
            <option value="ê²½ë¶">ê²½ë¶</option>
            <option value="ê²½ë‚¨">ê²½ë‚¨</option>
            <option value="ì œì£¼">ì œì£¼</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‹œêµ°êµ¬</label>
          <select id="location-sigungu">
            <option value="">ì‹œë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‚°ì—…ë‹¨ì§€ ì…ì£¼</label>
          <select id="industrial-complex">
            <option value="ë¯¸ì…ì£¼">ë¯¸ì…ì£¼</option>
            <option value="ì¼ë°˜ì‚°ë‹¨">ì¼ë°˜ì‚°ë‹¨</option>
            <option value="êµ­ê°€ì‚°ë‹¨">êµ­ê°€ì‚°ë‹¨</option>
            <option value="ì§€ë°©ì‚°ë‹¨">ì§€ë°©ì‚°ë‹¨</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ìˆ˜ë„ê¶Œ ì—¬ë¶€ <span class="required">*</span></label>
          <select id="capital-area" required disabled>
            <option value="">ìë™ ì„¤ì •ë¨</option>
            <option value="Y">ì˜ˆ (ì„œìš¸/ê²½ê¸°/ì¸ì²œ)</option>
            <option value="N">ì•„ë‹ˆì˜¤ (ì§€ë°©)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Section 2: ëŒ€í‘œì ì •ë³´ -->
    <div class="card">
      <h2>Section 2. ëŒ€í‘œì ì •ë³´</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ìƒë…„ì›”ì¼</label>
          <input type="date" id="ceo-birth">
          <span class="info-text">ì²­ë…„(ë§Œ39ì„¸â†“) íŒì •</span>
        </div>
        
        <div class="form-group">
          <label>ì„±ë³„ <span class="required">*</span></label>
          <select id="ceo-gender" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
          </select>
          <span class="info-text">ì—¬ì„±ê¸°ì—… ì „ìš© íŠ¸ë™</span>
        </div>
      </div>
    </div>

    <!-- Section 3: ì¬ë¬´ ë° ì‹ ìš©ì •ë³´ -->
    <div class="card">
      <h2>Section 3. ì¬ë¬´ ë° ì‹ ìš©ì •ë³´</h2>
      
      <h3>3-1. ì¬ë¬´ í˜„í™©</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ë§¤ì¶œì•¡ - ìµœê·¼ë…„ë„ (ì–µì›) <span class="required">*</span></label>
          <input type="number" id="revenue-recent" placeholder="ì˜ˆ: 15" required>
        </div>
        
        <div class="form-group">
          <label>ì˜ì—…ì´ìµ - ìµœê·¼ë…„ë„ (ì–µì›)</label>
          <div style="display: flex; align-items: center; gap: 0.3rem;">
            <label class="loss-checkbox-label">
              <input type="checkbox" id="profit-loss" onchange="toggleProfitSign()">
              <span class="loss-checkbox-box">âœ“</span>
              <span class="loss-checkbox-text">ì†ì‹¤</span>
            </label>
            <input type="text" id="profit-recent" placeholder="ì˜ˆ: 2" inputmode="decimal" style="flex: 1;" oninput="formatProfitInput(this)">
          </div>
        </div>
        
        <div class="form-group">
          <label>ë¶€ì±„ë¹„ìœ¨ (%)</label>
          <input type="text" id="debt-ratio" placeholder="ì˜ˆ: 87.5" inputmode="decimal" oninput="formatDecimalInput(this)">
        </div>
      </div>
      
      <h3>3-2. ê²°ê²©ì‚¬ìœ  ì²´í¬</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>êµ­ì„¸ ì²´ë‚© <span class="required">*</span></label>
          <select id="tax-arrears" required>
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì§€ë°©ì„¸ ì²´ë‚© <span class="required">*</span></label>
          <select id="local-tax-arrears" required>
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>4ëŒ€ë³´í—˜ ë¯¸ë‚©/ì²´ë‚©</label>
          <select id="insurance-arrears">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì™„ì „ìë³¸ì ì‹</label>
          <select id="capital-erosion">
            <option value="N">ì•„ë‹ˆì˜¤</option>
            <option value="Y">ì˜ˆ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ë¶€ë„/íšŒìƒ/íŒŒì‚° ì´ë ¥</label>
          <select id="bankruptcy-history">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
      </div>
      
      <h3>3-3. ì‹ ìš©ì •ë³´</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ê¸°ìˆ ì‹ ìš©í‰ê°€(TCB) ë“±ê¸‰</label>
          <select id="tcb-rating">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="T-1">T-1</option>
            <option value="T-2">T-2</option>
            <option value="T-3">T-3</option>
            <option value="T-4">T-4</option>
            <option value="T-5">T-5</option>
            <option value="T-6">T-6</option>
            <option value="T-7">T-7</option>
            <option value="T-8">T-8</option>
            <option value="T-9">T-9</option>
            <option value="T-10">T-10</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Section 4: ê³ ìš© ì •ë³´ -->
    <div class="card">
      <h2>Section 4. ê³ ìš© ì •ë³´</h2>
      
      <h3>4-1. ì¸ë ¥ í˜„í™©</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ìƒì‹œê·¼ë¡œì ìˆ˜ (ëª…) <span class="required">*</span></label>
          <input type="number" id="employees-total" placeholder="ëŒ€í‘œì ì œì™¸" required>
        </div>
        
        <div class="form-group">
          <label>ì²­ë…„ ê³ ìš© (ë§Œ15~34ì„¸)</label>
          <input type="number" id="employees-youth" placeholder="ì²­ë…„ ì¸ì›">
          <span class="info-text">ì²­ë…„ê³ ìš© ê°€ì </span>
        </div>
        
        <div class="form-group">
          <label>ì—¬ì„± ê³ ìš©</label>
          <input type="number" id="employees-female" placeholder="ì—¬ì„± ì¸ì›">
          <span class="info-text">ì—¬ì„±ê³ ìš© ê°€ì </span>
        </div>
        
        <div class="form-group">
          <label>ì¥ì• ì¸ ê³ ìš©</label>
          <input type="number" id="employees-disabled" placeholder="ì¥ì• ì¸ ì¸ì›">
        </div>
        
        <div class="form-group">
          <label>ê³ ìš© ì¦ê°€ìœ¨ (%)</label>
          <input type="number" id="employment-growth" placeholder="ì „ë…„ ëŒ€ë¹„ ì¦ê°€ìœ¨" step="0.1">
          <span class="info-text">ê³ ìš©ì°½ì¶œ ìš°ëŒ€</span>
        </div>
      </div>
    </div>

    <!-- Section 5: ê¸°ìˆ  ë° ì¸ì¦ ì •ë³´ -->
    <div class="card">
      <h2>Section 5. ê¸°ìˆ  ë° ì¸ì¦ ì •ë³´</h2>
      
      <h3>5-1. ê¸°ì—… ì¸ì¦</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ë²¤ì²˜ê¸°ì—… ì¸ì¦</label>
          <select id="cert-venture">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì´ë…¸ë¹„ì¦ˆ(ê¸°ìˆ í˜ì‹ )</label>
          <select id="cert-innobiz">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ë©”ì¸ë¹„ì¦ˆ(ê²½ì˜í˜ì‹ )</label>
          <select id="cert-mainbiz">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì—¬ì„±ê¸°ì—… ì¸ì¦</label>
          <select id="cert-woman">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
          <span class="info-text">ì—¬ì„±ê¸°ì—… ì „ìš© ì§€ì›</span>
        </div>
        
        <div class="form-group">
          <label>ì¥ì• ì¸ê¸°ì—… ì¸ì¦</label>
          <select id="cert-disabled">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‚¬íšŒì ê¸°ì—… ì¸ì¦</label>
          <select id="cert-social">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ESG ì¶”ì§„ ì—¬ë¶€</label>
          <select id="esg-status">
            <option value="N">ì•„ë‹ˆì˜¤</option>
            <option value="Y">ì˜ˆ</option>
          </select>
          <span class="info-text">ESG ê´€ë ¨ ì‚¬ì—… ê°€ì </span>
        </div>
      </div>
      
      <h3>5-2. ì—°êµ¬ê°œë°œ ì—­ëŸ‰</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ì—°êµ¬ì¡°ì§</label>
          <select id="research-org">
            <option value="ì—†ìŒ">ì—†ìŒ</option>
            <option value="ê¸°ì—…ë¶€ì„¤ì—°êµ¬ì†Œ">ê¸°ì—…ë¶€ì„¤ì—°êµ¬ì†Œ</option>
            <option value="ì—°êµ¬ê°œë°œì „ë‹´ë¶€ì„œ">ì—°êµ¬ê°œë°œì „ë‹´ë¶€ì„œ</option>
          </select>
          <span class="info-text">ê¸°ìˆ ê°œë°œì‚¬ì—… í•„ìˆ˜</span>
        </div>
        
        <div class="form-group">
          <label>íŠ¹í—ˆ ë“±ë¡ (ê±´)</label>
          <input type="number" id="patents-registered" placeholder="ë“±ë¡">
        </div>
      </div>
    </div>

    <!-- Section 6: ìˆ˜ì¶œ ë° í•´ì™¸ì§„ì¶œ -->
    <div class="card">
      <h2>Section 6. ìˆ˜ì¶œ ë° í•´ì™¸ì§„ì¶œ</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ìˆ˜ì¶œ ì‹¤ì  - ìµœê·¼ë…„ë„ ($)</label>
          <input type="number" id="export-recent" placeholder="ì˜ˆ: 100000">
        </div>
        
        <div class="form-group full-width">
          <label>ì£¼ìš” ìˆ˜ì¶œêµ­</label>
          <input type="text" id="export-countries" placeholder="ë§¤ì¶œë¹„ì¤‘ ìƒìœ„ 3ê°œêµ­ (ì˜ˆ: ë¯¸êµ­, ì¤‘êµ­, ì¼ë³¸)">
        </div>
      </div>
    </div>

    <!-- Section 9: í¬ë§ ì§€ì›ë¶„ì•¼ -->
    <div class="card">
      <h2>Section 9. í¬ë§ ì§€ì›ë¶„ì•¼ <span class="required">*</span></h2>
      
      <h3>9-1. ì§€ì› í•„ìš” ë¶„ì•¼ (ì¤‘ë³µì„ íƒ ê°€ëŠ¥)</h3>
      <div class="checkbox-grid">
        <div class="checkbox-item">
          <input type="checkbox" id="support-funding" value="ì •ì±…ìê¸ˆ">
          <label for="support-funding">ì •ì±…ìê¸ˆ</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-rd" value="ê¸°ìˆ ê°œë°œ">
          <label for="support-rd">ê¸°ìˆ ê°œë°œ(R&D)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-commercialize" value="ì‚¬ì—…í™”">
          <label for="support-commercialize">ì‚¬ì—…í™”</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-marketing" value="íŒë¡œë§ˆì¼€íŒ…">
          <label for="support-marketing">íŒë¡œ/ë§ˆì¼€íŒ…</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-export" value="ìˆ˜ì¶œì§€ì›">
          <label for="support-export">ìˆ˜ì¶œì§€ì›</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-hr" value="ì¸ë ¥êµìœ¡">
          <label for="support-hr">ì¸ë ¥/êµìœ¡</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-facility" value="ì‹œì„¤ê³µê°„">
          <label for="support-facility">ì‹œì„¤/ê³µê°„</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-consulting" value="ì»¨ì„¤íŒ…">
          <label for="support-consulting">ì»¨ì„¤íŒ…</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-startup" value="ì°½ì—…">
          <label for="support-startup">ì°½ì—…</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="support-esg" value="ESGíƒ„ì†Œì¤‘ë¦½">
          <label for="support-esg">ESG/íƒ„ì†Œì¤‘ë¦½</label>
        </div>
      </div>
    </div>

    <!-- ì‹¤í–‰ ë²„íŠ¼ -->
    <div class="card">
      <button class="btn btn-primary" onclick="analyzePrograms()" style="width: 100%; font-size: 1rem; padding: 0.8rem; margin-bottom: 0.5rem;">
        ğŸ” ë§ì¶¤ ì§€ì›ì‚¬ì—… ì°¾ê¸°
      </button>
      <div style="display: flex; gap: 0.5rem;">
        <button class="btn btn-secondary" onclick="saveCompany()" style="flex: 1;">
          ğŸ’¾ ì €ì¥
        </button>
        <button class="btn btn-secondary" onclick="deleteCompany()" style="flex: 0 0 auto; background: rgba(255,100,100,0.2); border-color: rgba(255,100,100,0.5);">
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
      </div>
    </div>

    <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <div id="results-section" style="display: none;"></div>
  </div>

  <script>
    // ==================== Firebase & Google Drive ì„¤ì • ====================
    
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDjS3bsIsl3uDtyQIrzpZTO3IigLmLNG1E",
      authDomain: "kfpc-company-support-project.firebaseapp.com",
      databaseURL: "https://kfpc-company-support-project-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "kfpc-company-support-project",
      storageBucket: "kfpc-company-support-project.firebasestorage.app",
      messagingSenderId: "1012609333373",
      appId: "1:1012609333373:web:5453ab357b06015d56d914",
      measurementId: "G-5BDZFX0SC6"
    };
    
    // Firebase ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    // Google API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    const CLIENT_ID = '1012609333373-5d223e3cqp6fo28i8bi85i9ae0p7ohen.apps.googleusercontent.com';
    let gapiInited = false;
    let gisInited = false;
    let tokenClient = null;
    let accessToken = null;
    let currentUser = null;
    
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
    const SCOPES = 'https://www.googleapis.com/auth/drive';
    
    // ==================== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ====================
    
    /**
     * KSIC ëŒ€ë¶„ë¥˜ ì„ íƒ ì‹œ ì½”ë“œ ì—…ë°ì´íŠ¸
     */
    function updateKsicCode() {
      const select = document.getElementById('ksic-select');
      const input = document.getElementById('ksic-code');
      if (select && input && select.value) {
        // ì„ íƒëœ ê°’ì´ 2ìë¦¬ë©´ ì•ì— ì±„ìš°ê³  ë‚˜ë¨¸ì§€ 3ìë¦¬ëŠ” ì‚¬ìš©ì ì…ë ¥
        input.value = select.value;
        input.focus();
      }
    }
    
    /**
     * KSIC ê²€ìƒ‰ ì‚¬ì´íŠ¸ ì—´ê¸°
     */
    function openKsicSearch() {
      window.open('https://kssc.kostat.go.kr:8443/ksscNew_web/index.jsp', '_blank');
    }
    
    /**
     * ìˆ«ìë§Œ ì…ë ¥ í—ˆìš©
     */
    function allowOnlyNumbers(input) {
      input.value = input.value.replace(/[^0-9]/g, '');
    }
    
    /**
     * ìµœëŒ€ ê¸¸ì´ ë„ë‹¬ ì‹œ ìë™ í¬ì»¤ìŠ¤ ì´ë™
     */
    function moveFocusOnMaxLength(current, nextId, maxLength) {
      if (current.value.length >= maxLength) {
        const nextElement = document.getElementById(nextId);
        if (nextElement) nextElement.focus();
      }
    }
    
    /**
     * ì—…ë ¥ ê³„ì‚° ë° í‘œì‹œ
     */
    function calculateBusinessAge() {
      const dateInput = document.getElementById('establish-date');
      const displaySpan = document.getElementById('business-age-display');
      
      if (!dateInput || !dateInput.value || !displaySpan) return;
      
      const foundedDate = new Date(dateInput.value);
      const today = new Date();
      
      let years = today.getFullYear() - foundedDate.getFullYear();
      let months = today.getMonth() - foundedDate.getMonth();
      
      if (months < 0) {
        years--;
        months += 12;
      }
      
      if (years < 0) {
        displaySpan.textContent = '';
        return;
      }
      
      if (years === 0) {
        displaySpan.textContent = `(${months}ê°œì›”)`;
      } else if (months === 0) {
        displaySpan.textContent = `(${years}ë…„)`;
      } else {
        displaySpan.textContent = `(${years}ë…„ ${months}ê°œì›”)`;
      }
    }
    
    /**
     * ì†ì‹¤ ì²´í¬ í† ê¸€
     */
    function toggleProfitSign() {
      const checkbox = document.getElementById('profit-loss');
      const input = document.getElementById('profit-recent');
      
      if (!input) return;
      
      let value = input.value.replace(/[^0-9.]/g, '');
      
      if (checkbox && checkbox.checked && value) {
        input.value = '-' + value;
        input.style.color = '#ff6b6b';
      } else if (value) {
        input.value = value;
        input.style.color = '#333';
      }
    }
    
    /**
     * ì˜ì—…ì´ìµ ì…ë ¥ í¬ë§·
     */
    function formatProfitInput(input) {
      const checkbox = document.getElementById('profit-loss');
      let value = input.value.replace(/[^0-9.]/g, '');
      
      // ì†Œìˆ˜ì  í•˜ë‚˜ë§Œ í—ˆìš©
      const parts = value.split('.');
      if (parts.length > 2) {
        value = parts[0] + '.' + parts.slice(1).join('');
      }
      
      if (checkbox && checkbox.checked && value) {
        input.value = '-' + value;
        input.style.color = '#ff6b6b';
      } else {
        input.value = value;
        input.style.color = '#333';
      }
    }
    
    /**
     * ì†Œìˆ˜ì  ì…ë ¥ í¬ë§· (ë¶€ì±„ë¹„ìœ¨ ë“±)
     */
    function formatDecimalInput(input) {
      let value = input.value.replace(/[^0-9.]/g, '');
      
      // ì†Œìˆ˜ì  í•˜ë‚˜ë§Œ í—ˆìš©
      const parts = value.split('.');
      if (parts.length > 2) {
        value = parts[0] + '.' + parts.slice(1).join('');
      }
      
      input.value = value;
    }
    
    // ==================== í…ŒìŠ¤íŠ¸ ë°ì´í„° (Phase 1) ====================
    const MOCK_COMPANIES = [
      {
        name: 'ì‚¼ì„±ì „ì(ì£¼)',
        businessNumber: '124-81-00998',
        ceo: 'í•œì¢…í¬',
        openingDate: '1969-01-13',
        industryCode: 'C26',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ìˆ˜ì›ì‹œ',
        revenue: '300000000000',
        employeeCount: '120000'
      },
      {
        name: 'LGì „ì(ì£¼)',
        businessNumber: '107-86-14075',
        ceo: 'ì¡°ì£¼ì™„',
        openingDate: '1958-10-01',
        industryCode: 'C26',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ì„œìš¸',
        locationSigungu: 'ì˜ë“±í¬êµ¬',
        revenue: '70000000000',
        employeeCount: '70000'
      },
      {
        name: 'í˜„ëŒ€ìë™ì°¨(ì£¼)',
        businessNumber: '101-81-42555',
        ceo: 'ì¥ì¬í›ˆ',
        openingDate: '1967-12-29',
        industryCode: 'C30',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ì„œìš¸',
        locationSigungu: 'ì„œì´ˆêµ¬',
        revenue: '130000000000',
        employeeCount: '75000'
      },
      {
        name: 'SKí•˜ì´ë‹‰ìŠ¤(ì£¼)',
        businessNumber: '120-81-62902',
        ceo: 'ê³½ë…¸ì •',
        openingDate: '1983-02-15',
        industryCode: 'C26',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ì´ì²œì‹œ',
        revenue: '40000000000',
        employeeCount: '35000'
      },
      {
        name: 'ë„¤ì´ë²„(ì£¼)',
        businessNumber: '220-81-62517',
        ceo: 'ìµœìˆ˜ì—°',
        openingDate: '1999-06-02',
        industryCode: 'J63',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ì„±ë‚¨ì‹œ',
        revenue: '8000000000',
        employeeCount: '4000'
      },
      {
        name: 'ì¹´ì¹´ì˜¤(ì£¼)',
        businessNumber: '120-81-47521',
        ceo: 'í™ì€íƒ',
        openingDate: '2006-02-16',
        industryCode: 'J63',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ì„±ë‚¨ì‹œ',
        revenue: '6000000000',
        employeeCount: '3500'
      }
    ];
    
    // ==================== í…ŒìŠ¤íŠ¸ ì§€ì›ì‚¬ì—… ë°ì´í„° ====================
    /**
     * ì‹¤ì œ ì§€ì›ì‚¬ì—… ë°ì´í„° (2025ë…„ ê¸°ì¤€)
     * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë§¤ì¹­ì— ì‚¬ìš©
     */
    const MOCK_PROGRAMS = [
      // 1. ì°½ì—… ì§€ì›
      {
        id: 'startup-001',
        name: 'ì˜ˆë¹„ì°½ì—…íŒ¨í‚¤ì§€',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ì°½ì—…',
        budget: 'ìµœëŒ€ 1ì–µì›',
        description: 'ìš°ìˆ˜í•œ ì‚¬ì—… ì•„ì´ë””ì–´ë¥¼ ë³´ìœ í•œ ì˜ˆë¹„ì°½ì—…ìì—ê²Œ ì‚¬ì—…í™” ìê¸ˆ, ë©˜í† ë§, êµìœ¡ ë“±ì„ ì¢…í•© ì§€ì›',
        
        // ìê²© ì¡°ê±´
        requiresNoArrears: true,
        minBusinessAge: null,
        maxBusinessAge: 0, // ì°½ì—… ì „
        targetCompanySize: [],
        maxCeoAge: 39,
        
        // ì„ í˜¸ ì¡°ê±´
        targetIndustry: [], // ì „ ì—…ì¢…
        targetRegion: [],
        prefersYouthEmployment: true,
        
        website: 'https://www.k-startup.go.kr'
      },
      
      {
        id: 'startup-002',
        name: 'ì´ˆê¸°ì°½ì—…íŒ¨í‚¤ì§€',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ì°½ì—…',
        budget: 'ìµœëŒ€ 1ì–µì›',
        description: 'ì—…ë ¥ 3ë…„ ì´í•˜ ì´ˆê¸°ì°½ì—…ê¸°ì—…ì˜ ì„±ì¥ ì§€ì› (ì‚¬ì—…í™” ìê¸ˆ, ë©˜í† ë§, ë§ˆì¼€íŒ… ë“±)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: 3,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        maxCeoAge: null,
        
        targetIndustry: [],
        targetRegion: [],
        
        website: 'https://www.k-startup.go.kr'
      },
      
      {
        id: 'startup-003',
        name: 'ì²­ë…„ì°½ì—…ì‚¬ê´€í•™êµ',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ì°½ì—…',
        budget: 'ìµœëŒ€ 1ì–µì› + ì…ì£¼ê³µê°„',
        description: 'ë§Œ 39ì„¸ ì´í•˜ ì²­ë…„ ì°½ì—…ì ëŒ€ìƒ ì°½ì—… êµìœ¡, ìê¸ˆ, ê³µê°„ ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: 3,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        maxCeoAge: 39,
        
        targetIndustry: [],
        targetRegion: [],
        prefersYouthEmployment: true,
        
        website: 'https://www.k-startup.go.kr'
      },
      
      // 2. R&D ì§€ì›
      {
        id: 'rnd-001',
        name: 'ì¤‘ì†Œê¸°ì—… ê¸°ìˆ ê°œë°œì‚¬ì—…',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'R&D',
        budget: 'ìµœëŒ€ 5ì–µì›',
        description: 'ì¤‘ì†Œê¸°ì—…ì˜ ê¸°ìˆ ê²½ìŸë ¥ ê°•í™”ë¥¼ ìœ„í•œ R&D ê³¼ì œ ì§€ì› (ì œí’ˆê°œë°œ, ê³µì •ê°œì„  ë“±)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: ['10', '20', '21', '26', '27', '28', '29', '62', '70'],
        targetRegion: [],
        
        prefersPatent: true,
        prefersRnD: true,
        prefersVenture: true,
        prefersInnobiz: true,
        
        website: 'https://www.smtech.go.kr'
      },
      
      {
        id: 'rnd-002',
        name: 'ì‚°ì—…ê¸°ìˆ  R&D (ì•Œí‚¤ë¯¸ìŠ¤íŠ¸)',
        organization: 'ì‚°ì—…í†µìƒìì›ë¶€',
        category: 'R&D',
        budget: 'ìµœëŒ€ 20ì–µì›',
        description: 'ì†Œì¬Â·ë¶€í’ˆÂ·ì¥ë¹„(ì†Œë¶€ì¥) í•µì‹¬ê¸°ìˆ  ê°œë°œ ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 3,
        maxBusinessAge: null,
        targetCompanySize: ['ì¤‘ì†Œê¸°ì—…', 'ì¤‘ê²¬ê¸°ì—…'],
        
        targetIndustry: ['20', '21', '26', '27', '28'], // í™”í•™, ì „ìë¶€í’ˆ, ë°˜ë„ì²´
        targetRegion: [],
        
        prefersPatent: true,
        prefersRnD: true,
        prefersVenture: true,
        
        website: 'https://www.motie.go.kr'
      },
      
      {
        id: 'rnd-003',
        name: 'ì‚°í•™ì—°í˜‘ë ¥ ê¸°ìˆ ê°œë°œ',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'R&D',
        budget: 'ìµœëŒ€ 3ì–µì›',
        description: 'ì¤‘ì†Œê¸°ì—…ê³¼ ëŒ€í•™/ì—°êµ¬ì†Œ ê°„ ê³µë™ R&D ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersPatent: true,
        prefersRnD: true,
        
        website: 'https://www.smtech.go.kr'
      },
      
      // 3. ê¸ˆìœµ ì§€ì›
      {
        id: 'finance-001',
        name: 'ì •ì±…ìê¸ˆìœµì',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ì§„í¥ê³µë‹¨',
        category: 'ê¸ˆìœµ',
        budget: 'ìµœëŒ€ 30ì–µì›',
        description: 'ì¤‘ì†Œê¸°ì—… ìš´ì˜ìê¸ˆ ë° ì‹œì„¤ìê¸ˆ ì €ë¦¬ ìœµì (ì—° 2~3% ê¸ˆë¦¬)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        website: 'https://www.kosmes.or.kr'
      },
      
      {
        id: 'finance-002',
        name: 'ë²¤ì²˜ê¸°ì—… íˆ¬ìœµì',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ì§„í¥ê³µë‹¨',
        category: 'ê¸ˆìœµ',
        budget: 'ìµœëŒ€ 50ì–µì›',
        description: 'ë²¤ì²˜ê¸°ì—… ì„±ì¥ ì§€ì› íˆ¬ìœµì (íˆ¬ì+ìœµì íŒ¨í‚¤ì§€)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: 7,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersVenture: true,
        prefersPatent: true,
        
        website: 'https://www.kosmes.or.kr'
      },
      
      {
        id: 'finance-003',
        name: 'ì†Œìƒê³µì¸ ì •ì±…ìê¸ˆ',
        organization: 'ì†Œìƒê³µì¸ì‹œì¥ì§„í¥ê³µë‹¨',
        category: 'ê¸ˆìœµ',
        budget: 'ìµœëŒ€ 7ì²œë§Œì›',
        description: 'ì†Œìƒê³µì¸ ìš´ì˜ìê¸ˆ ë° ì‹œì„¤ê°œì„  ìê¸ˆ ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…'],
        
        targetIndustry: ['46', '47', '56'], // ë„ì†Œë§¤, ìŒì‹ì 
        targetRegion: [],
        
        website: 'https://www.semas.or.kr'
      },
      
      // 4. ìˆ˜ì¶œ ì§€ì›
      {
        id: 'export-001',
        name: 'ìˆ˜ì¶œë°”ìš°ì²˜',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ìˆ˜ì¶œ',
        budget: 'ìµœëŒ€ 2ì²œë§Œì›',
        description: 'ì¤‘ì†Œê¸°ì—… í•´ì™¸ ì „ì‹œíšŒ ì°¸ê°€, ë§ˆì¼€íŒ…, ì¸ì¦íšë“ ë“± ìˆ˜ì¶œ ì—­ëŸ‰ ê°•í™” ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersExport: true,
        
        website: 'https://www.exportvoucher.com'
      },
      
      {
        id: 'export-002',
        name: 'K-ìŠ¤íƒ€íŠ¸ì—… ê¸€ë¡œë²Œ ì§„ì¶œ',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ìˆ˜ì¶œ',
        budget: 'ìµœëŒ€ 5ì²œë§Œì›',
        description: 'ìœ ë§ ìŠ¤íƒ€íŠ¸ì—… í•´ì™¸ì‹œì¥ ì§„ì¶œ ì§€ì› (í˜„ì§€í™”, ë§ˆì¼€íŒ…, IR ë“±)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: 7,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: ['58', '62', '63', '70'],
        targetRegion: [],
        
        prefersVenture: true,
        prefersPatent: true,
        
        website: 'https://www.k-startup.go.kr'
      },
      
      {
        id: 'export-003',
        name: 'ê¸€ë¡œë²Œ ê°•ì†Œê¸°ì—… ìœ¡ì„±',
        organization: 'ì‚°ì—…í†µìƒìì›ë¶€',
        category: 'ìˆ˜ì¶œ',
        budget: 'ìµœëŒ€ 10ì–µì›',
        description: 'ìˆ˜ì¶œ ìœ ë§ ì¤‘ì†Œê¸°ì—…ì˜ ê¸€ë¡œë²Œ ì‹œì¥ ì§„ì¶œ ì¢…í•© ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 3,
        maxBusinessAge: null,
        targetCompanySize: ['ì¤‘ì†Œê¸°ì—…', 'ì¤‘ê²¬ê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersExport: true,
        prefersPatent: true,
        
        website: 'https://www.motie.go.kr'
      },
      
      // 5. ê³ ìš© ì§€ì›
      {
        id: 'employment-001',
        name: 'ì²­ë…„ì¶”ê°€ê³ ìš©ì¥ë ¤ê¸ˆ',
        organization: 'ê³ ìš©ë…¸ë™ë¶€',
        category: 'ê³ ìš©',
        budget: '1ì¸ë‹¹ ìµœëŒ€ 900ë§Œì›',
        description: 'ë§Œ 15~34ì„¸ ì²­ë…„ ì •ê·œì§ ì‹ ê·œ ì±„ìš© ì‹œ ì¸ê±´ë¹„ ì§€ì› (3ë…„ê°„)',
        
        requiresNoArrears: false,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…', 'ì¤‘ê²¬ê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersYouthEmployment: true,
        
        website: 'https://www.work.go.kr'
      },
      
      {
        id: 'employment-002',
        name: 'ì¼ìë¦¬ ì•ˆì •ìê¸ˆ',
        organization: 'ê³ ìš©ë…¸ë™ë¶€',
        category: 'ê³ ìš©',
        budget: '1ì¸ë‹¹ ì›” ìµœëŒ€ 9ë§Œì›',
        description: 'ìµœì €ì„ê¸ˆ ì¸ìƒì— ë”°ë¥¸ ì†Œìƒê³µì¸Â·ì˜ì„¸ì¤‘ì†Œê¸°ì—… ì§€ì›',
        
        requiresNoArrears: false,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        website: 'https://www.work.go.kr'
      },
      
      {
        id: 'employment-003',
        name: 'ì—¬ì„±ê³ ìš© ìš°ìˆ˜ê¸°ì—… ì§€ì›',
        organization: 'ì—¬ì„±ê°€ì¡±ë¶€',
        category: 'ê³ ìš©',
        budget: 'ìµœëŒ€ 5ì²œë§Œì›',
        description: 'ì—¬ì„± ê³ ìš© ë¹„ìœ¨ì´ ë†’ì€ ê¸°ì—…ì— ëŒ€í•œ ì¸ì„¼í‹°ë¸Œ ë° ì§€ì›',
        
        requiresNoArrears: false,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersFemaleEmployment: true,
        
        website: 'https://www.mogef.go.kr'
      },
      
      // 6. ì§€ì—­ íŠ¹í™”
      {
        id: 'region-001',
        name: 'ì§€ì—­ì£¼ë ¥ì‚°ì—… ìœ¡ì„±ì‚¬ì—…',
        organization: 'ì‚°ì—…í†µìƒìì›ë¶€',
        category: 'ì§€ì—­íŠ¹í™”',
        budget: 'ìµœëŒ€ 10ì–µì›',
        description: 'ì§€ì—­ë³„ ì£¼ë ¥ì‚°ì—…(ìë™ì°¨, ì¡°ì„ , ì„¬ìœ  ë“±) ìœ¡ì„± ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: ['ë¶€ì‚°', 'ëŒ€êµ¬', 'ìš¸ì‚°', 'ê²½ë¶', 'ê²½ë‚¨', 'ì „ë¶', 'ì „ë‚¨'],
        
        preferNonCapital: true,
        
        website: 'https://www.motie.go.kr'
      },
      
      {
        id: 'region-002',
        name: 'ì§€ì—­ì‚°ì—… ë§ì¶¤í˜• ì¼ìë¦¬ì°½ì¶œ',
        organization: 'ê³ ìš©ë…¸ë™ë¶€',
        category: 'ì§€ì—­íŠ¹í™”',
        budget: 'ìµœëŒ€ 3ì–µì›',
        description: 'ì§€ì—­ íŠ¹ì„±ì— ë§ëŠ” ì¼ìë¦¬ ì°½ì¶œ ê¸°ì—… ì§€ì›',
        
        requiresNoArrears: false,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: ['ê°•ì›', 'ì¶©ë¶', 'ì¶©ë‚¨', 'ì „ë¶', 'ì „ë‚¨', 'ê²½ë¶', 'ê²½ë‚¨', 'ì œì£¼'],
        
        preferNonCapital: true,
        
        website: 'https://www.work.go.kr'
      },
      
      // 7. ë””ì§€í„¸ì „í™˜
      {
        id: 'digital-001',
        name: 'ìŠ¤ë§ˆíŠ¸ê³µì¥ êµ¬ì¶• ì§€ì›',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ë””ì§€í„¸ì „í™˜',
        budget: 'ìµœëŒ€ 1ì–µì›',
        description: 'ì œì¡°ì—… ìŠ¤ë§ˆíŠ¸ê³µì¥ êµ¬ì¶• ë° ê³ ë„í™” ì§€ì› (ì„¤ë¹„, SW, ì»¨ì„¤íŒ…)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: ['10', '11', '13', '14', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31'],
        targetRegion: [],
        
        website: 'https://www.smart-factory.kr'
      },
      
      {
        id: 'digital-002',
        name: 'ì¤‘ì†Œê¸°ì—… AIÂ·ë¹…ë°ì´í„° ë°”ìš°ì²˜',
        organization: 'ê³¼í•™ê¸°ìˆ ì •ë³´í†µì‹ ë¶€',
        category: 'ë””ì§€í„¸ì „í™˜',
        budget: 'ìµœëŒ€ 7ì²œë§Œì›',
        description: 'AIÂ·ë¹…ë°ì´í„° ê¸°ìˆ  ë„ì… ë° í™œìš© ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersRnD: true,
        
        website: 'https://www.msit.go.kr'
      },
      
      // 8. ê¸°íƒ€
      {
        id: 'etc-001',
        name: 'ì†Œìƒê³µì¸ í¬ë§ë¦¬í„´íŒ¨í‚¤ì§€',
        organization: 'ì†Œìƒê³µì¸ì‹œì¥ì§„í¥ê³µë‹¨',
        category: 'ì¬ê¸°ì§€ì›',
        budget: 'ìµœëŒ€ 5ì²œë§Œì›',
        description: 'íì—… í›„ ì¬ì°½ì—…í•˜ëŠ” ì†Œìƒê³µì¸ ì§€ì› (êµìœ¡, ìê¸ˆ, ì»¨ì„¤íŒ…)',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: 1,
        targetCompanySize: ['ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        website: 'https://www.semas.or.kr'
      },
      
      {
        id: 'etc-002',
        name: 'ì—¬ì„±ê¸°ì—… ì§€ì›ì‚¬ì—…',
        organization: 'ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ë¶€',
        category: 'ì—¬ì„±ê¸°ì—…',
        budget: 'ìµœëŒ€ 3ì–µì›',
        description: 'ì—¬ì„±ê¸°ì—… ë° ì—¬ì„± CEO ê¸°ì—… ëŒ€ìƒ ìê¸ˆ, íŒë¡œ, êµìœ¡ ì§€ì›',
        
        requiresNoArrears: true,
        minBusinessAge: 0,
        maxBusinessAge: null,
        targetCompanySize: ['ì†Œê¸°ì—…', 'ì¤‘ì†Œê¸°ì—…'],
        
        targetIndustry: [],
        targetRegion: [],
        
        prefersFemaleEmployment: true,
        
        website: 'https://www.smba.go.kr'
      }
    ];
    
    // ==================== Google API ì´ˆê¸°í™” ====================
    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }
    
    async function initializeGapiClient() {
      await gapi.client.init({
        discoveryDocs: [DISCOVERY_DOC],
      });
      gapiInited = true;
      console.log('âœ… GAPI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
      maybeEnableButtons();
    }
    
    // Google Identity Services ì´ˆê¸°í™”
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: handleTokenResponse,
      });
      gisInited = true;
      console.log('âœ… GIS í† í° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
      maybeEnableButtons();
    }
    
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        console.log('âœ… Google API ì¤€ë¹„ ì™„ë£Œ');
      }
    }
    
    // í† í° ì‘ë‹µ ì²˜ë¦¬
    async function handleTokenResponse(resp) {
      if (resp.error !== undefined) {
        console.error('âŒ í† í° íšë“ ì‹¤íŒ¨:', resp);
        alert('Google ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      accessToken = resp.access_token;
      console.log('ğŸ”‘ Access Token íšë“ ì„±ê³µ');
      
      // Google API í´ë¼ì´ì–¸íŠ¸ì— í† í° ì„¤ì •
      gapi.client.setToken({ access_token: accessToken });
      
      // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      try {
        const userInfo = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
          headers: { Authorization: `Bearer ${accessToken}` }
        }).then(res => res.json());
        
        currentUser = userInfo;
        document.getElementById('user-info').textContent = userInfo.email;
        console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', userInfo.email);
      } catch (e) {
        console.error('ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      
      // ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ í™”ë©´ í‘œì‹œ
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      
      // Google Driveì—ì„œ ë°ì´í„° ë¡œë“œ
      await loadFromDrive();
      
      // ìˆ«ì í¬ë§·íŒ… í™œì„±í™”
      attachNumberFormatting();
    }
    
    // Google ë¡œê·¸ì¸
    function signInWithGoogle() {
      if (!gisInited) {
        console.error('âŒ GISê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        alert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      console.log('ğŸ” Google ë¡œê·¸ì¸ ì‹œì‘...');
      
      // í† í° ìš”ì²­ (íŒì—…)
      tokenClient.requestAccessToken({ prompt: 'consent' });
    }
    
    // Google ë¡œê·¸ì•„ì›ƒ
    function signOut() {
      if (accessToken) {
        google.accounts.oauth2.revoke(accessToken, () => {
          console.log('âœ… í† í° ì·¨ì†Œ ì™„ë£Œ');
        });
      }
      
      accessToken = null;
      currentUser = null;
      savedCompanies = {};
      
      gapi.client.setToken(null);
      
      document.getElementById('main-content').style.display = 'none';
      document.getElementById('login-screen').style.display = 'flex';
      
      console.log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
    }
    
    // Google Driveì— ì €ì¥
    async function saveToDrive(data) {
      try {
        if (!accessToken) {
          console.error('âŒ Access tokenì´ ì—†ìŠµë‹ˆë‹¤');
          return false;
        }
        
        console.log('ğŸ’¾ Google Driveì— ì €ì¥ ì¤‘...');
        
        // ë°ì´í„° ì•”í˜¸í™”
        const encryptedData = encryptData(data);
        
        // ê¸°ì¡´ íŒŒì¼ ê²€ìƒ‰ (ë£¨íŠ¸ í´ë”)
        const searchResponse = await gapi.client.drive.files.list({
          q: "name='kfpc-bizinfo-data.json' and trashed=false",
          fields: 'files(id, name)',
        });
        
        // ì•ˆì „í•œ null ì²´í¬
        const files = searchResponse?.result?.files || [];
        const fileContent = JSON.stringify({ encryptedData, timestamp: new Date().toISOString() });
        const file = new Blob([fileContent], { type: 'application/json' });
        
        if (files && files.length > 0) {
          // ê¸°ì¡´ íŒŒì¼ ì—…ë°ì´íŠ¸
          const fileId = files[0].id;
          const form = new FormData();
          form.append('metadata', new Blob([JSON.stringify({})], { type: 'application/json' }));
          form.append('file', file);
          
          const updateResponse = await fetch(
            `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`,
            {
              method: 'PATCH',
              headers: { Authorization: `Bearer ${accessToken}` },
              body: form,
            }
          );
          
          if (updateResponse.ok) {
            console.log('âœ… Drive ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            return true;
          }
        } else {
          // ìƒˆ íŒŒì¼ ìƒì„± (ë£¨íŠ¸ í´ë”)
          const metadata = {
            name: 'kfpc-bizinfo-data.json',
            mimeType: 'application/json',
          };
          
          const form = new FormData();
          form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
          form.append('file', file);
          
          const createResponse = await fetch(
            'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
            {
              method: 'POST',
              headers: { Authorization: `Bearer ${accessToken}` },
              body: form,
            }
          );
          
          if (createResponse.ok) {
            console.log('âœ… Drive ì €ì¥ ì™„ë£Œ');
            return true;
          }
        }
        
        return false;
      } catch (error) {
        console.error('âŒ Drive ì €ì¥ ì‹¤íŒ¨:', error);
        return false;
      }
    }
    
    // Google Driveì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadFromDrive() {
      try {
        if (!accessToken) {
          console.error('âŒ Access tokenì´ ì—†ìŠµë‹ˆë‹¤');
          return false;
        }
        
        console.log('ğŸ“¥ Google Driveì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        
        const searchResponse = await gapi.client.drive.files.list({
          q: "name='kfpc-bizinfo-data.json' and trashed=false",
          fields: 'files(id, name)',
        });
        
        // ì•ˆì „í•œ null ì²´í¬
        if (!searchResponse || !searchResponse.result) {
          console.log('ğŸ“ Drive ì‘ë‹µ ì—†ìŒ');
          return false;
        }
        
        const files = searchResponse.result.files;
        if (!files || files.length === 0) {
          console.log('ğŸ“ ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
          return false;
        }
        
        const fileId = files[0].id;
        const getResponse = await fetch(
          `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
          {
            headers: { Authorization: `Bearer ${accessToken}` },
          }
        );
        
        if (getResponse.ok) {
          const fileData = await getResponse.json();
          const decryptedData = decryptData(fileData.encryptedData);
          
          if (decryptedData) {
            savedCompanies = decryptedData;
            updateCompanySelect();
            console.log('âœ… Drive ë¡œë“œ ì™„ë£Œ:', Object.keys(savedCompanies).length, 'ê°œ ê³ ê°ì‚¬');
            return true;
          }
        }
        
        return false;
      } catch (error) {
        console.error('âŒ Drive ë¡œë“œ ì‹¤íŒ¨:', error);
        return false;
      }
    }
    
    // ==================== AES-256 ì•”í˜¸í™” ====================
    
    // AES-256 ì•”í˜¸í™” í‚¤ (ì•± ê³ ìœ  í‚¤)
    const ENCRYPTION_KEY = 'KFPC-BizInfo-2025-AES256-SecureKey';
    
    let savedCompanies = {};

    // ì•”í˜¸í™” í•¨ìˆ˜
    function encryptData(data) {
      return CryptoJS.AES.encrypt(JSON.stringify(data), ENCRYPTION_KEY).toString();
    }
    
    // ë³µí˜¸í™” í•¨ìˆ˜
    function decryptData(encryptedData) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedData, ENCRYPTION_KEY);
        return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
      } catch (e) {
        console.error('ë³µí˜¸í™” ì‹¤íŒ¨:', e);
        return null;
      }
    }
    
    // ==================== ìˆ«ì í¬ë§·íŒ… ====================
    function formatNumber(value) {
      if (!value) return '';
      // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±°
      const numStr = String(value).replace(/[^\d]/g, '');
      if (!numStr) return '';
      
      // ìˆ«ìë¥¼ ì²œ ë‹¨ìœ„ë¡œ ì½¤ë§ˆ ì¶”ê°€
      return numStr.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    function unformatNumber(value) {
      if (!value) return '';
      // ì½¤ë§ˆ ì œê±°í•˜ê³  ìˆœìˆ˜ ìˆ«ìë§Œ ë°˜í™˜
      return String(value).replace(/,/g, '');
    }
    
    function attachNumberFormatting() {
      // ëª¨ë“  ìˆ«ì ì…ë ¥ í•„ë“œ ID ëª©ë¡ (ì†Œìˆ˜ì  í•„ë“œ ì œì™¸)
      const numberFields = [
        // Section 3: ì¬ë¬´ ì •ë³´
        'revenue-recent',
        // Section 4: ê³ ìš© ì •ë³´
        'employees-total', 'employees-youth', 
        'employees-female', 'employees-disabled', 'employment-growth',
        // Section 5: ê¸°ìˆ  ì •ë³´
        'patents-registered',
        // Section 6: ìˆ˜ì¶œ ì •ë³´
        'export-recent'
      ];
      
      numberFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          // typeì„ textë¡œ ë³€ê²½í•˜ê³  inputmode ì¶”ê°€
          field.type = 'text';
          field.setAttribute('inputmode', 'numeric');
          
          // input ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ í¬ë§·íŒ…
          field.addEventListener('input', function(e) {
            const cursorPos = this.selectionStart;
            const oldLength = this.value.length;
            
            // í¬ë§·íŒ… ì ìš©
            const formatted = formatNumber(this.value);
            this.value = formatted;
            
            // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
            const newLength = formatted.length;
            const lengthDiff = newLength - oldLength;
            
            // ìˆ«ì ì…ë ¥ ì¤‘ ì½¤ë§ˆê°€ ì¶”ê°€ë˜ë©´ ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
            if (lengthDiff > 0 && cursorPos < newLength) {
              this.setSelectionRange(cursorPos + lengthDiff, cursorPos + lengthDiff);
            } else {
              this.setSelectionRange(cursorPos, cursorPos);
            }
          });
          
          // blur ì´ë²¤íŠ¸ë¡œ ìµœì¢… í¬ë§·íŒ…
          field.addEventListener('blur', function() {
            this.value = formatNumber(this.value);
          });
        }
      });
      
      console.log('âœ… ìˆ«ì í•„ë“œ ì‹¤ì‹œê°„ ì½¤ë§ˆ í¬ë§·íŒ… í™œì„±í™” (' + numberFields.length + 'ê°œ í•„ë“œ)');
    }

    async function initializeApp() {
      try {
        console.log('ğŸš€ ì•± ì´ˆê¸°í™”');
        
        // GAPI ë¡œë“œ
        gapiLoaded();
        
        // GIS ë¡œë“œ
        gisLoaded();
        
        // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ (GISëŠ” ìë™ ë¡œê·¸ì¸ ì—†ìŒ)
        document.getElementById('login-screen').style.display = 'flex';
        document.getElementById('main-content').style.display = 'none';
        
        hideLoading();
        
      } catch (error) {
        console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        hideLoading();
      }
    }
    
    function hideLoading() {
      const loading = document.getElementById('loading-screen');
      loading.classList.add('hide');
      setTimeout(() => loading.style.display = 'none', 300);
    }
    
    function collectFormData() {
      // ì•ˆì „í•œ ê°’ ê°€ì ¸ì˜¤ê¸° í—¬í¼ í•¨ìˆ˜
      const getVal = (id) => document.getElementById(id)?.value || '';
      const getNumVal = (id) => unformatNumber(document.getElementById(id)?.value || '');
      const getChecked = (selector) => {
        const elements = document.querySelectorAll(selector);
        return elements ? Array.from(elements).filter(el => el.checked).map(el => el.value) : [];
      };
      
      // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ 3ê°œ input í•©ì¹˜ê¸°
      const bizNum1 = getVal('business-number-1');
      const bizNum2 = getVal('business-number-2');
      const bizNum3 = getVal('business-number-3');
      const businessNumber = bizNum1 && bizNum2 && bizNum3 ? `${bizNum1}-${bizNum2}-${bizNum3}` : '';
      
      // ëª¨ë“  ì…ë ¥ í•„ë“œ ë°ì´í„° ìˆ˜ì§‘
      const data = {
        // Section 1: ê¸°ì—… ê¸°ë³¸ì •ë³´
        companyName: getVal('company-name'),
        businessNumber: businessNumber,
        establishDate: getVal('establish-date'),
        companySize: getVal('company-size'),
        companyType: getVal('company-type'),
        businessStatus: getVal('business-status'),
        ksicCode: getVal('ksic-code'),
        productKeywords: [getVal('product-1'), getVal('product-2'), getVal('product-3'), getVal('product-4')].filter(Boolean).join(', '),
        locationSido: getVal('location-sido'),
        locationSigungu: getVal('location-sigungu'),
        industrialComplex: getVal('industrial-complex'),
        capitalArea: getVal('capital-area'),
        
        // Section 2: ëŒ€í‘œì ì •ë³´
        ceoBirth: getVal('ceo-birth'),
        ceoGender: getVal('ceo-gender'),
        
        // Section 3: ì¬ë¬´ ë° ì‹ ìš©ì •ë³´
        revenueRecent: getNumVal('revenue-recent'),
        profitRecent: getNumVal('profit-recent'),
        debtRatio: getNumVal('debt-ratio'),
        taxArrears: getVal('tax-arrears'),
        localTaxArrears: getVal('local-tax-arrears'),
        insuranceArrears: getVal('insurance-arrears'),
        capitalErosion: getVal('capital-erosion'),
        bankruptcyHistory: getVal('bankruptcy-history'),
        tcbRating: getVal('tcb-rating'),
        
        // Section 4: ê³ ìš© ì •ë³´
        employeesTotal: getNumVal('employees-total'),
        employeesYouth: getNumVal('employees-youth'),
        employeesFemale: getNumVal('employees-female'),
        employeesDisabled: getNumVal('employees-disabled'),
        employmentGrowth: getNumVal('employment-growth'),
        
        // Section 5: ê¸°ìˆ  ë° ì¸ì¦ ì •ë³´
        certVenture: getVal('cert-venture'),
        certInnobiz: getVal('cert-innobiz'),
        certMainbiz: getVal('cert-mainbiz'),
        certWoman: getVal('cert-woman'),
        certDisabled: getVal('cert-disabled'),
        certSocial: getVal('cert-social'),
        esgStatus: getVal('esg-status'),
        researchOrg: getVal('research-org'),
        patentsRegistered: getNumVal('patents-registered'),
        
        // Section 6: ìˆ˜ì¶œ ì •ë³´
        exportRecent: getNumVal('export-recent'),
        exportCountries: getVal('export-countries'),
        
        // Section 9: í¬ë§ ì§€ì›ë¶„ì•¼
        supportNeeds: getChecked('#support-funding, #support-rd, #support-commercialize, #support-marketing, #support-export, #support-hr, #support-facility, #support-consulting, #support-startup, #support-esg')
      };
      
      return data;
    }
    
    // í˜„ì¬ ì •ë ¬ ìƒíƒœ
    let currentSortType = 'name';
    let selectedCompanyId = null;
    
    function updateCompanySelect() {
      const select = document.getElementById('company-select');
      select.innerHTML = '<option value="">-- ìƒˆë¡œ ì…ë ¥ --</option>';
      
      Object.keys(savedCompanies).forEach(id => {
        const company = savedCompanies[id];
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `${company.companyName} (${company.companySize})`;
        select.appendChild(option);
      });
      
      // ëª©ë¡ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
      updateCompanyList();
    }
    
    function updateCompanyList() {
      const listContainer = document.getElementById('company-list');
      const searchTerm = document.getElementById('company-search')?.value?.toLowerCase() || '';
      
      // ê¸°ì—… ëª©ë¡ ë°°ì—´ë¡œ ë³€í™˜
      let companies = Object.keys(savedCompanies).map(id => ({
        id: id,
        ...savedCompanies[id]
      }));
      
      // ê²€ìƒ‰ í•„í„°
      if (searchTerm) {
        companies = companies.filter(c => 
          c.companyName?.toLowerCase().includes(searchTerm)
        );
      }
      
      // ì •ë ¬
      if (currentSortType === 'name') {
        companies.sort((a, b) => (a.companyName || '').localeCompare(b.companyName || '', 'ko'));
      } else if (currentSortType === 'date') {
        companies.sort((a, b) => {
          const dateA = a.savedAt ? new Date(a.savedAt) : new Date(0);
          const dateB = b.savedAt ? new Date(b.savedAt) : new Date(0);
          return dateB - dateA;
        });
      }
      
      // ëª©ë¡ì´ ë¹„ì–´ìˆìœ¼ë©´
      if (companies.length === 0) {
        listContainer.innerHTML = '<div class="company-list-empty">' + 
          (searchTerm ? 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤' : 'ì €ì¥ëœ ê³ ê°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤') + 
          '</div>';
        return;
      }
      
      // ëª©ë¡ ë Œë”ë§
      listContainer.innerHTML = companies.map(company => {
        const isSelected = selectedCompanyId === company.id;
        const savedDate = company.savedAt ? formatDate(company.savedAt) : '';
        const meta = [company.companySize, company.ksicCode].filter(Boolean).join(' Â· ');
        
        return `
          <div class="company-item ${isSelected ? 'selected' : ''}" onclick="selectCompanyFromList('${company.id}')">
            <div class="company-item-info">
              <div class="company-item-name">${company.companyName || '(ì´ë¦„ì—†ìŒ)'}</div>
              <div class="company-item-meta">${meta}</div>
            </div>
            <div class="company-item-date">${savedDate}</div>
          </div>
        `;
      }).join('');
    }
    
    function formatDate(dateStr) {
      try {
        const date = new Date(dateStr);
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${month}.${day}`;
      } catch {
        return '';
      }
    }
    
    function filterCompanyList() {
      updateCompanyList();
    }
    
    function sortCompanyList(type) {
      currentSortType = type;
      
      // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.getElementById('sort-name').classList.toggle('active', type === 'name');
      document.getElementById('sort-date').classList.toggle('active', type === 'date');
      
      updateCompanyList();
    }
    
    function selectCompanyFromList(companyId) {
      selectedCompanyId = companyId;
      
      // ë“œë¡­ë‹¤ìš´ë„ ë™ê¸°í™”
      document.getElementById('company-select').value = companyId;
      
      // ëª©ë¡ UI ì—…ë°ì´íŠ¸
      updateCompanyList();
      
      // í¼ì— ë°ì´í„° ë¡œë“œ
      loadSelectedCompany();
    }
    
    function loadSelectedCompany() {
      const companyId = selectedCompanyId || document.getElementById('company-select').value;
      
      if (!companyId) {
        clearForm();
        return;
      }
      
      const company = savedCompanies[companyId];
      if (!company) return;
      
      // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ë¶„ë¦¬ (123-45-67890 â†’ 3ê°œ input)
      if (company.businessNumber) {
        const bizParts = company.businessNumber.split('-');
        if (bizParts.length === 3) {
          document.getElementById('business-number-1').value = bizParts[0];
          document.getElementById('business-number-2').value = bizParts[1];
          document.getElementById('business-number-3').value = bizParts[2];
        }
      }
      
      // ìˆ«ì í•„ë“œ ëª©ë¡
      const numberFieldKeys = [
        'revenueRecent', 'profitRecent', 'debtRatio',
        'employeesTotal', 'employeesYouth', 
        'employeesFemale', 'employeesDisabled', 'employmentGrowth',
        'patentsRegistered', 'exportRecent'
      ];
      
      // ëª¨ë“  í•„ë“œì— ë°ì´í„° ë¡œë“œ
      Object.keys(company).forEach(key => {
        // businessNumberëŠ” ì´ë¯¸ ì²˜ë¦¬, corpNumberëŠ” ì‚­ì œëœ í•„ë“œì´ë¯€ë¡œ ìŠ¤í‚µ
        if (key === 'businessNumber' || key === 'corpNumber') return;
        
        const element = document.getElementById(key.replace(/([A-Z])/g, '-$1').toLowerCase());
        if (element) {
          if (element.type === 'checkbox') {
            element.checked = company[key].includes(element.value);
          } else if (element.type === 'radio') {
            if (element.value === company[key]) element.checked = true;
          } else {
            // ìˆ«ì í•„ë“œëŠ” ì½¤ë§ˆ ì¶”ê°€
            if (numberFieldKeys.includes(key)) {
              element.value = formatNumber(company[key]);
            } else {
              element.value = company[key];
            }
          }
        }
      });
      
      // ì£¼ë ¥ì œí’ˆ ë¶„ë¦¬ ë¡œë“œ
      if (company.productKeywords) {
        const products = company.productKeywords.split(',').map(p => p.trim());
        for (let i = 0; i < 4; i++) {
          const el = document.getElementById('product-' + (i + 1));
          if (el) el.value = products[i] || '';
        }
      }
      
      // ì—…ë ¥ ê³„ì‚° í‘œì‹œ
      if (company.establishDate) {
        calculateBusinessAge();
      }
      
      console.log('âœ… ê³ ê°ì‚¬ ì •ë³´ ë¡œë“œ:', company.companyName);
    }
    
    async function saveCompany() {
      const companyData = collectFormData();
      
      if (!companyData.companyName) {
        alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!companyData.businessNumber) {
        alert('ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ê¸°ì¡´ ê¸°ì—… ìˆ˜ì •ì¸ì§€ ì‹ ê·œì¸ì§€ í™•ì¸
      const companyId = selectedCompanyId || Date.now().toString();
      savedCompanies[companyId] = {
        ...companyData,
        savedAt: new Date().toISOString()
      };
      
      // Google Driveì— ì•”í˜¸í™”í•˜ì—¬ ì €ì¥
      const success = await saveToDrive(savedCompanies);
      
      if (success) {
        selectedCompanyId = companyId;
        updateCompanySelect();
        alert(`âœ… "${companyData.companyName}" ì €ì¥ ì™„ë£Œ!\n\nğŸ” êµ¬ê¸€ ë“œë¼ì´ë¸Œì— AES-256 ì•”í˜¸í™”ë¡œ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        console.log('ğŸ’¾ ê³ ê°ì‚¬ ì €ì¥ ì™„ë£Œ (Google Drive + ì•”í˜¸í™”)');
      } else {
        alert('âŒ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }
    
    async function deleteCompany() {
      if (!selectedCompanyId) {
        alert('ì‚­ì œí•  ê¸°ì—…ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const company = savedCompanies[selectedCompanyId];
      if (!company) return;
      
      if (!confirm(`"${company.companyName}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      delete savedCompanies[selectedCompanyId];
      
      const success = await saveToDrive(savedCompanies);
      
      if (success) {
        selectedCompanyId = null;
        clearForm();
        updateCompanySelect();
        alert('ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        alert('âŒ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    function clearForm() {
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'checkbox' || el.type === 'radio') {
          el.checked = false;
        } else if (el.id !== 'company-search') {
          el.value = '';
        }
      });
      document.getElementById('company-select').value = '';
      selectedCompanyId = null;
      updateCompanyList();
    }
    
    // ==================== í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë§¤ì¹­ ì—”ì§„ ====================
    
    /**
     * ì—…ë ¥ ê³„ì‚° (ë…„) - AI ë¶„ì„ìš©
     */
    function getBusinessAgeYears(establishDate) {
      if (!establishDate) return 0;
      const today = new Date();
      const established = new Date(establishDate);
      const years = (today - established) / (365.25 * 24 * 60 * 60 * 1000);
      return Math.floor(years);
    }
    
    /**
     * ë‚˜ì´ ê³„ì‚°
     */
    function calculateAge(birthDate) {
      if (!birthDate) return 0;
      const today = new Date();
      const birth = new Date(birthDate);
      const age = (today - birth) / (365.25 * 24 * 60 * 60 * 1000);
      return Math.floor(age);
    }
    
    /**
     * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë§¤ì¹­ ì—”ì§„
     * ë°±ì—”ë“œ ì—†ì´ ì‘ë™í•˜ëŠ” ì§€ì›ì‚¬ì—… ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜
     */
    function clientSideMatching(companyData) {
      console.log('ğŸ¯ í´ë¼ì´ì–¸íŠ¸ ë§¤ì¹­ ì‹œì‘:', companyData.companyName);
      
      const businessAge = getBusinessAgeYears(companyData.establishDate);
      const ceoAge = calculateAge(companyData.ceoBirth);
      
      console.log(`ğŸ“Š ê¸°ì—… ì •ë³´ - ì—…ë ¥: ${businessAge}ë…„, CEO ë‚˜ì´: ${ceoAge}ì„¸`);
      
      // Step 1: Kill-Out í•„í„° (ì¦‰ì‹œ íƒˆë½)
      let eligiblePrograms = MOCK_PROGRAMS.filter(program => {
        // ì²´ë‚© ì²´í¬
        if (program.requiresNoArrears) {
          if (companyData.taxArrears === 'Y' || companyData.localTaxArrears === 'Y') {
            console.log(`âŒ ${program.name}: ì²´ë‚©ìœ¼ë¡œ ì œì™¸`);
            return false;
          }
        }
        
        // ì—…ë ¥ ìµœì†Œ ìš”ê±´
        if (program.minBusinessAge !== null && program.minBusinessAge !== undefined) {
          if (businessAge < program.minBusinessAge) {
            console.log(`âŒ ${program.name}: ìµœì†Œ ì—…ë ¥ ë¯¸ë‹¬ (í•„ìš”: ${program.minBusinessAge}ë…„, í˜„ì¬: ${businessAge}ë…„)`);
            return false;
          }
        }
        
        // ì—…ë ¥ ìµœëŒ€ ì œí•œ
        if (program.maxBusinessAge !== null && program.maxBusinessAge !== undefined) {
          if (businessAge > program.maxBusinessAge) {
            console.log(`âŒ ${program.name}: ì—…ë ¥ ì´ˆê³¼ (ìµœëŒ€: ${program.maxBusinessAge}ë…„, í˜„ì¬: ${businessAge}ë…„)`);
            return false;
          }
        }
        
        // ê¸°ì—…ê·œëª¨ ì²´í¬
        if (program.targetCompanySize && program.targetCompanySize.length > 0) {
          if (!program.targetCompanySize.includes(companyData.companySize)) {
            console.log(`âŒ ${program.name}: ê¸°ì—…ê·œëª¨ ë¶ˆì¼ì¹˜`);
            return false;
          }
        }
        
        // CEO ë‚˜ì´ ì œí•œ
        if (program.maxCeoAge !== null && program.maxCeoAge !== undefined) {
          if (ceoAge > program.maxCeoAge) {
            console.log(`âŒ ${program.name}: CEO ë‚˜ì´ ì´ˆê³¼ (ìµœëŒ€: ${program.maxCeoAge}ì„¸, í˜„ì¬: ${ceoAge}ì„¸)`);
            return false;
          }
        }
        
        return true;
      });
      
      console.log(`âœ… Kill-Out í†µê³¼: ${eligiblePrograms.length}ê°œ í”„ë¡œê·¸ë¨`);
      
      // Step 2: ë§¤ì¹­ ì ìˆ˜ ê³„ì‚° (Scoring)
      const scoredPrograms = eligiblePrograms.map(program => {
        let score = 50; // ê¸°ë³¸ ì ìˆ˜
        let reasons = [];
        
        // ì—…ì¢… ë§¤ì¹­ (ìµœëŒ€ +30ì )
        if (program.targetIndustry && program.targetIndustry.length > 0) {
          if (program.targetIndustry.includes(companyData.ksicCode)) {
            score += 30;
            reasons.push('âœ… ì—…ì¢…ì´ ì •í™•íˆ ì¼ì¹˜í•©ë‹ˆë‹¤');
          } else if (program.targetIndustry.some(code => 
            companyData.ksicCode.startsWith(code.substring(0, 2)))) {
            score += 15;
            reasons.push('âœ… ê´€ë ¨ ì—…ì¢…ì…ë‹ˆë‹¤');
          }
        } else {
          // ì „ ì—…ì¢… ëŒ€ìƒ
          score += 10;
          reasons.push('âœ… ëª¨ë“  ì—…ì¢… ì§€ì› ê°€ëŠ¥');
        }
        
        // ì¸ì¦ ê°€ì‚°ì  (ìµœëŒ€ +20ì )
        if (program.prefersVenture && companyData.certVenture === 'Y') {
          score += 10;
          reasons.push('ğŸš€ ë²¤ì²˜ê¸°ì—… ì¸ì¦ ë³´ìœ ');
        }
        if (program.prefersInnobiz && companyData.certInnobiz === 'Y') {
          score += 8;
          reasons.push('ğŸ’¡ ì´ë…¸ë¹„ì¦ˆ ì¸ì¦ ë³´ìœ ');
        }
        if (program.prefersMainbiz && companyData.certMainbiz === 'Y') {
          score += 5;
          reasons.push('â­ ë©”ì¸ë¹„ì¦ˆ ì¸ì¦ ë³´ìœ ');
        }
        
        // íŠ¹í—ˆ ê°€ì‚°ì  (ìµœëŒ€ +15ì )
        if (program.prefersPatent) {
          const patents = parseInt(companyData.patentRegistered) || 0;
          if (patents >= 10) {
            score += 15;
            reasons.push(`ğŸ“œ íŠ¹í—ˆ ${patents}ê±´ ë³´ìœ  (ê¸°ìˆ ë ¥ ìš°ìˆ˜)`);
          } else if (patents >= 5) {
            score += 10;
            reasons.push(`ğŸ“œ íŠ¹í—ˆ ${patents}ê±´ ë³´ìœ `);
          } else if (patents >= 1) {
            score += 5;
            reasons.push(`ğŸ“œ íŠ¹í—ˆ ${patents}ê±´ ë³´ìœ `);
          }
        }
        
        // ê³ ìš© ê°€ì‚°ì  (ìµœëŒ€ +20ì )
        if (program.prefersYouthEmployment && companyData.employeesTotal > 0) {
          const youthRatio = companyData.employeesYouth / companyData.employeesTotal;
          if (youthRatio >= 0.3) {
            score += 10;
            reasons.push(`ğŸ‘¥ ì²­ë…„ê³ ìš© ë¹„ìœ¨ ${Math.round(youthRatio * 100)}%`);
          } else if (youthRatio >= 0.2) {
            score += 5;
            reasons.push(`ğŸ‘¥ ì²­ë…„ê³ ìš© ë¹„ìœ¨ ${Math.round(youthRatio * 100)}%`);
          }
        }
        
        if (program.prefersFemaleEmployment && companyData.employeesTotal > 0) {
          const femaleRatio = companyData.employeesFemale / companyData.employeesTotal;
          if (femaleRatio >= 0.3) {
            score += 8;
            reasons.push(`ğŸ‘© ì—¬ì„±ê³ ìš© ë¹„ìœ¨ ${Math.round(femaleRatio * 100)}%`);
          }
        }
        
        if (companyData.employeesDisabled > 0) {
          score += 12;
          reasons.push(`â™¿ ì¥ì• ì¸ ê³ ìš© ${companyData.employeesDisabled}ëª…`);
        }
        
        // ìˆ˜ì¶œ ê°€ì‚°ì  (ìµœëŒ€ +10ì )
        if (program.prefersExport && companyData.exportRecent > 0) {
          score += 10;
          reasons.push(`ğŸŒ ìˆ˜ì¶œì‹¤ì  $${companyData.exportRecent.toLocaleString()}`);
        }
        
        // ì—°êµ¬ì¡°ì§ ê°€ì‚°ì  (ìµœëŒ€ +10ì )
        if (program.prefersRnD && companyData.researchOrg && companyData.researchOrg !== 'ì—†ìŒ') {
          score += 8;
          reasons.push(`ğŸ”¬ ${companyData.researchOrg} ë³´ìœ `);
        }
        
        // ì§€ì—­ ê°€ì‚°ì  (ìµœëŒ€ +10ì )
        if (program.targetRegion && program.targetRegion.length > 0) {
          if (program.targetRegion.includes(companyData.locationSido)) {
            score += 10;
            reasons.push(`ğŸ“ ${companyData.locationSido} ì§€ì—­ ìš°ëŒ€`);
          }
        }
        
        // ìˆ˜ë„ê¶Œ ì—¬ë¶€
        if (program.preferNonCapital && companyData.capitalArea === 'N') {
          score += 8;
          reasons.push('ğŸï¸ ë¹„ìˆ˜ë„ê¶Œ ìš°ëŒ€ì‚¬ì—…');
        }
        
        return {
          ...program,
          matchScore: Math.min(score, 100), // ìµœëŒ€ 100ì 
          matchReasons: reasons.length > 0 ? reasons : ['ê¸°ë³¸ ìš”ê±´ ì¶©ì¡±']
        };
      });
      
      // Step 3: ì ìˆ˜ìˆœ ì •ë ¬
      const sortedPrograms = scoredPrograms.sort((a, b) => b.matchScore - a.matchScore);
      
      console.log(`ğŸ¯ ìµœì¢… ì¶”ì²œ: ${sortedPrograms.length}ê°œ í”„ë¡œê·¸ë¨`);
      sortedPrograms.slice(0, 5).forEach((p, i) => {
        console.log(`  ${i + 1}ìœ„. ${p.name} (${p.matchScore}ì )`);
      });
      
      return sortedPrograms;
    }
    
    async function analyzePrograms() {
      const companyData = collectFormData();
      
      // í•„ìˆ˜ í•„ë“œ ê²€ì¦ (í•­ëª©ëª… í¬í•¨)
      const requiredFields = [
        { key: 'companyName', name: 'ê¸°ì—…ëª…' },
        { key: 'businessNumber', name: 'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸' },
        { key: 'establishDate', name: 'ê°œì—…ì—°ì›”ì¼' },
        { key: 'companySize', name: 'ê¸°ì—… ê·œëª¨' },
        { key: 'companyType', name: 'ê¸°ì—… í˜•íƒœ' },
        { key: 'ksicCode', name: 'ì—…ì¢…(KSIC)' },
        { key: 'locationSido', name: 'ì†Œì¬ì§€(ì‹œë„)' },
        { key: 'capitalArea', name: 'ìˆ˜ë„ê¶Œ ì—¬ë¶€' },
        { key: 'revenueRecent', name: 'ìµœê·¼ ë§¤ì¶œì•¡' },
        { key: 'taxArrears', name: 'êµ­ì„¸ ì²´ë‚© ì—¬ë¶€' },
        { key: 'localTaxArrears', name: 'ì§€ë°©ì„¸ ì²´ë‚© ì—¬ë¶€' },
        { key: 'employeesTotal', name: 'ìƒì‹œê·¼ë¡œì ìˆ˜' }
      ];
      
      const missingFields = requiredFields.filter(f => {
        const val = companyData[f.key];
        return val === '' || val === null || val === undefined || val === 0;
      });
      
      // í¬ë§ ì§€ì›ë¶„ì•¼ ì²´í¬
      if (!companyData.supportNeeds || companyData.supportNeeds.length === 0) {
        missingFields.push({ key: 'supportNeeds', name: 'í¬ë§ ì§€ì›ë¶„ì•¼' });
      }
      
      if (missingFields.length > 0) {
        const fieldNames = missingFields.map(f => 'â€¢ ' + f.name).join('\n');
        alert('ë‹¤ìŒ í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:\n\n' + fieldNames);
        return;
      }
      
      try {
        showLoadingOverlay('AI ë¶„ì„ ì¤‘...', 'ì§€ì›ì‚¬ì—… ë°ì´í„° ë¡œë”© ì¤‘...');
        
        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë§¤ì¹­ ì‹¤í–‰
        const results = clientSideMatching(companyData);
        
        // ì•½ê°„ì˜ ëŒ€ê¸° ì‹œê°„ (ë¡œë”© íš¨ê³¼)
        await new Promise(resolve => setTimeout(resolve, 800));
        
        hideLoadingOverlay();
        displayResults({ recommendations: results });
        
      } catch (error) {
        hideLoadingOverlay();
        console.error('âŒ ë¶„ì„ ì‹¤íŒ¨:', error);
        alert('ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n' + error.message);
      }
    }
    
    function showLoadingOverlay(title, subtitle) {
      const totalPrograms = typeof MOCK_PROGRAMS !== 'undefined' ? MOCK_PROGRAMS.length : 0;
      const overlay = document.createElement('div');
      overlay.className = 'loading-overlay';
      overlay.id = 'loading-overlay';
      overlay.innerHTML = `
        <div class="loader"></div>
        <h2>${title}</h2>
        <p>${subtitle}</p>
        <p id="program-count" style="font-size: 0.75rem; color: #ffd27f; margin-top: 0.5rem;">ğŸ“‹ ${totalPrograms}ê°œ ê³µê³  ë¶„ì„ ì¤‘...</p>
        <div style="width: 200px; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; margin-top: 0.5rem; overflow: hidden;">
          <div id="progress-bar" style="width: 0%; height: 100%; background: #FF8802; border-radius: 3px; transition: width 0.3s;"></div>
        </div>
        <p id="progress-text" style="font-size: 0.8rem; margin-top: 0.5rem;">0%</p>
      `;
      document.body.appendChild(overlay);
      
      // ì§„í–‰ìœ¨ ì• ë‹ˆë©”ì´ì…˜
      let progress = 0;
      let analyzed = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        analyzed = Math.min(Math.floor(progress / 100 * totalPrograms), totalPrograms);
        if (progress > 90) progress = 90;
        updateProgress(progress, analyzed, totalPrograms);
        if (progress >= 90) clearInterval(progressInterval);
      }, 200);
      
      overlay.progressInterval = progressInterval;
    }
    
    function updateProgress(percent, analyzed, total) {
      const bar = document.getElementById('progress-bar');
      const text = document.getElementById('progress-text');
      const countText = document.getElementById('program-count');
      if (bar) bar.style.width = percent + '%';
      if (text) text.textContent = Math.round(percent) + '%';
      if (countText && analyzed !== undefined) {
        countText.textContent = `ğŸ“‹ ${analyzed || 0}/${total || 0}ê°œ ê³µê³  ë¶„ì„ ì™„ë£Œ`;
      }
    }
    
    function hideLoadingOverlay() {
      const overlay = document.getElementById('loading-overlay');
      if (overlay) {
        if (overlay.progressInterval) clearInterval(overlay.progressInterval);
        const totalPrograms = typeof MOCK_PROGRAMS !== 'undefined' ? MOCK_PROGRAMS.length : 0;
        updateProgress(100, totalPrograms, totalPrograms);
        setTimeout(() => overlay.remove(), 300);
      }
    }
    
    function displayResults(result) {
      const section = document.getElementById('results-section');
      
      if (!result.recommendations || result.recommendations.length === 0) {
        section.innerHTML = `
          <div class="card">
            <h2>ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>
            <div style="text-align: center; padding: 3rem; color: #666;">
              <p style="font-size: 1.2rem; margin-bottom: 1rem;">í˜„ì¬ ì¡°ê±´ì— ë§ëŠ” ì§€ì›ì‚¬ì—…ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
              <p>â€¢ ì…ë ¥ ì •ë³´ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”</p>
              <p>â€¢ ë˜ëŠ” ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš” (1357-1357)</p>
            </div>
          </div>
        `;
        section.style.display = 'block';
        section.scrollIntoView({ behavior: 'smooth' });
        return;
      }
      
      let html = `
        <div class="card">
          <h2>ğŸ“Š ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… ì¶”ì²œ ê²°ê³¼</h2>
          <p style="color: #666; margin-top: 0.5rem;">
            ì´ <strong style="color: #FF8802;">${result.recommendations.length}ê°œ</strong>ì˜ ì§€ì›ì‚¬ì—…ì´ ê·€ì‚¬ì— ì í•©í•©ë‹ˆë‹¤.
          </p>
        </div>
      `;
      
      result.recommendations.forEach((rec, index) => {
        const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
        const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : '';
        
        html += `
          <div class="result-card ${rankClass}">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
              <span class="rank">${rankEmoji} ${index + 1}ìœ„</span>
              <span class="match-score" style="font-size: 1.1rem; font-weight: bold;">ë§¤ì¹­ë„: ${rec.matchScore}ì </span>
            </div>
            
            <h3 style="color: #0c2c54; margin-bottom: 0.5rem;">${rec.name}</h3>
            <p style="color:#666;font-size:0.9rem;margin-bottom:0.75rem;">
              <strong>ì£¼ê´€:</strong> ${rec.organization} | 
              <strong>ë¶„ì•¼:</strong> ${rec.category}
            </p>
            
            <div style="margin-top:1rem;padding-top:1rem;border-top:2px solid #e0e0e0;">
              <h4 style="color:#0c2c54;margin-bottom:0.75rem;font-size:1.05rem;">ğŸ¯ ì¶”ì²œ ì´ìœ </h4>
              <ul style="color:#555;line-height:1.8;padding-left:1.5rem;margin-bottom:1.5rem;">
                ${rec.matchReasons.map(reason => `<li>${reason}</li>`).join('')}
              </ul>
              
              <h4 style="color:#0c2c54;margin-bottom:0.75rem;font-size:1.05rem;">ğŸ’° ì§€ì› ë‚´ìš©</h4>
              <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color:#333;margin-bottom:0.5rem;"><strong>ì§€ì› ê·œëª¨:</strong> ${rec.budget}</p>
                <p style="color:#555;line-height:1.6;margin:0;">${rec.description}</p>
              </div>
              
              <div style="display:flex;gap:0.75rem;margin-top:1rem;">
                <a href="${rec.website}" target="_blank" 
                   style="display:inline-block;padding:0.7rem 1.5rem;background:#FF8802;color:white;text-decoration:none;border-radius:8px;font-weight:600;font-size:0.95rem;transition:all 0.3s;">
                  ğŸ“‹ ìƒì„¸ë³´ê¸° â†’
                </a>
                <button onclick="alert('ìƒë‹´ ì˜ˆì•½ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')"
                        style="display:inline-block;padding:0.7rem 1.5rem;background:#fff;color:#0c2c54;border:2px solid #0c2c54;border-radius:8px;font-weight:600;font-size:0.95rem;cursor:pointer;transition:all 0.3s;">
                  ğŸ“ ìƒë‹´ ì˜ˆì•½
                </button>
              </div>
            </div>
          </div>
        `;
      });
      
      section.innerHTML = html;
      section.style.display = 'block';
      section.scrollIntoView({ behavior: 'smooth' });
    }
    
    function goHome() {
      window.location.href = 'https://ceofocus123.netlify.app/index.html';
    }
    
    
    // ==================== ì‹œêµ°êµ¬ ë° ìˆ˜ë„ê¶Œ ìë™ ì„¤ì • ====================
    
    // ì‹œë„ë³„ ì‹œêµ°êµ¬ ë°ì´í„°
    const SIGUNGU_DATA = {
      'ì„œìš¸': ['ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ìš©ì‚°êµ¬', 'ì„±ë™êµ¬', 'ê´‘ì§„êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ì¤‘ë‘êµ¬', 'ì„±ë¶êµ¬', 'ê°•ë¶êµ¬', 'ë„ë´‰êµ¬', 'ë…¸ì›êµ¬', 'ì€í‰êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ë§ˆí¬êµ¬', 'ì–‘ì²œêµ¬', 'ê°•ì„œêµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ë™ì‘êµ¬', 'ê´€ì•…êµ¬', 'ì„œì´ˆêµ¬', 'ê°•ë‚¨êµ¬', 'ì†¡íŒŒêµ¬', 'ê°•ë™êµ¬'],
      'ê²½ê¸°': ['ìˆ˜ì›ì‹œ', 'ì„±ë‚¨ì‹œ', 'ê³ ì–‘ì‹œ', 'ìš©ì¸ì‹œ', 'ë¶€ì²œì‹œ', 'ì•ˆì‚°ì‹œ', 'ì•ˆì–‘ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'í™”ì„±ì‹œ', 'í‰íƒì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ì‹œí¥ì‹œ', 'íŒŒì£¼ì‹œ', 'ê¹€í¬ì‹œ', 'ê´‘ëª…ì‹œ', 'ê´‘ì£¼ì‹œ', 'êµ°í¬ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì–‘ì£¼ì‹œ', 'ì´ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ì•ˆì„±ì‹œ', 'í¬ì²œì‹œ', 'ì˜ì™•ì‹œ', 'ì–‘í‰êµ°', 'ì—¬ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ê³¼ì²œì‹œ', 'ê°€í‰êµ°', 'ì—°ì²œêµ°'],
      'ì¸ì²œ': ['ì¤‘êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ì—°ìˆ˜êµ¬', 'ë‚¨ë™êµ¬', 'ë¶€í‰êµ¬', 'ê³„ì–‘êµ¬', 'ì„œêµ¬', 'ê°•í™”êµ°', 'ì˜¹ì§„êµ°'],
      'ë¶€ì‚°': ['ì¤‘êµ¬', 'ì„œêµ¬', 'ë™êµ¬', 'ì˜ë„êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë™ë˜êµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'í•´ìš´ëŒ€êµ¬', 'ì‚¬í•˜êµ¬', 'ê¸ˆì •êµ¬', 'ê°•ì„œêµ¬', 'ì—°ì œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì‚¬ìƒêµ¬', 'ê¸°ì¥êµ°'],
      'ëŒ€êµ¬': ['ì¤‘êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°'],
      'ëŒ€ì „': ['ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬'],
      'ê´‘ì£¼': ['ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬'],
      'ìš¸ì‚°': ['ì¤‘êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°'],
      'ì„¸ì¢…': ['ì„¸ì¢…ì‹œ'],
      'ê°•ì›': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
      'ì¶©ë¶': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
      'ì¶©ë‚¨': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
      'ì „ë¶': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
      'ì „ë‚¨': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
      'ê²½ë¶': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
      'ê²½ë‚¨': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
      'ì œì£¼': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
    };
    
    // ì‹œë„ ì„ íƒ ì‹œ ì‹œêµ°êµ¬ ì˜µì…˜ ì—…ë°ì´íŠ¸ ë° ìˆ˜ë„ê¶Œ ìë™ ì„¤ì •
    function updateSigunguOptions() {
      const sidoSelect = document.getElementById('location-sido');
      const sigunguSelect = document.getElementById('location-sigungu');
      const capitalAreaSelect = document.getElementById('capital-area');
      
      const selectedSido = sidoSelect.value;
      
      // ì‹œêµ°êµ¬ ì´ˆê¸°í™”
      sigunguSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
      
      if (selectedSido && SIGUNGU_DATA[selectedSido]) {
        // ì‹œêµ°êµ¬ ì˜µì…˜ ì¶”ê°€
        SIGUNGU_DATA[selectedSido].forEach(sigungu => {
          const option = document.createElement('option');
          option.value = sigungu;
          option.textContent = sigungu;
          sigunguSelect.appendChild(option);
        });
        sigunguSelect.disabled = false;
        
        // ìˆ˜ë„ê¶Œ ì—¬ë¶€ ìë™ ì„¤ì •
        if (selectedSido === 'ì„œìš¸' || selectedSido === 'ê²½ê¸°' || selectedSido === 'ì¸ì²œ') {
          capitalAreaSelect.value = 'Y';
        } else {
          capitalAreaSelect.value = 'N';
        }
        capitalAreaSelect.disabled = true; // ìë™ ì„¤ì •ì´ë¯€ë¡œ ë¹„í™œì„±í™”
      } else {
        sigunguSelect.innerHTML = '<option value="">ì‹œë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
        sigunguSelect.disabled = true;
        capitalAreaSelect.value = '';
        capitalAreaSelect.disabled = true;
      }
    }
    
    // ì´ˆê¸°í™” í•¨ìˆ˜ ìˆ˜ì •
    const originalInit = window.addEventListener;
    window.addEventListener('load', function(event) {
      initializeApp();
    });
    
  </script>

  <!-- ============================================ -->
  <!-- AI ë¶„ì„ ì„¹ì…˜ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€, ì¶”ê°€ë§Œ í•¨) -->
  <!-- ============================================ -->
  
  <div class="card" id="aiAnalysisSection" style="margin-top: 2rem;">
    <h2 style="color: #FFD700; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
      ğŸ¤– AI ì§€ì›ì‚¬ì—… ë§¤ì¹­ ë¶„ì„
      <span style="font-size: 0.7em; color: rgba(255,255,255,0.7); font-weight: normal;">
        (ê¸°ì—…ë§ˆë‹¹ 500ê°œ ê³µê³  Ã— Gemini AI)
      </span>
    </h2>
    
    <div class="info-notice" style="background: rgba(255, 136, 2, 0.2); border: 2px solid #FF8802; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
      <p style="margin: 0; font-size: 0.95rem;">
        ğŸ’¡ <strong>ì•ˆë‚´:</strong> ìœ„ì— ì…ë ¥í•œ ê¸°ì—… ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì—…ë§ˆë‹¹ 500ê°œ ê³µê³ ë¥¼ AIê°€ ìë™ ë¶„ì„í•©ë‹ˆë‹¤. 
        ì•½ 15ì´ˆ ì†Œìš”ë©ë‹ˆë‹¤.
      </p>
    </div>
    
    <button 
      id="aiAnalyzeBtn"
      onclick="startAIAnalysis()" 
      class="btn btn-primary" 
      style="width: 100%; font-size: 1.2rem; padding: 1.2rem;">
      ğŸš€ AI ë¶„ì„ ì‹œì‘ (500ê°œ ê³µê³  ë¶„ì„)
    </button>
    
    <!-- ë¡œë”© í‘œì‹œ -->
    <div id="aiLoadingSection" style="display: none; text-align: center; padding: 2rem;">
      <div class="loader" style="margin: 0 auto;"></div>
      <p id="aiLoadingText" style="margin-top: 1rem; font-size: 1.1rem;">ê¸°ì—…ë§ˆë‹¹ API ì¡°íšŒ ì¤‘...</p>
      <p id="aiLoadingDetail" style="margin-top: 0.5rem; color: rgba(255,255,255,0.7); font-size: 0.9rem;"></p>
    </div>
    
    <!-- ê²°ê³¼ í‘œì‹œ -->
    <div id="aiResultsSection" style="display: none; margin-top: 2rem;">
      <h3 style="color: #FFD700; margin-bottom: 1rem; font-size: 1.5rem;">
        ğŸ¯ AI ë¶„ì„ ê²°ê³¼ (ìƒìœ„ 20ê°œ)
      </h3>
      <div id="aiResultsList"></div>
    </div>
  </div>

  <script>
    // ============================================
    // AI ë¶„ì„ ë©”ì¸ í•¨ìˆ˜
    // ============================================
    async function startAIAnalysis() {
      try {
        const btn = document.getElementById('aiAnalyzeBtn');
        const loadingSection = document.getElementById('aiLoadingSection');
        const resultsSection = document.getElementById('aiResultsSection');
        
        // ë²„íŠ¼ ë¹„í™œì„±í™”
        btn.disabled = true;
        btn.textContent = 'ë¶„ì„ ì¤‘...';
        
        // ë¡œë”© í‘œì‹œ
        loadingSection.style.display = 'block';
        resultsSection.style.display = 'none';
        
        // ê¸°ì—… ë°ì´í„° ìˆ˜ì§‘
        const companyData = collectCompanyDataForAI();
        
        // í•„ìˆ˜ í•„ë“œ ê²€ì¦
        if (!validateCompanyData(companyData)) {
          alert('í•„ìˆ˜ í•­ëª©(*)ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\níŠ¹íˆ ë‹¤ìŒ í•­ëª©ì„ í™•ì¸í•˜ì„¸ìš”:\n- ê¸°ì—…ëª…\n- ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸\n- ê°œì—…ì—°ì›”ì¼\n- ê¸°ì—… ê·œëª¨\n- ìƒì‹œê·¼ë¡œì ìˆ˜\n- ìµœê·¼ ë§¤ì¶œì•¡');
          btn.disabled = false;
          btn.textContent = 'ğŸš€ AI ë¶„ì„ ì‹œì‘ (500ê°œ ê³µê³  ë¶„ì„)';
          loadingSection.style.display = 'none';
          return;
        }
        
        updateAILoading('ê¸°ì—…ë§ˆë‹¹ API ì¡°íšŒ ì¤‘...', '500ê°œ ê³µê³  ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        
        // Step 1: ê¸°ì—…ë§ˆë‹¹ API ì¡°íšŒ
        const response1 = await fetch('/.netlify/functions/getBizinfoPrograms', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ filters: {} })
        });
        
        if (!response1.ok) {
          throw new Error('ê¸°ì—…ë§ˆë‹¹ API ì¡°íšŒ ì‹¤íŒ¨');
        }
        
        const data1 = await response1.json();
        const programs = data1.programs || [];
        
        updateAILoading('Gemini AI ë¶„ì„ ì¤‘...', `${programs.length}ê°œ ê³µê³ ì™€ ê¸°ì—… ì •ë³´ ë§¤ì¹­ ì¤‘...`);
        
        // Step 2: AI ë§¤ì¹­ ë¶„ì„
        const response2 = await fetch('/.netlify/functions/analyzeCompanyMatch', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            companyData: companyData,
            programs: programs
          })
        });
        
        if (!response2.ok) {
          throw new Error('AI ë¶„ì„ ì‹¤íŒ¨');
        }
        
        const data2 = await response2.json();
        const matchedPrograms = data2.matchedPrograms || [];
        
        // ê²°ê³¼ í‘œì‹œ
        displayAIResults(matchedPrograms);
        
        // ë³µêµ¬
        btn.disabled = false;
        btn.textContent = 'ğŸš€ AI ë¶„ì„ ì‹œì‘ (500ê°œ ê³µê³  ë¶„ì„)';
        loadingSection.style.display = 'none';
        
        // ìŠ¤í¬ë¡¤
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
      } catch (error) {
        console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
        alert('AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' + error.message + '\n\në„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        
        document.getElementById('aiAnalyzeBtn').disabled = false;
        document.getElementById('aiAnalyzeBtn').textContent = 'ğŸš€ AI ë¶„ì„ ì‹œì‘ (500ê°œ ê³µê³  ë¶„ì„)';
        document.getElementById('aiLoadingSection').style.display = 'none';
      }
    }
    
    // ============================================
    // ê¸°ì—… ë°ì´í„° ìˆ˜ì§‘ (ê¸°ì¡´ í¼ì˜ ëª¨ë“  í•„ë“œ)
    // ============================================
    function collectCompanyDataForAI() {
      // ê°œì—…ì—°ì›”ì¼ì—ì„œ ì—…ë ¥ ê³„ì‚°
      const foundedDateStr = document.getElementById('establish-date')?.value || '';
      let businessAge = 0;
      let foundedYear = 0;
      
      if (foundedDateStr) {
        const foundedDate = new Date(foundedDateStr);
        foundedYear = foundedDate.getFullYear();
        const today = new Date();
        businessAge = today.getFullYear() - foundedYear;
      }
      
      // ì§ì›ìˆ˜ ê³„ì‚°
      const employees = parseInt(document.getElementById('employees-total')?.value) || 0;
      const youthEmployees = parseInt(document.getElementById('employees-youth')?.value) || 0;
      const femaleEmployees = parseInt(document.getElementById('employees-female')?.value) || 0;
      
      const youthRatio = employees > 0 ? (youthEmployees / employees * 100).toFixed(1) : 0;
      const femaleRatio = employees > 0 ? (femaleEmployees / employees * 100).toFixed(1) : 0;
      
      // ë§¤ì¶œì•¡ (ì–µì› â†’ ì›)
      const revenue = (parseFloat(document.getElementById('revenue-recent')?.value) || 0) * 100000000;
      
      // ì‚¬ì—…ìë²ˆí˜¸ ì¡°í•©
      const bizNum1 = document.getElementById('business-number-1')?.value || '';
      const bizNum2 = document.getElementById('business-number-2')?.value || '';
      const bizNum3 = document.getElementById('business-number-3')?.value || '';
      const businessNumber = bizNum1 && bizNum2 && bizNum3 ? `${bizNum1}-${bizNum2}-${bizNum3}` : '';
      
      return {
        // ê¸°ë³¸ ì •ë³´
        companyName: document.getElementById('company-name')?.value || '',
        businessNumber: businessNumber,
        foundedYear: foundedYear,
        businessAge: businessAge,
        
        // ë¶„ë¥˜
        companySize: document.getElementById('company-size')?.value || '',
        companyType: document.getElementById('company-type')?.value || '',
        businessStatus: document.getElementById('business-status')?.value || 'ìš´ì˜ì¤‘',
        industry: document.getElementById('ksic-code')?.value || '',
        
        // ì†Œì¬ì§€
        region: document.getElementById('location-sido')?.value || '',
        sigungu: document.getElementById('location-sigungu')?.value || '',
        isMetro: document.getElementById('capital-area')?.value === 'Y',
        
        // ëŒ€í‘œì
        ceoGender: document.getElementById('ceo-gender')?.value || '',
        ceoBirthYear: document.getElementById('ceo-birth')?.value || '',
        
        // ì¬ë¬´
        revenue: revenue,
        debtRatio: parseFloat(document.getElementById('debt-ratio')?.value) || 0,
        
        // ê²°ê²©ì‚¬ìœ 
        hasTaxArrears: document.getElementById('tax-arrears')?.value === 'Y',
        hasLocalTaxArrears: document.getElementById('local-tax-arrears')?.value === 'Y',
        hasCapitalErosion: document.getElementById('capital-erosion')?.value === 'Y',
        
        // ê³ ìš©
        employees: employees,
        youthEmployees: youthEmployees,
        femaleEmployees: femaleEmployees,
        disabledEmployees: parseInt(document.getElementById('employees-disabled')?.value) || 0,
        youthRatio: parseFloat(youthRatio),
        femaleRatio: parseFloat(femaleRatio),
        employmentGrowth: parseFloat(document.getElementById('employment-growth')?.value) || 0,
        
        // ì¸ì¦
        hasVenture: document.getElementById('cert-venture')?.value === 'Y',
        hasInnobiz: document.getElementById('cert-innobiz')?.value === 'Y',
        hasMainbiz: document.getElementById('cert-mainbiz')?.value === 'Y',
        hasWomanCert: document.getElementById('cert-woman')?.value === 'Y',
        hasDisabledCert: document.getElementById('cert-disabled')?.value === 'Y',
        hasSocialCert: document.getElementById('cert-social')?.value === 'Y',
        hasESG: document.getElementById('esg-status')?.value === 'Y',
        
        // ê¸°ìˆ 
        patentCount: parseInt(document.getElementById('patents-registered')?.value) || 0,
        researchOrg: document.getElementById('research-org')?.value || '',
        tcbRating: document.getElementById('tcb-rating')?.value || '',
        
        // ìˆ˜ì¶œ
        exportAmount: parseFloat(document.getElementById('export-recent')?.value) || 0,
        exportCountries: document.getElementById('export-countries')?.value || '',
        
        // í¬ë§ ì§€ì›ë¶„ì•¼
        desiredSupports: getDesiredSupports()
      };
    }
    
    // ============================================
    // í¬ë§ ì§€ì›ë¶„ì•¼ ìˆ˜ì§‘
    // ============================================
    function getDesiredSupports() {
      const supports = [];
      const checkboxes = document.querySelectorAll('input[name="desiredSupport"]:checked');
      checkboxes.forEach(cb => {
        supports.push(cb.value);
      });
      return supports;
    }
    
    // ============================================
    // í•„ìˆ˜ í•„ë“œ ê²€ì¦
    // ============================================
    function validateCompanyData(data) {
      if (!data.companyName) return false;
      if (!data.businessNumber) return false;
      if (!data.foundedYear || data.foundedYear === 0) return false;
      if (!data.companySize) return false;
      if (!data.employees || data.employees === 0) return false;
      if (data.revenue === 0) return false;
      return true;
    }
    
    // ============================================
    // ë¡œë”© ì—…ë°ì´íŠ¸
    // ============================================
    function updateAILoading(text, detail) {
      document.getElementById('aiLoadingText').textContent = text;
      document.getElementById('aiLoadingDetail').textContent = detail;
    }
    
    // ============================================
    // ê²°ê³¼ í‘œì‹œ
    // ============================================
    function displayAIResults(programs) {
      const resultsSection = document.getElementById('aiResultsSection');
      const resultsList = document.getElementById('aiResultsList');
      
      resultsList.innerHTML = '';
      
      if (programs.length === 0) {
        resultsList.innerHTML = `
          <div style="text-align: center; padding: 3rem; background: rgba(255,255,255,0.1); border-radius: 12px;">
            <p style="font-size: 1.2rem; margin-bottom: 1rem;">ğŸ˜”</p>
            <p style="font-size: 1.1rem;">ë§¤ì¹­ë˜ëŠ” ì§€ì›ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem; color: rgba(255,255,255,0.7);">
              ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹œê±°ë‚˜ ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.
            </p>
          </div>
        `;
        resultsSection.style.display = 'block';
        return;
      }
      
      const top20 = programs.slice(0, 20);
      
      top20.forEach((program, index) => {
        const item = document.createElement('div');
        item.className = 'card';
        item.style.cssText = 'background: rgba(255,255,255,0.15); margin-bottom: 1rem; border-left: 5px solid #FF8802; transition: all 0.3s;';
        
        item.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
            <div style="flex: 1; min-width: 200px;">
              <h4 style="color: #FFD700; font-size: 1.3rem; margin-bottom: 0.5rem;">
                ${index + 1}. ${program.name || 'ì œëª© ì—†ìŒ'}
              </h4>
              <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                <span>ğŸ¢ ${program.organization || 'ë¯¸ìƒ'}</span>
                <span>ğŸ“‚ ${program.category || 'ê¸°íƒ€'}</span>
                <span>ğŸ“… ${program.reqstPeriod || 'ìƒì‹œ'}</span>
              </div>
            </div>
            <div style="background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%); color: white; padding: 0.5rem 1.5rem; border-radius: 20px; font-weight: bold; font-size: 1.2rem; white-space: nowrap;">
              ${program.matchScore || 0}ì 
            </div>
          </div>
          
          ${program.description ? `
            <p style="margin-bottom: 1rem; line-height: 1.6; color: rgba(255,255,255,0.9);">
              ${program.description.substring(0, 200)}...
            </p>
          ` : ''}
          
          ${program.matchReasons && program.matchReasons.length > 0 ? `
            <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
              <strong style="color: #FFD700; display: block; margin-bottom: 0.5rem;">âœ… ë§¤ì¹­ ê·¼ê±°:</strong>
              <ul style="margin-left: 1.5rem; line-height: 1.8;">
                ${program.matchReasons.map(r => `<li>${r}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          ${program.strengths && program.strengths.length > 0 ? `
            <div style="background: rgba(52, 211, 153, 0.2); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 3px solid #34d399;">
              <strong style="color: #34d399; display: block; margin-bottom: 0.5rem;">ğŸ’ª ê°•ì :</strong>
              <ul style="margin-left: 1.5rem; line-height: 1.8;">
                ${program.strengths.map(s => `<li>${s}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          ${program.weaknesses && program.weaknesses.length > 0 ? `
            <div style="background: rgba(251, 191, 36, 0.2); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 3px solid #fbbf24;">
              <strong style="color: #fbbf24; display: block; margin-bottom: 0.5rem;">âš ï¸ ì•½ì /ì£¼ì˜ì‚¬í•­:</strong>
              <ul style="margin-left: 1.5rem; line-height: 1.8;">
                ${program.weaknesses.map(w => `<li>${w}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <button 
              onclick="window.open('${program.website}', '_blank')" 
              class="btn btn-secondary"
              style="padding: 0.6rem 1.2rem; font-size: 0.9rem;">
              ğŸ“„ ê³µê³ ë¬¸ ë³´ê¸°
            </button>
            ${program.applicationUrl ? `
              <button 
                onclick="window.open('${program.applicationUrl}', '_blank')" 
                class="btn btn-secondary"
                style="padding: 0.6rem 1.2rem; font-size: 0.9rem;">
                âœï¸ ì‹ ì²­í•˜ê¸°
              </button>
            ` : ''}
          </div>
        `;
        
        // í˜¸ë²„ íš¨ê³¼
        item.addEventListener('mouseenter', function() {
          this.style.background = 'rgba(255,255,255,0.2)';
          this.style.transform = 'translateX(5px)';
        });
        item.addEventListener('mouseleave', function() {
          this.style.background = 'rgba(255,255,255,0.15)';
          this.style.transform = 'translateX(0)';
        });
        
        resultsList.appendChild(item);
      });
      
      resultsSection.style.display = 'block';
    }
  </script>

</body>
</html>
