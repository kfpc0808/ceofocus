<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­ - KFPC</title>
  
  <!-- CryptoJS for AES-256 encryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
  
  <!-- Google API for Drive -->
  <script src="https://apis.google.com/js/api.js"></script>
  
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client"></script>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      color: #fff;
      min-height: 100vh;
      -webkit-overflow-scrolling: touch;
      font-size: 14px;
    }
    
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.3s;
    }
    
    .loading-screen.hide {
      opacity: 0;
      pointer-events: none;
    }
    
    .loader {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: #FF8802;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 0.75rem;
      font-size: 0.95rem;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0.75rem;
    }
    
    .btn-main {
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .btn-main.btn-small {
      padding: 0.35rem 0.5rem;
      font-size: 0.6rem;
    }
    
    .btn-main:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .header-left {
      position: static;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-shrink: 0;
    }
    
    .header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      padding: 0.8rem 0.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    .header h1 {
      font-size: 1.1rem;
      margin: 0;
      flex: 1;
      text-align: center;
      min-width: 200px;
    }
    
    .header .btn-main {
      flex-shrink: 0;
    }
    
    /* ëª¨ë°”ì¼ í—¤ë” */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
        padding: 0.5rem;
      }
      
      .header-left {
        order: 2;
        justify-content: center;
        width: 100%;
      }
      
      .header h1 {
        order: 1;
        font-size: 1rem;
        text-align: center;
      }
      
      .header > .btn-main {
        order: 3;
        width: 100%;
        text-align: center;
      }
    }
    
    /* ì£¼ë ¥ì œí’ˆ ê·¸ë¦¬ë“œ */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.3rem;
    }
    
    .product-grid input {
      padding: 0.4rem 0.5rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 12px;
    }
    
    @media (min-width: 600px) {
      .product-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    /* ë¯¸ë‹ˆ ë²„íŠ¼ */
    .btn-mini {
      padding: 0.4rem 0.5rem;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.15);
      color: white;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .btn-mini:hover {
      background: rgba(255,255,255,0.25);
    }
    
    /* ì†ì‹¤ ì²´í¬ë°•ìŠ¤ */
    .loss-checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.2rem;
      cursor: pointer;
      user-select: none;
    }
    
    .loss-checkbox-label input {
      display: none;
    }
    
    .loss-checkbox-box {
      width: 20px;
      height: 20px;
      border: 2px solid #ff6b6b;
      border-radius: 4px;
      background: rgba(255,255,255,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: transparent;
      transition: all 0.2s;
    }
    
    .loss-checkbox-label input:checked + .loss-checkbox-box {
      background: #ff6b6b;
      color: white;
    }
    
    .loss-checkbox-text {
      font-size: 0.7rem;
      color: #ff6b6b;
      font-weight: 600;
    }
    
    .required-notice {
      background: rgba(255, 136, 2, 0.2);
      border: 1px solid #FF8802;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.75rem;
      text-align: center;
      font-size: 0.8rem;
    }
    
    .required-notice strong {
      color: #FFD700;
      font-size: 0.85rem;
    }
    
    .btn {
      padding: 0.6rem 1rem;
      border-radius: 8px;
      border: none;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 40px;
      user-select: none;
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #FF9933 0%, #FF8020 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(255,136,2,0.25);
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.15);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    /* ì»´íŒ©íŠ¸ ì¹´ë“œ */
    .card {
      background: rgba(255,255,255,0.12);
      border-radius: 10px;
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .card h2 {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
      color: #ffd27f;
      padding-bottom: 0.4rem;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .section-info-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: rgba(255, 210, 127, 0.2);
      border: 1px solid #ffd27f;
      border-radius: 50%;
      font-size: 0.7rem;
      font-weight: 700;
      color: #ffd27f;
      cursor: help;
      flex-shrink: 0;
    }
    
    .section-info-tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      left: 25px;
      top: -8px;
      background: rgba(20, 40, 70, 0.98);
      color: #fff;
      padding: 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 400;
      line-height: 1.4;
      white-space: nowrap;
      z-index: 1000;
      border: 1px solid rgba(255, 210, 127, 0.3);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      pointer-events: none;
    }
    
    .section-info-tooltip::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 50%;
      transform: translateY(-50%);
      border-width: 5px;
      border-style: solid;
      border-color: transparent rgba(20, 40, 70, 0.98) transparent transparent;
    }
    
    .section-info-icon:hover .section-info-tooltip {
      visibility: visible;
      opacity: 1;
    }
    
    .card h3 {
      font-size: 0.85rem;
      margin: 0.6rem 0 0.4rem 0;
      color: #ffd27f;
      padding-bottom: 0.25rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    /* ì»´íŒ©íŠ¸ í¼ ê·¸ë¦¬ë“œ - ëª¨ë°”ì¼ì—ì„œë„ 2ì—´ */
    .form-grid {
      display: grid;
      gap: 0.4rem;
      grid-template-columns: repeat(2, 1fr);
    }
    
    .form-grid .full-width {
      grid-column: 1 / -1;
    }
    
    @media (min-width: 600px) {
      .form-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 900px) {
      .form-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (min-width: 1200px) {
      .form-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    
    /* ì»´íŒ©íŠ¸ í¼ ê·¸ë£¹ */
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group label {
      font-size: 0.72rem;
      font-weight: 600;
      margin-bottom: 0.15rem;
      color: #ffd27f;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .required {
      color: #FF8802;
      font-weight: 700;
    }
    
    /* ì»´íŒ©íŠ¸ ì¸í’‹ */
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.45rem 0.5rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 13px;
      -webkit-appearance: none;
      appearance: none;
      min-height: 32px;
    }
    
    .form-group select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      padding-right: 1.8rem;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #FF8802;
      box-shadow: 0 0 0 2px rgba(255, 136, 2, 0.2);
    }
    
    .form-group textarea {
      min-height: 50px;
      resize: vertical;
      font-family: inherit;
    }
    
    /* ì»´íŒ©íŠ¸ ì²´í¬ë°•ìŠ¤ ê·¸ë¦¬ë“œ */
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.3rem;
    }
    
    @media (min-width: 480px) {
      .checkbox-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 768px) {
      .checkbox-grid {
        grid-template-columns: repeat(5, 1fr);
      }
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 0.35rem 0.5rem;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 32px;
    }
    
    .checkbox-item:active {
      background: rgba(255,255,255,0.2);
    }
    
    .checkbox-item input[type="checkbox"],
    .checkbox-item input[type="radio"] {
      width: 16px;
      height: 16px;
      margin-right: 0.35rem;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255,255,255,0.9);
      border: 1.5px solid rgba(255,255,255,0.5);
      border-radius: 3px;
      position: relative;
      flex-shrink: 0;
    }
    
    .checkbox-item input[type="radio"] {
      border-radius: 50%;
    }
    
    .checkbox-item input:checked {
      background: #FF8802;
      border-color: #FF8802;
    }
    
    .checkbox-item input:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 11px;
      font-weight: bold;
    }
    
    .checkbox-item label {
      font-size: 0.72rem;
      cursor: pointer;
      margin: 0;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(12, 44, 84, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    
    .loading-overlay .loader {
      width: 50px;
      height: 50px;
    }
    
    .loading-overlay h2 {
      margin-top: 1rem;
      font-size: 1.1rem;
    }
    
    .loading-overlay p {
      margin-top: 0.3rem;
      font-size: 0.85rem;
      opacity: 0.8;
    }
    
    .result-card {
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 10px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .result-card .rank {
      display: inline-block;
      background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
    }
    
    .result-card h3 {
      font-size: 1rem;
      color: #0c2c54;
      margin-bottom: 0.3rem;
      line-height: 1.3;
      border: none;
      padding: 0;
    }
    
    .match-score {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-weight: 700;
      margin-bottom: 0.5rem;
      font-size: 0.8rem;
    }
    
    /* ì»´íŒ©íŠ¸ info-text */
    .info-text {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.1rem;
      font-style: italic;
      line-height: 1.2;
    }
    
    /* ëª¨ë°”ì¼ ì¶”ê°€ ìµœì í™” */
    @media (max-width: 479px) {
      .container {
        padding: 0.5rem;
      }
      .header h1 {
        font-size: 1.1rem;
        padding-right: 70px;
      }
      .card {
        padding: 0.5rem;
        border-radius: 8px;
      }
      .card h2 {
        font-size: 0.9rem;
      }
    }
    
    /* PC ìµœì í™” */
    @media (min-width: 1024px) {
      .container {
        padding: 1rem;
      }
      .card {
        padding: 0.85rem;
      }
      .form-grid {
        gap: 0.5rem;
      }
      .form-group label {
        font-size: 0.78rem;
      }
      .form-group input,
      .form-group select {
        padding: 0.5rem 0.6rem;
        font-size: 14px;
        min-height: 36px;
      }
      .checkbox-item {
        padding: 0.45rem 0.6rem;
        min-height: 36px;
      }
      .checkbox-item label {
        font-size: 0.78rem;
      }
    }
    
    /* ë²„íŠ¼ 1í–‰ ê³ ì • */
    button, .btn-primary, .btn-secondary {
      white-space: nowrap !important;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* ê³ ê°ì‚¬ ëª©ë¡ ìŠ¤íƒ€ì¼ */
    .company-list-controls {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .search-box input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.95);
      color: #333;
      font-size: 13px;
    }
    
    .sort-buttons {
      display: flex;
      gap: 0.3rem;
    }
    
    .sort-btn {
      flex: 1;
      padding: 0.4rem 0.5rem;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
      color: #fff;
      border-radius: 6px;
      font-size: 0.72rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .sort-btn.active {
      background: #FF8802;
      border-color: #FF8802;
    }
    
    .company-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      background: rgba(0,0,0,0.1);
    }
    
    .company-list-empty {
      padding: 1rem;
      text-align: center;
      color: rgba(255,255,255,0.5);
      font-size: 0.8rem;
    }
    
    .company-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.6rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .company-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .company-item.selected {
      background: rgba(255,136,2,0.3);
      border-left: 3px solid #FF8802;
    }
    
    .company-item:last-child {
      border-bottom: none;
    }
    
    .company-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .company-item-name {
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .company-item-meta {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.6);
      margin-top: 0.1rem;
    }
    
    .company-item-date {
      font-size: 0.6rem;
      color: rgba(255,255,255,0.4);
      white-space: nowrap;
    }
    
    .company-action-buttons {
      display: flex;
      gap: 0.3rem;
    }
    
    .company-action-buttons .btn {
      flex: 1;
      font-size: 0.8rem;
      padding: 0.5rem;
    }
    
    @media (min-width: 480px) {
      .company-list-controls {
        flex-direction: row;
        align-items: center;
      }
      .search-box {
        flex: 1;
      }
      .sort-buttons {
        flex: 0 0 auto;
      }
    }
    
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading-screen">
    <div class="loader"></div>
    <div class="loading-text" id="loading-text">ì•± ë¡œë”© ì¤‘...</div>
  </div>

  <!-- ì¸ì¦ í™•ì¸ìš© ë¡œë”© í™”ë©´ (ë¡œê·¸ì¸ í™”ë©´ ëŒ€ì‹ ) -->
  <div id="auth-loading-screen" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%); z-index: 9999; align-items: center; justify-content: center; flex-direction: column;">
    <div style="text-align: center;">
      <div style="font-size: 4rem; margin-bottom: 1.5rem; animation: pulse 1.5s infinite;">ğŸ¢</div>
      <h2 style="color: white; margin-bottom: 1rem; font-size: 1.8rem;">ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­</h2>
      <div id="auth-status-text" style="color: rgba(255,255,255,0.9); font-size: 1rem; margin-bottom: 2rem;">
        ì¸ì¦ í™•ì¸ ì¤‘...
      </div>
      <div style="width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
    </div>
  </div>
  
  <style>
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>

  <!-- Google ë¡œê·¸ì¸ í™”ë©´ (ë¡œê·¸ì¸ í•„ìš”í•  ë•Œë§Œ í‘œì‹œ) -->
  <div id="login-screen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0c2c54 0%, #2a5a8a 100%); z-index: 9999; align-items: center; justify-content: center;">
    <div style="background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; max-width: 400px; width: 90%;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ¢</div>
      <h2 style="color: #0c2c54; margin-bottom: 0.5rem; font-size: 1.8rem;">ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­</h2>
      <p style="color: #666; margin-bottom: 2rem; font-size: 0.95rem;">êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤</p>
      
      <button id="google-signin-btn" onclick="signInWithGoogle()" style="
        width: 100%;
        padding: 1rem;
        background: white;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        color: #333;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        transition: all 0.2s;
      " onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.boxShadow='none'">
        <svg width="20" height="20" viewBox="0 0 24 24">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Google ê³„ì •ìœ¼ë¡œ ì‹œì‘í•˜ê¸°
      </button>
      
      <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; text-align: left; font-size: 0.85rem; color: #666;">
        <div style="font-weight: 600; margin-bottom: 0.5rem; color: #0c2c54;">ğŸ”’ ì •ë³´ë³´í˜¸</div>
        <div style="line-height: 1.6;">
          â€¢ ë°ì´í„°ëŠ” ì‚¬ìš©ìì˜ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì•”í˜¸í™” ì €ì¥<br>
          â€¢ ì–¸ì œë“  ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="main-content" style="display: none;">
    <div class="header">
      <div class="header-left">
        <button id="connection-status-btn" class="btn-main btn-small" style="background: #6c757d;" onclick="connectDrive()">
          <span style="font-size: 0.9rem;">â³</span> ì—°ê²° ì¤‘...
        </button>
        <button class="btn-main btn-small" onclick="signOut()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      <h1 style="flex: 1; text-align: center;">ğŸ¢ ê¸°ì—… ì§€ì›ì‚¬ì—… AI ë§¤ì¹­</h1>
      <button class="btn-main btn-small" onclick="goHome()">ë©”ì¸</button>
    </div>

    <div class="required-notice">
      <strong>* í‘œì‹œ í•­ëª©ì€ í•„ìˆ˜ ì…ë ¥ ì‚¬í•­ì…ë‹ˆë‹¤</strong>
    </div>

    <!-- 1. ê³ ê°ì‚¬ ì„ íƒ -->
    <div class="card">
      <h2>1. ê³ ê°ì‚¬ ê´€ë¦¬</h2>
      
      <div style="background: rgba(255,210,127,0.15); border: 1px solid rgba(255,210,127,0.3); border-radius: 8px; padding: 0.6rem; margin-bottom: 0.6rem;">
        <p style="margin: 0; font-size: 0.8rem; color: rgba(255,255,255,0.9);">
          ğŸ’¡ <strong>ì•ˆë‚´:</strong> ì•„ë˜ì— ì €ì¥ëœ ê³ ê°ì‚¬ëª…ì„ ì„ íƒí•˜ê±°ë‚˜, "ìƒˆë¡œ ì…ë ¥" ë²„íŠ¼ìœ¼ë¡œ ì‹ ê·œ ê³ ê°ì‚¬ë¥¼ ë“±ë¡í•˜ì„¸ìš”.
        </p>
      </div>
      
      <!-- íšŒì‚¬ëª… ì…ë ¥ ë° ë²„íŠ¼ -->
      <div style="display: flex; gap: 0.5rem; margin-bottom: 0.6rem; align-items: center;">
        <input type="text" id="company-name-search" placeholder="íšŒì‚¬ëª… ì…ë ¥ ë˜ëŠ” ì„ íƒ..." style="flex: 1; padding: 0.6rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 0.85rem;">
        <button class="btn btn-secondary" onclick="searchCompany()" style="padding: 0.6rem 1rem; white-space: nowrap;">
          ğŸ” ì¡°íšŒ
        </button>
        <button class="btn btn-secondary" onclick="openCompanyListModal()" style="padding: 0.6rem 1rem; white-space: nowrap;">
          ğŸ“‹ ëª©ë¡
        </button>
      </div>
      
      <!-- ìˆ¨ê¹€ ë“œë¡­ë‹¤ìš´ (í˜¸í™˜ì„±) -->
      <select id="company-select" style="display:none;" onchange="loadSelectedCompany()">
        <option value="">-- ìƒˆë¡œ ì…ë ¥ --</option>
      </select>
      
      <div class="company-action-buttons">
        <button class="btn btn-secondary" onclick="clearForm()">
          â• ìƒˆë¡œ ì…ë ¥
        </button>
      </div>
    </div>

    <!-- ê³ ê°ì‚¬ ëª©ë¡ ëª¨ë‹¬ -->
    <div id="company-list-modal" onclick="event.target.id === 'company-list-modal' && closeCompanyListModal()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; padding: 1rem; overflow-y: auto;">
      <div style="max-width: 800px; margin: 2rem auto; background: linear-gradient(135deg, #1a3a5c 0%, #2a5a8a 100%); border-radius: 15px; padding: 1.5rem; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
        
        <!-- ëª¨ë‹¬ í—¤ë” -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.2);">
          <h3 style="margin: 0; color: #ffd27f; font-size: 1.3rem;">ğŸ“‹ ì €ì¥ëœ ê³ ê°ì‚¬ ëª©ë¡</h3>
          <button onclick="closeCompanyListModal()" style="background: none; border: none; color: white; font-size: 1.8rem; cursor: pointer; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">Ã—</button>
        </div>
        
        <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
        <div style="background: rgba(255,210,127,0.15); border: 1px solid rgba(255,210,127,0.3); border-radius: 8px; padding: 0.6rem 0.8rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-size: 1rem;">ğŸ’¡</span>
          <span style="color: #ffd27f; font-size: 0.8rem; line-height: 1.4;">ê³ ê°ì‚¬ê°€ ë¦¬ìŠ¤íŠ¸ì— ì—†ì„ ê²½ìš° <strong>ìƒˆë¡œê³ ì¹¨</strong>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</span>
        </div>
        
        <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
          <input type="text" id="modal-company-search" placeholder="ğŸ” íšŒì‚¬ëª… ê²€ìƒ‰..." oninput="filterModalList()" style="flex: 1; min-width: 120px; padding: 0.6rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 0.85rem;">
          <button class="sort-btn active" onclick="sortModalList('name')" id="modal-sort-name" style="padding: 0.6rem 0.8rem; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 6px; cursor: pointer; font-size: 0.8rem; white-space: nowrap;">ê°€ë‚˜ë‹¤ìˆœ</button>
          <button class="sort-btn" onclick="sortModalList('date')" id="modal-sort-date" style="padding: 0.6rem 0.8rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 6px; cursor: pointer; font-size: 0.8rem; white-space: nowrap;">ìµœì‹ ìˆœ</button>
          <button onclick="refreshDriveConnection()" style="padding: 0.6rem 0.8rem; background: linear-gradient(135deg, #28a745, #20c997); border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 0.8rem; white-space: nowrap; display: flex; align-items: center; gap: 0.3rem; font-weight: 600; box-shadow: 0 2px 8px rgba(40,167,69,0.3);" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <!-- ê³ ê°ì‚¬ ë¦¬ìŠ¤íŠ¸ -->
        <div id="modal-company-list" style="max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 0.5rem;">
          <div style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.6);">ì €ì¥ëœ ê³ ê°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
        
      </div>
    </div>

    <!-- Section 1: ê¸°ì—… ê¸°ë³¸ì •ë³´ -->
    <div class="card">
      <h2>Section 1. ê¸°ì—… ê¸°ë³¸ì •ë³´</h2>
      
      <h3>1-1. ê¸°ì—… ì‹ë³„ì •ë³´</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ê¸°ì—…ëª… <span class="required">*</span></label>
          <input type="text" id="company-name" placeholder="ìƒí˜¸ëª…ì„ ì •í™•íˆ ì…ë ¥" required style="width: 100%; max-width: 100%; box-sizing: border-box;">
        </div>
        
        <div class="form-group">
          <label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ <span class="required">*</span></label>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="text" id="business-number-1" placeholder="000" maxlength="3" style="width: 80px;" inputmode="numeric" required oninput="allowOnlyNumbers(this); moveFocusOnMaxLength(this, 'business-number-2', 3)">
            <span style="color: #ddd;">-</span>
            <input type="text" id="business-number-2" placeholder="00" maxlength="2" style="width: 60px;" inputmode="numeric" required oninput="allowOnlyNumbers(this); moveFocusOnMaxLength(this, 'business-number-3', 2)">
            <span style="color: #ddd;">-</span>
            <input type="text" id="business-number-3" placeholder="00000" maxlength="5" style="width: 100px;" inputmode="numeric" required oninput="allowOnlyNumbers(this)">
          </div>
        </div>
        
        <div class="form-group">
          <label>ê°œì—…ì—°ì›”ì¼(ì‚¬ì—…ìë“±ë¡ì¦) <span class="required">*</span></label>
          <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
            <input type="date" id="establish-date" required onchange="calculateBusinessAge()" style="flex: 1; min-width: 150px;">
            <span id="business-age-display" style="font-size: 0.75rem; color: #ffd27f; white-space: nowrap;"></span>
          </div>
        </div>
      </div>
      
      <h3>1-2. ê¸°ì—… ë¶„ë¥˜</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ê¸°ì—… ê·œëª¨ <span class="required">*</span></label>
          <select id="company-size" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì˜ˆë¹„ì°½ì—…ì">ì˜ˆë¹„ì°½ì—…ì</option>
            <option value="ì†Œìƒê³µì¸">ì†Œìƒê³µì¸</option>
            <option value="ì†Œê¸°ì—…">ì†Œê¸°ì—…</option>
            <option value="ì¤‘ê¸°ì—…">ì¤‘ê¸°ì—…</option>
            <option value="ì¤‘ê²¬ê¸°ì—…">ì¤‘ê²¬ê¸°ì—…</option>
            <option value="ëŒ€ê¸°ì—…">ëŒ€ê¸°ì—…</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ê¸°ì—… í˜•íƒœ <span class="required">*</span></label>
          <select id="company-type" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ê°œì¸ì‚¬ì—…ì">ê°œì¸ì‚¬ì—…ì</option>
            <option value="ë²•ì¸(ì£¼ì‹)">ë²•ì¸(ì£¼ì‹íšŒì‚¬)</option>
            <option value="ë²•ì¸(ìœ í•œ)">ë²•ì¸(ìœ í•œíšŒì‚¬)</option>
            <option value="í˜‘ë™ì¡°í•©">í˜‘ë™ì¡°í•©</option>
            <option value="ì‚¬íšŒì ê¸°ì—…">ì‚¬íšŒì ê¸°ì—…</option>
            <option value="ì†Œì…œë²¤ì²˜">ì†Œì…œë²¤ì²˜</option>
            <option value="ë¹„ì˜ë¦¬">ë¹„ì˜ë¦¬ë²•ì¸</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‚¬ì—… ìƒíƒœ <span class="required">*</span></label>
          <select id="business-status" required>
            <option value="ìš´ì˜ì¤‘">ìš´ì˜ì¤‘</option>
            <option value="íœ´ì—…">íœ´ì—…</option>
            <option value="íì—…">íì—…</option>
          </select>
        </div>
        
        <div class="form-group full-width">
          <label>ì—…ì¢…(KSIC ì½”ë“œ_11ì°¨) <span class="required">*</span></label>
          <div style="display: flex; gap: 0.3rem; align-items: flex-start; flex-wrap: wrap;">
            <!-- ê³„ì¸µí˜• KSIC ì„ íƒ -->
            <select id="ksic-level-2" onchange="onKsicLevel2Change()" style="flex: 1; min-width: 150px;">
              <option value="">ì¤‘ë¶„ë¥˜(2ìë¦¬) ì„ íƒ</option>
            </select>
            <select id="ksic-level-3" onchange="onKsicLevel3Change()" style="flex: 1; min-width: 150px;" disabled>
              <option value="">ì†Œë¶„ë¥˜(3ìë¦¬) ì„ íƒ</option>
            </select>
            <select id="ksic-level-4" onchange="onKsicLevel4Change()" style="flex: 1; min-width: 150px;" disabled>
              <option value="">ì„¸ë¶„ë¥˜(4ìë¦¬) ì„ íƒ</option>
            </select>
            <select id="ksic-level-5" onchange="onKsicLevel5Change()" style="flex: 1; min-width: 150px;" disabled>
              <option value="">ì„¸ì„¸ë¶„ë¥˜(5ìë¦¬) ì„ íƒ</option>
            </select>
          </div>
          <div style="display: flex; gap: 0.3rem; align-items: center; margin-top: 0.5rem;">
            <span style="font-weight: bold; color: #4a90d9;">ì„ íƒëœ ì½”ë“œ:</span>
            <input type="text" id="ksic-display" readonly style="width: 80px; text-align: center; padding: 0.4rem; font-size: 1rem; font-weight: bold; background: #1a2a3a; border: 2px solid #4a90d9; color: #fff;" placeholder="00000">
            <span id="ksic-name-display" style="color: #8ab4f8; font-size: 0.9rem;"></span>
            <input type="hidden" id="ksic-code">
            <button type="button" onclick="openKsicSearch()" class="btn-mini" title="í†µê³„ì²­ ê³µì‹ KSIC ê²€ìƒ‰ ì‚¬ì´íŠ¸">ğŸ” í†µê³„ì²­ ê²€ìƒ‰</button>
          </div>
          <span class="info-text" style="color: #ff9999; font-weight: bold;">âš ï¸ KSIC ì½”ë“œ 5ìë¦¬ê¹Œì§€ ì„ íƒí•´ì£¼ì„¸ìš”. ì´ ì½”ë“œê°€ AI ë¶„ì„ì— ê°€ì¥ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤!</span>
        </div>
        
        <div class="form-group full-width">
          <label>ì£¼ë ¥ ì œí’ˆ/ì„œë¹„ìŠ¤ (ìµœëŒ€ 4ê°œ)</label>
          <div class="product-grid">
            <input type="text" id="product-1" placeholder="ì£¼ë ¥ì œí’ˆ 1">
            <input type="text" id="product-2" placeholder="ì£¼ë ¥ì œí’ˆ 2">
            <input type="text" id="product-3" placeholder="ì£¼ë ¥ì œí’ˆ 3">
            <input type="text" id="product-4" placeholder="ì£¼ë ¥ì œí’ˆ 4">
          </div>
        </div>
      </div>
      
      <h3>1-3. ì‚¬ì—…ì¥ ì •ë³´</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ë³¸ì  ì†Œì¬ì§€ (ì‹œë„) <span class="required">*</span></label>
          <select id="location-sido" required onchange="updateSigunguOptions()">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì„œìš¸">ì„œìš¸</option>
            <option value="ê²½ê¸°">ê²½ê¸°</option>
            <option value="ì¸ì²œ">ì¸ì²œ</option>
            <option value="ë¶€ì‚°">ë¶€ì‚°</option>
            <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
            <option value="ëŒ€ì „">ëŒ€ì „</option>
            <option value="ê´‘ì£¼">ê´‘ì£¼</option>
            <option value="ìš¸ì‚°">ìš¸ì‚°</option>
            <option value="ì„¸ì¢…">ì„¸ì¢…</option>
            <option value="ê°•ì›">ê°•ì›</option>
            <option value="ì¶©ë¶">ì¶©ë¶</option>
            <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
            <option value="ì „ë¶">ì „ë¶</option>
            <option value="ì „ë‚¨">ì „ë‚¨</option>
            <option value="ê²½ë¶">ê²½ë¶</option>
            <option value="ê²½ë‚¨">ê²½ë‚¨</option>
            <option value="ì œì£¼">ì œì£¼</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‹œêµ°êµ¬</label>
          <select id="location-sigungu">
            <option value="">ì‹œë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‚°ì—…ë‹¨ì§€ ì…ì£¼</label>
          <select id="industrial-complex">
            <option value="ë¯¸ì…ì£¼">ë¯¸ì…ì£¼</option>
            <option value="ì¼ë°˜ì‚°ë‹¨">ì¼ë°˜ì‚°ë‹¨</option>
            <option value="êµ­ê°€ì‚°ë‹¨">êµ­ê°€ì‚°ë‹¨</option>
            <option value="ì§€ë°©ì‚°ë‹¨">ì§€ë°©ì‚°ë‹¨</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ìˆ˜ë„ê¶Œ ì—¬ë¶€ <span class="required">*</span></label>
          <select id="capital-area" required disabled>
            <option value="">ìë™ ì„¤ì •ë¨</option>
            <option value="Y">ì˜ˆ (ì„œìš¸/ê²½ê¸°/ì¸ì²œ)</option>
            <option value="N">ì•„ë‹ˆì˜¤ (ì§€ë°©)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Section 2: ëŒ€í‘œì ì •ë³´ -->
    <div class="card">
      <h2>Section 2. ëŒ€í‘œì ì •ë³´</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ìƒë…„ì›”ì¼</label>
          <input type="date" id="ceo-birth">
          <span class="info-text">ì²­ë…„(ë§Œ39ì„¸â†“) íŒì •</span>
        </div>
        
        <div class="form-group">
          <label>ì„±ë³„ <span class="required">*</span></label>
          <select id="ceo-gender" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
          </select>
          <span class="info-text">ì—¬ì„±ê¸°ì—… ì „ìš© íŠ¸ë™</span>
        </div>
      </div>
    </div>

    <!-- Section 3: ì¬ë¬´ ë° ì‹ ìš©ì •ë³´ -->
    <div class="card">
      <h2>Section 3. ì¬ë¬´ ë° ì‹ ìš©ì •ë³´</h2>
      
      <h3>3-1. ì¬ë¬´ í˜„í™©</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ë§¤ì¶œì•¡ - ìµœê·¼ë…„ë„ (ì›) <span class="required">*</span></label>
          <input type="text" id="revenue-recent" placeholder="ì˜ˆ: 1500000000" required>
        </div>
        
        <div class="form-group">
          <label>ì˜ì—…ì´ìµ - ìµœê·¼ë…„ë„ (ì›)</label>
          <div style="display: flex; align-items: center; gap: 0.3rem;">
            <label class="loss-checkbox-label">
              <input type="checkbox" id="profit-loss" onchange="toggleProfitSign()">
              <span class="loss-checkbox-box">âœ“</span>
              <span class="loss-checkbox-text">ì†ì‹¤</span>
            </label>
            <input type="text" id="profit-recent" placeholder="ì˜ˆ: 200000000" inputmode="numeric" style="flex: 1;" oninput="formatProfitInput(this)">
          </div>
        </div>
        
        <div class="form-group">
          <label>ë¶€ì±„ë¹„ìœ¨ (%)</label>
          <input type="text" id="debt-ratio" placeholder="ì˜ˆ: 87.5" inputmode="decimal" oninput="formatDecimalInput(this)">
        </div>
      </div>
      
      <h3>3-2. ê²°ê²©ì‚¬ìœ  ì²´í¬</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>êµ­ì„¸ ì²´ë‚© <span class="required">*</span></label>
          <select id="tax-arrears" required>
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì§€ë°©ì„¸ ì²´ë‚© <span class="required">*</span></label>
          <select id="local-tax-arrears" required>
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>4ëŒ€ë³´í—˜ ë¯¸ë‚©/ì²´ë‚©</label>
          <select id="insurance-arrears">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì™„ì „ìë³¸ì ì‹</label>
          <select id="capital-erosion">
            <option value="N">ì•„ë‹ˆì˜¤</option>
            <option value="Y">ì˜ˆ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ë¶€ë„/íšŒìƒ/íŒŒì‚° ì´ë ¥</label>
          <select id="bankruptcy-history">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
      </div>
      
      <h3>3-3. ì‹ ìš©ì •ë³´</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ê¸°ìˆ ì‹ ìš©í‰ê°€(TCB) ë“±ê¸‰</label>
          <select id="tcb-rating">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="T-1">T-1</option>
            <option value="T-2">T-2</option>
            <option value="T-3">T-3</option>
            <option value="T-4">T-4</option>
            <option value="T-5">T-5</option>
            <option value="T-6">T-6</option>
            <option value="T-7">T-7</option>
            <option value="T-8">T-8</option>
            <option value="T-9">T-9</option>
            <option value="T-10">T-10</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Section 4: ê³ ìš© ì •ë³´ -->
    <div class="card">
      <h2>Section 4. ê³ ìš© ì •ë³´</h2>
      
      <h3>4-1. ì¸ë ¥ í˜„í™©</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ìƒì‹œê·¼ë¡œì ìˆ˜ (ëª…) <span class="required">*</span></label>
          <input type="number" id="employees-total" placeholder="ëŒ€í‘œì ì œì™¸" required>
        </div>
        
        <div class="form-group">
          <label>ì²­ë…„ ê³ ìš© (ë§Œ15~34ì„¸)</label>
          <input type="number" id="employees-youth" placeholder="ì²­ë…„ ì¸ì›">
          <span class="info-text">ì²­ë…„ê³ ìš© ê°€ì </span>
        </div>
        
        <div class="form-group">
          <label>ì—¬ì„± ê³ ìš©</label>
          <input type="number" id="employees-female" placeholder="ì—¬ì„± ì¸ì›">
          <span class="info-text">ì—¬ì„±ê³ ìš© ê°€ì </span>
        </div>
        
        <div class="form-group">
          <label>ì¥ì• ì¸ ê³ ìš©</label>
          <input type="number" id="employees-disabled" placeholder="ì¥ì• ì¸ ì¸ì›">
        </div>
        
        <div class="form-group">
          <label>ê³ ìš© ì¦ê°€ìœ¨ (%)</label>
          <input type="number" id="employment-growth" placeholder="ì „ë…„ ëŒ€ë¹„ ì¦ê°€ìœ¨" step="0.1">
          <span class="info-text">ê³ ìš©ì°½ì¶œ ìš°ëŒ€</span>
        </div>
      </div>
    </div>

    <!-- Section 5: ê¸°ìˆ  ë° ì¸ì¦ ì •ë³´ -->
    <div class="card">
      <h2>Section 5. ê¸°ìˆ  ë° ì¸ì¦ ì •ë³´</h2>
      
      <h3>5-1. ê¸°ì—… ì¸ì¦</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ë²¤ì²˜ê¸°ì—… ì¸ì¦</label>
          <select id="cert-venture">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì´ë…¸ë¹„ì¦ˆ(ê¸°ìˆ í˜ì‹ )</label>
          <select id="cert-innobiz">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ë©”ì¸ë¹„ì¦ˆ(ê²½ì˜í˜ì‹ )</label>
          <select id="cert-mainbiz">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì—¬ì„±ê¸°ì—… ì¸ì¦</label>
          <select id="cert-woman">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
          <span class="info-text">ì—¬ì„±ê¸°ì—… ì „ìš© ì§€ì›</span>
        </div>
        
        <div class="form-group">
          <label>ì¥ì• ì¸ê¸°ì—… ì¸ì¦</label>
          <select id="cert-disabled">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‚¬íšŒì ê¸°ì—… ì¸ì¦</label>
          <select id="cert-social">
            <option value="N">ì—†ìŒ</option>
            <option value="Y">ìˆìŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ESG ì¶”ì§„ ì—¬ë¶€</label>
          <select id="esg-status">
            <option value="N">ì•„ë‹ˆì˜¤</option>
            <option value="Y">ì˜ˆ</option>
          </select>
          <span class="info-text">ESG ê´€ë ¨ ì‚¬ì—… ê°€ì </span>
        </div>
      </div>
      
      <h3>5-2. ì—°êµ¬ê°œë°œ ì—­ëŸ‰</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>ì—°êµ¬ì¡°ì§</label>
          <select id="research-org">
            <option value="ì—†ìŒ">ì—†ìŒ</option>
            <option value="ê¸°ì—…ë¶€ì„¤ì—°êµ¬ì†Œ">ê¸°ì—…ë¶€ì„¤ì—°êµ¬ì†Œ</option>
            <option value="ì—°êµ¬ê°œë°œì „ë‹´ë¶€ì„œ">ì—°êµ¬ê°œë°œì „ë‹´ë¶€ì„œ</option>
          </select>
          <span class="info-text">ê¸°ìˆ ê°œë°œì‚¬ì—… í•„ìˆ˜</span>
        </div>
        
        <div class="form-group">
          <label>íŠ¹í—ˆ ë“±ë¡ (ê±´)</label>
          <input type="number" id="patents-registered" placeholder="ë“±ë¡">
        </div>
      </div>
    </div>

    <!-- Section 6: ìˆ˜ì¶œ ë° í•´ì™¸ì§„ì¶œ -->
    <div class="card">
      <h2>Section 6. ìˆ˜ì¶œ ë° í•´ì™¸ì§„ì¶œ</h2>
      <div class="form-grid">
        <div class="form-group">
          <label>ìˆ˜ì¶œ ì‹¤ì  - ìµœê·¼ë…„ë„ ($)</label>
          <input type="number" id="export-recent" placeholder="ì˜ˆ: 100000">
        </div>
        
        <div class="form-group full-width">
          <label>ì£¼ìš” ìˆ˜ì¶œêµ­</label>
          <input type="text" id="export-countries" placeholder="ë§¤ì¶œë¹„ì¤‘ ìƒìœ„ 3ê°œêµ­ (ì˜ˆ: ë¯¸êµ­, ì¤‘êµ­, ì¼ë³¸)">
        </div>
      </div>
    </div>

    <!-- Section 7: í¬ë§ ì§€ì›ë¶„ì•¼ -->
    <div class="card">
      <h2>Section 7. í¬ë§ ì§€ì›ë¶„ì•¼ <span class="required">*</span></h2>
      
      <style>
        .support-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.8rem;
        }
        @media (max-width: 1024px) {
          .support-grid {
            grid-template-columns: repeat(3, 1fr);
          }
        }
        @media (max-width: 768px) {
          .support-grid {
            grid-template-columns: repeat(2, 1fr);
          }
        }
        .support-item {
          background: rgba(255,255,255,0.05);
          border: 1px solid rgba(255,255,255,0.15);
          border-radius: 8px;
          padding: 0.7rem;
          display: flex;
          flex-direction: column;
          gap: 0.3rem;
        }
        .support-item:hover {
          background: rgba(255,255,255,0.1);
          border-color: rgba(255,255,255,0.25);
        }
        .support-item label {
          font-weight: 600;
          font-size: 0.9rem;
          cursor: pointer;
        }
        .support-item .support-desc {
          font-size: 0.7rem;
          color: rgba(255,255,255,0.6);
          line-height: 1.3;
          margin-left: 1.4rem;
        }
      </style>
      
      <h3>7-1. ì§€ì› í•„ìš” ë¶„ì•¼ (ì¤‘ë³µì„ íƒ ê°€ëŠ¥)</h3>
      <div class="support-grid">
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-finance" name="desiredSupport" value="ê¸ˆìœµ">
            <label for="support-finance">ê¸ˆìœµ</label>
          </div>
          <span class="support-desc">ì •ì±…ìê¸ˆ, ìœµì, ë³´ì¦, íˆ¬ì</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-tech" name="desiredSupport" value="ê¸°ìˆ ">
            <label for="support-tech">ê¸°ìˆ </label>
          </div>
          <span class="support-desc">R&D, ê¸°ìˆ ê°œë°œ, íŠ¹í—ˆ, ì¸ì¦</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-manpower" name="desiredSupport" value="ì¸ë ¥">
            <label for="support-manpower">ì¸ë ¥</label>
          </div>
          <span class="support-desc">ê³ ìš©ì§€ì›, ì±„ìš©, êµìœ¡, ì¸ê±´ë¹„</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-export" name="desiredSupport" value="ìˆ˜ì¶œ">
            <label for="support-export">ìˆ˜ì¶œ</label>
          </div>
          <span class="support-desc">í•´ì™¸ì§„ì¶œ, ìˆ˜ì¶œë°”ìš°ì²˜, ë¬´ì—­</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-domestic" name="desiredSupport" value="ë‚´ìˆ˜">
            <label for="support-domestic">ë‚´ìˆ˜</label>
          </div>
          <span class="support-desc">íŒë¡œê°œì²™, ë§ˆì¼€íŒ…, í™ë³´</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-startup" name="desiredSupport" value="ì°½ì—…">
            <label for="support-startup">ì°½ì—…</label>
          </div>
          <span class="support-desc">ì°½ì—…ì§€ì›, ì•¡ì…€ëŸ¬ë ˆì´íŒ…</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-management" name="desiredSupport" value="ê²½ì˜">
            <label for="support-management">ê²½ì˜</label>
          </div>
          <span class="support-desc">ì»¨ì„¤íŒ…, í˜ì‹ , ìŠ¤ë§ˆíŠ¸ê³µì¥</span>
        </div>
        <div class="support-item">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-etc" name="desiredSupport" value="ê¸°íƒ€">
            <label for="support-etc">ê¸°íƒ€</label>
          </div>
          <span class="support-desc">ESG, íƒ„ì†Œì¤‘ë¦½, ì‹œì„¤, ê³µê°„</span>
        </div>
        <div class="support-item" style="grid-column: span 2; background: rgba(255,210,127,0.1); border-color: rgba(255,210,127,0.3);">
          <div style="display: flex; align-items: center; gap: 0.4rem;">
            <input type="checkbox" id="support-all" name="desiredSupport" value="ì „ì²´" onchange="toggleAllSupport(this.checked)">
            <label for="support-all" style="color: #ffd27f;">ì „ì²´</label>
          </div>
          <span class="support-desc" style="color: rgba(255,210,127,0.8);">ë¶„ì•¼ ë¬´ê´€, ëª¨ë“  ì§€ì›ì‚¬ì—…</span>
        </div>
      </div>
    </div>

    <!-- ì‹¤í–‰ ë²„íŠ¼ -->
    <div class="card">
      <style>
        .action-btn-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }
        @media (max-width: 768px) {
          .action-btn-grid {
            grid-template-columns: repeat(2, 1fr);
          }
        }
        .btn-action-primary {
          background: linear-gradient(135deg, #FF8802 0%, #FF6B00 100%);
          color: white;
          border: none;
          padding: 0.9rem 0.5rem;
          border-radius: 8px;
          font-weight: 600;
          font-size: 0.85rem;
          cursor: pointer;
          transition: transform 0.2s, box-shadow 0.2s;
          text-align: center;
          white-space: nowrap;
        }
        .btn-action-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(255,136,2,0.4);
        }
        .btn-action-secondary {
          background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
          color: white;
          border: none;
          padding: 0.9rem 0.5rem;
          border-radius: 8px;
          font-weight: 600;
          font-size: 0.85rem;
          cursor: pointer;
          transition: transform 0.2s, box-shadow 0.2s;
          text-align: center;
          white-space: nowrap;
        }
        .btn-action-secondary:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(74,85,104,0.4);
        }
      </style>
      
      <!-- ë²„íŠ¼ ê·¸ë¦¬ë“œ (PC: 4ê°œì”©, ëª¨ë°”ì¼: 2ê°œì”©) -->
      <div class="action-btn-grid">
        <button class="btn-action-primary" onclick="findAndAnalyzePrograms()">
          ğŸ” ì§€ì›ì‚¬ì—…+ë¶„ì„
        </button>
        <button class="btn-action-primary" onclick="analyzeProgramsDetail()">
          ğŸ“Š ìƒì„¸ë¶„ì„(ìµœëŒ€10ê°œ)
        </button>
        <button class="btn-action-secondary" onclick="saveCompany()">
          ğŸ’¾ ê¸°ì—…ì •ë³´ ì €ì¥
        </button>
        <button class="btn-action-secondary" onclick="saveWithPrograms()">
          ğŸ’¾ ì €ì¥(ê¸°ì—…+ì§€ì›ì‚¬ì—…)
        </button>
      </div>
      
      <div class="action-btn-grid">
        <button class="btn-action-secondary" onclick="saveWithAIAnalysis()">
          ğŸ’¾ ì €ì¥(ìƒì„¸ë¶„ì„)
        </button>
        <button class="btn-action-secondary" onclick="showDetailSample()">
          ğŸ‘ï¸ ìƒì„¸ë¶„ì„ ìƒ˜í”Œ
        </button>
        <button class="btn-action-secondary" onclick="showMyPoints()">
          ğŸ’° í¬ì¸íŠ¸ ì¡°íšŒ
        </button>
        <button class="btn-action-secondary" onclick="deleteCompany()" style="background: linear-gradient(135deg, #718096 0%, #4a5568 100%);" title="â€» ê¸°ì—…ì •ë³´ëŠ” ëª©ë¡ì—ì„œ ì‚­ì œ">
          ğŸ—‘ï¸ ì‚­ì œ(ì§€ì›ì •ë³´)
        </button>
      </div>
      <p style="text-align: right; font-size: 0.7rem; color: #aaa; margin: 0.3rem 0 0 0;">â€» ê¸°ì—…ì •ë³´ëŠ” ëª©ë¡ì—ì„œ ì‚­ì œ</p>
    </div>

    <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <div id="results-section" style="display: none;"></div>
    
    <!-- AI ë¶„ì„ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
    <div id="aiResultsSection" style="display: none; margin-top: 2rem;">
      <div class="card">
        <h3 style="color: #FFD700; margin-bottom: 1rem; font-size: 1.3rem;">
          ğŸ¯ AI ë¶„ì„ ê²°ê³¼ (ìƒìœ„ 20ê°œ)
        </h3>
        <div id="aiResultsList"></div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer style="text-align: center; padding: 2rem 1rem; margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); font-size: 0.8rem;">
      <p style="margin: 0;">Â© 2025 (ì£¼)í•œêµ­FPì„¼í„°. All Rights Reserved.</p>
    </footer>
  </div>

  <script>
    // ==================== Firebase & Google Drive ì„¤ì • ====================
    
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyBHiLDRhm7j5gs2MMZuffH4Fs1xDx2OL9I",
      authDomain: "kfpc-company-support-project.firebaseapp.com",
      databaseURL: "https://kfpc-company-support-project-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "kfpc-company-support-project",
      storageBucket: "kfpc-company-support-project.firebasestorage.app",
      messagingSenderId: "1012609333373",
      appId: "1:1012609333373:web:5453ab357b06015d56d914",
      measurementId: "G-5BDZFX0SC6"
    };
    
    // Firebase ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    // Firebase Functions ì´ˆê¸°í™” (ì„œìš¸ ë¦¬ì „)
    const functions = firebase.app().functions('asia-northeast3');
    
    // Google API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    // UPDATED: Corrected Client ID for finmaster domain
    const CLIENT_ID = '1012609333373-a1mclfpsvgnt079nmrp34ja0mc53i00h.apps.googleusercontent.com';
    
    // âš ï¸ Gemini API í‚¤ ì„¤ì •
    // í‚¤ ë°œê¸‰: https://aistudio.google.com/apikey
    // âš ï¸ Gemini API í‚¤ëŠ” Netlify Functionì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    // ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    
    let gapiInited = false;
    let gisInited = false;
    let tokenClient = null;
    let hasCompletedSearch = false; // ë§ì¶¤ì°¾ê¸° ì™„ë£Œ í”Œë˜ê·¸
    
    // ... [Rest of the JavaScript code remains exactly the same as the original file, except for the goHome function] ...

    // ... (All functions like getRelevanceGrade, loadKsicData, etc. remain unchanged) ...

    function goHome() {
      // UPDATED: Relative path for navigation
      window.location.href = 'index.html';
    }

    // ... [Rest of the file continues with exactly the same content as the original upload] ...
    
    // ==================== ê´€ë ¨ë„ ë“±ê¸‰ ë³€í™˜ ====================
    /**
     * ì ìˆ˜ë¥¼ ê´€ë ¨ë„ ë“±ê¸‰ìœ¼ë¡œ ë³€í™˜
     * @param {number} score - ì ìˆ˜ (0~100)
     * @param {boolean} isEligible - ì í•© ì—¬ë¶€
     * @returns {object} { text: 'ë§¤ìš°ë†’ìŒ', color: '#28a745', bgColor: '...' }
     */
    function getRelevanceGrade(score, isEligible = true) {
      // ë¶€ì í•©ì´ê±°ë‚˜ 80ì  ì´í•˜ë©´ "ì°¸ê³ "
      if (!isEligible || score <= 80) {
        return {
          text: 'ì°¸ê³ ',
          color: '#333',
          bgColor: 'linear-gradient(135deg, #ffc107, #ffda6a)',
          borderColor: '#ffc107',
          headerBg: '#fff3cd',
          headerText: '#856404',
          icon: 'ğŸŸ¡'
        };
      }
      
      if (score >= 96) {
        return {
          text: 'ë§¤ìš°ë†’ìŒ',
          color: '#fff',
          bgColor: 'linear-gradient(135deg, #28a745, #20c997)',
          borderColor: '#28a745',
          headerBg: '#d4edda',
          headerText: '#155724',
          icon: 'ğŸŸ¢'
        };
      } else if (score >= 91) {
        return {
          text: 'ë†’ìŒ',
          color: '#fff',
          bgColor: 'linear-gradient(135deg, #17a2b8, #20c997)',
          borderColor: '#17a2b8',
          headerBg: '#d1ecf1',
          headerText: '#0c5460',
          icon: 'ğŸ”µ'
        };
      } else if (score >= 86) {
        return {
          text: 'ë³´í†µ',
          color: '#fff',
          bgColor: 'linear-gradient(135deg, #6f42c1, #e83e8c)',
          borderColor: '#6f42c1',
          headerBg: '#e2d9f3',
          headerText: '#4a2c7c',
          icon: 'ğŸŸ£'
        };
      } else { // 81~85
        return {
          text: 'ë„ì „',
          color: '#333',
          bgColor: 'linear-gradient(135deg, #fd7e14, #ffc107)',
          borderColor: '#fd7e14',
          headerBg: '#fff3cd',
          headerText: '#856404',
          icon: 'ğŸŸ '
        };
      }
    }
    
    // ==================== KSIC ë°ì´í„° ë° ê³„ì¸µí˜• ë“œë¡­ë‹¤ìš´ ====================
    let ksicData = [];
    
    // KSIC ë°ì´í„° ë¡œë“œ
    async function loadKsicData() {
      try {
        const response = await fetch('./ksic_data.json');
        if (!response.ok) throw new Error('KSIC ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        ksicData = await response.json();
        console.log(`âœ… KSIC ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${ksicData.length}ê°œ`);
        initKsicLevel2();
      } catch (error) {
        console.error('KSIC ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        // ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
        ksicData = [];
      }
    }
    
    // ì½”ë“œ ê¸¸ì´ë¡œ ë ˆë²¨ íŒë‹¨
    function getCodeLevel(code) {
      return code.length;
    }
    
    // íŠ¹ì • ë ˆë²¨ì˜ ì½”ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    function getCodesByLevel(level) {
      return ksicData.filter(item => item.code.length === level);
    }
    
    // ë¶€ëª¨ ì½”ë“œì— í•´ë‹¹í•˜ëŠ” ìì‹ ì½”ë“œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    function getChildCodes(parentCode) {
      const parentLevel = parentCode.length;
      const childLevel = parentLevel + 1;
      return ksicData.filter(item => 
        item.code.length === childLevel && item.code.startsWith(parentCode)
      );
    }
    
    // Level 2 (ì¤‘ë¶„ë¥˜) ì´ˆê¸°í™”
    function initKsicLevel2() {
      const select = document.getElementById('ksic-level-2');
      if (!select) return;
      
      select.innerHTML = '<option value="">ì¤‘ë¶„ë¥˜(2ìë¦¬) ì„ íƒ</option>';
      const level2Codes = getCodesByLevel(2);
      
      level2Codes.forEach(item => {
        const option = document.createElement('option');
        option.value = item.code;
        option.textContent = `${item.code} - ${item.name}`;
        select.appendChild(option);
      });
    }
    
    // Level 2 ì„ íƒ ì‹œ
    function onKsicLevel2Change() {
      const select2 = document.getElementById('ksic-level-2');
      const select3 = document.getElementById('ksic-level-3');
      const select4 = document.getElementById('ksic-level-4');
      const select5 = document.getElementById('ksic-level-5');
      
      const selectedCode = select2.value;
      
      // í•˜ìœ„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
      select3.innerHTML = '<option value="">ì†Œë¶„ë¥˜(3ìë¦¬) ì„ íƒ</option>';
      select4.innerHTML = '<option value="">ì„¸ë¶„ë¥˜(4ìë¦¬) ì„ íƒ</option>';
      select5.innerHTML = '<option value="">ì„¸ì„¸ë¶„ë¥˜(5ìë¦¬) ì„ íƒ</option>';
      select3.disabled = true;
      select4.disabled = true;
      select5.disabled = true;
      
      if (!selectedCode) {
        updateKsicDisplay('');
        return;
      }
      
      // Level 3 ì±„ìš°ê¸°
      const children = getChildCodes(selectedCode);
      if (children.length > 0) {
        children.forEach(item => {
          const option = document.createElement('option');
          option.value = item.code;
          option.textContent = `${item.code} - ${item.name}`;
          select3.appendChild(option);
        });
        select3.disabled = false;
      }
      
      updateKsicDisplay(selectedCode);
    }
    
    // Level 3 ì„ íƒ ì‹œ
    function onKsicLevel3Change() {
      const select3 = document.getElementById('ksic-level-3');
      const select4 = document.getElementById('ksic-level-4');
      const select5 = document.getElementById('ksic-level-5');
      
      const selectedCode = select3.value;
      
      // í•˜ìœ„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
      select4.innerHTML = '<option value="">ì„¸ë¶„ë¥˜(4ìë¦¬) ì„ íƒ</option>';
      select5.innerHTML = '<option value="">ì„¸ì„¸ë¶„ë¥˜(5ìë¦¬) ì„ íƒ</option>';
      select4.disabled = true;
      select5.disabled = true;
      
      if (!selectedCode) {
        const parentCode = document.getElementById('ksic-level-2').value;
        updateKsicDisplay(parentCode);
        return;
      }
      
      // Level 4 ì±„ìš°ê¸°
      const children = getChildCodes(selectedCode);
      if (children.length > 0) {
        children.forEach(item => {
          const option = document.createElement('option');
          option.value = item.code;
          option.textContent = `${item.code} - ${item.name}`;
          select4.appendChild(option);
        });
        select4.disabled = false;
      }
      
      updateKsicDisplay(selectedCode);
    }
    
    // Level 4 ì„ íƒ ì‹œ
    function onKsicLevel4Change() {
      const select4 = document.getElementById('ksic-level-4');
      const select5 = document.getElementById('ksic-level-5');
      
      const selectedCode = select4.value;
      
      // í•˜ìœ„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
      select5.innerHTML = '<option value="">ì„¸ì„¸ë¶„ë¥˜(5ìë¦¬) ì„ íƒ</option>';
      select5.disabled = true;
      
      if (!selectedCode) {
        const parentCode = document.getElementById('ksic-level-3').value;
        updateKsicDisplay(parentCode);
        return;
      }
      
      // Level 5 ì±„ìš°ê¸°
      const children = getChildCodes(selectedCode);
      if (children.length > 0) {
        children.forEach(item => {
          const option = document.createElement('option');
          option.value = item.code;
          option.textContent = `${item.code} - ${item.name}`;
          select5.appendChild(option);
        });
        select5.disabled = false;
      }
      
      updateKsicDisplay(selectedCode);
    }
    
    // Level 5 ì„ íƒ ì‹œ
    function onKsicLevel5Change() {
      const select5 = document.getElementById('ksic-level-5');
      const selectedCode = select5.value;
      
      if (!selectedCode) {
        const parentCode = document.getElementById('ksic-level-4').value;
        updateKsicDisplay(parentCode);
        return;
      }
      
      updateKsicDisplay(selectedCode);
    }
    
    // KSIC ì½”ë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateKsicDisplay(code) {
      const display = document.getElementById('ksic-display');
      const nameDisplay = document.getElementById('ksic-name-display');
      const hiddenField = document.getElementById('ksic-code');
      
      if (!code) {
        display.value = '';
        nameDisplay.textContent = '';
        hiddenField.value = '';
        return;
      }
      
      // 5ìë¦¬ë¡œ íŒ¨ë”©
      const paddedCode = code.padEnd(5, '0');
      display.value = paddedCode;
      hiddenField.value = paddedCode;
      
      // ì—…ì¢…ëª… ì°¾ê¸°
      const item = ksicData.find(i => i.code === code);
      if (item) {
        nameDisplay.textContent = item.name;
      } else {
        nameDisplay.textContent = '';
      }
    }
    
    // ì €ì¥ëœ KSIC ì½”ë“œë¡œ ë“œë¡­ë‹¤ìš´ ì„¤ì •
    function setKsicFromCode(fullCode) {
      if (!fullCode || fullCode.length < 2) return;
      
      // 2ìë¦¬ ì½”ë“œ ì„¤ì •
      const code2 = fullCode.substring(0, 2);
      const select2 = document.getElementById('ksic-level-2');
      if (select2) {
        select2.value = code2;
        onKsicLevel2Change();
      }
      
      // 3ìë¦¬ ì½”ë“œ ì„¤ì •
      if (fullCode.length >= 3) {
        const code3 = fullCode.substring(0, 3);
        setTimeout(() => {
          const select3 = document.getElementById('ksic-level-3');
          if (select3 && !select3.disabled) {
            // code3ì´ ì˜µì…˜ì— ìˆëŠ”ì§€ í™•ì¸
            const hasOption = Array.from(select3.options).some(o => o.value === code3);
            if (hasOption) {
              select3.value = code3;
              onKsicLevel3Change();
            }
          }
          
          // 4ìë¦¬ ì½”ë“œ ì„¤ì •
          if (fullCode.length >= 4) {
            const code4 = fullCode.substring(0, 4);
            setTimeout(() => {
              const select4 = document.getElementById('ksic-level-4');
              if (select4 && !select4.disabled) {
                const hasOption = Array.from(select4.options).some(o => o.value === code4);
                if (hasOption) {
                  select4.value = code4;
                  onKsicLevel4Change();
                }
              }
              
              // 5ìë¦¬ ì½”ë“œ ì„¤ì •
              if (fullCode.length >= 5) {
                const code5 = fullCode.substring(0, 5);
                setTimeout(() => {
                  const select5 = document.getElementById('ksic-level-5');
                  if (select5 && !select5.disabled) {
                    const hasOption = Array.from(select5.options).some(o => o.value === code5);
                    if (hasOption) {
                      select5.value = code5;
                      onKsicLevel5Change();
                    }
                  }
                }, 100);
              }
            }, 100);
          }
        }, 100);
      }
    }
    let lastMatchedPrograms = []; // ë§ì¶¤ì°¾ê¸° ê²°ê³¼ ì €ì¥ (ìš”ì•½/ìƒì„¸ë¶„ì„ì— ì‚¬ìš©)
    let lastCompanyData = null; // ë§ˆì§€ë§‰ ê²€ìƒ‰ ê¸°ì—… ë°ì´í„°
    let lastDetailResults = []; // PDF ìƒì„¸ë¶„ì„ ê²°ê³¼ ì €ì¥ (programId ê¸°ë°˜)
    let lastSummaryResults = []; // AI ìš”ì•½ë¶„ì„ ê²°ê³¼ ì €ì¥ (programId ê¸°ë°˜)
    let accessToken = localStorage.getItem('driveAccessToken') || null;
    let currentUser = null;
    
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
    const SCOPES = 'https://www.googleapis.com/auth/drive';
    
    // ==================== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ====================
    
    /**
     * KSIC ëŒ€ë¶„ë¥˜ ì„ íƒ ì‹œ ì½”ë“œ ì—…ë°ì´íŠ¸
     */
    function updateKsicCode() {
      const select = document.getElementById('ksic-select');
      const ksic1 = document.getElementById('ksic-1');
      const ksic2 = document.getElementById('ksic-2');
      
      if (select && select.value && ksic1 && ksic2) {
        // ì„ íƒëœ ê°’ì„ ì²« 2ìë¦¬ì— ìë™ ì…ë ¥
        const code = select.value;
        ksic1.value = code[0] || '';
        ksic2.value = code[1] || '';
        
        // hidden í•„ë“œë„ ì—…ë°ì´íŠ¸
        updateKsicHiddenField();
        
        // 3ë²ˆì§¸ ì…ë ¥ì°½ìœ¼ë¡œ í¬ì»¤ìŠ¤
        document.getElementById('ksic-3').focus();
      }
    }
    
    /**
     * KSIC ì½”ë“œ 5ìë¦¬ ê°œë³„ ì…ë ¥ ì²˜ë¦¬
     */
    function handleKsicInput(input, position) {
      // ìˆ«ìë§Œ í—ˆìš©
      input.value = input.value.replace(/[^0-9]/g, '');
      
      // ê°’ì´ ì…ë ¥ë˜ë©´ ë‹¤ìŒ ì¹¸ìœ¼ë¡œ ìë™ ì´ë™
      if (input.value && position < 5) {
        const nextInput = document.getElementById(`ksic-${position + 1}`);
        if (nextInput) {
          nextInput.focus();
        }
      }
      
      // hidden í•„ë“œ ì—…ë°ì´íŠ¸
      updateKsicHiddenField();
    }
    
    /**
     * í¬ë§ ì§€ì›ë¶„ì•¼ "ì „ì²´" ì„ íƒ ì‹œ ëª¨ë“  í•­ëª© ì²´í¬/í•´ì œ
     */
    function toggleAllSupport(isChecked) {
      const supportIds = [
        'support-finance',
        'support-tech', 
        'support-manpower',
        'support-export',
        'support-domestic',
        'support-startup',
        'support-management',
        'support-etc'
      ];
      
      supportIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.checked = isChecked;
      });
    }
    
    /**
     * KSIC ì²« ë²ˆì§¸ ì…ë ¥ì¹¸ í¬ì»¤ìŠ¤ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€
     * (ê³ ê°ì‚¬ ë¡œë“œ ì¤‘ì—ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ)
     */
    let isLoadingCompany = false;
    
    function showKsicWarning() {
      // ê³ ê°ì‚¬ ë¡œë“œ ì¤‘ì´ë©´ ê²½ê³  í‘œì‹œ ì•ˆ í•¨
      if (isLoadingCompany) return;
      
      const hasShownWarning = sessionStorage.getItem('ksicWarningShown');
      if (!hasShownWarning) {
        alert('âš ï¸ KSIC ì½”ë“œëŠ” AI ë¶„ì„ì— ê°€ì¥ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤!\n\ní•´ë‹¹ ê¸°ì—…ì˜ ì •í™•í•œ ì—…ì¢… ì½”ë“œ 5ìë¦¬ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\nì •í™•í•œ ì½”ë“œë¥¼ ëª¨ë¥´ì‹œë©´ ğŸ” ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.');
        sessionStorage.setItem('ksicWarningShown', 'true');
      }
    }
    
    /**
     * KSIC ê²€ìƒ‰ ì‚¬ì´íŠ¸ ì—´ê¸° (í†µê³„ì²­ ê³µì‹)
     */
    function openKsicSearch() {
      // í†µê³„ì²­ í•œêµ­í‘œì¤€ì‚°ì—…ë¶„ë¥˜ ê²€ìƒ‰ í˜ì´ì§€ (ì§ì ‘ ì ‘ê·¼)
      window.open('https://kssc.kostat.go.kr:8443/ksscNew_web/kssc/common/ClassificationContent.do?gubun=1&strCategoryNameCode=001&categoryMenu=007&addGubun=no', '_blank');
    }
    
    /**
     * ìˆ«ìë§Œ ì…ë ¥ í—ˆìš©
     */
    function allowOnlyNumbers(input) {
      input.value = input.value.replace(/[^0-9]/g, '');
    }
    
    /**
     * ìµœëŒ€ ê¸¸ì´ ë„ë‹¬ ì‹œ ìë™ í¬ì»¤ìŠ¤ ì´ë™
     */
    function moveFocusOnMaxLength(current, nextId, maxLength) {
      if (current.value.length >= maxLength) {
        const nextElement = document.getElementById(nextId);
        if (nextElement) nextElement.focus();
      }
    }
    
    /**
     * ì—…ë ¥ ê³„ì‚° ë° í‘œì‹œ
     */
    function calculateBusinessAge() {
      const dateInput = document.getElementById('establish-date');
      const displaySpan = document.getElementById('business-age-display');
      
      if (!dateInput || !dateInput.value || !displaySpan) return;
      
      const foundedDate = new Date(dateInput.value);
      const today = new Date();
      
      let years = today.getFullYear() - foundedDate.getFullYear();
      let months = today.getMonth() - foundedDate.getMonth();
      
      if (months < 0) {
        years--;
        months += 12;
      }
      
      if (years < 0) {
        displaySpan.textContent = '';
        return;
      }
      
      if (years === 0) {
        displaySpan.textContent = `(${months}ê°œì›”)`;
      } else if (months === 0) {
        displaySpan.textContent = `(${years}ë…„)`;
      } else {
        displaySpan.textContent = `(${years}ë…„ ${months}ê°œì›”)`;
      }
    }
    
    /**
     * ì†ì‹¤ ì²´í¬ í† ê¸€
     */
    function toggleProfitSign() {
      const checkbox = document.getElementById('profit-loss');
      const input = document.getElementById('profit-recent');
      
      if (!input) return;
      
      // ìˆ«ìë§Œ ì¶”ì¶œ (ì½¤ë§ˆ, ë§ˆì´ë„ˆìŠ¤ ì œê±°)
      let value = input.value.replace(/[^0-9]/g, '');
      
      // ì½¤ë§ˆ í¬ë§·íŒ…
      if (value) {
        value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      }
      
      // ì†ì‹¤ ì²´í¬ ì‹œ ë§ˆì´ë„ˆìŠ¤ ì¶”ê°€
      if (checkbox && checkbox.checked && value) {
        input.value = '-' + value;
        input.style.color = '#ff6b6b';
      } else if (value) {
        input.value = value;
        input.style.color = '#333';
      }
    }
    
    /**
     * ì˜ì—…ì´ìµ ì…ë ¥ í¬ë§·
     */
    function formatProfitInput(input) {
      const checkbox = document.getElementById('profit-loss');
      let value = input.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ
      
      // ì½¤ë§ˆ í¬ë§·íŒ…
      if (value) {
        value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      }
      
      if (checkbox && checkbox.checked && value) {
        input.value = '-' + value;
        input.style.color = '#ff6b6b';
      } else {
        input.value = value;
        input.style.color = '#333';
      }
    }
    
    /**
     * ì†Œìˆ˜ì  ì…ë ¥ í¬ë§· (ë¶€ì±„ë¹„ìœ¨ ë“±)
     */
    function formatDecimalInput(input) {
      let value = input.value.replace(/[^0-9.]/g, '');
      
      // ì†Œìˆ˜ì  í•˜ë‚˜ë§Œ í—ˆìš©
      const parts = value.split('.');
      if (parts.length > 2) {
        value = parts[0] + '.' + parts.slice(1).join('');
      }
      
      input.value = value;
    }
    
    // ==================== í…ŒìŠ¤íŠ¸ ë°ì´í„° (Phase 1) ====================
    const MOCK_COMPANIES = [
      {
        name: 'ì‚¼ì„±ì „ì(ì£¼)',
        businessNumber: '124-81-00998',
        ceo: 'í•œì¢…í¬',
        openingDate: '1969-01-13',
        industryCode: 'C26',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ìˆ˜ì›ì‹œ',
        revenue: '300000000000',
        employeeCount: '120000'
      },
      {
        name: 'LGì „ì(ì£¼)',
        businessNumber: '107-86-14075',
        ceo: 'ì¡°ì£¼ì™„',
        openingDate: '1958-10-01',
        industryCode: 'C26',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ì„œìš¸',
        locationSigungu: 'ì˜ë“±í¬êµ¬',
        revenue: '70000000000',
        employeeCount: '70000'
      },
      {
        name: 'í˜„ëŒ€ìë™ì°¨(ì£¼)',
        businessNumber: '101-81-42555',
        ceo: 'ì¥ì¬í›ˆ',
        openingDate: '1967-12-29',
        industryCode: 'C30',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ì„œìš¸',
        locationSigungu: 'ì„œì´ˆêµ¬',
        revenue: '130000000000',
        employeeCount: '75000'
      },
      {
        name: 'SKí•˜ì´ë‹‰ìŠ¤(ì£¼)',
        businessNumber: '120-81-62902',
        ceo: 'ê³½ë…¸ì •',
        openingDate: '1983-02-15',
        industryCode: 'C26',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ì´ì²œì‹œ',
        revenue: '40000000000',
        employeeCount: '35000'
      },
      {
        name: 'ë„¤ì´ë²„(ì£¼)',
        businessNumber: '220-81-62517',
        ceo: 'ìµœìˆ˜ì—°',
        openingDate: '1999-06-02',
        industryCode: 'J63',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ì„±ë‚¨ì‹œ',
        revenue: '8000000000',
        employeeCount: '4000'
      },
      {
        name: 'ì¹´ì¹´ì˜¤(ì£¼)',
        businessNumber: '120-81-47521',
        ceo: 'í™ì€íƒ',
        openingDate: '2006-02-16',
        industryCode: 'J63',
        companySize: 'ëŒ€ê¸°ì—…',
        companyType: 'ë²•ì¸',
        locationSido: 'ê²½ê¸°',
        locationSigungu: 'ì„±ë‚¨ì‹œ',
        revenue: '6000000000',
        employeeCount: '3500'
      }
    ];
    
    // ==================== ê¸°ì—…ë§ˆë‹¹ API ì—°ë™ ====================
    /**
     * ì‹¤ì œ ì§€ì›ì‚¬ì—… ë°ì´í„°ë¥¼ ê¸°ì—…ë§ˆë‹¹ APIì—ì„œ ê°€ì ¸ì˜´
     */
    let bizInfoPrograms = []; // APIì—ì„œ ê°€ì ¸ì˜¨ ì‹¤ì œ ë°ì´í„°
    let bizInfoLoaded = false;
    
    /**
     * ê¸°ì—…ë§ˆë‹¹ APIì—ì„œ ì§€ì›ì‚¬ì—… ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
     */
    async function fetchBizInfoPrograms() {
      if (bizInfoLoaded && bizInfoPrograms.length > 0) {
        console.log('ğŸ“¦ ìºì‹œëœ ë°ì´í„° ì‚¬ìš©:', bizInfoPrograms.length, 'ê°œ');
        return bizInfoPrograms;
      }
      
      try {
        console.log('ğŸ“¡ ê¸°ì—…ë§ˆë‹¹ API í˜¸ì¶œ ì¤‘...');
        
        // Firebase Functionsë¥¼ í†µí•´ ê¸°ì—…ë§ˆë‹¹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const getBizInfoPrograms = functions.httpsCallable('getBizInfoPrograms');
        const result = await getBizInfoPrograms();
        const data = result.data;
        
        if (data.success && data.programs) {
          bizInfoPrograms = data.programs;
          bizInfoLoaded = true;
          console.log('âœ… ê¸°ì—…ë§ˆë‹¹ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', bizInfoPrograms.length, 'ê°œ ê³µê³ ');
          console.log('ğŸ“Š ë¶„ì•¼ë³„:', data.stats?.byCategory);
          return bizInfoPrograms;
        } else {
          throw new Error(data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }
      } catch (error) {
        console.error('âŒ ê¸°ì—…ë§ˆë‹¹ API ì˜¤ë¥˜:', error);
        throw error;
      }
    }
    
    // ==================== ì‚­ì œëœ MOCK_PROGRAMS ====================
    // ê¸°ì¡´ í•˜ë“œì½”ë”© ë°ì´í„°ëŠ” ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.
    // ì´ì œ fetchBizInfoPrograms()ë¡œ ì‹¤ì œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    
    // ==================== Google API ì´ˆê¸°í™” ====================
    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
      // KSIC ë°ì´í„° ë¡œë“œ
      loadKsicData();
    }
    
    async function initializeGapiClient() {
      await gapi.client.init({
        discoveryDocs: [DISCOVERY_DOC],
      });
      gapiInited = true;
      console.log('âœ… GAPI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
      maybeEnableButtons();
    }
    
    // Google Identity Services ì´ˆê¸°í™”
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: handleTokenResponse,
      });
      gisInited = true;
      console.log('âœ… GIS í† í° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
      maybeEnableButtons();
    }
    
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        console.log('âœ… Google API ì¤€ë¹„ ì™„ë£Œ');
        // ìë™ ë¡œê·¸ì¸ì€ auth.onAuthStateChangedì—ì„œ ì²˜ë¦¬
      }
    }
    
    // í† í° ì‘ë‹µ ì²˜ë¦¬
    async function handleTokenResponse(resp) {
      if (resp.error !== undefined) {
        console.error('âŒ í† í° íšë“ ì‹¤íŒ¨:', resp);
        alert('Google ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        
        // Promise ê±°ë¶€ (requestDriveAccessì—ì„œ catch ê°€ëŠ¥)
        if (window._tokenPromiseReject) {
          window._tokenPromiseReject(resp.error);
        }
        return;
      }
      
      accessToken = resp.access_token;
      localStorage.setItem('driveAccessToken', accessToken);
      console.log('ğŸ”‘ Access Token íšë“ ë° ì €ì¥ ì„±ê³µ');
      
      // Promise ì´í–‰ (requestDriveAccessì—ì„œ await ê°€ëŠ¥)
      if (window._tokenPromiseResolve) {
        window._tokenPromiseResolve(accessToken);
      }
      
      // Google API í´ë¼ì´ì–¸íŠ¸ì— í† í° ì„¤ì •
      gapi.client.setToken({ access_token: accessToken });
      
      // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      try {
        const userInfo = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
          headers: { Authorization: `Bearer ${accessToken}` }
        }).then(res => res.json());
        
        currentUser = userInfo;
        console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', userInfo.email);
      } catch (e) {
        console.error('ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      
      // ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ í™”ë©´ í‘œì‹œ
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      
      // Google Driveì—ì„œ ë°ì´í„° ë¡œë“œ
      try {
        await loadFromDrive();
        updateConnectionStatus('connected');
        console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', Object.keys(savedCompanies).length, 'ê°œ ê¸°ì—…');
      } catch (error) {
        console.error('Drive ë¡œë“œ ì‹¤íŒ¨:', error);
        updateConnectionStatus('disconnected');
      }
      
      // ìˆ«ì í¬ë§·íŒ… í™œì„±í™”
      attachNumberFormatting();
    }
    
    // Google ë¡œê·¸ì¸
    async function signInWithGoogle() {
      try {
        console.log('ğŸ” Google ë¡œê·¸ì¸ ì‹œì‘...');
        
        // ê¸°ì¡´ í† í° ì´ˆê¸°í™”
        localStorage.removeItem('driveAccessToken');
        accessToken = null;
        
        // Firebase Auth ë¡œê·¸ì¸ (Drive ê¶Œí•œ í¬í•¨)
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('https://www.googleapis.com/auth/drive');
        provider.addScope('https://www.googleapis.com/auth/drive.file');
        
        const result = await auth.signInWithPopup(provider);
        console.log('âœ… Firebase ë¡œê·¸ì¸ ì„±ê³µ:', result.user.email);
        
        // Firebase credentialì—ì„œ ì§ì ‘ access token íšë“
        const credential = result.credential;
        if (credential && credential.accessToken) {
          accessToken = credential.accessToken;
          localStorage.setItem('driveAccessToken', accessToken);
          console.log('ğŸ”‘ Firebase credentialì—ì„œ Access Token íšë“ ì„±ê³µ');
          
          // GAPI í´ë¼ì´ì–¸íŠ¸ì— í† í° ì„¤ì •
          if (gapiInited && gapi.client) {
            gapi.client.setToken({ access_token: accessToken });
            console.log('ğŸ”‘ GAPI í´ë¼ì´ì–¸íŠ¸ì— í† í° ì„¤ì • ì™„ë£Œ');
          }
        } else {
          console.log('âš ï¸ Firebase credentialì—ì„œ í† í°ì„ ë°›ì§€ ëª»í•¨, GISë¡œ ì¬ì‹œë„...');
          // GISë¥¼ í†µí•´ í† í° ìš”ì²­
          try {
            await requestDriveAccess();
            console.log('ğŸ”‘ GISì—ì„œ Access Token íšë“ ì„±ê³µ');
          } catch (e) {
            console.error('âŒ GIS í† í° íšë“ ì‹¤íŒ¨:', e);
          }
        }
        
        currentUser = { email: result.user.email };
        
        // ë¡œê·¸ì¸ í™”ë©´ ë° ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ í™”ë©´ í‘œì‹œ
        const authLoadingScreen = document.getElementById('auth-loading-screen');
        if (authLoadingScreen) authLoadingScreen.style.display = 'none';
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        
        // Google Driveì—ì„œ ë°ì´í„° ë¡œë“œ
        try {
          await loadFromDrive();
          updateConnectionStatus('connected');
          console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', Object.keys(savedCompanies).length, 'ê°œ ê¸°ì—…');
        } catch (error) {
          console.error('Drive ë¡œë“œ ì‹¤íŒ¨:', error);
          updateConnectionStatus('disconnected');
        }
        
        // ìˆ«ì í¬ë§·íŒ… í™œì„±í™”
        attachNumberFormatting();
        
      } catch (error) {
        console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
        alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }
    
    // Google ë¡œê·¸ì•„ì›ƒ
    async function signOut() {
      try {
        // GIS í† í° ì·¨ì†Œ
        if (accessToken) {
          google.accounts.oauth2.revoke(accessToken, () => {
            console.log('âœ… GIS í† í° ì·¨ì†Œ ì™„ë£Œ');
          });
        }
        
        // Firebase ë¡œê·¸ì•„ì›ƒ
        await auth.signOut();
        
        accessToken = null;
        localStorage.removeItem('driveAccessToken');
        currentUser = null;
        savedCompanies = {};
        
        gapi.client.setToken(null);
        
        document.getElementById('main-content').style.display = 'none';
        document.getElementById('login-screen').style.display = 'flex';
        
        console.log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
      }
    }
    
    // Drive ê¶Œí•œ ìš”ì²­ (í•„ìš”ì‹œ íŒì—…)
    async function requestDriveAccess() {
      if (accessToken) {
        return accessToken; // ì´ë¯¸ í† í° ìˆìŒ
      }
      
      if (!gisInited) {
        throw new Error('GISê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
      }
      
      console.log('ğŸ” Drive ê¶Œí•œ ìš”ì²­ ì¤‘...');
      
      // Promiseë¡œ ê°ì‹¸ê¸°
      return new Promise((resolve, reject) => {
        window._tokenPromiseResolve = resolve;
        window._tokenPromiseReject = reject;
        
        // GIS íŒì—… ë„ìš°ê¸°
        tokenClient.requestAccessToken({ prompt: '' }); // prompt: '' = ìë™ (ì´ì „ ì„ íƒ ê¸°ì–µ)
      });
    }
    
    // Google Driveì— ì €ì¥
    async function saveToDrive(data) {
      try {
        // Access Token ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìš”ì²­
        if (!accessToken) {
          console.log('ğŸ” Drive ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤...');
          try {
            await requestDriveAccess();
          } catch (error) {
            console.error('âŒ Drive ê¶Œí•œ íšë“ ì‹¤íŒ¨:', error);
            alert('Google Drive ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            return false;
          }
        }
        
        console.log('ğŸ’¾ Google Driveì— ì €ì¥ ì¤‘...');
        
        // ë°ì´í„° ì•”í˜¸í™” (ê¸°ì—… ì •ë³´ë§Œ ì €ì¥, í¬ë ˆë”§ì€ Firestoreì—ì„œ ê´€ë¦¬)
        const encryptedData = encryptData(data);
        
        // ê¸°ì¡´ íŒŒì¼ ê²€ìƒ‰ (ë£¨íŠ¸ í´ë”)
        const searchResponse = await gapi.client.drive.files.list({
          q: "name='kfpc-bizinfo-data.json' and trashed=false",
          fields: 'files(id, name)',
        });
        
        // ì•ˆì „í•œ null ì²´í¬
        const files = searchResponse?.result?.files || [];
        const fileContent = JSON.stringify({ encryptedData, timestamp: new Date().toISOString() });
        const file = new Blob([fileContent], { type: 'application/json' });
        
        if (files && files.length > 0) {
          // ê¸°ì¡´ íŒŒì¼ ì—…ë°ì´íŠ¸
          const fileId = files[0].id;
          const form = new FormData();
          form.append('metadata', new Blob([JSON.stringify({})], { type: 'application/json' }));
          form.append('file', file);
          
          const updateResponse = await fetch(
            `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`,
            {
              method: 'PATCH',
              headers: { Authorization: `Bearer ${accessToken}` },
              body: form,
            }
          );
          
          if (updateResponse.ok) {
            console.log('âœ… Drive ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            return true;
          }
        } else {
          // ìƒˆ íŒŒì¼ ìƒì„± (ë£¨íŠ¸ í´ë”)
          const metadata = {
            name: 'kfpc-bizinfo-data.json',
            mimeType: 'application/json',
          };
          
          const form = new FormData();
          form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
          form.append('file', file);
          
          const createResponse = await fetch(
            'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
            {
              method: 'POST',
              headers: { Authorization: `Bearer ${accessToken}` },
              body: form,
            }
          );
          
          if (createResponse.ok) {
            console.log('âœ… Drive ì €ì¥ ì™„ë£Œ');
            return true;
          }
        }
        
        return false;
      } catch (error) {
        console.error('âŒ Drive ì €ì¥ ì‹¤íŒ¨:', error);
        return false;
      }
    }
    
    // Google Driveì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadFromDrive() {
      try {
        // Access Token ì—†ìœ¼ë©´ ì¡°ìš©íˆ ìŠ¤í‚µ (ìµœì´ˆ ë¡œê·¸ì¸ ì‹œ)
        if (!accessToken) {
          console.log('â„¹ï¸ Drive ê¶Œí•œ ì—†ìŒ (ë‚˜ì¤‘ì— ì €ì¥ ì‹œ ìš”ì²­ë¨)');
          return false;
        }
        
        console.log('ğŸ“¥ Google Driveì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        
        // GAPI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” í™•ì¸
        if (!gapiInited || !gapi.client) {
          console.log('âš ï¸ GAPI í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ, ì´ˆê¸°í™” ì‹œë„...');
          await initGapi();
        }
        
        // Drive API ë¡œë“œ í™•ì¸
        if (!gapi.client.drive) {
          console.log('âš ï¸ Drive API ë¡œë“œ ì¤‘...');
          await gapi.client.load('drive', 'v3');
        }
        
        // GAPI í´ë¼ì´ì–¸íŠ¸ì— í† í° ì„¤ì •
        gapi.client.setToken({ access_token: accessToken });
        
        const searchResponse = await gapi.client.drive.files.list({
          q: "name='kfpc-bizinfo-data.json' and trashed=false",
          fields: 'files(id, name)',
        });
        
        // ì•ˆì „í•œ null ì²´í¬
        if (!searchResponse || !searchResponse.result) {
          console.log('ğŸ“ Drive ì‘ë‹µ ì—†ìŒ');
          return false;
        }
        
        const files = searchResponse.result.files;
        if (!files || files.length === 0) {
          console.log('ğŸ“ ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤ (ìƒˆë¡œìš´ ì‚¬ìš©ì)');
          return false;
        }
        
        const fileId = files[0].id;
        const getResponse = await fetch(
          `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
          {
            headers: { Authorization: `Bearer ${accessToken}` },
          }
        );
        
        // 401 ì—ëŸ¬ ì²˜ë¦¬ (í† í° ë§Œë£Œ)
        if (getResponse.status === 401) {
          console.log('âš ï¸ Access Token ë§Œë£Œ, í† í° ê°±ì‹  ì‹œë„...');
          localStorage.removeItem('driveAccessToken');
          accessToken = null;
          
          // í† í° ê°±ì‹  ì‹œë„
          try {
            await requestDriveAccess();
            // í† í° ê°±ì‹  í›„ ì¬ì‹œë„
            return await loadFromDrive();
          } catch (e) {
            console.error('âŒ í† í° ê°±ì‹  ì‹¤íŒ¨, ì¬ë¡œê·¸ì¸ í•„ìš”');
            updateConnectionStatus('disconnected', false);
            alert('Google Drive ì—°ê²°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\në¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            return false;
          }
        }
        
        if (getResponse.ok) {
          const fileData = await getResponse.json();
          const decryptedData = decryptData(fileData.encryptedData);
          
          if (decryptedData) {
            // í•˜ìœ„ í˜¸í™˜ì„±: ìƒˆ í˜•ì‹(companies í¬í•¨)ì´ë©´ companiesë§Œ ì¶”ì¶œ
            if (decryptedData.companies) {
              savedCompanies = decryptedData.companies;
            } else {
              savedCompanies = decryptedData;
            }
            
            updateCompanySelect();
            console.log('âœ… Drive ë¡œë“œ ì™„ë£Œ:', Object.keys(savedCompanies).length, 'ê°œ ê³ ê°ì‚¬');
            return true;
          }
        }
        
        return false;
      } catch (error) {
        console.error('âŒ Drive ë¡œë“œ ì‹¤íŒ¨:', error);
        
        // 401 ê´€ë ¨ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
        if (error.status === 401 || (error.result && error.result.error && error.result.error.code === 401)) {
          console.log('âš ï¸ ì¸ì¦ ì˜¤ë¥˜ - í† í° ì´ˆê¸°í™”');
          localStorage.removeItem('driveAccessToken');
          accessToken = null;
          updateConnectionStatus('disconnected');
        }
        
        return false;
      }
    }
    
    // ==================== AES-256 ì•”í˜¸í™” ====================
    
    // AES-256 ì•”í˜¸í™” í‚¤ (ì•± ê³ ìœ  í‚¤)
    const ENCRYPTION_KEY = 'KFPC-BizInfo-2025-AES256-SecureKey';
    
    let savedCompanies = {};

    // ì•”í˜¸í™” í•¨ìˆ˜
    function encryptData(data) {
      return CryptoJS.AES.encrypt(JSON.stringify(data), ENCRYPTION_KEY).toString();
    }
    
    // ë³µí˜¸í™” í•¨ìˆ˜
    function decryptData(encryptedData) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedData, ENCRYPTION_KEY);
        return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
      } catch (e) {
        console.error('ë³µí˜¸í™” ì‹¤íŒ¨:', e);
        return null;
      }
    }
    
    // ==================== ìˆ«ì í¬ë§·íŒ… ====================
    function formatNumber(value) {
      if (!value) return '';
      
      // ë§ˆì´ë„ˆìŠ¤ ë¶€í˜¸ í™•ì¸
      const isNegative = String(value).trim().startsWith('-');
      
      // ìˆ«ìë§Œ ì¶”ì¶œ
      const numStr = String(value).replace(/[^\d]/g, '');
      if (!numStr) return '';
      
      // ì½¤ë§ˆ ì¶”ê°€
      const formatted = numStr.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      
      // ë§ˆì´ë„ˆìŠ¤ ë³µì›
      return isNegative ? '-' + formatted : formatted;
    }
    
    function unformatNumber(value) {
      if (!value) return '';
      // ì½¤ë§ˆ ì œê±°í•˜ê³  ìˆœìˆ˜ ìˆ«ìë§Œ ë°˜í™˜
      return String(value).replace(/,/g, '');
    }
    
    function attachNumberFormatting() {
      // ëª¨ë“  ìˆ«ì ì…ë ¥ í•„ë“œ ID ëª©ë¡ (ì†Œìˆ˜ì  í•„ë“œ ì œì™¸)
      const numberFields = [
        // Section 3: ì¬ë¬´ ì •ë³´
        'revenue-recent',
        // Section 4: ê³ ìš© ì •ë³´
        'employees-total', 'employees-youth', 
        'employees-female', 'employees-disabled', 'employment-growth',
        // Section 5: ê¸°ìˆ  ì •ë³´
        'patents-registered',
        // Section 6: ìˆ˜ì¶œ ì •ë³´
        'export-recent'
      ];
      
      numberFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          // typeì„ textë¡œ ë³€ê²½í•˜ê³  inputmode ì¶”ê°€
          field.type = 'text';
          field.setAttribute('inputmode', 'numeric');
          
          // input ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ í¬ë§·íŒ…
          field.addEventListener('input', function(e) {
            const cursorPos = this.selectionStart;
            const oldLength = this.value.length;
            
            // í¬ë§·íŒ… ì ìš©
            const formatted = formatNumber(this.value);
            this.value = formatted;
            
            // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
            const newLength = formatted.length;
            const lengthDiff = newLength - oldLength;
            
            // ìˆ«ì ì…ë ¥ ì¤‘ ì½¤ë§ˆê°€ ì¶”ê°€ë˜ë©´ ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
            if (lengthDiff > 0 && cursorPos < newLength) {
              this.setSelectionRange(cursorPos + lengthDiff, cursorPos + lengthDiff);
            } else {
              this.setSelectionRange(cursorPos, cursorPos);
            }
          });
          
          // blur ì´ë²¤íŠ¸ë¡œ ìµœì¢… í¬ë§·íŒ…
          field.addEventListener('blur', function() {
            this.value = formatNumber(this.value);
          });
        }
      });
      
      console.log('âœ… ìˆ«ì í•„ë“œ ì‹¤ì‹œê°„ ì½¤ë§ˆ í¬ë§·íŒ… í™œì„±í™” (' + numberFields.length + 'ê°œ í•„ë“œ)');
    }

    async function initializeApp() {
      try {
        console.log('ğŸš€ ì•± ì´ˆê¸°í™”');
        
        // ì—°ê²° ìƒíƒœ ë²„íŠ¼ ì´ˆê¸°í™”
        updateConnectionStatus('connecting');
        
        // GAPI ë¡œë“œ
        gapiLoaded();
        
        // GIS ë¡œë“œ
        gisLoaded();
        
        // Firebase ì¸ì¦ ìƒíƒœ í™•ì¸ (ìë™ ë¡œê·¸ì¸)
        auth.onAuthStateChanged(async (user) => {
          const authLoadingScreen = document.getElementById('auth-loading-screen');
          const authStatusText = document.getElementById('auth-status-text');
          
          if (user) {
            console.log('âœ… Firebase ì„¸ì…˜ ìœ ì§€:', user.email);
            
            // ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            if (authStatusText) {
              authStatusText.textContent = 'ë°ì´í„° ë¡œë”© ì¤‘...';
            }
            
            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
            currentUser = { email: user.email };
            
            // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ë©”ì¸ í™”ë©´ í‘œì‹œ
            if (authLoadingScreen) authLoadingScreen.style.display = 'none';
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            
            // ìˆ«ì í¬ë§·íŒ… í™œì„±í™”
            attachNumberFormatting();
            
            // â˜… í•µì‹¬: Firebaseì—ì„œ ìƒˆë¡œìš´ Access Token ìë™ ë°œê¸‰ (íŒì—… ì—†ìŒ!)
            try {
              // Firebase Authì—ì„œ credential ì¬ë°œê¸‰ ì‹œë„
              const credential = firebase.auth.GoogleAuthProvider.credential(
                await user.getIdToken(true)
              );
              
              // reauthenticateWithCredentialì€ access tokenì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ
              // ì €ì¥ëœ í† í°ìœ¼ë¡œ ì‹œë„ í›„, ì‹¤íŒ¨í•˜ë©´ ì¡°ìš©íˆ ì¬ì¸ì¦ ìš”ì²­
              if (accessToken) {
                console.log('ğŸ”‘ ì €ì¥ëœ í† í°ìœ¼ë¡œ ì—°ê²° ì‹œë„...');
                gapi.client.setToken({ access_token: accessToken });
                
                try {
                  await loadFromDrive();
                  updateConnectionStatus('connected');
                  console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', Object.keys(savedCompanies).length, 'ê°œ ê¸°ì—…');
                  hideLoading();
                  return;
                } catch (error) {
                  console.log('âš ï¸ ì €ì¥ëœ í† í° ë§Œë£Œë¨ - ì¬ì—°ê²° í•„ìš”');
                  accessToken = null;
                  localStorage.removeItem('driveAccessToken');
                }
              }
              
              // í† í°ì´ ì—†ê±°ë‚˜ ë§Œë£Œë˜ì—ˆìœ¼ë©´ ê³„ì • ì„ íƒ íŒì—… í‘œì‹œ
              if (!accessToken && gisInited) {
                console.log('ğŸ”‘ Drive ì—°ê²°ì„ ìœ„í•´ ê³„ì • ì„ íƒ í•„ìš”...');
                updateConnectionStatus('disconnected', false); // ìë™ ì¬ì—°ê²° íŒì—… ë°©ì§€ (ì•„ë˜ì„œ ì§ì ‘ ì²˜ë¦¬)
                
                // ì‚¬ìš©ìì—ê²Œ ì—°ê²° í•„ìš” ì•Œë¦¼ í›„ ê³„ì • ì„ íƒ íŒì—…
                setTimeout(() => {
                  if (confirm('Google Drive ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nê³„ì •ì„ ì„ íƒí•˜ì—¬ ì—°ê²°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    tokenClient.requestAccessToken({ prompt: 'select_account' });
                  } else {
                    hideLoading();
                  }
                }, 500);
                
                return new Promise((resolve) => {
                  window._tokenPromiseResolve = async () => {
                    try {
                      await loadFromDrive();
                      updateConnectionStatus('connected', false);
                      console.log('âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', Object.keys(savedCompanies).length, 'ê°œ ê¸°ì—…');
                    } catch (error) {
                      console.error('Drive ë¡œë“œ ì‹¤íŒ¨:', error);
                      updateConnectionStatus('disconnected', false);
                    }
                    hideLoading();
                    resolve();
                  };
                  window._tokenPromiseReject = () => {
                    console.log('âš ï¸ ì—°ê²° ì·¨ì†Œë¨');
                    updateConnectionStatus('disconnected', false);
                    hideLoading();
                    resolve();
                  };
                });
              }
              
              hideLoading();
              
            } catch (error) {
              console.log('âš ï¸ ìë™ í† í° ë°œê¸‰ ì‹¤íŒ¨:', error.message);
              updateConnectionStatus('disconnected'); // ìë™ ì¬ì—°ê²° íŒì—… í—ˆìš©
              hideLoading();
            }
          } else {
            console.log('âš ï¸ ë¡œê·¸ì¸ í•„ìš”');
            updateConnectionStatus('disconnected', false); // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œí•˜ë¯€ë¡œ íŒì—… ë¶ˆí•„ìš”
            
            // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
            if (authLoadingScreen) authLoadingScreen.style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-content').style.display = 'none';
            hideLoading();
          }
        });
        
      } catch (error) {
        console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        updateConnectionStatus('error');
        hideLoading();
      }
    }
    
    /**
     * ì—°ê²° ìƒíƒœ ë²„íŠ¼ ì—…ë°ì´íŠ¸
     */
    function updateConnectionStatus(status, autoReconnect = true) {
      const btn = document.getElementById('connection-status-btn');
      if (!btn) return;
      
      switch(status) {
        case 'connecting':
          btn.innerHTML = '<span style="font-size: 0.9rem;">â³</span> ì—°ê²° ì¤‘...';
          btn.style.background = '#6c757d';
          btn.style.color = '#fff';
          btn.style.cursor = 'default';
          break;
        case 'connected':
          btn.innerHTML = '<span style="font-size: 0.9rem;">âœ“</span> ì—°ê²°ë¨';
          btn.style.background = '#28a745';
          btn.style.color = '#fff';
          btn.style.cursor = 'default';
          break;
        case 'disconnected':
        case 'no-data':
        case 'error':
          btn.innerHTML = '<span style="font-size: 0.9rem;">âœ—</span> ë¯¸ì—°ê²°';
          btn.style.background = '#dc3545';
          btn.style.color = '#fff';
          btn.style.cursor = 'pointer';
          
          // ë¯¸ì—°ê²° ì‹œ ìë™ìœ¼ë¡œ ê³„ì • ì„ íƒ íŒì—… (ì¤‘ë³µ ë°©ì§€)
          if (autoReconnect && gisInited && !window._reconnectInProgress) {
            window._reconnectInProgress = true;
            setTimeout(() => {
              if (confirm('Google Drive ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nê³„ì •ì„ ì„ íƒí•˜ì—¬ ì—°ê²°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window._tokenPromiseResolve = async () => {
                  try {
                    await loadFromDrive();
                    updateConnectionStatus('connected', false);
                    console.log('âœ… ì¬ì—°ê²° ì„±ê³µ');
                  } catch (error) {
                    console.error('ì¬ì—°ê²° ì‹¤íŒ¨:', error);
                  }
                  window._reconnectInProgress = false;
                };
                window._tokenPromiseReject = () => {
                  console.log('ì—°ê²° ì·¨ì†Œë¨');
                  window._reconnectInProgress = false;
                };
                tokenClient.requestAccessToken({ prompt: 'select_account' });
              } else {
                window._reconnectInProgress = false;
              }
            }, 300);
          }
          break;
      }
    }
    
    /**
     * Drive ì—°ê²° (ë¯¸ì—°ê²° ë²„íŠ¼ í´ë¦­ ì‹œ)
     */
    async function connectDrive() {
      const btn = document.getElementById('connection-status-btn');
      
      // ì´ë¯¸ ì—°ê²°ëœ ìƒíƒœë©´ ë¬´ì‹œ
      if (accessToken) {
        console.log('âœ… ì´ë¯¸ ì—°ê²°ë¨');
        return;
      }
      
      // ì—°ê²° ì¤‘ ìƒíƒœë¡œ ë³€ê²½
      updateConnectionStatus('connecting');
      
      try {
        // Drive ê¶Œí•œ ìš”ì²­
        await requestDriveAccess();
        
        // Drive ë°ì´í„° ë¡œë“œ
        await loadFromDrive();
        
        // ì—°ê²° ì„±ê³µ
        updateConnectionStatus('connected');
        console.log('âœ… Drive ì—°ê²° ì„±ê³µ:', Object.keys(savedCompanies).length, 'ê°œ ê¸°ì—…');
        
      } catch (error) {
        console.error('âŒ Drive ì—°ê²° ì‹¤íŒ¨:', error);
        updateConnectionStatus('disconnected', false); // ì´ë¯¸ alert í‘œì‹œí•˜ë¯€ë¡œ íŒì—… ë¶ˆí•„ìš”
        alert('Drive ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }
    
    function hideLoading() {
      const loading = document.getElementById('loading-screen');
      loading.classList.add('hide');
      setTimeout(() => loading.style.display = 'none', 300);
    }
    
    // ... (rest of the code - showSavingIndicator, hideSavingIndicator, collectFormData, etc.) ...
    
    /**
     * ì €ì¥ ì¤‘ í‘œì‹œ (ì¦‰ì‹œ í”¼ë“œë°±)
     */
    function showSavingIndicator(message = 'ì €ì¥ ì¤‘...') {
      // ê¸°ì¡´ í‘œì‹œê°€ ìˆìœ¼ë©´ ì œê±°
      hideSavingIndicator();
      
      const indicator = document.createElement('div');
      indicator.id = 'saving-indicator';
      indicator.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 1.5rem 2.5rem;
        border-radius: 16px;
        z-index: 99999;
        display: flex;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        font-size: 1rem;
        font-weight: 600;
      `;
      indicator.innerHTML = `
        <div style="width: 24px; height: 24px; border: 3px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
        <span>${message}</span>
      `;
      
      // ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
      if (!document.getElementById('saving-spinner-style')) {
        const style = document.createElement('style');
        style.id = 'saving-spinner-style';
        style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
        document.head.appendChild(style);
      }
      
      document.body.appendChild(indicator);
    }
    
    /**
     * ì €ì¥ ì¤‘ í‘œì‹œ ì œê±°
     */
    function hideSavingIndicator() {
      const indicator = document.getElementById('saving-indicator');
      if (indicator) {
        indicator.remove();
      }
    }
    
    function collectFormData() {
      // ì•ˆì „í•œ ê°’ ê°€ì ¸ì˜¤ê¸° í—¬í¼ í•¨ìˆ˜
      const getVal = (id) => document.getElementById(id)?.value || '';
      const getNumVal = (id) => unformatNumber(document.getElementById(id)?.value || '');
      const getChecked = (selector) => {
        const elements = document.querySelectorAll(selector);
        return elements ? Array.from(elements).filter(el => el.checked).map(el => el.value) : [];
      };
      
      // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ 3ê°œ input í•©ì¹˜ê¸°
      const bizNum1 = getVal('business-number-1');
      const bizNum2 = getVal('business-number-2');
      const bizNum3 = getVal('business-number-3');
      const businessNumber = bizNum1 && bizNum2 && bizNum3 ? `${bizNum1}-${bizNum2}-${bizNum3}` : '';
      
      // ëª¨ë“  ì…ë ¥ í•„ë“œ ë°ì´í„° ìˆ˜ì§‘
      const data = {
        // Section 1: ê¸°ì—… ê¸°ë³¸ì •ë³´
        companyName: getVal('company-name'),
        businessNumber: businessNumber,
        establishDate: getVal('establish-date'),
        companySize: getVal('company-size'),
        companyType: getVal('company-type'),
        businessStatus: getVal('business-status'),
        ksicCode: getVal('ksic-code'),
        productKeywords: [getVal('product-1'), getVal('product-2'), getVal('product-3'), getVal('product-4')].filter(Boolean).join(', '),
        locationSido: getVal('location-sido'),
        locationSigungu: getVal('location-sigungu'),
        industrialComplex: getVal('industrial-complex'),
        capitalArea: getVal('capital-area'),
        
        // Section 2: ëŒ€í‘œì ì •ë³´
        ceoBirth: getVal('ceo-birth'),
        ceoGender: getVal('ceo-gender'),
        
        // Section 3: ì¬ë¬´ ë° ì‹ ìš©ì •ë³´
        revenueRecent: getNumVal('revenue-recent'),
        profitRecent: getNumVal('profit-recent'),
        debtRatio: getNumVal('debt-ratio'),
        taxArrears: getVal('tax-arrears'),
        localTaxArrears: getVal('local-tax-arrears'),
        insuranceArrears: getVal('insurance-arrears'),
        capitalErosion: getVal('capital-erosion'),
        bankruptcyHistory: getVal('bankruptcy-history'),
        tcbRating: getVal('tcb-rating'),
        
        // Section 4: ê³ ìš© ì •ë³´
        employeesTotal: getNumVal('employees-total'),
        employeesYouth: getNumVal('employees-youth'),
        employeesFemale: getNumVal('employees-female'),
        employeesDisabled: getNumVal('employees-disabled'),
        employmentGrowth: getNumVal('employment-growth'),
        
        // Section 5: ê¸°ìˆ  ë° ì¸ì¦ ì •ë³´
        certVenture: getVal('cert-venture'),
        certInnobiz: getVal('cert-innobiz'),
        certMainbiz: getVal('cert-mainbiz'),
        certWoman: getVal('cert-woman'),
        certDisabled: getVal('cert-disabled'),
        certSocial: getVal('cert-social'),
        esgStatus: getVal('esg-status'),
        researchOrg: getVal('research-org'),
        patentsRegistered: getNumVal('patents-registered'),
        
        // Section 6: ìˆ˜ì¶œ ì •ë³´
        exportRecent: getNumVal('export-recent'),
        exportCountries: getVal('export-countries'),
        
        // Section 7: í¬ë§ ì§€ì›ë¶„ì•¼
        supportNeeds: getChecked('#support-finance, #support-tech, #support-manpower, #support-export, #support-domestic, #support-startup, #support-management, #support-etc, #support-all')
      };
      
      return data;
    }
    
    // í˜„ì¬ ì •ë ¬ ìƒíƒœ
    let currentSortType = 'name';
    let currentModalSortType = 'name'; // ëª¨ë‹¬ ì •ë ¬ íƒ€ì…
    let selectedCompanyId = null;
    
    function updateCompanySelect() {
      const select = document.getElementById('company-select');
      select.innerHTML = '<option value="">-- ìƒˆë¡œ ì…ë ¥ --</option>';
      
      Object.keys(savedCompanies).forEach(id => {
        const company = savedCompanies[id];
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `${company.companyName} (${company.companySize})`;
        select.appendChild(option);
      });
    }
    
    function formatDate(dateStr) {
      try {
        const date = new Date(dateStr);
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${month}.${day}`;
      } catch {
        return '';
      }
    }
    
    function selectCompanyFromList(companyId) {
      selectedCompanyId = companyId;
      
      // ë“œë¡­ë‹¤ìš´ë„ ë™ê¸°í™”
      document.getElementById('company-select').value = companyId;
      
      // í¼ì— ë°ì´í„° ë¡œë“œ
      loadSelectedCompany();
    }
    
    // ==================== ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ====================
    
    function openCompanyListModal() {
      const modal = document.getElementById('company-list-modal');
      modal.style.display = 'block';
      document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ë°©ì§€
      
      // ESC í‚¤ ì´ë²¤íŠ¸ ì¶”ê°€
      const escHandler = (e) => {
        if (e.key === 'Escape') {
          closeCompanyListModal();
        }
      };
      document.addEventListener('keydown', escHandler);
      modal._escHandler = escHandler; // ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´ ì €ì¥
      
      // ëª¨ë‹¬ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      renderModalCompanyList();
    }
    
    function closeCompanyListModal() {
      const modal = document.getElementById('company-list-modal');
      modal.style.display = 'none';
      document.body.style.overflow = 'auto'; // ìŠ¤í¬ë¡¤ ë³µì›
      
      // ESC í‚¤ ì´ë²¤íŠ¸ ì œê±°
      if (modal._escHandler) {
        document.removeEventListener('keydown', modal._escHandler);
        modal._escHandler = null;
      }
      
      // ê²€ìƒ‰ì–´ ì´ˆê¸°í™”
      document.getElementById('modal-company-search').value = '';
    }
    
    /**
     * ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ - Google Drive ì¬ì—°ê²°
     */
    async function refreshDriveConnection() {
      try {
        // ë¡œë”© í‘œì‹œ
        const refreshBtn = event.target.closest('button');
        const originalText = refreshBtn.innerHTML;
        refreshBtn.innerHTML = 'â³ ì—°ê²° ì¤‘...';
        refreshBtn.disabled = true;
        
        // ê¸°ì¡´ í† í° ì œê±°
        accessToken = null;
        localStorage.removeItem('driveAccessToken');
        
        // GISë¥¼ í†µí•´ ìƒˆë¡œìš´ í† í° ìš”ì²­ (ê³„ì • ì„ íƒ íŒì—…)
        if (gisInited && tokenClient) {
          tokenClient.requestAccessToken({ prompt: 'select_account' });
          
          // í† í° íšë“ í›„ ì½œë°±
          window._tokenPromiseResolve = async () => {
            try {
              await loadFromDrive();
              updateConnectionStatus('connected');
              renderModalCompanyList();
              
              // ì„±ê³µ ì•Œë¦¼
              alert('âœ… Google Drive ì—°ê²° ì„±ê³µ!\n\n' + Object.keys(savedCompanies).length + 'ê°œ ê³ ê°ì‚¬ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
            } catch (error) {
              console.error('Drive ë¡œë“œ ì‹¤íŒ¨:', error);
              alert('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨\n\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
            
            // ë²„íŠ¼ ë³µì›
            refreshBtn.innerHTML = originalText;
            refreshBtn.disabled = false;
          };
          
          window._tokenPromiseReject = () => {
            console.log('âš ï¸ ì—°ê²° ì·¨ì†Œë¨');
            refreshBtn.innerHTML = originalText;
            refreshBtn.disabled = false;
          };
        } else {
          alert('âš ï¸ Google ì¸ì¦ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
          refreshBtn.innerHTML = originalText;
          refreshBtn.disabled = false;
        }
        
      } catch (error) {
        console.error('ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
        alert('âŒ ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' + error.message);
      }
    }
    
    function renderModalCompanyList() {
      const listContainer = document.getElementById('modal-company-list');
      const searchTerm = document.getElementById('modal-company-search')?.value?.toLowerCase() || '';
      
      // ê¸°ì—… ëª©ë¡ ë°°ì—´ë¡œ ë³€í™˜
      let companies = Object.keys(savedCompanies).map(id => ({
        id: id,
        ...savedCompanies[id]
      }));
      
      // ê²€ìƒ‰ í•„í„°
      if (searchTerm) {
        companies = companies.filter(c => 
          c.companyName?.toLowerCase().includes(searchTerm)
        );
      }
      
      // ì •ë ¬
      if (currentModalSortType === 'name') {
        companies.sort((a, b) => (a.companyName || '').localeCompare(b.companyName || '', 'ko'));
      } else if (currentModalSortType === 'date') {
        companies.sort((a, b) => {
          const dateA = a.savedAt ? new Date(a.savedAt) : new Date(0);
          const dateB = b.savedAt ? new Date(b.savedAt) : new Date(0);
          return dateB - dateA;
        });
      }
      
      // ëª©ë¡ì´ ë¹„ì–´ìˆìœ¼ë©´
      if (companies.length === 0) {
        listContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.6);">' + 
          (searchTerm ? 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤' : 'ì €ì¥ëœ ê³ ê°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤') + 
          '</div>';
        return;
      }
      
      // ëª©ë¡ ë Œë”ë§
      listContainer.innerHTML = companies.map(company => {
        const isSelected = selectedCompanyId === company.id;
        const savedDate = company.savedAt ? formatDateFull(company.savedAt) : '';
        const meta = [company.companySize, company.ksicCode].filter(Boolean).join(' Â· ');
        
        return `
          <div style="
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: ${isSelected ? 'rgba(255,210,127,0.2)' : 'rgba(255,255,255,0.05)'};
            border: 1px solid ${isSelected ? 'rgba(255,210,127,0.5)' : 'rgba(255,255,255,0.1)'};
            border-radius: 8px;
            transition: all 0.2s;
          ">
            <div style="display: flex; justify-content: space-between; align-items: start; gap: 0.5rem;">
              <div onclick="selectCompanyFromModal('${company.id}')" style="flex: 1; min-width: 0; cursor: pointer;" onmouseover="this.parentElement.parentElement.style.background='rgba(255,255,255,0.15)'" onmouseout="this.parentElement.parentElement.style.background='${isSelected ? 'rgba(255,210,127,0.2)' : 'rgba(255,255,255,0.05)'}'">
                <div style="font-weight: 600; font-size: 0.95rem; color: ${isSelected ? '#ffd27f' : 'white'}; margin-bottom: 0.3rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                  ${company.companyName || '(ì´ë¦„ì—†ìŒ)'}
                </div>
                <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                  ${meta || 'ì •ë³´ ì—†ìŒ'} ${savedDate ? 'Â· ' + savedDate : ''}
                </div>
              </div>
              <button onclick="event.stopPropagation(); deleteCompanyFromModal('${company.id}', '${(company.companyName || '').replace(/'/g, "\\'")}');" style="
                padding: 0.4rem 0.6rem;
                background: rgba(255,100,100,0.2);
                border: 1px solid rgba(255,100,100,0.5);
                border-radius: 6px;
                color: #ffaaaa;
                font-size: 0.75rem;
                cursor: pointer;
                white-space: nowrap;
                transition: all 0.2s;
              " onmouseover="this.style.background='rgba(255,100,100,0.4)'" onmouseout="this.style.background='rgba(255,100,100,0.2)'">
                ğŸ—‘ï¸ ì‚­ì œ
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function formatDateFull(dateStr) {
      try {
        const date = new Date(dateStr);
        const year = date.getFullYear().toString().slice(2);
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}.${month}.${day}`;
      } catch {
        return '';
      }
    }
    
    function selectCompanyFromModal(companyId) {
      selectedCompanyId = companyId;
      
      // íšŒì‚¬ëª… í‘œì‹œ
      const company = savedCompanies[companyId];
      if (company) {
        document.getElementById('company-name-search').value = company.companyName;
      }
      
      // ë“œë¡­ë‹¤ìš´ë„ ë™ê¸°í™”
      document.getElementById('company-select').value = companyId;
      
      // í¼ì— ë°ì´í„° ë¡œë“œ
      loadSelectedCompany();
      
      // ëª¨ë‹¬ ë‹«ê¸°
      closeCompanyListModal();
    }
    
    /**
     * ëª¨ë‹¬ì—ì„œ ê³ ê°ì‚¬ ì‚­ì œ
     */
    async function deleteCompanyFromModal(companyId, companyName) {
      if (!confirm(`"${companyName}" ê³ ê°ì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // ë¡œì»¬ ê°ì²´ì—ì„œ ì‚­ì œ
        delete savedCompanies[companyId];
        
        // Google Driveì— ì €ì¥ (ì‚­ì œ ë°˜ì˜)
        const success = await saveToDrive(savedCompanies);
        
        if (!success) {
          throw new Error('Google Drive ì €ì¥ ì‹¤íŒ¨');
        }
        
        // í˜„ì¬ ì„ íƒëœ íšŒì‚¬ì¸ ê²½ìš° í¼ ì´ˆê¸°í™”
        if (selectedCompanyId === companyId) {
          selectedCompanyId = null;
          clearForm();
          document.getElementById('company-name-search').value = '';
        }
        
        // ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§
        renderModalCompanyList();
        updateCompanySelect();
        
        // ì—°ê²° ìƒíƒœëŠ” í•­ìƒ connected (Drive ì—°ê²° ìœ ì§€)
        updateConnectionStatus('connected');
        
        console.log('âœ… ê³ ê°ì‚¬ ì‚­ì œ ì™„ë£Œ:', companyName);
      } catch (error) {
        console.error('âŒ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }
    
    function sortModalList(type) {
      currentModalSortType = type;
      
      // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
      const nameBtn = document.getElementById('modal-sort-name');
      const dateBtn = document.getElementById('modal-sort-date');
      
      if (type === 'name') {
        nameBtn.classList.add('active');
        dateBtn.classList.remove('active');
        nameBtn.style.background = 'rgba(255,255,255,0.2)';
        dateBtn.style.background = 'rgba(255,255,255,0.1)';
      } else {
        nameBtn.classList.remove('active');
        dateBtn.classList.add('active');
        nameBtn.style.background = 'rgba(255,255,255,0.1)';
        dateBtn.style.background = 'rgba(255,255,255,0.2)';
      }
      
      renderModalCompanyList();
    }
    
    function filterModalList() {
      renderModalCompanyList();
    }
    
    function searchCompany() {
      const searchInput = document.getElementById('company-name-search').value.trim();
      
      if (!searchInput) {
        alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì €ì¥ëœ ê³ ê°ì‚¬ ì¤‘ ê²€ìƒ‰
      const found = Object.keys(savedCompanies).find(id => 
        savedCompanies[id].companyName?.toLowerCase() === searchInput.toLowerCase()
      );
      
      if (found) {
        selectCompanyFromModal(found);
      } else {
        alert(`"${searchInput}"ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nëª©ë¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥ëœ ê³ ê°ì‚¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
      }
    }
    
    // ==================== ê¸°ì¡´ í•¨ìˆ˜ ====================
    
    function loadSelectedCompany() {
      const companyId = selectedCompanyId || document.getElementById('company-select').value;
      
      if (!companyId) {
        clearForm();
        return;
      }
      
      const company = savedCompanies[companyId];
      if (!company) return;
      
      // ë¡œë”© ì¤‘ í”Œë˜ê·¸ ì„¤ì • (KSIC ê²½ê³  ë°©ì§€)
      isLoadingCompany = true;
      
      // ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ë¶„ë¦¬ (123-45-67890 â†’ 3ê°œ input)
      if (company.businessNumber) {
        const bizParts = company.businessNumber.split('-');
        if (bizParts.length === 3) {
          document.getElementById('business-number-1').value = bizParts[0];
          document.getElementById('business-number-2').value = bizParts[1];
          document.getElementById('business-number-3').value = bizParts[2];
        }
      }
      
      // ìˆ«ì í•„ë“œ ëª©ë¡
      const numberFieldKeys = [
        'revenueRecent', 'profitRecent', 'debtRatio',
        'employeesTotal', 'employeesYouth', 
        'employeesFemale', 'employeesDisabled', 'employmentGrowth',
        'patentsRegistered', 'exportRecent'
      ];
      
      // ëª¨ë“  í•„ë“œì— ë°ì´í„° ë¡œë“œ
      Object.keys(company).forEach(key => {
        // businessNumberëŠ” ì´ë¯¸ ì²˜ë¦¬, corpNumberëŠ” ì‚­ì œëœ í•„ë“œì´ë¯€ë¡œ ìŠ¤í‚µ
        if (key === 'businessNumber' || key === 'corpNumber') return;
        
        const element = document.getElementById(key.replace(/([A-Z])/g, '-$1').toLowerCase());
        if (element) {
          if (element.type === 'checkbox') {
            element.checked = company[key].includes(element.value);
          } else if (element.type === 'radio') {
            if (element.value === company[key]) element.checked = true;
          } else {
            // ìˆ«ì í•„ë“œëŠ” ì½¤ë§ˆ ì¶”ê°€
            if (numberFieldKeys.includes(key)) {
              element.value = formatNumber(company[key]);
            } else {
              element.value = company[key];
            }
          }
        }
      });
      
      // ì£¼ë ¥ì œí’ˆ ë¶„ë¦¬ ë¡œë“œ
      if (company.productKeywords) {
        const products = company.productKeywords.split(',').map(p => p.trim());
        for (let i = 0; i < 4; i++) {
          const el = document.getElementById('product-' + (i + 1));
          if (el) el.value = products[i] || '';
        }
      }
      
      // ì˜ì—…ì´ìµ ì†ì‹¤ ì²´í¬ë°•ìŠ¤ ì„¤ì •
      if (company.profitRecent) {
        const profitCheckbox = document.getElementById('profit-loss');
        const profitInput = document.getElementById('profit-recent');
        if (profitCheckbox && profitInput) {
          const isLoss = String(company.profitRecent).startsWith('-');
          profitCheckbox.checked = isLoss;
          if (isLoss) {
            profitInput.style.color = '#ff6b6b';
          } else {
            profitInput.style.color = '#333';
          }
        }
      }
      
      // ì—…ë ¥ ê³„ì‚° í‘œì‹œ
      if (company.establishDate) {
        calculateBusinessAge();
      }
      
      // KSIC ì½”ë“œ ê³„ì¸µí˜• ë“œë¡­ë‹¤ìš´ì— ë¡œë“œ
      if (company.ksicCode) {
        const code = String(company.ksicCode).padStart(5, '0');
        // ê³„ì¸µí˜• ë“œë¡­ë‹¤ìš´ ì„¤ì •
        setTimeout(() => {
          setKsicFromCode(code);
        }, 500); // KSIC ë°ì´í„° ë¡œë“œ í›„ ì„¤ì •
      }
      
      // ì‹œë„ ì„ íƒ í›„ ì‹œêµ°êµ¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
      if (company.locationSido) {
        updateSigunguOptions();
        // ì‹œêµ°êµ¬ ê°’ ì„¤ì • (ì˜µì…˜ ìƒì„± í›„)
        if (company.locationSigungu) {
          document.getElementById('location-sigungu').value = company.locationSigungu;
        }
      }
      
      // í¬ë§ ì§€ì›ë¶„ì•¼ ì²´í¬ë°•ìŠ¤ ë¡œë“œ
      if (company.supportNeeds && Array.isArray(company.supportNeeds)) {
        const checkboxMap = {
          'ê¸ˆìœµ': 'support-finance',
          'ê¸°ìˆ ': 'support-tech',
          'ì¸ë ¥': 'support-manpower',
          'ìˆ˜ì¶œ': 'support-export',
          'ë‚´ìˆ˜': 'support-domestic',
          'ì°½ì—…': 'support-startup',
          'ê²½ì˜': 'support-management',
          'ê¸°íƒ€': 'support-etc',
          'ì „ì²´': 'support-all'
        };